(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const f of l)if(f.type==="childList")for(const _ of f.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&c(_)}).observe(document,{childList:!0,subtree:!0});function t(l){const f={};return l.integrity&&(f.integrity=l.integrity),l.referrerPolicy&&(f.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?f.credentials="include":l.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(l){if(l.ep)return;l.ep=!0;const f=t(l);fetch(l.href,f)}})();var x=0,sr=1,fe=5,dt=10,pt=12,mt=14,ar=21,it=25,Wi=27,ft=100,$i=101,Ki=3338,Qi=3594,Gi=4106,Yi=2570,Xi=1802,Ji=1034,Zi=3850,es=266,wr=522,ts=1546,rs=2058,br=778,Er=1,gt=2,Ke=4,ns=8,is=64,ye=256,ss=512,ve=0,Le=1,ze=2,We=4,as=2048,os=16384,ls=14,Sr=21,kr=31,Tr=32,cs=33,or=1,lr=2,cr=3,ur=4,dr=5,us=2,ds=512,fs=class{name;mxPathname=64;_module;constructor(o,r){this.name=o,this._module=r}close(){}isReady(){return!0}hasAsyncMethod(o){return!1}xOpen(o,r,t,c,l){return mt}xDelete(o,r,t){return x}xAccess(o,r,t,c){return x}xFullPathname(o,r,t,c){return x}xGetLastError(o,r,t){return x}xClose(o){return x}xRead(o,r,t,c,l){return x}xWrite(o,r,t,c,l){return x}xTruncate(o,r,t){return x}xSync(o,r){return x}xFileSize(o,r){return x}xLock(o,r){return x}xUnlock(o,r){return x}xCheckReservedLock(o,r){return x}xFileControl(o,r,t){return pt}xSectorSize(o){return ds}xDeviceCharacteristics(o){return 0}},hs=Object.getPrototypeOf(async function(){}).constructor,_s=class extends fs{constructor(o,r){super(o,r)}hasAsyncMethod(o){const r=`j${o.slice(1)}`;return this[r]instanceof hs}getFilename(o){throw new Error("unimplemented")}jOpen(o,r,t,c){return mt}jDelete(o,r){return x}jAccess(o,r,t){return x}jFullPathname(o,r){const{read:t,written:c}=new TextEncoder().encodeInto(o,r);return t<o.length||c>=r.length?dt:(r[c]=0,x)}jGetLastError(o){return x}jClose(o){return x}jRead(o,r,t){return r.fill(0),wr}jWrite(o,r,t){return br}jTruncate(o,r){return x}jSync(o,r){return x}jFileSize(o,r){return x}jLock(o,r){return x}jUnlock(o,r){return x}jCheckReservedLock(o,r){return r.setInt32(0,0,!0),x}jFileControl(o,r,t){return pt}jSectorSize(o){return super.xSectorSize(o)}jDeviceCharacteristics(o){return 0}xOpen(o,r,t,c,l){const f=this.#e(r,c),_=this.#r("Int32",l);return this.log?.("jOpen",f,t,"0x"+c.toString(16)),this.jOpen(f,t,c,_)}xDelete(o,r,t){const c=this._module.UTF8ToString(r);return this.log?.("jDelete",c,t),this.jDelete(c,t)}xAccess(o,r,t,c){const l=this._module.UTF8ToString(r),f=this.#r("Int32",c);return this.log?.("jAccess",l,t),this.jAccess(l,t,f)}xFullPathname(o,r,t,c){const l=this._module.UTF8ToString(r),f=this._module.HEAPU8.subarray(c,c+t);return this.log?.("jFullPathname",l,t),this.jFullPathname(l,f)}xGetLastError(o,r,t){const c=this._module.HEAPU8.subarray(t,t+r);return this.log?.("jGetLastError",r),this.jGetLastError(c)}xClose(o){return this.log?.("jClose",o),this.jClose(o)}xRead(o,r,t,c,l){const f=this.#t(r,t),_=st(c,l);return this.log?.("jRead",o,t,_),this.jRead(o,f,_)}xWrite(o,r,t,c,l){const f=this.#t(r,t),_=st(c,l);return this.log?.("jWrite",o,f,_),this.jWrite(o,f,_)}xTruncate(o,r,t){const c=st(r,t);return this.log?.("jTruncate",o,c),this.jTruncate(o,c)}xSync(o,r){return this.log?.("jSync",o,r),this.jSync(o,r)}xFileSize(o,r){const t=this.#r("BigInt64",r);return this.log?.("jFileSize",o),this.jFileSize(o,t)}xLock(o,r){return this.log?.("jLock",o,r),this.jLock(o,r)}xUnlock(o,r){return this.log?.("jUnlock",o,r),this.jUnlock(o,r)}xCheckReservedLock(o,r){const t=this.#r("Int32",r);return this.log?.("jCheckReservedLock",o),this.jCheckReservedLock(o,t)}xFileControl(o,r,t){const c=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+t);return this.log?.("jFileControl",o,r,c),this.jFileControl(o,r,c)}xSectorSize(o){return this.log?.("jSectorSize",o),this.jSectorSize(o)}xDeviceCharacteristics(o){return this.log?.("jDeviceCharacteristics",o),this.jDeviceCharacteristics(o)}#r(o,r){return new ms(this._module,r,o)}#t(o,r){return new ps(this._module,o,r)}#e(o,r){if(r&is){let t=o,c=1;const l=[];for(;c;){const f=this._module.HEAPU8[t++];if(f)l.push(f);else switch(this._module.HEAPU8[t]||(c=null),c){case 1:l.push(63),c=2;break;case 2:l.push(61),c=3;break;case 3:l.push(38),c=2;break}}return new TextDecoder().decode(new Uint8Array(l))}return o?this._module.UTF8ToString(o):null}};function st(o,r){return r*4294967296+o+(o<0?2**32:0)}var ps=class{#r;#t=new Uint8Array;get#e(){return this.#t.buffer.byteLength===0&&(this.#t=this.#r.HEAPU8.subarray(this.byteOffset,this.byteOffset+this.byteLength)),this.#t}constructor(o,r,t){this.#r=o,this.byteOffset=r,this.length=this.byteLength=t}get buffer(){return this.#e.buffer}at(o){return this.#e.at(o)}copyWithin(o,r,t){this.#e.copyWithin(o,r,t)}entries(){return this.#e.entries()}every(o){return this.#e.every(o)}fill(o,r,t){this.#e.fill(o,r,t)}filter(o){return this.#e.filter(o)}find(o){return this.#e.find(o)}findIndex(o){return this.#e.findIndex(o)}findLast(o){return this.#e.findLast(o)}findLastIndex(o){return this.#e.findLastIndex(o)}forEach(o){this.#e.forEach(o)}includes(o,r){return this.#e.includes(o,r)}indexOf(o,r){return this.#e.indexOf(o,r)}join(o){return this.#e.join(o)}keys(){return this.#e.keys()}lastIndexOf(o,r){return this.#e.lastIndexOf(o,r)}map(o){return this.#e.map(o)}reduce(o,r){return this.#e.reduce(o,r)}reduceRight(o,r){return this.#e.reduceRight(o,r)}reverse(){this.#e.reverse()}set(o,r){this.#e.set(o,r)}slice(o,r){return this.#e.slice(o,r)}some(o){return this.#e.some(o)}sort(o){this.#e.sort(o)}subarray(o,r){return this.#e.subarray(o,r)}toLocaleString(o,r){return this.#e.toLocaleString(o,r)}toReversed(){return this.#e.toReversed()}toSorted(o){return this.#e.toSorted(o)}toString(){return this.#e.toString()}values(){return this.#e.values()}with(o,r){return this.#e.with(o,r)}[Symbol.iterator](){return this.#e[Symbol.iterator]()}},ms=class{#r;#t;#e=new DataView(new ArrayBuffer(0));get#n(){return this.#e.buffer.byteLength===0&&(this.#e=new DataView(this.#r.HEAPU8.buffer,this.#r.HEAPU8.byteOffset+this.byteOffset)),this.#e}constructor(o,r,t){this.#r=o,this.byteOffset=r,this.#t=t}get buffer(){return this.#n.buffer}get byteLength(){return this.#t==="Int32"?4:8}getInt32(o,r){if(this.#t!=="Int32")throw new Error("invalid type");if(!r)throw new Error("must be little endian");return this.#n.getInt32(o,r)}setInt32(o,r,t){if(this.#t!=="Int32")throw new Error("invalid type");if(!t)throw new Error("must be little endian");this.#n.setInt32(o,r,t)}getBigInt64(o,r){if(this.#t!=="BigInt64")throw new Error("invalid type");if(!r)throw new Error("must be little endian");return this.#n.getBigInt64(o,r)}setBigInt64(o,r,t){if(this.#t!=="BigInt64")throw new Error("invalid type");if(!t)throw new Error("must be little endian");this.#n.setBigInt64(o,r,t)}},fr=0x7fffffffffffffffn,hr=-0x8000000000000000n,at=Object.getPrototypeOf(async function(){}).constructor,Fe=class extends Error{constructor(o,r){super(o),this.code=r}},xe=!0;function gs(o){const r={};o.retryOps=[];const t=o._getSqliteFree(),c=o._malloc(8),l=[c,c+4],f=new TextEncoder;function _(w){if(typeof w!="string")return 0;const g=f.encode(w),y=o._sqlite3_malloc(g.byteLength+1);return o.HEAPU8.set(g,y),o.HEAPU8[y+g.byteLength]=0,y}function p(w,g){return BigInt(g)<<32n|BigInt(w)&0xffffffffn}const b=(function(){const w=BigInt(Number.MAX_SAFE_INTEGER)>>32n,g=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(y,E){return E>w||E<g?p(y,E):E*4294967296+(y&2147483647)-(y&2147483648)}})(),k=new Set;function S(w){if(!k.has(w))throw new Fe("not a database",ar)}const I=new Map;function L(w){if(!I.has(w))throw new Fe("not a statement",ar)}r.bind_collection=function(w,g){L(w);const y=Array.isArray(g),E=r.bind_parameter_count(w);for(let A=1;A<=E;++A){const B=y?A-1:r.bind_parameter_name(w,A),O=g[B];O!==void 0&&r.bind(w,A,O)}return x},r.bind=function(w,g,y){switch(L(w),typeof y){case"number":return y===(y|0)?r.bind_int(w,g,y):r.bind_double(w,g,y);case"string":return r.bind_text(w,g,y);case"boolean":return r.bind_int(w,g,y?1:0);default:return y instanceof Uint8Array||Array.isArray(y)?r.bind_blob(w,g,y):y===null?r.bind_null(w,g):typeof y=="bigint"?r.bind_int64(w,g,y):y===void 0?Wi:(console.warn("unknown binding converted to null",y),r.bind_null(w,g))}},r.bind_blob=(function(){const w="sqlite3_bind_blob",g=o.cwrap(w,...U("nnnnn:n"));return function(y,E,A){L(y);const B=A.byteLength??A.length,O=o._sqlite3_malloc(B);o.HEAPU8.subarray(O).set(A);const Q=g(y,E,O,B,t);return M(w,Q,I.get(y))}})(),r.bind_parameter_count=(function(){const g=o.cwrap("sqlite3_bind_parameter_count",...U("n:n"));return function(y){return L(y),g(y)}})(),r.bind_double=(function(){const w="sqlite3_bind_double",g=o.cwrap(w,...U("nnn:n"));return function(y,E,A){L(y);const B=g(y,E,A);return M(w,B,I.get(y))}})(),r.bind_int=(function(){const w="sqlite3_bind_int",g=o.cwrap(w,...U("nnn:n"));return function(y,E,A){if(L(y),A>2147483647||A<-2147483648)return it;const B=g(y,E,A);return M(w,B,I.get(y))}})(),r.bind_int64=(function(){const w="sqlite3_bind_int64",g=o.cwrap(w,...U("nnnn:n"));return function(y,E,A){if(L(y),A>fr||A<hr)return it;const B=A&0xffffffffn,O=A>>32n,Q=g(y,E,Number(B),Number(O));return M(w,Q,I.get(y))}})(),r.bind_null=(function(){const w="sqlite3_bind_null",g=o.cwrap(w,...U("nn:n"));return function(y,E){L(y);const A=g(y,E);return M(w,A,I.get(y))}})(),r.bind_parameter_name=(function(){const g=o.cwrap("sqlite3_bind_parameter_name",...U("n:s"));return function(y,E){return L(y),g(y,E)}})(),r.bind_text=(function(){const w="sqlite3_bind_text",g=o.cwrap(w,...U("nnnnn:n"));return function(y,E,A){L(y);const B=_(A),O=g(y,E,B,-1,t);return M(w,O,I.get(y))}})(),r.changes=(function(){const g=o.cwrap("sqlite3_changes",...U("n:n"));return function(y){return S(y),g(y)}})(),r.clear_bindings=(function(){const w="sqlite3_clear_bindings",g=o.cwrap(w,...U("n:n"));return function(y){L(y);const E=g(y);return M(w,E,I.get(y))}})(),r.close=(function(){const w="sqlite3_close",g=o.cwrap(w,...U("n:n"),{async:xe});return async function(y){S(y);const E=await g(y);return k.delete(y),M(w,E,y)}})(),r.column=function(w,g){L(w);const y=r.column_type(w,g);switch(y){case ur:return r.column_blob(w,g);case lr:return r.column_double(w,g);case or:const E=r.column_int(w,g),A=o.getTempRet0();return b(E,A);case dr:return null;case cr:return r.column_text(w,g);default:throw new Fe("unknown type",y)}},r.column_blob=(function(){const g=o.cwrap("sqlite3_column_blob",...U("nn:n"));return function(y,E){L(y);const A=r.column_bytes(y,E),B=g(y,E);return o.HEAPU8.subarray(B,B+A)}})(),r.column_bytes=(function(){const g=o.cwrap("sqlite3_column_bytes",...U("nn:n"));return function(y,E){return L(y),g(y,E)}})(),r.column_count=(function(){const g=o.cwrap("sqlite3_column_count",...U("n:n"));return function(y){return L(y),g(y)}})(),r.column_double=(function(){const g=o.cwrap("sqlite3_column_double",...U("nn:n"));return function(y,E){return L(y),g(y,E)}})(),r.column_int=(function(){const g=o.cwrap("sqlite3_column_int64",...U("nn:n"));return function(y,E){return L(y),g(y,E)}})(),r.column_int64=(function(){const g=o.cwrap("sqlite3_column_int64",...U("nn:n"));return function(y,E){L(y);const A=g(y,E),B=o.getTempRet0();return p(A,B)}})(),r.column_name=(function(){const g=o.cwrap("sqlite3_column_name",...U("nn:s"));return function(y,E){return L(y),g(y,E)}})(),r.column_names=function(w){const g=[],y=r.column_count(w);for(let E=0;E<y;++E)g.push(r.column_name(w,E));return g},r.column_text=(function(){const g=o.cwrap("sqlite3_column_text",...U("nn:s"));return function(y,E){return L(y),g(y,E)}})(),r.column_type=(function(){const g=o.cwrap("sqlite3_column_type",...U("nn:n"));return function(y,E){return L(y),g(y,E)}})(),r.create_function=function(w,g,y,E,A,B,O,Q){S(w);function X(q){return q instanceof at?(async($,ie,re)=>q($,o.HEAP32.subarray(re/4,re/4+ie))):(($,ie,re)=>q($,o.HEAP32.subarray(re/4,re/4+ie)))}const Z=o.create_function(w,g,y,E,A,B&&X(B),O&&X(O),Q);return M("sqlite3_create_function",Z,w)},r.data_count=(function(){const g=o.cwrap("sqlite3_data_count",...U("n:n"));return function(y){return L(y),g(y)}})(),r.exec=async function(w,g,y){for await(const E of r.statements(w,g)){let A;for(;await r.step(E)===ft;)if(y){A=A??r.column_names(E);const B=r.row(E);await y(B,A)}}return x},r.finalize=(function(){const g=o.cwrap("sqlite3_finalize",...U("n:n"),{async:xe});return async function(y){const E=await g(y);return I.delete(y),E}})(),r.get_autocommit=(function(){const g=o.cwrap("sqlite3_get_autocommit",...U("n:n"));return function(y){return g(y)}})(),r.libversion=(function(){const g=o.cwrap("sqlite3_libversion",...U(":s"));return function(){return g()}})(),r.libversion_number=(function(){const g=o.cwrap("sqlite3_libversion_number",...U(":n"));return function(){return g()}})(),r.limit=(function(){const g=o.cwrap("sqlite3_limit",...U("nnn:n"));return function(y,E,A){return g(y,E,A)}})(),r.open_v2=(function(){const w="sqlite3_open_v2",g=o.cwrap(w,...U("snnn:n"),{async:xe});return async function(y,E,A){E=E||Ke|gt,A=_(A);try{const B=await P(()=>g(y,l[0],E,A)),O=o.getValue(l[0],"*");return k.add(O),o.ccall("RegisterExtensionFunctions","void",["number"],[O]),M(w,B),O}finally{o._sqlite3_free(A)}}})(),r.progress_handler=function(w,g,y,E){S(w),o.progress_handler(w,g,y,E)},r.reset=(function(){const w="sqlite3_reset",g=o.cwrap(w,...U("n:n"),{async:xe});return async function(y){L(y);const E=await g(y);return M(w,E,I.get(y))}})(),r.result=function(w,g){switch(typeof g){case"number":g===(g|0)?r.result_int(w,g):r.result_double(w,g);break;case"string":r.result_text(w,g);break;default:if(g instanceof Uint8Array||Array.isArray(g))r.result_blob(w,g);else if(g===null)r.result_null(w);else{if(typeof g=="bigint")return r.result_int64(w,g);console.warn("unknown result converted to null",g),r.result_null(w)}break}},r.result_blob=(function(){const g=o.cwrap("sqlite3_result_blob",...U("nnnn:n"));return function(y,E){const A=E.byteLength??E.length,B=o._sqlite3_malloc(A);o.HEAPU8.subarray(B).set(E),g(y,B,A,t)}})(),r.result_double=(function(){const g=o.cwrap("sqlite3_result_double",...U("nn:n"));return function(y,E){g(y,E)}})(),r.result_int=(function(){const g=o.cwrap("sqlite3_result_int",...U("nn:n"));return function(y,E){g(y,E)}})(),r.result_int64=(function(){const g=o.cwrap("sqlite3_result_int64",...U("nnn:n"));return function(y,E){if(E>fr||E<hr)return it;const A=E&0xffffffffn,B=E>>32n;g(y,Number(A),Number(B))}})(),r.result_null=(function(){const g=o.cwrap("sqlite3_result_null",...U("n:n"));return function(y){g(y)}})(),r.result_text=(function(){const g=o.cwrap("sqlite3_result_text",...U("nnnn:n"));return function(y,E){const A=_(E);g(y,A,-1,t)}})(),r.row=function(w){const g=[],y=r.data_count(w);for(let E=0;E<y;++E){const A=r.column(w,E);g.push(A?.buffer===o.HEAPU8.buffer?A.slice():A)}return g},r.set_authorizer=function(w,g,y){S(w);function E(O,Q,X,Z,q,$){return[O,Q,o.UTF8ToString(X),o.UTF8ToString(Z),o.UTF8ToString(q),o.UTF8ToString($)]}function A(O){return O instanceof at?(async(Q,X,Z,q,$,ie)=>O(...E(Q,X,Z,q,$,ie))):((Q,X,Z,q,$,ie)=>O(...E(Q,X,Z,q,$,ie)))}const B=o.set_authorizer(w,A(g),y);return M("sqlite3_set_authorizer",B,w)},r.sql=(function(){const g=o.cwrap("sqlite3_sql",...U("n:s"));return function(y){return L(y),g(y)}})(),r.statements=function(w,g,y={}){const E=o.cwrap("sqlite3_prepare_v3","number",["number","number","number","number","number","number"],{async:!0});return(async function*(){const A=[];try{let O=function(){re&&!y.unscoped&&r.finalize(re),re=0};var B=O;const Q=f.encode(g),X=Q.byteLength-Q.byteLength%4+12,Z=o._sqlite3_malloc(X),q=Z+Q.byteLength+1;A.push(()=>o._sqlite3_free(Z)),o.HEAPU8.set(Q,Z),o.HEAPU8[q-1]=0;const $=Z+X-8,ie=Z+X-4;let re;A.push(O),o.setValue(ie,Z,"*");do{O();const De=o.getValue(ie,"*"),Be=await P(()=>E(w,De,q-ie,y.flags||0,$,ie));Be!==x&&M("sqlite3_prepare_v3",Be,w),re=o.getValue($,"*"),re&&(I.set(re,w),yield re)}while(re)}finally{for(;A.length;)A.pop()()}})()},r.step=(function(){const w="sqlite3_step",g=o.cwrap(w,...U("n:n"),{async:xe});return async function(y){L(y);const E=await P(()=>g(y));return M(w,E,I.get(y),[ft,$i])}})(),r.commit_hook=function(w,g){S(w),o.commit_hook(w,g)},r.update_hook=function(w,g){S(w);function y(A,B,O,Q,X){return[A,o.UTF8ToString(B),o.UTF8ToString(O),p(Q,X)]}function E(A){return A instanceof at?(async(B,O,Q,X,Z)=>A(...y(B,O,Q,X,Z))):((B,O,Q,X,Z)=>A(...y(B,O,Q,X,Z)))}o.update_hook(w,E(g))},r.value=function(w){const g=r.value_type(w);switch(g){case ur:return r.value_blob(w);case lr:return r.value_double(w);case or:const y=r.value_int(w),E=o.getTempRet0();return b(y,E);case dr:return null;case cr:return r.value_text(w);default:throw new Fe("unknown type",g)}},r.value_blob=(function(){const g=o.cwrap("sqlite3_value_blob",...U("n:n"));return function(y){const E=r.value_bytes(y),A=g(y);return o.HEAPU8.subarray(A,A+E)}})(),r.value_bytes=(function(){const g=o.cwrap("sqlite3_value_bytes",...U("n:n"));return function(y){return g(y)}})(),r.value_double=(function(){const g=o.cwrap("sqlite3_value_double",...U("n:n"));return function(y){return g(y)}})(),r.value_int=(function(){const g=o.cwrap("sqlite3_value_int64",...U("n:n"));return function(y){return g(y)}})(),r.value_int64=(function(){const g=o.cwrap("sqlite3_value_int64",...U("n:n"));return function(y){const E=g(y),A=o.getTempRet0();return p(E,A)}})(),r.value_text=(function(){const g=o.cwrap("sqlite3_value_text",...U("n:s"));return function(y){return g(y)}})(),r.value_type=(function(){const g=o.cwrap("sqlite3_value_type",...U("n:n"));return function(y){return g(y)}})(),r.vfs_register=function(w,g){const y=o.vfs_register(w,g);return M("sqlite3_vfs_register",y)};function M(w,g,y=null,E=[x]){if(E.includes(g))return g;const A=y?o.ccall("sqlite3_errmsg","string",["number"],[y]):w;throw new Fe(A,g)}async function P(w){let g;do o.retryOps.length&&(await Promise.all(o.retryOps),o.retryOps=[]),g=await w();while(g&&o.retryOps.length);return g}return r}function U(o){const r=[],t=o.match(/([ns@]*):([nsv@])/);switch(t[2]){case"n":r.push("number");break;case"s":r.push("string");break;case"v":r.push(null);break}const c=[];for(let l of t[1])switch(l){case"n":c.push("number");break;case"s":c.push("string");break}return r.push(c),r}async function ce(o){if(await o!==x)throw new Error(`Error code: ${await o}`)}function ht(){return new DataView(new ArrayBuffer(4))}async function Lr(o,r,t){let c;return o.releaser instanceof FileSystemDirectoryHandle?[c]=await o.getPathComponents(r,t):c=await navigator.storage.getDirectory(),await c.getFileHandle(r,{create:t})}function Ar(o){return"releaser"in o}function ys(o,r,t){const c=[];let l,f;new Promise((k,S)=>{l=k,f=S}).finally(async()=>{for(;c.length;)await c.pop()()});const _=Math.floor(Math.random()*4294967296);let p=0,b=0;return new ReadableStream({async start(k){try{const S=ye|Er;await ce(o.jOpen(r,_,S,ht())),c.push(()=>o.jClose(_)),await ce(o.jLock(_,Le)),c.push(()=>o.jUnlock(_,ve));const I=new DataView(new ArrayBuffer(8));await ce(o.jFileSize(_,I)),b=Number(I.getBigUint64(0,!0))}catch(S){k.error(S),f(S)}},async pull(k){if(b===0){k.close(),l();return}try{const S=Math.min(b,65536),I=new Uint8Array(S);await ce(o.jRead(_,I,p)),k.enqueue(I),p+=S,b-=S,b===0&&(k.close(),l())}catch(S){k.error(S),f(S)}},cancel(k){f(new Error(k))}})}async function vs(o,r){const t=ys(o,r),c=[],l=t.getReader();let f=0;try{for(;;){const{done:b,value:k}=await l.read();if(b)break;c.push(k),f+=k.length}}finally{l.releaseLock()}const _=new Uint8Array(f);let p=0;for(const b of c)_.set(b,p),p+=b.length;return _}async function ws(o,r){return await Lr(o,r).then(t=>t.getFile()).then(t=>t.arrayBuffer()).then(t=>new Uint8Array(t))}async function bs(o,r){return Ar(o)?await ws(o,r):await vs(o,r)}var _r=new Uint8Array([83,81,76,105,116,101,32,102,111,114,109,97,116,32,51,0]);async function Ir(o){const r=await _t(o,32);for(let t=0;t<_r.length;t++)if(r[t]!==_r[t])throw new Error("Not a SQLite database file");return r}async function _t(o,r){const t=new Uint8Array(r);let c=0;if(o.leftover){const l=Math.min(r,o.leftover.length);t.set(o.leftover.subarray(0,l),0),c+=l,l<o.leftover.length?o.leftover=o.leftover.subarray(l):o.leftover=null}for(;c<r;){const{done:l,value:f}=await o.read();if(l){if(c<r)throw new Error(`Unexpected EOF: Expected ${r}, got ${c}`);break}const _=Math.min(r-c,f.length);t.set(f.subarray(0,_),c),c+=_,_<f.length&&(o.leftover=f.subarray(_))}return t}async function*Es(o){const r=o.getReader();try{const t=await Ir(r),c=new DataView(t.buffer),l=c.getUint16(16),f=l===1?65536:l,_=c.getUint32(28),p=await _t(r,f-32),b=new Uint8Array(f);b.set(t),b.set(p,32),yield b;for(let S=1;S<_;S++)yield await _t(r,f);const{done:k}=await r.read();if(!k)throw new Error("Unexpected data after last page")}finally{r.releaseLock()}}async function Ss(o,r,t){const c=[];try{const f=ye|Ke|gt;await ce(o.jOpen(r,1234,f,ht())),c.push(()=>o.jClose(1234)),await ce(o.jLock(1234,Le)),c.push(()=>o.jUnlock(1234,ve)),await ce(o.jLock(1234,ze)),c.push(()=>o.jUnlock(1234,Le)),await ce(o.jLock(1234,We));const _=ht();await o.jFileControl(1234,kr,_),await ce(o.jTruncate(1234,0));let p=0;for await(const b of Es(t))await ce(o.jWrite(1234,b,p)),p+=b.byteLength;await o.jFileControl(1234,Tr,_),await o.jFileControl(1234,Sr,_),await o.jSync(1234,us)}finally{for(;c.length;)await c.pop()()}}async function ks(o,r,t){const c=await Lr(o,r,!0),[l,f]=t.tee(),_=l.getReader();try{await Ir(_)}finally{_.releaseLock()}const p=await c.createWritable();await f.pipeTo(p)}async function qr(o,r,t){const c=t instanceof globalThis.File?t.stream():t;Ar(o)?await ks(o,r,c):await Ss(o,r,c)}function pr(o,r){return{...r,beforeOpen:(t,c)=>qr(t,c,o)}}async function Ts(o){await o.sqlite.close(o.pointer)}function Ls(o){return o.sqliteModule._sqlite3_changes(o.pointer)}function As(o){return o.sqliteModule._sqlite3_last_insert_rowid(o.pointer)}async function Cr(o,r,t,c){const{sqlite:l,pointer:f}=o;for await(const _ of l.statements(f,t)){c&&l.bind_collection(_,c);const p=l.column_names(_);for(;await l.step(_)===ft;){const b=l.row(_);r(Object.fromEntries(p.map((k,S)=>[k,b[S]])))}}}async function Is(o,r,t){const c=[];return await Cr(o,l=>c.push(l),r,t),c}function qs(o){return o?Er:gt|Ke}async function ot(o){const r=await Cs(o);return{...r,changes:()=>Ls(r),close:()=>Ts(r),dump:()=>bs(r.vfs,r.path),lastInsertRowId:()=>As(r),run:(...t)=>Is(r,...t),stream:(...t)=>Cr(r,...t),sync:t=>qr(r.vfs,r.path,t)}}async function Cs(o){const{path:r,sqliteModule:t,vfsFn:c,vfsOptions:l,readonly:f,beforeOpen:_}=await o,p=gs(t),b=await c(r,t,l);p.vfs_register(b,!0),await _?.(b,r);const k=await p.open_v2(r,qs(f));return{db:k,path:r,pointer:k,sqlite:p,sqliteModule:t,vfs:b}}var Ue={mode:"shared"},Rs={ifAvailable:!0,mode:"shared"},mr={ifAvailable:!0,mode:"exclusive"},Ps=["exclusive","shared","shared+hint"],$e=o=>class extends o{#r={lockPolicy:"exclusive",lockTimeout:1/0};#t=new Map;constructor(r,t,c){if(super(r,t,c),Object.assign(this.#r,c),Ps.indexOf(this.#r.lockPolicy)===-1)throw new Error(`WebLocksMixin: invalid lock mode: ${c.lockPolicy}`)}async jLock(r,t){try{const c=this.#e(r);if(t<=c.type)return x;switch(this.#r.lockPolicy){case"exclusive":return await this.#n(c,t);case"shared":case"shared+hint":return await this.#o(c,t)}}catch(c){return console.error("WebLocksMixin: lock error",c),Zi}}async jUnlock(r,t){try{const c=this.#e(r);if(!(t<c.type))return x;switch(this.#r.lockPolicy){case"exclusive":return await this.#s(c,t);case"shared":case"shared+hint":return await this.#l(c,t)}}catch(c){return console.error("WebLocksMixin: unlock error",c),rs}}async jCheckReservedLock(r,t){try{const c=this.#e(r);switch(this.#r.lockPolicy){case"exclusive":return this.#a(c,t);case"shared":case"shared+hint":return await this.#c(c,t)}}catch(c){return console.error("WebLocksMixin: check reserved lock error",c),Qi}return t.setInt32(0,0,!0),x}jFileControl(r,t,c){if(t===$e.WRITE_HINT_OP_CODE&&this.#r.lockPolicy==="shared+hint"){const l=this.#e(r);l.writeHint=!0}return pt}#e(r){let t=this.#t.get(r);return t||(t={baseName:this.getFilename(r),type:ve,writeHint:!1},this.#t.set(r,t)),t}async#n(r,t){if(!r.access){if(!await this.#i(r,"access"))return fe;console.assert(!!r.access)}return r.type=t,x}#s(r,t){return t===ve&&(r.access?.(),console.assert(!r.access)),r.type=t,x}#a(r,t){return t.setInt32(0,0,!0),x}async#o(r,t){switch(r.type){case ve:switch(t){case Le:if(r.writeHint&&!await this.#i(r,"hint"))return fe;if(!await this.#i(r,"gate",Ue))return r.hint?.(),fe;await this.#i(r,"access",Ue),r.gate(),console.assert(!r.gate),console.assert(!!r.access),console.assert(!r.reserved);break;default:throw new Error("unsupported lock transition")}break;case Le:switch(t){case ze:if(this.#r.lockPolicy==="shared+hint"&&!r.hint&&!await this.#i(r,"hint",mr))return fe;if(!await this.#i(r,"reserved",mr))return r.hint?.(),fe;r.access(),console.assert(!r.gate),console.assert(!r.access),console.assert(!!r.reserved);break;case We:if(!await this.#i(r,"gate"))return fe;if(r.access(),!await this.#i(r,"access"))return r.gate(),fe;console.assert(!!r.gate),console.assert(!!r.access),console.assert(!r.reserved);break;default:throw new Error("unsupported lock transition")}break;case ze:switch(t){case We:if(!await this.#i(r,"gate"))return fe;if(!await this.#i(r,"access"))return r.gate(),fe;console.assert(!!r.gate),console.assert(!!r.access),console.assert(!!r.reserved);break;default:throw new Error("unsupported lock transition")}break}return r.type=t,x}async#l(r,t){if(t===ve)r.access?.(),r.gate?.(),r.reserved?.(),r.hint?.(),r.writeHint=!1,console.assert(!r.access),console.assert(!r.gate),console.assert(!r.reserved),console.assert(!r.hint);else switch(r.type){case We:r.access(),await this.#i(r,"access",Ue),r.gate(),r.reserved?.(),r.hint?.(),console.assert(!!r.access),console.assert(!r.gate),console.assert(!r.reserved);break;case ze:await this.#i(r,"access",Ue),r.reserved(),r.hint?.(),console.assert(!!r.access),console.assert(!r.gate),console.assert(!r.reserved);break}return r.type=t,x}async#c(r,t){return await this.#i(r,"reserved",Rs)?(r.reserved(),t.setInt32(0,0,!0)):t.setInt32(0,1,!0),x}#i(r,t,c={}){return console.assert(!r[t]),new Promise(l=>{if(!c.ifAvailable&&this.#r.lockTimeout<1/0){const _=new AbortController;c=Object.assign({},c,{signal:_.signal}),setTimeout(()=>{_.abort(),l?.(!1)},this.#r.lockTimeout)}const f=`lock##${r.baseName}##${t}`;navigator.locks.request(f,c,_=>{if(_)return new Promise(p=>{r[t]=()=>{p(),r[t]=null},l(!0),l=null});r[t]=null,l(!1),l=null}).catch(_=>{if(_.name!=="AbortError")throw _})})}};$e.WRITE_HINT_OP_CODE=-9999;var Fs=(async function(o={}){var r,t=o,c,l,f=new Promise((e,n)=>{c=e,l=n}),_=typeof window=="object",p=typeof WorkerGlobalScope<"u";typeof process=="object"&&process.versions?.node&&process.type!="renderer";var b="./this.program",k=(e,n)=>{throw n},S=import.meta.url,I="";function L(e){return t.locateFile?t.locateFile(e,I):I+e}var M,P;if(_||p){try{I=new URL(".",S).href}catch{}p&&(P=e=>{var n=new XMLHttpRequest;return n.open("GET",e,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),M=async e=>{var n=await fetch(e,{credentials:"same-origin"});if(n.ok)return n.arrayBuffer();throw new Error(n.status+" : "+n.url)}}var w=console.log.bind(console),g=console.error.bind(console),y,E,A=!1,B,O,Q,X,Z,q,$,ie,re;function De(){var e=E.buffer;O=new Int8Array(e),X=new Int16Array(e),t.HEAPU8=Q=new Uint8Array(e),Z=new Uint16Array(e),t.HEAP32=q=new Int32Array(e),$=new Uint32Array(e),ie=new Float32Array(e),re=new Float64Array(e)}function Be(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)zr(t.preRun.shift());wt(Et)}function xr(){!t.noFSInit&&!a.initialized&&a.init(),d.qa(),a.ignorePermissions=!1}function Or(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)Vr(t.postRun.shift());wt(bt)}var _e=0,Ae=null;function yt(e){_e++,t.monitorRunDependencies?.(_e)}function Qe(e){if(_e--,t.monitorRunDependencies?.(_e),_e==0&&Ae){var n=Ae;Ae=null,n()}}function ue(e){t.onAbort?.(e),e="Aborted("+e+")",g(e),A=!0,e+=". Build with -sASSERTIONS for more info.";var n=new WebAssembly.RuntimeError(e);throw l(n),n}var Ge;function Dr(){return t.locateFile?L("wa-sqlite-async.wasm"):new URL("/gioibon/assets/wa-sqlite-async-CTFr_gWm.wasm",import.meta.url).href}function Br(e){if(e==Ge&&y)return new Uint8Array(y);if(P)return P(e);throw"both async and sync fetching of the wasm failed"}async function Nr(e){if(!y)try{var n=await M(e);return new Uint8Array(n)}catch{}return Br(e)}async function Mr(e,n){try{var i=await Nr(e),s=await WebAssembly.instantiate(i,n);return s}catch(u){g(`failed to asynchronously prepare wasm: ${u}`),ue(u)}}async function jr(e,n,i){if(!e&&typeof WebAssembly.instantiateStreaming=="function")try{var s=fetch(n,{credentials:"same-origin"}),u=await WebAssembly.instantiateStreaming(s,i);return u}catch(h){g(`wasm streaming compile failed: ${h}`),g("falling back to ArrayBuffer instantiation")}return Mr(n,i)}function Ur(){return{a:qi}}async function Hr(){function e(h,m){return d=h.exports,d=R.instrumentWasmExports(d),E=d.pa,De(),Ee=d.jf,Qe(),d}yt();function n(h){return e(h.instance)}var i=Ur();if(t.instantiateWasm)return new Promise((h,m)=>{t.instantiateWasm(i,(v,T)=>{h(e(v))})});Ge??=Dr();try{var s=await jr(y,Ge,i),u=n(s);return u}catch(h){return l(h),Promise.reject(h)}}var D,J;class vt{name="ExitStatus";constructor(n){this.message=`Program terminated with exit(${n})`,this.status=n}}var wt=e=>{for(;e.length>0;)e.shift()(t)},bt=[],Vr=e=>bt.push(e),Et=[],zr=e=>Et.push(e);function St(e,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":return O[e];case"i8":return O[e];case"i16":return X[e>>1];case"i32":return q[e>>2];case"i64":ue("to do getValue(i64) use WASM_BIGINT");case"float":return ie[e>>2];case"double":return re[e>>3];case"*":return $[e>>2];default:ue(`invalid type for getValue: ${n}`)}}var Ye=!0;function we(e,n,i="i8"){switch(i.endsWith("*")&&(i="*"),i){case"i1":O[e]=n;break;case"i8":O[e]=n;break;case"i16":X[e>>1]=n;break;case"i32":q[e>>2]=n;break;case"i64":ue("to do setValue(i64) use WASM_BIGINT");case"float":ie[e>>2]=n;break;case"double":re[e>>3]=n;break;case"*":$[e>>2]=n;break;default:ue(`invalid type for setValue: ${i}`)}}var Wr=e=>Di(e),$r=()=>Ni(),kt=new TextDecoder,pe=(e,n)=>{if(!e)return"";for(var i=e+n,s=e;!(s>=i)&&Q[s];)++s;return kt.decode(Q.subarray(e,s))},Kr=(e,n,i,s)=>ue(`Assertion failed: ${pe(e)}, at: `+[n?pe(n):"unknown filename",i,s?pe(s):"unknown function"]),G={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return n.exec(e).slice(1)},normalizeArray:(e,n)=>{for(var i=0,s=e.length-1;s>=0;s--){var u=e[s];u==="."?e.splice(s,1):u===".."?(e.splice(s,1),i++):i&&(e.splice(s,1),i--)}if(n)for(;i;i--)e.unshift("..");return e},normalize:e=>{var n=G.isAbs(e),i=e.slice(-1)==="/";return e=G.normalizeArray(e.split("/").filter(s=>!!s),!n).join("/"),!e&&!n&&(e="."),e&&i&&(e+="/"),(n?"/":"")+e},dirname:e=>{var n=G.splitPath(e),i=n[0],s=n[1];return!i&&!s?".":(s&&(s=s.slice(0,-1)),i+s)},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>G.normalize(e.join("/")),join2:(e,n)=>G.normalize(e+"/"+n)},Qr=()=>e=>crypto.getRandomValues(e),Tt=e=>{(Tt=Qr())(e)},be={resolve:(...e)=>{for(var n="",i=!1,s=e.length-1;s>=-1&&!i;s--){var u=s>=0?e[s]:a.cwd();if(typeof u!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!u)return"";n=u+"/"+n,i=G.isAbs(u)}return n=G.normalizeArray(n.split("/").filter(h=>!!h),!i).join("/"),(i?"/":"")+n||"."},relative:(e,n)=>{e=be.resolve(e).slice(1),n=be.resolve(n).slice(1);function i(C){for(var N=0;N<C.length&&C[N]==="";N++);for(var W=C.length-1;W>=0&&C[W]==="";W--);return N>W?[]:C.slice(N,W-N+1)}for(var s=i(e.split("/")),u=i(n.split("/")),h=Math.min(s.length,u.length),m=h,v=0;v<h;v++)if(s[v]!==u[v]){m=v;break}for(var T=[],v=m;v<s.length;v++)T.push("..");return T=T.concat(u.slice(m)),T.join("/")}},Ie=(e,n=0,i=NaN)=>{for(var s=n+i,u=n;e[u]&&!(u>=s);)++u;return kt.decode(e.buffer?e.subarray(n,u):new Uint8Array(e.slice(n,u)))},Xe=[],me=e=>{for(var n=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s<=127?n++:s<=2047?n+=2:s>=55296&&s<=57343?(n+=4,++i):n+=3}return n},Je=(e,n,i,s)=>{if(!(s>0))return 0;for(var u=i,h=i+s-1,m=0;m<e.length;++m){var v=e.charCodeAt(m);if(v>=55296&&v<=57343){var T=e.charCodeAt(++m);v=65536+((v&1023)<<10)|T&1023}if(v<=127){if(i>=h)break;n[i++]=v}else if(v<=2047){if(i+1>=h)break;n[i++]=192|v>>6,n[i++]=128|v&63}else if(v<=65535){if(i+2>=h)break;n[i++]=224|v>>12,n[i++]=128|v>>6&63,n[i++]=128|v&63}else{if(i+3>=h)break;n[i++]=240|v>>18,n[i++]=128|v>>12&63,n[i++]=128|v>>6&63,n[i++]=128|v&63}}return n[i]=0,i-u},Ze=(e,n,i)=>{var s=i>0?i:me(e)+1,u=new Array(s),h=Je(e,u,0,u.length);return n&&(u.length=h),u},Gr=()=>{if(!Xe.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(e=window.prompt("Input: "),e!==null&&(e+=`
`)),!e)return null;Xe=Ze(e,!0)}return Xe.shift()},ge={ttys:[],init(){},shutdown(){},register(e,n){ge.ttys[e]={input:[],output:[],ops:n},a.registerDevice(e,ge.stream_ops)},stream_ops:{open(e){var n=ge.ttys[e.node.rdev];if(!n)throw new a.ErrnoError(43);e.tty=n,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,n,i,s,u){if(!e.tty||!e.tty.ops.get_char)throw new a.ErrnoError(60);for(var h=0,m=0;m<s;m++){var v;try{v=e.tty.ops.get_char(e.tty)}catch{throw new a.ErrnoError(29)}if(v===void 0&&h===0)throw new a.ErrnoError(6);if(v==null)break;h++,n[i+m]=v}return h&&(e.node.atime=Date.now()),h},write(e,n,i,s,u){if(!e.tty||!e.tty.ops.put_char)throw new a.ErrnoError(60);try{for(var h=0;h<s;h++)e.tty.ops.put_char(e.tty,n[i+h])}catch{throw new a.ErrnoError(29)}return s&&(e.node.mtime=e.node.ctime=Date.now()),h}},default_tty_ops:{get_char(e){return Gr()},put_char(e,n){n===null||n===10?(w(Ie(e.output)),e.output=[]):n!=0&&e.output.push(n)},fsync(e){e.output?.length>0&&(w(Ie(e.output)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,n,i){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,n){n===null||n===10?(g(Ie(e.output)),e.output=[]):n!=0&&e.output.push(n)},fsync(e){e.output?.length>0&&(g(Ie(e.output)),e.output=[])}}},Yr=(e,n)=>Q.fill(0,e,e+n),Lt=(e,n)=>Math.ceil(e/n)*n,At=e=>{e=Lt(e,65536);var n=Fi(65536,e);return n&&Yr(n,e),n},j={ops_table:null,mount(e){return j.createNode(null,"/",16895,0)},createNode(e,n,i,s){if(a.isBlkdev(i)||a.isFIFO(i))throw new a.ErrnoError(63);j.ops_table||={dir:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr,lookup:j.node_ops.lookup,mknod:j.node_ops.mknod,rename:j.node_ops.rename,unlink:j.node_ops.unlink,rmdir:j.node_ops.rmdir,readdir:j.node_ops.readdir,symlink:j.node_ops.symlink},stream:{llseek:j.stream_ops.llseek}},file:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr},stream:{llseek:j.stream_ops.llseek,read:j.stream_ops.read,write:j.stream_ops.write,mmap:j.stream_ops.mmap,msync:j.stream_ops.msync}},link:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr,readlink:j.node_ops.readlink},stream:{}},chrdev:{node:{getattr:j.node_ops.getattr,setattr:j.node_ops.setattr},stream:a.chrdev_stream_ops}};var u=a.createNode(e,n,i,s);return a.isDir(u.mode)?(u.node_ops=j.ops_table.dir.node,u.stream_ops=j.ops_table.dir.stream,u.contents={}):a.isFile(u.mode)?(u.node_ops=j.ops_table.file.node,u.stream_ops=j.ops_table.file.stream,u.usedBytes=0,u.contents=null):a.isLink(u.mode)?(u.node_ops=j.ops_table.link.node,u.stream_ops=j.ops_table.link.stream):a.isChrdev(u.mode)&&(u.node_ops=j.ops_table.chrdev.node,u.stream_ops=j.ops_table.chrdev.stream),u.atime=u.mtime=u.ctime=Date.now(),e&&(e.contents[n]=u,e.atime=e.mtime=e.ctime=u.atime),u},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,n){var i=e.contents?e.contents.length:0;if(!(i>=n)){var s=1024*1024;n=Math.max(n,i*(i<s?2:1.125)>>>0),i!=0&&(n=Math.max(n,256));var u=e.contents;e.contents=new Uint8Array(n),e.usedBytes>0&&e.contents.set(u.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,n){if(e.usedBytes!=n)if(n==0)e.contents=null,e.usedBytes=0;else{var i=e.contents;e.contents=new Uint8Array(n),i&&e.contents.set(i.subarray(0,Math.min(n,e.usedBytes))),e.usedBytes=n}},node_ops:{getattr(e){var n={};return n.dev=a.isChrdev(e.mode)?e.id:1,n.ino=e.id,n.mode=e.mode,n.nlink=1,n.uid=0,n.gid=0,n.rdev=e.rdev,a.isDir(e.mode)?n.size=4096:a.isFile(e.mode)?n.size=e.usedBytes:a.isLink(e.mode)?n.size=e.link.length:n.size=0,n.atime=new Date(e.atime),n.mtime=new Date(e.mtime),n.ctime=new Date(e.ctime),n.blksize=4096,n.blocks=Math.ceil(n.size/n.blksize),n},setattr(e,n){for(const i of["mode","atime","mtime","ctime"])n[i]!=null&&(e[i]=n[i]);n.size!==void 0&&j.resizeFileStorage(e,n.size)},lookup(e,n){throw j.doesNotExistError},mknod(e,n,i,s){return j.createNode(e,n,i,s)},rename(e,n,i){var s;try{s=a.lookupNode(n,i)}catch{}if(s){if(a.isDir(e.mode))for(var u in s.contents)throw new a.ErrnoError(55);a.hashRemoveNode(s)}delete e.parent.contents[e.name],n.contents[i]=e,e.name=i,n.ctime=n.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,n){delete e.contents[n],e.ctime=e.mtime=Date.now()},rmdir(e,n){var i=a.lookupNode(e,n);for(var s in i.contents)throw new a.ErrnoError(55);delete e.contents[n],e.ctime=e.mtime=Date.now()},readdir(e){return[".","..",...Object.keys(e.contents)]},symlink(e,n,i){var s=j.createNode(e,n,41471,0);return s.link=i,s},readlink(e){if(!a.isLink(e.mode))throw new a.ErrnoError(28);return e.link}},stream_ops:{read(e,n,i,s,u){var h=e.node.contents;if(u>=e.node.usedBytes)return 0;var m=Math.min(e.node.usedBytes-u,s);if(m>8&&h.subarray)n.set(h.subarray(u,u+m),i);else for(var v=0;v<m;v++)n[i+v]=h[u+v];return m},write(e,n,i,s,u,h){if(n.buffer===O.buffer&&(h=!1),!s)return 0;var m=e.node;if(m.mtime=m.ctime=Date.now(),n.subarray&&(!m.contents||m.contents.subarray)){if(h)return m.contents=n.subarray(i,i+s),m.usedBytes=s,s;if(m.usedBytes===0&&u===0)return m.contents=n.slice(i,i+s),m.usedBytes=s,s;if(u+s<=m.usedBytes)return m.contents.set(n.subarray(i,i+s),u),s}if(j.expandFileStorage(m,u+s),m.contents.subarray&&n.subarray)m.contents.set(n.subarray(i,i+s),u);else for(var v=0;v<s;v++)m.contents[u+v]=n[i+v];return m.usedBytes=Math.max(m.usedBytes,u+s),s},llseek(e,n,i){var s=n;if(i===1?s+=e.position:i===2&&a.isFile(e.node.mode)&&(s+=e.node.usedBytes),s<0)throw new a.ErrnoError(28);return s},mmap(e,n,i,s,u){if(!a.isFile(e.node.mode))throw new a.ErrnoError(43);var h,m,v=e.node.contents;if(!(u&2)&&v&&v.buffer===O.buffer)m=!1,h=v.byteOffset;else{if(m=!0,h=At(n),!h)throw new a.ErrnoError(48);v&&((i>0||i+n<v.length)&&(v.subarray?v=v.subarray(i,i+n):v=Array.prototype.slice.call(v,i,i+n)),O.set(v,h))}return{ptr:h,allocated:m}},msync(e,n,i,s,u){return j.stream_ops.write(e,n,0,s,i,!1),0}}},It=async e=>{var n=await M(e);return new Uint8Array(n)};It.isAsync=!0;var Xr=(...e)=>a.createDataFile(...e),qt=[],Jr=(e,n,i,s)=>{typeof Browser<"u"&&Browser.init();var u=!1;return qt.forEach(h=>{u||h.canHandle(n)&&(h.handle(e,n,i,s),u=!0)}),u},Zr=(e,n,i,s,u,h,m,v,T,C)=>{var N=n?be.resolve(G.join2(e,n)):e;function W(V){function F(H){C?.(),v||Xr(e,n,H,s,u,T),h?.(),Qe()}Jr(V,N,F,()=>{m?.(),Qe()})||F(V)}yt(),typeof i=="string"?It(i).then(W,m):W(i)},en=e=>{var n={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},i=n[e];if(typeof i>"u")throw new Error(`Unknown file open mode: ${e}`);return i},et=(e,n)=>{var i=0;return e&&(i|=365),n&&(i|=146),i},a={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{name="ErrnoError";constructor(e){this.errno=e}},FSStream:class{shared={};get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(e,n,i,s){e||(e=this),this.parent=e,this.mount=e.mount,this.id=a.nextInode++,this.name=n,this.mode=i,this.rdev=s,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return a.isDir(this.mode)}get isDevice(){return a.isChrdev(this.mode)}},lookupPath(e,n={}){if(!e)throw new a.ErrnoError(44);n.follow_mount??=!0,G.isAbs(e)||(e=a.cwd()+"/"+e);e:for(var i=0;i<40;i++){for(var s=e.split("/").filter(C=>!!C),u=a.root,h="/",m=0;m<s.length;m++){var v=m===s.length-1;if(v&&n.parent)break;if(s[m]!=="."){if(s[m]===".."){if(h=G.dirname(h),a.isRoot(u)){e=h+"/"+s.slice(m+1).join("/");continue e}else u=u.parent;continue}h=G.join2(h,s[m]);try{u=a.lookupNode(u,s[m])}catch(C){if(C?.errno===44&&v&&n.noent_okay)return{path:h};throw C}if(a.isMountpoint(u)&&(!v||n.follow_mount)&&(u=u.mounted.root),a.isLink(u.mode)&&(!v||n.follow)){if(!u.node_ops.readlink)throw new a.ErrnoError(52);var T=u.node_ops.readlink(u);G.isAbs(T)||(T=G.dirname(h)+"/"+T),e=T+"/"+s.slice(m+1).join("/");continue e}}}return{path:h,node:u}}throw new a.ErrnoError(32)},getPath(e){for(var n;;){if(a.isRoot(e)){var i=e.mount.mountpoint;return n?i[i.length-1]!=="/"?`${i}/${n}`:i+n:i}n=n?`${e.name}/${n}`:e.name,e=e.parent}},hashName(e,n){for(var i=0,s=0;s<n.length;s++)i=(i<<5)-i+n.charCodeAt(s)|0;return(e+i>>>0)%a.nameTable.length},hashAddNode(e){var n=a.hashName(e.parent.id,e.name);e.name_next=a.nameTable[n],a.nameTable[n]=e},hashRemoveNode(e){var n=a.hashName(e.parent.id,e.name);if(a.nameTable[n]===e)a.nameTable[n]=e.name_next;else for(var i=a.nameTable[n];i;){if(i.name_next===e){i.name_next=e.name_next;break}i=i.name_next}},lookupNode(e,n){var i=a.mayLookup(e);if(i)throw new a.ErrnoError(i);for(var s=a.hashName(e.id,n),u=a.nameTable[s];u;u=u.name_next){var h=u.name;if(u.parent.id===e.id&&h===n)return u}return a.lookup(e,n)},createNode(e,n,i,s){var u=new a.FSNode(e,n,i,s);return a.hashAddNode(u),u},destroyNode(e){a.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var n=["r","w","rw"][e&3];return e&512&&(n+="w"),n},nodePermissions(e,n){return a.ignorePermissions?0:n.includes("r")&&!(e.mode&292)||n.includes("w")&&!(e.mode&146)||n.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!a.isDir(e.mode))return 54;var n=a.nodePermissions(e,"x");return n||(e.node_ops.lookup?0:2)},mayCreate(e,n){if(!a.isDir(e.mode))return 54;try{var i=a.lookupNode(e,n);return 20}catch{}return a.nodePermissions(e,"wx")},mayDelete(e,n,i){var s;try{s=a.lookupNode(e,n)}catch(h){return h.errno}var u=a.nodePermissions(e,"wx");if(u)return u;if(i){if(!a.isDir(s.mode))return 54;if(a.isRoot(s)||a.getPath(s)===a.cwd())return 10}else if(a.isDir(s.mode))return 31;return 0},mayOpen(e,n){return e?a.isLink(e.mode)?32:a.isDir(e.mode)&&(a.flagsToPermissionString(n)!=="r"||n&576)?31:a.nodePermissions(e,a.flagsToPermissionString(n)):44},checkOpExists(e,n){if(!e)throw new a.ErrnoError(n);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=a.MAX_OPEN_FDS;e++)if(!a.streams[e])return e;throw new a.ErrnoError(33)},getStreamChecked(e){var n=a.getStream(e);if(!n)throw new a.ErrnoError(8);return n},getStream:e=>a.streams[e],createStream(e,n=-1){return e=Object.assign(new a.FSStream,e),n==-1&&(n=a.nextfd()),e.fd=n,a.streams[n]=e,e},closeStream(e){a.streams[e]=null},dupStream(e,n=-1){var i=a.createStream(e,n);return i.stream_ops?.dup?.(i),i},doSetAttr(e,n,i){var s=e?.stream_ops.setattr,u=s?e:n;s??=n.node_ops.setattr,a.checkOpExists(s,63),s(u,i)},chrdev_stream_ops:{open(e){var n=a.getDevice(e.node.rdev);e.stream_ops=n.stream_ops,e.stream_ops.open?.(e)},llseek(){throw new a.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,n)=>e<<8|n,registerDevice(e,n){a.devices[e]={stream_ops:n}},getDevice:e=>a.devices[e],getMounts(e){for(var n=[],i=[e];i.length;){var s=i.pop();n.push(s),i.push(...s.mounts)}return n},syncfs(e,n){typeof e=="function"&&(n=e,e=!1),a.syncFSRequests++,a.syncFSRequests>1&&g(`warning: ${a.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var i=a.getMounts(a.root.mount),s=0;function u(m){return a.syncFSRequests--,n(m)}function h(m){if(m)return h.errored?void 0:(h.errored=!0,u(m));++s>=i.length&&u(null)}i.forEach(m=>{if(!m.type.syncfs)return h(null);m.type.syncfs(m,e,h)})},mount(e,n,i){var s=i==="/",u=!i,h;if(s&&a.root)throw new a.ErrnoError(10);if(!s&&!u){var m=a.lookupPath(i,{follow_mount:!1});if(i=m.path,h=m.node,a.isMountpoint(h))throw new a.ErrnoError(10);if(!a.isDir(h.mode))throw new a.ErrnoError(54)}var v={type:e,opts:n,mountpoint:i,mounts:[]},T=e.mount(v);return T.mount=v,v.root=T,s?a.root=T:h&&(h.mounted=v,h.mount&&h.mount.mounts.push(v)),T},unmount(e){var n=a.lookupPath(e,{follow_mount:!1});if(!a.isMountpoint(n.node))throw new a.ErrnoError(28);var i=n.node,s=i.mounted,u=a.getMounts(s);Object.keys(a.nameTable).forEach(m=>{for(var v=a.nameTable[m];v;){var T=v.name_next;u.includes(v.mount)&&a.destroyNode(v),v=T}}),i.mounted=null;var h=i.mount.mounts.indexOf(s);i.mount.mounts.splice(h,1)},lookup(e,n){return e.node_ops.lookup(e,n)},mknod(e,n,i){var s=a.lookupPath(e,{parent:!0}),u=s.node,h=G.basename(e);if(!h)throw new a.ErrnoError(28);if(h==="."||h==="..")throw new a.ErrnoError(20);var m=a.mayCreate(u,h);if(m)throw new a.ErrnoError(m);if(!u.node_ops.mknod)throw new a.ErrnoError(63);return u.node_ops.mknod(u,h,n,i)},statfs(e){return a.statfsNode(a.lookupPath(e,{follow:!0}).node)},statfsStream(e){return a.statfsNode(e.node)},statfsNode(e){var n={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:a.nextInode,ffree:a.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(n,e.node_ops.statfs(e.mount.opts.root)),n},create(e,n=438){return n&=4095,n|=32768,a.mknod(e,n,0)},mkdir(e,n=511){return n&=1023,n|=16384,a.mknod(e,n,0)},mkdirTree(e,n){var i=e.split("/"),s="";for(var u of i)if(u){(s||G.isAbs(e))&&(s+="/"),s+=u;try{a.mkdir(s,n)}catch(h){if(h.errno!=20)throw h}}},mkdev(e,n,i){return typeof i>"u"&&(i=n,n=438),n|=8192,a.mknod(e,n,i)},symlink(e,n){if(!be.resolve(e))throw new a.ErrnoError(44);var i=a.lookupPath(n,{parent:!0}),s=i.node;if(!s)throw new a.ErrnoError(44);var u=G.basename(n),h=a.mayCreate(s,u);if(h)throw new a.ErrnoError(h);if(!s.node_ops.symlink)throw new a.ErrnoError(63);return s.node_ops.symlink(s,u,e)},rename(e,n){var i=G.dirname(e),s=G.dirname(n),u=G.basename(e),h=G.basename(n),m,v,T;if(m=a.lookupPath(e,{parent:!0}),v=m.node,m=a.lookupPath(n,{parent:!0}),T=m.node,!v||!T)throw new a.ErrnoError(44);if(v.mount!==T.mount)throw new a.ErrnoError(75);var C=a.lookupNode(v,u),N=be.relative(e,s);if(N.charAt(0)!==".")throw new a.ErrnoError(28);if(N=be.relative(n,i),N.charAt(0)!==".")throw new a.ErrnoError(55);var W;try{W=a.lookupNode(T,h)}catch{}if(C!==W){var V=a.isDir(C.mode),F=a.mayDelete(v,u,V);if(F)throw new a.ErrnoError(F);if(F=W?a.mayDelete(T,h,V):a.mayCreate(T,h),F)throw new a.ErrnoError(F);if(!v.node_ops.rename)throw new a.ErrnoError(63);if(a.isMountpoint(C)||W&&a.isMountpoint(W))throw new a.ErrnoError(10);if(T!==v&&(F=a.nodePermissions(v,"w"),F))throw new a.ErrnoError(F);a.hashRemoveNode(C);try{v.node_ops.rename(C,T,h),C.parent=T}catch(H){throw H}finally{a.hashAddNode(C)}}},rmdir(e){var n=a.lookupPath(e,{parent:!0}),i=n.node,s=G.basename(e),u=a.lookupNode(i,s),h=a.mayDelete(i,s,!0);if(h)throw new a.ErrnoError(h);if(!i.node_ops.rmdir)throw new a.ErrnoError(63);if(a.isMountpoint(u))throw new a.ErrnoError(10);i.node_ops.rmdir(i,s),a.destroyNode(u)},readdir(e){var n=a.lookupPath(e,{follow:!0}),i=n.node,s=a.checkOpExists(i.node_ops.readdir,54);return s(i)},unlink(e){var n=a.lookupPath(e,{parent:!0}),i=n.node;if(!i)throw new a.ErrnoError(44);var s=G.basename(e),u=a.lookupNode(i,s),h=a.mayDelete(i,s,!1);if(h)throw new a.ErrnoError(h);if(!i.node_ops.unlink)throw new a.ErrnoError(63);if(a.isMountpoint(u))throw new a.ErrnoError(10);i.node_ops.unlink(i,s),a.destroyNode(u)},readlink(e){var n=a.lookupPath(e),i=n.node;if(!i)throw new a.ErrnoError(44);if(!i.node_ops.readlink)throw new a.ErrnoError(28);return i.node_ops.readlink(i)},stat(e,n){var i=a.lookupPath(e,{follow:!n}),s=i.node,u=a.checkOpExists(s.node_ops.getattr,63);return u(s)},fstat(e){var n=a.getStreamChecked(e),i=n.node,s=n.stream_ops.getattr,u=s?n:i;return s??=i.node_ops.getattr,a.checkOpExists(s,63),s(u)},lstat(e){return a.stat(e,!0)},doChmod(e,n,i,s){a.doSetAttr(e,n,{mode:i&4095|n.mode&-4096,ctime:Date.now(),dontFollow:s})},chmod(e,n,i){var s;if(typeof e=="string"){var u=a.lookupPath(e,{follow:!i});s=u.node}else s=e;a.doChmod(null,s,n,i)},lchmod(e,n){a.chmod(e,n,!0)},fchmod(e,n){var i=a.getStreamChecked(e);a.doChmod(i,i.node,n,!1)},doChown(e,n,i){a.doSetAttr(e,n,{timestamp:Date.now(),dontFollow:i})},chown(e,n,i,s){var u;if(typeof e=="string"){var h=a.lookupPath(e,{follow:!s});u=h.node}else u=e;a.doChown(null,u,s)},lchown(e,n,i){a.chown(e,n,i,!0)},fchown(e,n,i){var s=a.getStreamChecked(e);a.doChown(s,s.node,!1)},doTruncate(e,n,i){if(a.isDir(n.mode))throw new a.ErrnoError(31);if(!a.isFile(n.mode))throw new a.ErrnoError(28);var s=a.nodePermissions(n,"w");if(s)throw new a.ErrnoError(s);a.doSetAttr(e,n,{size:i,timestamp:Date.now()})},truncate(e,n){if(n<0)throw new a.ErrnoError(28);var i;if(typeof e=="string"){var s=a.lookupPath(e,{follow:!0});i=s.node}else i=e;a.doTruncate(null,i,n)},ftruncate(e,n){var i=a.getStreamChecked(e);if(n<0||(i.flags&2097155)===0)throw new a.ErrnoError(28);a.doTruncate(i,i.node,n)},utime(e,n,i){var s=a.lookupPath(e,{follow:!0}),u=s.node,h=a.checkOpExists(u.node_ops.setattr,63);h(u,{atime:n,mtime:i})},open(e,n,i=438){if(e==="")throw new a.ErrnoError(44);n=typeof n=="string"?en(n):n,n&64?i=i&4095|32768:i=0;var s,u;if(typeof e=="object")s=e;else{u=e.endsWith("/");var h=a.lookupPath(e,{follow:!(n&131072),noent_okay:!0});s=h.node,e=h.path}var m=!1;if(n&64)if(s){if(n&128)throw new a.ErrnoError(20)}else{if(u)throw new a.ErrnoError(31);s=a.mknod(e,i|511,0),m=!0}if(!s)throw new a.ErrnoError(44);if(a.isChrdev(s.mode)&&(n&=-513),n&65536&&!a.isDir(s.mode))throw new a.ErrnoError(54);if(!m){var v=a.mayOpen(s,n);if(v)throw new a.ErrnoError(v)}n&512&&!m&&a.truncate(s,0),n&=-131713;var T=a.createStream({node:s,path:a.getPath(s),flags:n,seekable:!0,position:0,stream_ops:s.stream_ops,ungotten:[],error:!1});return T.stream_ops.open&&T.stream_ops.open(T),m&&a.chmod(s,i&511),t.logReadFiles&&!(n&1)&&(e in a.readFiles||(a.readFiles[e]=1)),T},close(e){if(a.isClosed(e))throw new a.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(n){throw n}finally{a.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,n,i){if(a.isClosed(e))throw new a.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new a.ErrnoError(70);if(i!=0&&i!=1&&i!=2)throw new a.ErrnoError(28);return e.position=e.stream_ops.llseek(e,n,i),e.ungotten=[],e.position},read(e,n,i,s,u){if(s<0||u<0)throw new a.ErrnoError(28);if(a.isClosed(e))throw new a.ErrnoError(8);if((e.flags&2097155)===1)throw new a.ErrnoError(8);if(a.isDir(e.node.mode))throw new a.ErrnoError(31);if(!e.stream_ops.read)throw new a.ErrnoError(28);var h=typeof u<"u";if(!h)u=e.position;else if(!e.seekable)throw new a.ErrnoError(70);var m=e.stream_ops.read(e,n,i,s,u);return h||(e.position+=m),m},write(e,n,i,s,u,h){if(s<0||u<0)throw new a.ErrnoError(28);if(a.isClosed(e))throw new a.ErrnoError(8);if((e.flags&2097155)===0)throw new a.ErrnoError(8);if(a.isDir(e.node.mode))throw new a.ErrnoError(31);if(!e.stream_ops.write)throw new a.ErrnoError(28);e.seekable&&e.flags&1024&&a.llseek(e,0,2);var m=typeof u<"u";if(!m)u=e.position;else if(!e.seekable)throw new a.ErrnoError(70);var v=e.stream_ops.write(e,n,i,s,u,h);return m||(e.position+=v),v},mmap(e,n,i,s,u){if((s&2)!==0&&(u&2)===0&&(e.flags&2097155)!==2)throw new a.ErrnoError(2);if((e.flags&2097155)===1)throw new a.ErrnoError(2);if(!e.stream_ops.mmap)throw new a.ErrnoError(43);if(!n)throw new a.ErrnoError(28);return e.stream_ops.mmap(e,n,i,s,u)},msync(e,n,i,s,u){return e.stream_ops.msync?e.stream_ops.msync(e,n,i,s,u):0},ioctl(e,n,i){if(!e.stream_ops.ioctl)throw new a.ErrnoError(59);return e.stream_ops.ioctl(e,n,i)},readFile(e,n={}){if(n.flags=n.flags||0,n.encoding=n.encoding||"binary",n.encoding!=="utf8"&&n.encoding!=="binary")throw new Error(`Invalid encoding type "${n.encoding}"`);var i,s=a.open(e,n.flags),u=a.stat(e),h=u.size,m=new Uint8Array(h);return a.read(s,m,0,h,0),n.encoding==="utf8"?i=Ie(m):n.encoding==="binary"&&(i=m),a.close(s),i},writeFile(e,n,i={}){i.flags=i.flags||577;var s=a.open(e,i.flags,i.mode);if(typeof n=="string"){var u=new Uint8Array(me(n)+1),h=Je(n,u,0,u.length);a.write(s,u,0,h,void 0,i.canOwn)}else if(ArrayBuffer.isView(n))a.write(s,n,0,n.byteLength,void 0,i.canOwn);else throw new Error("Unsupported data type");a.close(s)},cwd:()=>a.currentPath,chdir(e){var n=a.lookupPath(e,{follow:!0});if(n.node===null)throw new a.ErrnoError(44);if(!a.isDir(n.node.mode))throw new a.ErrnoError(54);var i=a.nodePermissions(n.node,"x");if(i)throw new a.ErrnoError(i);a.currentPath=n.path},createDefaultDirectories(){a.mkdir("/tmp"),a.mkdir("/home"),a.mkdir("/home/web_user")},createDefaultDevices(){a.mkdir("/dev"),a.registerDevice(a.makedev(1,3),{read:()=>0,write:(s,u,h,m,v)=>m,llseek:()=>0}),a.mkdev("/dev/null",a.makedev(1,3)),ge.register(a.makedev(5,0),ge.default_tty_ops),ge.register(a.makedev(6,0),ge.default_tty1_ops),a.mkdev("/dev/tty",a.makedev(5,0)),a.mkdev("/dev/tty1",a.makedev(6,0));var e=new Uint8Array(1024),n=0,i=()=>(n===0&&(Tt(e),n=e.byteLength),e[--n]);a.createDevice("/dev","random",i),a.createDevice("/dev","urandom",i),a.mkdir("/dev/shm"),a.mkdir("/dev/shm/tmp")},createSpecialDirectories(){a.mkdir("/proc");var e=a.mkdir("/proc/self");a.mkdir("/proc/self/fd"),a.mount({mount(){var n=a.createNode(e,"fd",16895,73);return n.stream_ops={llseek:j.stream_ops.llseek},n.node_ops={lookup(i,s){var u=+s,h=a.getStreamChecked(u),m={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>h.path},id:u+1};return m.parent=m,m},readdir(){return Array.from(a.streams.entries()).filter(([i,s])=>s).map(([i,s])=>i.toString())}},n}},{},"/proc/self/fd")},createStandardStreams(e,n,i){e?a.createDevice("/dev","stdin",e):a.symlink("/dev/tty","/dev/stdin"),n?a.createDevice("/dev","stdout",null,n):a.symlink("/dev/tty","/dev/stdout"),i?a.createDevice("/dev","stderr",null,i):a.symlink("/dev/tty1","/dev/stderr"),a.open("/dev/stdin",0),a.open("/dev/stdout",1),a.open("/dev/stderr",1)},staticInit(){a.nameTable=new Array(4096),a.mount(j,{},"/"),a.createDefaultDirectories(),a.createDefaultDevices(),a.createSpecialDirectories(),a.filesystems={MEMFS:j}},init(e,n,i){a.initialized=!0,e??=t.stdin,n??=t.stdout,i??=t.stderr,a.createStandardStreams(e,n,i)},quit(){a.initialized=!1;for(var e of a.streams)e&&a.close(e)},findObject(e,n){var i=a.analyzePath(e,n);return i.exists?i.object:null},analyzePath(e,n){try{var i=a.lookupPath(e,{follow:!n});e=i.path}catch{}var s={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var i=a.lookupPath(e,{parent:!0});s.parentExists=!0,s.parentPath=i.path,s.parentObject=i.node,s.name=G.basename(e),i=a.lookupPath(e,{follow:!n}),s.exists=!0,s.path=i.path,s.object=i.node,s.name=i.node.name,s.isRoot=i.path==="/"}catch(u){s.error=u.errno}return s},createPath(e,n,i,s){e=typeof e=="string"?e:a.getPath(e);for(var u=n.split("/").reverse();u.length;){var h=u.pop();if(h){var m=G.join2(e,h);try{a.mkdir(m)}catch(v){if(v.errno!=20)throw v}e=m}}return m},createFile(e,n,i,s,u){var h=G.join2(typeof e=="string"?e:a.getPath(e),n),m=et(s,u);return a.create(h,m)},createDataFile(e,n,i,s,u,h){var m=n;e&&(e=typeof e=="string"?e:a.getPath(e),m=n?G.join2(e,n):e);var v=et(s,u),T=a.create(m,v);if(i){if(typeof i=="string"){for(var C=new Array(i.length),N=0,W=i.length;N<W;++N)C[N]=i.charCodeAt(N);i=C}a.chmod(T,v|146);var V=a.open(T,577);a.write(V,i,0,i.length,0,h),a.close(V),a.chmod(T,v)}},createDevice(e,n,i,s){var u=G.join2(typeof e=="string"?e:a.getPath(e),n),h=et(!!i,!!s);a.createDevice.major??=64;var m=a.makedev(a.createDevice.major++,0);return a.registerDevice(m,{open(v){v.seekable=!1},close(v){s?.buffer?.length&&s(10)},read(v,T,C,N,W){for(var V=0,F=0;F<N;F++){var H;try{H=i()}catch{throw new a.ErrnoError(29)}if(H===void 0&&V===0)throw new a.ErrnoError(6);if(H==null)break;V++,T[C+F]=H}return V&&(v.node.atime=Date.now()),V},write(v,T,C,N,W){for(var V=0;V<N;V++)try{s(T[C+V])}catch{throw new a.ErrnoError(29)}return N&&(v.node.mtime=v.node.ctime=Date.now()),V}}),a.mkdev(u,h,m)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{e.contents=P(e.url),e.usedBytes=e.contents.length}catch{throw new a.ErrnoError(29)}},createLazyFile(e,n,i,s,u){class h{lengthKnown=!1;chunks=[];get(F){if(!(F>this.length-1||F<0)){var H=F%this.chunkSize,ee=F/this.chunkSize|0;return this.getter(ee)[H]}}setDataGetter(F){this.getter=F}cacheLength(){var F=new XMLHttpRequest;if(F.open("HEAD",i,!1),F.send(null),!(F.status>=200&&F.status<300||F.status===304))throw new Error("Couldn't load "+i+". Status: "+F.status);var H=Number(F.getResponseHeader("Content-length")),ee,Y=(ee=F.getResponseHeader("Accept-Ranges"))&&ee==="bytes",te=(ee=F.getResponseHeader("Content-Encoding"))&&ee==="gzip",se=1024*1024;Y||(se=H);var ae=(oe,ke)=>{if(oe>ke)throw new Error("invalid range ("+oe+", "+ke+") or no bytes requested!");if(ke>H-1)throw new Error("only "+H+" bytes available! programmer error!");var ne=new XMLHttpRequest;if(ne.open("GET",i,!1),H!==se&&ne.setRequestHeader("Range","bytes="+oe+"-"+ke),ne.responseType="arraybuffer",ne.overrideMimeType&&ne.overrideMimeType("text/plain; charset=x-user-defined"),ne.send(null),!(ne.status>=200&&ne.status<300||ne.status===304))throw new Error("Couldn't load "+i+". Status: "+ne.status);return ne.response!==void 0?new Uint8Array(ne.response||[]):Ze(ne.responseText||"",!0)},Pe=this;Pe.setDataGetter(oe=>{var ke=oe*se,ne=(oe+1)*se-1;if(ne=Math.min(ne,H-1),typeof Pe.chunks[oe]>"u"&&(Pe.chunks[oe]=ae(ke,ne)),typeof Pe.chunks[oe]>"u")throw new Error("doXHR failed!");return Pe.chunks[oe]}),(te||!H)&&(se=H=1,H=this.getter(0).length,se=H,w("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=H,this._chunkSize=se,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var m=new h,v={isDevice:!1,contents:m}}else var v={isDevice:!1,url:i};var T=a.createFile(e,n,v,s,u);v.contents?T.contents=v.contents:v.url&&(T.contents=null,T.url=v.url),Object.defineProperties(T,{usedBytes:{get:function(){return this.contents.length}}});var C={},N=Object.keys(T.stream_ops);N.forEach(V=>{var F=T.stream_ops[V];C[V]=(...H)=>(a.forceLoadFile(T),F(...H))});function W(V,F,H,ee,Y){var te=V.node.contents;if(Y>=te.length)return 0;var se=Math.min(te.length-Y,ee);if(te.slice)for(var ae=0;ae<se;ae++)F[H+ae]=te[Y+ae];else for(var ae=0;ae<se;ae++)F[H+ae]=te.get(Y+ae);return se}return C.read=(V,F,H,ee,Y)=>(a.forceLoadFile(T),W(V,F,H,ee,Y)),C.mmap=(V,F,H,ee,Y)=>{a.forceLoadFile(T);var te=At(F);if(!te)throw new a.ErrnoError(48);return W(V,O,te,F,H),{ptr:te,allocated:!0}},T.stream_ops=C,T}},z={DEFAULT_POLLMASK:5,calculateAt(e,n,i){if(G.isAbs(n))return n;var s;if(e===-100)s=a.cwd();else{var u=z.getStreamFromFD(e);s=u.path}if(n.length==0){if(!i)throw new a.ErrnoError(44);return s}return s+"/"+n},writeStat(e,n){q[e>>2]=n.dev,q[e+4>>2]=n.mode,$[e+8>>2]=n.nlink,q[e+12>>2]=n.uid,q[e+16>>2]=n.gid,q[e+20>>2]=n.rdev,J=[n.size>>>0,(D=n.size,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],q[e+24>>2]=J[0],q[e+28>>2]=J[1],q[e+32>>2]=4096,q[e+36>>2]=n.blocks;var i=n.atime.getTime(),s=n.mtime.getTime(),u=n.ctime.getTime();return J=[Math.floor(i/1e3)>>>0,(D=Math.floor(i/1e3),+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],q[e+40>>2]=J[0],q[e+44>>2]=J[1],$[e+48>>2]=i%1e3*1e3*1e3,J=[Math.floor(s/1e3)>>>0,(D=Math.floor(s/1e3),+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],q[e+56>>2]=J[0],q[e+60>>2]=J[1],$[e+64>>2]=s%1e3*1e3*1e3,J=[Math.floor(u/1e3)>>>0,(D=Math.floor(u/1e3),+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],q[e+72>>2]=J[0],q[e+76>>2]=J[1],$[e+80>>2]=u%1e3*1e3*1e3,J=[n.ino>>>0,(D=n.ino,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],q[e+88>>2]=J[0],q[e+92>>2]=J[1],0},writeStatFs(e,n){q[e+4>>2]=n.bsize,q[e+40>>2]=n.bsize,q[e+8>>2]=n.blocks,q[e+12>>2]=n.bfree,q[e+16>>2]=n.bavail,q[e+20>>2]=n.files,q[e+24>>2]=n.ffree,q[e+28>>2]=n.fsid,q[e+44>>2]=n.flags,q[e+36>>2]=n.namelen},doMsync(e,n,i,s,u){if(!a.isFile(n.node.mode))throw new a.ErrnoError(43);if(s&2)return 0;var h=Q.slice(e,e+i);a.msync(n,h,u,i,s)},getStreamFromFD(e){var n=a.getStreamChecked(e);return n},varargs:void 0,getStr(e){var n=pe(e);return n}};function tn(e,n){try{return e=z.getStr(e),a.chmod(e,n),0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function rn(e,n,i,s){try{if(n=z.getStr(n),n=z.calculateAt(e,n),i&-8)return-28;var u=a.lookupPath(n,{follow:!0}),h=u.node;if(!h)return-44;var m="";return i&4&&(m+="r"),i&2&&(m+="w"),i&1&&(m+="x"),m&&a.nodePermissions(h,m)?-2:0}catch(v){if(typeof a>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}function nn(e,n){try{return a.fchmod(e,n),0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function sn(e,n,i){try{return a.fchown(e,n,i),0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}var Ne=()=>{var e=q[+z.varargs>>2];return z.varargs+=4,e},an=Ne;function on(e,n,i){z.varargs=i;try{var s=z.getStreamFromFD(e);switch(n){case 0:{var u=Ne();if(u<0)return-28;for(;a.streams[u];)u++;var h;return h=a.dupStream(s,u),h.fd}case 1:case 2:return 0;case 3:return s.flags;case 4:{var u=Ne();return s.flags|=u,0}case 12:{var u=an(),m=0;return X[u+m>>1]=2,0}case 13:case 14:return 0}return-28}catch(v){if(typeof a>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}function ln(e,n){try{return z.writeStat(n,a.fstat(e))}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}var qe=(e,n)=>n+2097152>>>0<4194305-!!e?(e>>>0)+n*4294967296:NaN;function cn(e,n,i){var s=qe(n,i);try{return isNaN(s)?-61:(a.ftruncate(e,s),0)}catch(u){if(typeof a>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}var de=(e,n,i)=>Je(e,Q,n,i);function un(e,n){try{if(n===0)return-28;var i=a.cwd(),s=me(i)+1;return n<s?-68:(de(i,e,n),s)}catch(u){if(typeof a>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function dn(e,n){try{return e=z.getStr(e),z.writeStat(n,a.lstat(e))}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function fn(e,n,i){try{return n=z.getStr(n),n=z.calculateAt(e,n),a.mkdir(n,i,0),0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function hn(e,n,i,s){try{n=z.getStr(n);var u=s&256,h=s&4096;return s=s&-6401,n=z.calculateAt(e,n,h),z.writeStat(i,u?a.lstat(n):a.stat(n))}catch(m){if(typeof a>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}function _n(e,n,i,s){z.varargs=s;try{n=z.getStr(n),n=z.calculateAt(e,n);var u=s?Ne():0;return a.open(n,i,u).fd}catch(h){if(typeof a>"u"||h.name!=="ErrnoError")throw h;return-h.errno}}function pn(e,n,i,s){try{if(n=z.getStr(n),n=z.calculateAt(e,n),s<=0)return-28;var u=a.readlink(n),h=Math.min(s,me(u)),m=O[i+h];return de(u,i,s+1),O[i+h]=m,h}catch(v){if(typeof a>"u"||v.name!=="ErrnoError")throw v;return-v.errno}}function mn(e){try{return e=z.getStr(e),a.rmdir(e),0}catch(n){if(typeof a>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function gn(e,n){try{return e=z.getStr(e),z.writeStat(n,a.stat(e))}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function yn(e,n,i){try{if(n=z.getStr(n),n=z.calculateAt(e,n),!i)a.unlink(n);else if(i===512)a.rmdir(n);else return-28;return 0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}var Ct=e=>$[e>>2]+q[e+4>>2]*4294967296;function vn(e,n,i,s){try{n=z.getStr(n),n=z.calculateAt(e,n,!0);var u=Date.now(),h,m;if(!i)h=u,m=u;else{var v=Ct(i),T=q[i+8>>2];T==1073741823?h=u:T==1073741822?h=null:h=v*1e3+T/(1e3*1e3),i+=16,v=Ct(i),T=q[i+8>>2],T==1073741823?m=u:T==1073741822?m=null:m=v*1e3+T/(1e3*1e3)}return(m??h)!==null&&a.utime(n,h,m),0}catch(C){if(typeof a>"u"||C.name!=="ErrnoError")throw C;return-C.errno}}var wn=()=>ue(""),Me=0,bn=()=>{Ye=!1,Me=0},En=e=>e%4===0&&(e%100!==0||e%400===0),Sn=[0,31,60,91,121,152,182,213,244,274,305,335],kn=[0,31,59,90,120,151,181,212,243,273,304,334],Tn=e=>{var n=En(e.getFullYear()),i=n?Sn:kn,s=i[e.getMonth()]+e.getDate()-1;return s};function Ln(e,n,i){var s=qe(e,n),u=new Date(s*1e3);q[i>>2]=u.getSeconds(),q[i+4>>2]=u.getMinutes(),q[i+8>>2]=u.getHours(),q[i+12>>2]=u.getDate(),q[i+16>>2]=u.getMonth(),q[i+20>>2]=u.getFullYear()-1900,q[i+24>>2]=u.getDay();var h=Tn(u)|0;q[i+28>>2]=h,q[i+36>>2]=-(u.getTimezoneOffset()*60);var m=new Date(u.getFullYear(),0,1),v=new Date(u.getFullYear(),6,1).getTimezoneOffset(),T=m.getTimezoneOffset(),C=(v!=T&&u.getTimezoneOffset()==Math.min(T,v))|0;q[i+32>>2]=C}function An(e,n,i,s,u,h,m,v){var T=qe(u,h);try{var C=z.getStreamFromFD(s),N=a.mmap(C,e,T,n,i),W=N.ptr;return q[m>>2]=N.allocated,$[v>>2]=W,0}catch(V){if(typeof a>"u"||V.name!=="ErrnoError")throw V;return-V.errno}}function In(e,n,i,s,u,h,m){var v=qe(h,m);try{var T=z.getStreamFromFD(u);i&2&&z.doMsync(e,T,n,s,v)}catch(C){if(typeof a>"u"||C.name!=="ErrnoError")throw C;return-C.errno}}var Ce={},tt=e=>{if(e instanceof vt||e=="unwind")return B;k(1,e)},Rt=()=>Ye||Me>0,Pt=e=>{B=e,Rt()||(t.onExit?.(e),A=!0),k(e,new vt(e))},Ft=(e,n)=>{B=e,Pt(e)},qn=Ft,Cn=()=>{if(!Rt())try{qn(B)}catch(e){tt(e)}},xt=e=>{if(!A)try{e(),Cn()}catch(n){tt(n)}},Ot=()=>performance.now(),Rn=(e,n)=>{if(Ce[e]&&(clearTimeout(Ce[e].id),delete Ce[e]),!n)return 0;var i=setTimeout(()=>{delete Ce[e],xt(()=>xi(e,Ot()))},n);return Ce[e]={id:i,timeout_ms:n},0},Pn=(e,n,i,s)=>{var u=new Date().getFullYear(),h=new Date(u,0,1),m=new Date(u,6,1),v=h.getTimezoneOffset(),T=m.getTimezoneOffset(),C=Math.max(v,T);$[e>>2]=C*60,q[n>>2]=+(v!=T);var N=F=>{var H=F>=0?"-":"+",ee=Math.abs(F),Y=String(Math.floor(ee/60)).padStart(2,"0"),te=String(ee%60).padStart(2,"0");return`UTC${H}${Y}${te}`},W=N(v),V=N(T);T<v?(de(W,i,17),de(V,s,17)):(de(W,s,17),de(V,i,17))},Fn=()=>Date.now(),xn=()=>2147483648,On=e=>{var n=E.buffer,i=(e-n.byteLength+65535)/65536|0;try{return E.grow(i),De(),1}catch{}},Dn=e=>{var n=Q.length;e>>>=0;var i=xn();if(e>i)return!1;for(var s=1;s<=4;s*=2){var u=n*(1+.2/s);u=Math.min(u,e+100663296);var h=Math.min(i,Lt(Math.max(e,u),65536)),m=On(h);if(m)return!0}return!1},rt={},Bn=()=>b||"./this.program",Re=()=>{if(!Re.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:Bn()};for(var i in rt)rt[i]===void 0?delete n[i]:n[i]=rt[i];var s=[];for(var i in n)s.push(`${i}=${n[i]}`);Re.strings=s}return Re.strings},Nn=(e,n)=>{var i=0,s=0;for(var u of Re()){var h=n+i;$[e+s>>2]=h,i+=de(u,h,1/0)+1,s+=4}return 0},Mn=(e,n)=>{var i=Re();$[e>>2]=i.length;var s=0;for(var u of i)s+=me(u)+1;return $[n>>2]=s,0};function jn(e){try{var n=z.getStreamFromFD(e);return a.close(n),0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return i.errno}}function Un(e,n){try{var i=0,s=0,u=0,h=z.getStreamFromFD(e),m=h.tty?2:a.isDir(h.mode)?3:a.isLink(h.mode)?7:4;return O[n]=m,X[n+2>>1]=u,J=[i>>>0,(D=i,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],q[n+8>>2]=J[0],q[n+12>>2]=J[1],J=[s>>>0,(D=s,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],q[n+16>>2]=J[0],q[n+20>>2]=J[1],0}catch(v){if(typeof a>"u"||v.name!=="ErrnoError")throw v;return v.errno}}var Hn=(e,n,i,s)=>{for(var u=0,h=0;h<i;h++){var m=$[n>>2],v=$[n+4>>2];n+=8;var T=a.read(e,O,m,v,s);if(T<0)return-1;if(u+=T,T<v)break}return u};function Vn(e,n,i,s){try{var u=z.getStreamFromFD(e),h=Hn(u,n,i);return $[s>>2]=h,0}catch(m){if(typeof a>"u"||m.name!=="ErrnoError")throw m;return m.errno}}function zn(e,n,i,s,u){var h=qe(n,i);try{if(isNaN(h))return 61;var m=z.getStreamFromFD(e);return a.llseek(m,h,s),J=[m.position>>>0,(D=m.position,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],q[u>>2]=J[0],q[u+4>>2]=J[1],m.getdents&&h===0&&s===0&&(m.getdents=null),0}catch(v){if(typeof a>"u"||v.name!=="ErrnoError")throw v;return v.errno}}var Dt=function(e){try{var n=z.getStreamFromFD(e);return R.handleSleep(i=>{var s=n.node.mount;if(!s.type.syncfs){i(0);return}s.type.syncfs(s,!1,u=>{i(u?29:0)})})}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return i.errno}};Dt.isAsync=!0;var Wn=(e,n,i,s)=>{for(var u=0,h=0;h<i;h++){var m=$[n>>2],v=$[n+4>>2];n+=8;var T=a.write(e,O,m,v,s);if(T<0)return-1;if(u+=T,T<v)break}return u};function $n(e,n,i,s){try{var u=z.getStreamFromFD(e),h=Wn(u,n,i);return $[s>>2]=h,0}catch(m){if(typeof a>"u"||m.name!=="ErrnoError")throw m;return m.errno}}var K=function(){const e=typeof R=="object"?R.handleAsync.bind(R):null;t.handleAsync=e;const n=new Map;t.setCallback=(i,s)=>n.set(i,s),t.getCallback=i=>n.get(i),t.deleteCallback=i=>n.delete(i),K=function(i,s,...u){const h=n.get(s);let m=null;const v=typeof h=="function"?h:h[m=pe(u.shift())];if(i){if(e)return e(()=>v.apply(h,u));throw new Error("Synchronous WebAssembly cannot call async function")}const T=v.apply(h,u);if(typeof T?.then=="function")throw console.error("unexpected Promise",v),new Error(`${m} unexpectedly returned a Promise`);return T}};function Kn(...e){return K(!1,...e)}function Bt(...e){return K(!0,...e)}Bt.isAsync=!0;function Qn(...e){return K(!1,...e)}function Nt(...e){return K(!0,...e)}Nt.isAsync=!0;function Gn(...e){return K(!1,...e)}function Mt(...e){return K(!0,...e)}Mt.isAsync=!0;function Yn(...e){return K(!1,...e)}function jt(...e){return K(!0,...e)}jt.isAsync=!0;function Xn(...e){return K(!1,...e)}function Ut(...e){return K(!0,...e)}Ut.isAsync=!0;function Jn(...e){return K(!1,...e)}function Ht(...e){return K(!0,...e)}Ht.isAsync=!0;function Zn(...e){return K(!1,...e)}function Vt(...e){return K(!0,...e)}Vt.isAsync=!0;function ei(...e){return K(!1,...e)}function zt(...e){return K(!0,...e)}zt.isAsync=!0;function ti(...e){return K(!1,...e)}function Wt(...e){return K(!0,...e)}Wt.isAsync=!0;function ri(...e){return K(!1,...e)}function $t(...e){return K(!0,...e)}$t.isAsync=!0;function ni(...e){return K(!1,...e)}function Kt(...e){return K(!0,...e)}Kt.isAsync=!0;function ii(...e){return K(!1,...e)}function Qt(...e){return K(!0,...e)}Qt.isAsync=!0;function si(...e){return K(!1,...e)}function Gt(...e){return K(!0,...e)}Gt.isAsync=!0;function ai(...e){return K(!1,...e)}function Yt(...e){return K(!0,...e)}Yt.isAsync=!0;function oi(...e){return K(!1,...e)}function Xt(...e){return K(!0,...e)}Xt.isAsync=!0;function li(...e){return K(!1,...e)}function Jt(...e){return K(!0,...e)}Jt.isAsync=!0;var je=e=>{try{return e()}catch(n){ue(n)}},ci=e=>{for(var n={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:e[0]=="v"?[]:[n[e[0]]]},s=1;s<e.length;++s)i.parameters.push(n[e[s]]);return i},ui=()=>{Me+=1},di=()=>{Me-=1},R={instrumentWasmImports(e){var n=/^(ipp|ipp_async|ippp|ippp_async|vppp|vppp_async|ipppj|ipppj_async|ipppi|ipppi_async|ipppp|ipppp_async|ipppip|ipppip_async|vpppip|vpppip_async|ippppi|ippppi_async|ippppij|ippppij_async|ipppiii|ipppiii_async|ippppip|ippppip_async|ippipppp|ippipppp_async|ipppppip|ipppppip_async|ipppiiip|ipppiiip_async|vppippii|vppippii_async|invoke_.*|__asyncjs__.*)$/;for(let[i,s]of Object.entries(e))typeof s=="function"&&(s.isAsync||n.test(i))},instrumentWasmExports(e){var n={};for(let[i,s]of Object.entries(e))typeof s=="function"?n[i]=(...u)=>{R.exportCallStack.push(i);try{return s(...u)}finally{A||(R.exportCallStack.pop(),R.maybeStopUnwind())}}:n[i]=s;return n},State:{Normal:0,Unwinding:1,Rewinding:2,Disabled:3},state:0,StackSize:16384,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToName:{},callStackId:0,asyncPromiseHandlers:null,sleepCallbacks:[],getCallStackId(e){var n=R.callStackNameToId[e];return n===void 0&&(n=R.callStackId++,R.callStackNameToId[e]=n,R.callStackIdToName[n]=e),n},maybeStopUnwind(){R.currData&&R.state===R.State.Unwinding&&R.exportCallStack.length===0&&(R.state=R.State.Normal,je(ji),typeof Fibers<"u"&&Fibers.trampoline())},whenDone(){return new Promise((e,n)=>{R.asyncPromiseHandlers={resolve:e,reject:n}})},allocateData(){var e=Ci(12+R.StackSize);return R.setDataHeader(e,e+12,R.StackSize),R.setDataRewindFunc(e),e},setDataHeader(e,n,i){$[e>>2]=n,$[e+4>>2]=n+i},setDataRewindFunc(e){var n=R.exportCallStack[0],i=R.getCallStackId(n);q[e+8>>2]=i},getDataRewindFuncName(e){var n=q[e+8>>2],i=R.callStackIdToName[n];return i},getDataRewindFunc(e){var n=d[e];return n},doRewind(e){var n=R.getDataRewindFuncName(e),i=R.getDataRewindFunc(n);return i()},handleSleep(e){if(!A){if(R.state===R.State.Normal){var n=!1,i=!1;e((s=0)=>{if(!A&&(R.handleSleepReturnValue=s,n=!0,!!i)){R.state=R.State.Rewinding,je(()=>Ui(R.currData)),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.resume();var u,h=!1;try{u=R.doRewind(R.currData)}catch(T){u=T,h=!0}var m=!1;if(!R.currData){var v=R.asyncPromiseHandlers;v&&(R.asyncPromiseHandlers=null,(h?v.reject:v.resolve)(u),m=!0)}if(h&&!m)throw u}}),i=!0,n||(R.state=R.State.Unwinding,R.currData=R.allocateData(),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.pause(),je(()=>Mi(R.currData)))}else R.state===R.State.Rewinding?(R.state=R.State.Normal,je(Hi),Ri(R.currData),R.currData=null,R.sleepCallbacks.forEach(xt)):ue(`invalid state: ${R.state}`);return R.handleSleepReturnValue}},handleAsync:e=>R.handleSleep(n=>{e().then(n)})},Zt=(e,n)=>{e<128?n.push(e):n.push(e%128|128,e>>7)},fi=(e,n)=>{var i=e.slice(0,1),s=e.slice(1),u={i:127,p:127,j:126,f:125,d:124,e:111};n.push(96),Zt(s.length,n);for(var h of s)n.push(u[h]);i=="v"?n.push(0):n.push(1,u[i])},hi=(e,n)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(ci(n),e);var i=[1];fi(n,i);var s=[0,97,115,109,1,0,0,0,1];Zt(i.length,s),s.push(...i),s.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var u=new WebAssembly.Module(new Uint8Array(s)),h=new WebAssembly.Instance(u,{e:{f:e}}),m=h.exports.f;return m},Ee,_i=e=>Ee.get(e),pi=(e,n)=>{if(Se)for(var i=e;i<e+n;i++){var s=_i(i);s&&Se.set(s,i)}},Se,mi=e=>(Se||(Se=new WeakMap,pi(0,Ee.length)),Se.get(e)||0),er=[],gi=()=>{if(er.length)return er.pop();try{Ee.grow(1)}catch(e){throw e instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":e}return Ee.length-1},tr=(e,n)=>Ee.set(e,n),yi=(e,n)=>{var i=mi(e);if(i)return i;var s=gi();try{tr(s,e)}catch(h){if(!(h instanceof TypeError))throw h;var u=hi(e,n);tr(s,u)}return Se.set(e,s),s},rr=e=>{var n=t["_"+e];return n},nr=(e,n)=>{O.set(e,n)},ir=e=>Bi(e),vi=e=>{var n=me(e)+1,i=ir(n);return de(e,i,n),i},he=(e,n,i,s,u)=>{var h={string:Y=>{var te=0;return Y!=null&&Y!==0&&(te=vi(Y)),te},array:Y=>{var te=ir(Y.length);return nr(Y,te),te}};function m(Y){return n==="string"?pe(Y):n==="boolean"?!!Y:Y}var v=rr(e),T=[],C=0;if(s)for(var N=0;N<s.length;N++){var W=h[i[N]];W?(C===0&&(C=$r()),T[N]=W(s[N])):T[N]=s[N]}var V=R.currData,F=v(...T);function H(Y){return di(),C!==0&&Wr(C),m(Y)}var ee=u?.async;return ui(),R.currData!=V?R.whenDone().then(H):(F=H(F),ee?Promise.resolve(F):F)},wi=(e,n,i,s)=>{var u=!i||i.every(m=>m==="number"||m==="boolean"),h=n!=="string";return h&&u&&!s?rr(e):(...m)=>he(e,n,i,m,s)},bi=e=>Oi(),Ei=(e,n,i)=>{if(i??=2147483647,i<2)return 0;i-=2;for(var s=n,u=i<e.length*2?i/2:e.length,h=0;h<u;++h){var m=e.charCodeAt(h);X[n>>1]=m,n+=2}return X[n>>1]=0,n-s},Si=(e,n,i)=>{if(i??=2147483647,i<4)return 0;for(var s=n,u=s+i-4,h=0;h<e.length;++h){var m=e.charCodeAt(h);if(m>=55296&&m<=57343){var v=e.charCodeAt(++h);m=65536+((m&1023)<<10)|v&1023}if(q[n>>2]=m,n+=4,n+4>u)break}return q[n>>2]=0,n-s},ki=e=>{for(var n="";;){var i=Q[e++];if(!i)return n;n+=String.fromCharCode(i)}},Ti=new TextDecoder("utf-16le"),Li=(e,n)=>{for(var i=e>>1,s=i+n/2,u=i;!(u>=s)&&Z[u];)++u;return Ti.decode(Z.subarray(i,u))},Ai=(e,n)=>{for(var i=0,s="";!(i>=n/4);){var u=q[e+i*4>>2];if(u==0)break;if(++i,u>=65536){var h=u-65536;s+=String.fromCharCode(55296|h>>10,56320|h&1023)}else s+=String.fromCharCode(u)}return s},Ii=e=>{for(var n=[],i=0;i<e.length;i++){var s=e[i];s>255&&(s&=255),n.push(String.fromCharCode(s))}return n.join("")};a.createPreloadedFile=Zr,a.staticInit(),j.doesNotExistError=new a.ErrnoError(44),j.doesNotExistError.stack="<generic error, no stack>",K(),t.noExitRuntime&&(Ye=t.noExitRuntime),t.preloadPlugins&&(qt=t.preloadPlugins),t.print&&(w=t.print),t.printErr&&(g=t.printErr),t.wasmBinary&&(y=t.wasmBinary),t.arguments&&t.arguments,t.thisProgram&&(b=t.thisProgram),t.getTempRet0=bi,t.ccall=he,t.cwrap=wi,t.addFunction=yi,t.setValue=we,t.getValue=St,t.UTF8ToString=pe,t.stringToUTF8=de,t.lengthBytesUTF8=me,t.intArrayFromString=Ze,t.intArrayToString=Ii,t.AsciiToString=ki,t.UTF16ToString=Li,t.stringToUTF16=Ei,t.UTF32ToString=Ai,t.stringToUTF32=Si,t.writeArrayToMemory=nr;var qi={a:Kr,aa:tn,da:rn,ba:nn,$:sn,b:on,_:ln,y:cn,U:un,Y:dn,R:fn,X:hn,P:_n,N:pn,M:mn,Z:gn,K:yn,J:vn,F:wn,E:bn,w:Ln,u:An,v:In,G:Rn,Q:Pn,n:Fn,g:Ot,H:Dn,S:Nn,T:Mn,o:jn,I:Un,O:Vn,x:zn,V:Dt,L:$n,s:Kn,t:Bt,ka:Qn,oa:Nt,j:Gn,k:Mt,c:Yn,d:jt,ga:Xn,ha:Ut,ia:Jn,ja:Ht,h:Zn,i:Vt,z:ei,A:zt,e:ti,f:Wt,ea:ri,fa:$t,B:ni,C:Kt,p:ii,q:Qt,la:si,ma:Gt,D:Pt,na:ai,r:Yt,l:oi,m:Xt,W:li,ca:Jt},d=await Hr();d.qa,t._sqlite3_status64=d.ra,t._sqlite3_status=d.sa,t._sqlite3_msize=d.ta,t._sqlite3_db_status=d.ua,t._sqlite3_vfs_find=d.va,t._sqlite3_vfs_register=d.wa,t._sqlite3_vfs_unregister=d.xa,t._sqlite3_release_memory=d.ya,t._sqlite3_soft_heap_limit64=d.za,t._sqlite3_memory_used=d.Aa,t._sqlite3_hard_heap_limit64=d.Ba,t._sqlite3_memory_highwater=d.Ca,t._sqlite3_malloc=d.Da,t._sqlite3_malloc64=d.Ea,t._sqlite3_free=d.Fa,t._sqlite3_realloc=d.Ga,t._sqlite3_realloc64=d.Ha,t._sqlite3_str_vappendf=d.Ia,t._sqlite3_str_append=d.Ja,t._sqlite3_str_appendchar=d.Ka,t._sqlite3_str_appendall=d.La,t._sqlite3_str_appendf=d.Ma,t._sqlite3_str_finish=d.Na,t._sqlite3_str_errcode=d.Oa,t._sqlite3_str_length=d.Pa,t._sqlite3_str_value=d.Qa,t._sqlite3_str_reset=d.Ra,t._sqlite3_str_new=d.Sa,t._sqlite3_vmprintf=d.Ta,t._sqlite3_mprintf=d.Ua,t._sqlite3_vsnprintf=d.Va,t._sqlite3_snprintf=d.Wa,t._sqlite3_log=d.Xa,t._sqlite3_randomness=d.Ya,t._sqlite3_stricmp=d.Za,t._sqlite3_strnicmp=d._a,t._sqlite3_os_init=d.$a,t._sqlite3_os_end=d.ab,t._sqlite3_serialize=d.bb,t._sqlite3_prepare_v2=d.cb,t._sqlite3_step=d.db,t._sqlite3_column_int64=d.eb,t._sqlite3_reset=d.fb,t._sqlite3_exec=d.gb,t._sqlite3_column_int=d.hb,t._sqlite3_finalize=d.ib,t._sqlite3_deserialize=d.jb,t._sqlite3_database_file_object=d.kb,t._sqlite3_backup_init=d.lb,t._sqlite3_backup_step=d.mb,t._sqlite3_backup_finish=d.nb,t._sqlite3_backup_remaining=d.ob,t._sqlite3_backup_pagecount=d.pb,t._sqlite3_clear_bindings=d.qb,t._sqlite3_value_blob=d.rb,t._sqlite3_value_text=d.sb,t._sqlite3_value_bytes=d.tb,t._sqlite3_value_bytes16=d.ub,t._sqlite3_value_double=d.vb,t._sqlite3_value_int=d.wb,t._sqlite3_value_int64=d.xb,t._sqlite3_value_subtype=d.yb,t._sqlite3_value_pointer=d.zb,t._sqlite3_value_text16=d.Ab,t._sqlite3_value_text16be=d.Bb,t._sqlite3_value_text16le=d.Cb,t._sqlite3_value_type=d.Db,t._sqlite3_value_encoding=d.Eb,t._sqlite3_value_nochange=d.Fb,t._sqlite3_value_frombind=d.Gb,t._sqlite3_value_dup=d.Hb,t._sqlite3_value_free=d.Ib,t._sqlite3_result_blob=d.Jb,t._sqlite3_result_blob64=d.Kb,t._sqlite3_result_double=d.Lb,t._sqlite3_result_error=d.Mb,t._sqlite3_result_error16=d.Nb,t._sqlite3_result_int=d.Ob,t._sqlite3_result_int64=d.Pb,t._sqlite3_result_null=d.Qb,t._sqlite3_result_pointer=d.Rb,t._sqlite3_result_subtype=d.Sb,t._sqlite3_result_text=d.Tb,t._sqlite3_result_text64=d.Ub,t._sqlite3_result_text16=d.Vb,t._sqlite3_result_text16be=d.Wb,t._sqlite3_result_text16le=d.Xb,t._sqlite3_result_value=d.Yb,t._sqlite3_result_error_toobig=d.Zb,t._sqlite3_result_zeroblob=d._b,t._sqlite3_result_zeroblob64=d.$b,t._sqlite3_result_error_code=d.ac,t._sqlite3_result_error_nomem=d.bc,t._sqlite3_user_data=d.cc,t._sqlite3_context_db_handle=d.dc,t._sqlite3_vtab_nochange=d.ec,t._sqlite3_vtab_in_first=d.fc,t._sqlite3_vtab_in_next=d.gc,t._sqlite3_aggregate_context=d.hc,t._sqlite3_get_auxdata=d.ic,t._sqlite3_set_auxdata=d.jc,t._sqlite3_column_count=d.kc,t._sqlite3_data_count=d.lc,t._sqlite3_column_blob=d.mc,t._sqlite3_column_bytes=d.nc,t._sqlite3_column_bytes16=d.oc,t._sqlite3_column_double=d.pc,t._sqlite3_column_text=d.qc,t._sqlite3_column_value=d.rc,t._sqlite3_column_text16=d.sc,t._sqlite3_column_type=d.tc,t._sqlite3_column_name=d.uc,t._sqlite3_column_name16=d.vc,t._sqlite3_bind_blob=d.wc,t._sqlite3_bind_blob64=d.xc,t._sqlite3_bind_double=d.yc,t._sqlite3_bind_int=d.zc,t._sqlite3_bind_int64=d.Ac,t._sqlite3_bind_null=d.Bc,t._sqlite3_bind_pointer=d.Cc,t._sqlite3_bind_text=d.Dc,t._sqlite3_bind_text64=d.Ec,t._sqlite3_bind_text16=d.Fc,t._sqlite3_bind_value=d.Gc,t._sqlite3_bind_zeroblob=d.Hc,t._sqlite3_bind_zeroblob64=d.Ic,t._sqlite3_bind_parameter_count=d.Jc,t._sqlite3_bind_parameter_name=d.Kc,t._sqlite3_bind_parameter_index=d.Lc,t._sqlite3_db_handle=d.Mc,t._sqlite3_stmt_readonly=d.Nc,t._sqlite3_stmt_isexplain=d.Oc,t._sqlite3_stmt_explain=d.Pc,t._sqlite3_stmt_busy=d.Qc,t._sqlite3_next_stmt=d.Rc,t._sqlite3_stmt_status=d.Sc,t._sqlite3_sql=d.Tc,t._sqlite3_expanded_sql=d.Uc,t._sqlite3_value_numeric_type=d.Vc,t._sqlite3_blob_open=d.Wc,t._sqlite3_blob_close=d.Xc,t._sqlite3_blob_read=d.Yc,t._sqlite3_blob_write=d.Zc,t._sqlite3_blob_bytes=d._c,t._sqlite3_blob_reopen=d.$c,t._sqlite3_set_authorizer=d.ad,t._sqlite3_strglob=d.bd,t._sqlite3_strlike=d.cd,t._sqlite3_errmsg=d.dd,t._sqlite3_auto_extension=d.ed,t._sqlite3_cancel_auto_extension=d.fd,t._sqlite3_reset_auto_extension=d.gd,t._sqlite3_prepare=d.hd,t._sqlite3_prepare_v3=d.id,t._sqlite3_prepare16=d.jd,t._sqlite3_prepare16_v2=d.kd,t._sqlite3_prepare16_v3=d.ld,t._sqlite3_get_table=d.md,t._sqlite3_free_table=d.nd,t._sqlite3_create_module=d.od,t._sqlite3_create_module_v2=d.pd,t._sqlite3_drop_modules=d.qd,t._sqlite3_declare_vtab=d.rd,t._sqlite3_vtab_on_conflict=d.sd,t._sqlite3_vtab_config=d.td,t._sqlite3_vtab_collation=d.ud,t._sqlite3_vtab_in=d.vd,t._sqlite3_vtab_rhs_value=d.wd,t._sqlite3_vtab_distinct=d.xd,t._sqlite3_keyword_name=d.yd,t._sqlite3_keyword_count=d.zd,t._sqlite3_keyword_check=d.Ad,t._sqlite3_complete=d.Bd,t._sqlite3_complete16=d.Cd,t._sqlite3_libversion=d.Dd,t._sqlite3_libversion_number=d.Ed,t._sqlite3_threadsafe=d.Fd,t._sqlite3_initialize=d.Gd,t._sqlite3_shutdown=d.Hd,t._sqlite3_config=d.Id,t._sqlite3_db_mutex=d.Jd,t._sqlite3_db_release_memory=d.Kd,t._sqlite3_db_cacheflush=d.Ld,t._sqlite3_db_config=d.Md,t._sqlite3_last_insert_rowid=d.Nd,t._sqlite3_set_last_insert_rowid=d.Od,t._sqlite3_changes64=d.Pd,t._sqlite3_changes=d.Qd,t._sqlite3_total_changes64=d.Rd,t._sqlite3_total_changes=d.Sd,t._sqlite3_txn_state=d.Td,t._sqlite3_close=d.Ud,t._sqlite3_close_v2=d.Vd,t._sqlite3_busy_handler=d.Wd,t._sqlite3_progress_handler=d.Xd,t._sqlite3_busy_timeout=d.Yd,t._sqlite3_interrupt=d.Zd,t._sqlite3_is_interrupted=d._d,t._sqlite3_create_function=d.$d,t._sqlite3_create_function_v2=d.ae,t._sqlite3_create_window_function=d.be,t._sqlite3_create_function16=d.ce,t._sqlite3_overload_function=d.de,t._sqlite3_trace_v2=d.ee,t._sqlite3_commit_hook=d.fe,t._sqlite3_update_hook=d.ge,t._sqlite3_rollback_hook=d.he,t._sqlite3_autovacuum_pages=d.ie,t._sqlite3_wal_autocheckpoint=d.je,t._sqlite3_wal_hook=d.ke,t._sqlite3_wal_checkpoint_v2=d.le,t._sqlite3_wal_checkpoint=d.me,t._sqlite3_error_offset=d.ne,t._sqlite3_errmsg16=d.oe,t._sqlite3_errcode=d.pe,t._sqlite3_extended_errcode=d.qe,t._sqlite3_system_errno=d.re,t._sqlite3_errstr=d.se,t._sqlite3_limit=d.te,t._sqlite3_open=d.ue,t._sqlite3_open_v2=d.ve,t._sqlite3_open16=d.we,t._sqlite3_create_collation=d.xe,t._sqlite3_create_collation_v2=d.ye,t._sqlite3_create_collation16=d.ze,t._sqlite3_collation_needed=d.Ae,t._sqlite3_collation_needed16=d.Be,t._sqlite3_get_clientdata=d.Ce,t._sqlite3_set_clientdata=d.De,t._sqlite3_get_autocommit=d.Ee,t._sqlite3_table_column_metadata=d.Fe,t._sqlite3_sleep=d.Ge,t._sqlite3_extended_result_codes=d.He,t._sqlite3_file_control=d.Ie,t._sqlite3_test_control=d.Je,t._sqlite3_create_filename=d.Ke,t._sqlite3_free_filename=d.Le,t._sqlite3_uri_parameter=d.Me,t._sqlite3_uri_key=d.Ne,t._sqlite3_uri_boolean=d.Oe,t._sqlite3_uri_int64=d.Pe,t._sqlite3_filename_database=d.Qe,t._sqlite3_filename_journal=d.Re,t._sqlite3_filename_wal=d.Se,t._sqlite3_db_name=d.Te,t._sqlite3_db_filename=d.Ue,t._sqlite3_db_readonly=d.Ve,t._sqlite3_compileoption_used=d.We,t._sqlite3_compileoption_get=d.Xe,t._sqlite3_sourceid=d.Ye;var Ci=t._malloc=d.Ze,Ri=t._free=d._e;t._RegisterExtensionFunctions=d.$e,t._getSqliteFree=d.af;var Pi=t._main=d.bf;t._libauthorizer_set_authorizer=d.cf,t._libfunction_create_function=d.df,t._libhook_commit_hook=d.ef,t._libhook_update_hook=d.ff,t._libprogress_progress_handler=d.gf,t._libvfs_vfs_register=d.hf;var Fi=d.kf,xi=d.lf,Oi=d.mf,Di=d.nf,Bi=d.of,Ni=d.pf;t.dynCall_vi=d.dynCall_vi,t.dynCall_iiiii=d.dynCall_iiiii,t.dynCall_viii=d.dynCall_viii,t.dynCall_iii=d.dynCall_iii,t.dynCall_iiii=d.dynCall_iiii,t.dynCall_iiiiiii=d.dynCall_iiiiiii,t.dynCall_ii=d.dynCall_ii,t.dynCall_vii=d.dynCall_vii,t.dynCall_iiiiii=d.dynCall_iiiiii,t.dynCall_viiii=d.dynCall_viiii,t.dynCall_iiiiiiiii=d.dynCall_iiiiiiiii,t.dynCall_vijii=d.dynCall_vijii,t.dynCall_viiiii=d.dynCall_viiiii,t.dynCall_iiiij=d.dynCall_iiiij,t.dynCall_viji=d.dynCall_viji,t.dynCall_viiiij=d.dynCall_viiiij,t.dynCall_iij=d.dynCall_iij,t.dynCall_v=d.dynCall_v,t.dynCall_iijii=d.dynCall_iijii,t.dynCall_iiji=d.dynCall_iiji,t.dynCall_i=d.dynCall_i,t.dynCall_iiiiiij=d.dynCall_iiiiiij,t.dynCall_ji=d.dynCall_ji,t.dynCall_iiiiiiii=d.dynCall_iiiiiiii;var Mi=d.qf,ji=d.rf,Ui=d.sf,Hi=d.tf;t._sqlite3_version=5472;function Vi(){var e=Pi,n=0,i=0;try{var s=e(n,i);return Ft(s,!0),s}catch(u){return tt(u)}}function nt(){if(_e>0){Ae=nt;return}if(Be(),_e>0){Ae=nt;return}function e(){if(t.calledRun=!0,!A){xr(),c(t),t.onRuntimeInitialized?.();var n=t.noInitialRun||!1;n||Vi(),Or()}}t.setStatus?(t.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>t.setStatus(""),1),e()},1)):e()}function zi(){if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.shift()()}return zi(),nt(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor;let n=0;t.set_authorizer=function(i,s,u){n&&(t.deleteCallback(n),t._sqlite3_free(n),n=0),n=t._sqlite3_malloc(4),we(n,s instanceof e?1:0,"i32");const h=he("libauthorizer_set_authorizer","number",["number","number","number"],[i,s?1:0,n]);return!h&&s&&t.setCallback(n,(m,v,T,C,N,W)=>s(u,v,T,C,N,W)),h}})(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor,n=["xFunc","xStep","xFinal"],i=new Map;t.create_function=function(s,u,h,m,v,T,C,N){const W=t._sqlite3_malloc(4),V={xFunc:T,xStep:C,xFinal:N};we(W,n.reduce((H,ee,Y)=>V[ee]instanceof e?H|1<<Y:H,0),"i32");const F=he("libfunction_create_function","number",["number","string","number","number","number","number","number","number"],[s,u,h,m,W,T?1:0,C?1:0,N?1:0]);if(!F){if(i.has(u)){const H=i.get(u);t.deleteCallback(H)}i.set(u,W),t.setCallback(W,{xFunc:T,xStep:C,xFinal:N})}return F}})(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor;let n=0;t.update_hook=function(i,s){n&&(t.deleteCallback(n),t._sqlite3_free(n),n=0),n=t._sqlite3_malloc(4),we(n,s instanceof e?1:0,"i32"),he("libhook_update_hook","void",["number","number","number"],[i,s?1:0,n]),s&&t.setCallback(n,(u,h,m,v,T,C)=>s(h,m,v,T,C))}})(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor;let n=0;t.commit_hook=function(i,s){n&&(t.deleteCallback(n),t._sqlite3_free(n),n=0),n=t._sqlite3_malloc(4),we(n,s instanceof e?1:0,"i32"),he("libhook_commit_hook","void",["number","number","number"],[i,s?1:0,n]),s&&t.setCallback(n,u=>s())}})(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor;let n=0;t.progress_handler=function(i,s,u,h){n&&(t.deleteCallback(n),t._sqlite3_free(n),n=0),n=t._sqlite3_malloc(4),we(n,u instanceof e?1:0,"i32"),he("libprogress_progress_handler","number",["number","number","number","number"],[i,s,u?1:0,n]),u&&t.setCallback(n,m=>u(h))}})(),(function(){const e=["xOpen","xDelete","xAccess","xFullPathname","xRandomness","xSleep","xCurrentTime","xGetLastError","xCurrentTimeInt64","xClose","xRead","xWrite","xTruncate","xSync","xFileSize","xLock","xUnlock","xCheckReservedLock","xFileControl","xSectorSize","xDeviceCharacteristics","xShmMap","xShmLock","xShmBarrier","xShmUnmap"],n=new Map;t.vfs_register=function(i,s){let u=0,h=0;e.forEach((v,T)=>{i[v]&&(u|=1<<T,i.hasAsyncMethod(v)&&(h|=1<<T))});const m=t._sqlite3_malloc(4);try{const v=he("libvfs_vfs_register","number",["string","number","number","number","number","number"],[i.name,i.mxPathname,u,h,s?1:0,m]);if(!v){if(n.has(i.name)){const C=n.get(i.name);t.deleteCallback(C)}const T=St(m,"*");n.set(i.name,T),t.setCallback(T,i)}return v}finally{t._sqlite3_free(m)}}})(),r=f,r}),xs=Fs,Os=new Set(["TransactionInactiveError","InvalidStateError"]),Ds=class{path;flags;metadata;fileSize=0;needsMetadataSync=!1;rollback=null;changedPages=new Set;synchronous="full";txOptions={durability:"strict"};constructor(r,t,c){this.path=r,this.flags=t,this.metadata=c}},Bs=class Rr extends $e(_s){mapIdToFile=new Map;lastError=null;log=null;#r;#t;static async create(r,t,c){const l=new Rr(r,t,c);return await l.isReady(),l}constructor(r,t,c={}){super(r,t,c),this.#r=this.#e(c.idbName??r)}async#e(r){this.#t=await Ns.create(r)}close(){this.#t.close()}async isReady(){await super.isReady(),await this.#r}getFilename(r){const t=this.mapIdToFile.get(r).path;return`IDB(${this.name}):${t}`}async jOpen(r,t,c,l){try{const _=new URL(r||Math.random().toString(36).slice(2),"file://").pathname;let p=await this.#t.q(({metadata:k})=>k.get(_));if(!p&&c&Ke&&(p={name:_,fileSize:0,version:0},await this.#t.q(({metadata:k})=>k.put(p),"rw")),!p)throw new Error(`File ${_} not found`);const b=new Ds(_,c,p);return this.mapIdToFile.set(t,b),l.setInt32(0,c,!0),x}catch(f){return this.lastError=f,mt}}async jDelete(r,t){try{const l=new URL(r,"file://").pathname;return this.#t.q(({metadata:f,blocks:_})=>{const p=IDBKeyRange.bound([l,-1/0],[l,1/0]);_.delete(p),f.delete(l)},"rw"),t&&await this.#t.sync(!1),x}catch(c){return this.lastError=c,Yi}}async jAccess(r,t,c){try{const f=new URL(r,"file://").pathname,_=await this.#t.q(({metadata:p})=>p.get(f));return c.setInt32(0,_?1:0,!0),x}catch(l){return this.lastError=l,Ki}}async jClose(r){try{const t=this.mapIdToFile.get(r);return this.mapIdToFile.delete(r),t.flags&ns&&await this.#t.q(({metadata:c,blocks:l})=>{c.delete(t.path),l.delete(IDBKeyRange.bound([t.path,0],[t.path,1/0]))},"rw"),t.needsMetadataSync&&this.#t.q(({metadata:c})=>c.put(t.metadata),"rw"),await this.#t.sync(t.synchronous==="full"),x}catch(t){return this.lastError=t,Gi}}async jRead(r,t,c){try{const l=this.mapIdToFile.get(r);let f=0;for(;f<t.byteLength;){const _=c+f,p=await this.#t.q(({blocks:I})=>{const L=IDBKeyRange.bound([l.path,-_],[l.path,1/0]);return I.get(L)});if(!p||p.data.byteLength-p.offset<=_)return t.fill(0,f),wr;const b=t.subarray(f),k=_+p.offset,S=Math.min(Math.max(p.data.byteLength-k,0),b.byteLength);b.set(p.data.subarray(k,k+S)),f+=S}return x}catch(l){return this.lastError=l,es}}jWrite(r,t,c){try{const l=this.mapIdToFile.get(r);if(l.flags&ye&&!l.rollback){const b=Object.assign({pendingVersion:l.metadata.version-1},l.metadata);this.#t.q(({metadata:k})=>k.put(b),"rw",l.txOptions),l.rollback=Object.assign({},l.metadata),l.metadata.version--}l.flags&ye&&l.changedPages.add(c);const f=t.slice(),_=l.metadata.version;if(!(c<l.metadata.fileSize)||l.flags&ye||l.flags&ss){const b={path:l.path,offset:-c,version:_,data:t.slice()};this.#t.q(({blocks:k})=>{k.put(b),l.changedPages.add(c)},"rw",l.txOptions)}else this.#t.q(async({blocks:b})=>{const k=IDBKeyRange.bound([l.path,-c],[l.path,1/0]),S=await b.get(k);S.data.subarray(c+S.offset).set(f),b.put(S)},"rw",l.txOptions);return l.metadata.fileSize<c+t.length&&(l.metadata.fileSize=c+t.length,l.needsMetadataSync=!0),x}catch(l){return this.lastError=l,br}}jTruncate(r,t){try{const c=this.mapIdToFile.get(r);return t<c.metadata.fileSize&&(this.#t.q(({blocks:l})=>{const f=IDBKeyRange.bound([c.path,-1/0],[c.path,-t,1/0]);l.delete(f)},"rw",c.txOptions),c.metadata.fileSize=t,c.needsMetadataSync=!0),x}catch(c){return this.lastError=c,ts}}async jSync(r,t){try{const c=this.mapIdToFile.get(r);return c.needsMetadataSync&&(this.#t.q(({metadata:l})=>l.put(c.metadata),"rw",c.txOptions),c.needsMetadataSync=!1),c.flags&ye?c.synchronous==="full"&&await this.#t.sync(!0):await this.#t.sync(c.synchronous==="full"),x}catch(c){return this.lastError=c,Ji}}jFileSize(r,t){try{const c=this.mapIdToFile.get(r);return t.setBigInt64(0,BigInt(c.metadata.fileSize),!0),x}catch(c){return this.lastError=c,Xi}}async jLock(r,t){const c=this.mapIdToFile.get(r),l=await super.jLock(r,t);return t===Le&&(c.metadata=await this.#t.q(async({metadata:f,blocks:_})=>{const p=await f.get(c.path);return p.pendingVersion&&(console.warn(`removing failed transaction ${p.pendingVersion}`),await new Promise((b,k)=>{const S=IDBKeyRange.bound([p.name,-1/0],[p.name,1/0]),I=_.openCursor(S);I.onsuccess=()=>{const L=I.result;L?(L.value.version<p.version&&L.delete(),L.continue()):b()},I.onerror=()=>k(I.error)}),delete p.pendingVersion,f.put(p)),p},"rw",c.txOptions)),l}async jUnlock(r,t){if(t===ve){const c=this.mapIdToFile.get(r);await this.#t.sync(c.synchronous==="full")}return super.jUnlock(r,t)}jFileControl(r,t,c){try{const l=this.mapIdToFile.get(r);switch(t){case ls:const f=gr(c,4),_=gr(c,8);this.log?.("xFileControl",l.path,"PRAGMA",f,_);const p=k=>{const S=new TextEncoder().encode(k),I=this._module._sqlite3_malloc(S.byteLength);return this._module.HEAPU8.subarray(I,I+S.byteLength).set(S),c.setUint32(0,I,!0),sr};switch(f.toLowerCase()){case"page_size":if(l.flags&ye&&_&&l.metadata.fileSize)return sr;break;case"synchronous":if(_)switch(_.toLowerCase()){case"0":case"off":l.synchronous="off",l.txOptions={durability:"relaxed"};break;case"1":case"normal":l.synchronous="normal",l.txOptions={durability:"relaxed"};break;case"2":case"3":case"full":case"extra":l.synchronous="full",l.txOptions={durability:"strict"};break}break;case"write_hint":return super.jFileControl(r,$e.WRITE_HINT_OP_CODE,null)}break;case Sr:if(this.log?.("xFileControl",l.path,"SYNC"),l.rollback){const k=Object.assign({},l.metadata),S=l.rollback.fileSize;this.#t.q(({metadata:I,blocks:L})=>{I.put(k);for(const M of l.changedPages)if(M<S){const P=IDBKeyRange.bound([l.path,-M,k.version],[l.path,-M,1/0],!0);L.delete(P)}l.changedPages.clear()},"rw",l.txOptions),l.needsMetadataSync=!1,l.rollback=null}break;case kr:return this.log?.("xFileControl",l.path,"BEGIN_ATOMIC_WRITE"),x;case Tr:return this.log?.("xFileControl",l.path,"COMMIT_ATOMIC_WRITE"),x;case cs:this.log?.("xFileControl",l.path,"ROLLBACK_ATOMIC_WRITE"),l.metadata=l.rollback;const b=Object.assign({},l.metadata);return this.#t.q(({metadata:k,blocks:S})=>{k.put(b);for(const I of l.changedPages)S.delete([l.path,-I,b.version-1]);l.changedPages.clear()},"rw",l.txOptions),l.needsMetadataSync=!1,l.rollback=null,x}}catch(l){return this.lastError=l,dt}return super.jFileControl(r,t,c)}jDeviceCharacteristics(r){return 0|os|as}jGetLastError(r){if(this.lastError){console.error(this.lastError);const t=r.subarray(0,r.byteLength-1),{written:c}=new TextEncoder().encodeInto(this.lastError.message,t);r[c]=0}return x}};function gr(o,r){const t=o.getUint32(r,!0);if(t){const c=new Uint8Array(o.buffer,t);return new TextDecoder().decode(c.subarray(0,c.indexOf(0)))}return null}var Ns=class Pr{#r;#t=null;#e=Promise.resolve();#n=null;#s=new WeakSet;log=null;static async create(r){const t=await new Promise((c,l)=>{const f=indexedDB.open(r,6);f.onupgradeneeded=async _=>{const p=f.result;switch(_.oldVersion&&console.log(`Upgrading IndexedDB from version ${_.oldVersion}`),_.oldVersion){case 0:p.createObjectStore("blocks",{keyPath:["path","offset","version"]}).createIndex("version",["path","version"]);case 5:const b=f.transaction;b.objectStore("blocks").deleteIndex("version");const S=p.createObjectStore("metadata",{keyPath:"name"});await new Promise((I,L)=>{let M={};const P=b.objectStore("blocks").openCursor();P.onsuccess=()=>{const w=P.result;if(w){const g=w.value;typeof g.offset!="number"||g.path===M.path&&g.offset===M.offset?w.delete():g.offset===0&&(S.put({name:g.path,fileSize:g.fileSize,version:g.version}),delete g.fileSize,w.update(g)),M=g,w.continue()}else I()},P.onerror=()=>L(P.error)});break}},f.onsuccess=()=>c(f.result),f.onerror=()=>l(f.error)});return new Pr(t)}constructor(r){this.#r=r}close(){this.#r.close()}q(r,t="ro",c={}){const l=t==="ro"?"readonly":"readwrite",f=Object.assign({durability:"default"},c);return this.#t=(this.#t||Promise.resolve()).then(()=>this.#a(r,l,f)),this.#t}async#a(r,t,c){let l;this.#n&&this.#s.has(this.#n.transaction)&&this.#n.transaction.mode>=t&&this.#n.transaction.durability===c.durability&&(l=this.#n.transaction,this.#n.readyState==="pending"&&await new Promise(f=>{this.#n.addEventListener("success",f,{once:!0}),this.#n.addEventListener("error",f,{once:!0})}));for(let f=0;f<2;++f){l||(await this.#e,l=this.#r.transaction(this.#r.objectStoreNames,t,c),this.log?.("IDBTransaction open",t),this.#s.add(l),this.#e=new Promise((_,p)=>{l.addEventListener("complete",()=>{this.log?.("IDBTransaction complete"),this.#s.delete(l),_()}),l.addEventListener("abort",()=>{this.#s.delete(l),p(new Error("transaction aborted"))})}));try{const _=[...l.objectStoreNames].map(p=>[p,this.proxyStoreOrIndex(l.objectStore(p))]);return await r(Object.fromEntries(_))}catch(_){if(!f&&Os.has(_.name)){this.log?.(`${_.name}, retrying`),l=null;continue}throw _}}}proxyStoreOrIndex(r){return new Proxy(r,{get:(t,c,l)=>{const f=Reflect.get(t,c,l);return typeof f=="function"?(..._)=>{const p=Reflect.apply(f,t,_);return p instanceof IDBRequest&&!c.endsWith("Cursor")?(this.#n=p,p.addEventListener("error",()=>{console.error(p.error),p.transaction.abort()},{once:!0}),Ms(p)):p}:f}})}async sync(r){this.#t&&(await this.#t,r&&await this.#e,this.reset())}reset(){this.#t=null,this.#e=Promise.resolve(),this.#n=null}};function Ms(o){return new Promise((r,t)=>{o.onsuccess=()=>r(o.result),o.onerror=()=>t(o.error)})}async function lt(o,r={}){const{url:t,lockPolicy:c="shared+hint",lockTimeout:l=1/0,...f}=r,_=await xs(t?{locateFile:()=>t}:void 0),p=o.endsWith(".db")?o:`${o}.db`,b={idbName:p,lockPolicy:c,lockTimeout:l};return{path:p,sqliteModule:_,vfsFn:Bs.create,vfsOptions:b,...f}}const js={},Oe=js?"/gioibon/":"/",le={API_KEY:"google_cloud_api_key",TTS_VOICE:"tts_voice_name",TTS_RATE:"tts_rate",TTS_CACHE_LIST:"tts_gcloud_voices_list",TTS_CACHE_TS:"tts_gcloud_voices_ts"},He={VOICE_LANG:"vi-VN",VOICE_NAME:"vi-VN-Chirp3-HD-Charon",RATE:1.5,CACHE_DURATION:10080*60*1e3},yr={TTS:"https://texttospeech.googleapis.com/v1/text:synthesize",VOICES:"https://texttospeech.googleapis.com/v1/voices"},ct={SCROLL_THRESHOLD_TOP:80,SCROLL_THRESHOLD_BOTTOM:80,SCROLL_BEHAVIOR:"smooth"};class Fr{constructor(r="content.db",t=`${Oe}app-content/content.db`){this.dbName=r,this.dbUrl=t,this.db=null}async init(){if(this.db)return this.db;try{const r=this.dbUrl.replace(/\.db$/,"_version.json"),t=`db_version_${this.dbName}`,c=localStorage.getItem(t);let l=!1,f=null;try{const _=await fetch(`${r}?t=${Date.now()}`,{cache:"no-store"});_.ok?(f=await _.json(),f.version!==c?(console.log(` DB updated. Old: ${c}, New: ${f.version}`),l=!0):console.log(" DB is up-to-date. Using local cache.")):(console.warn(` Cannot fetch version file (${_.status}). Force checking integrity.`),l=!c)}catch(_){console.warn(" Error checking DB version (Likely offline). Proceeding with local DB.",_),l=!c}if(l){console.log(" Downloading fresh DB...");const _=await fetch(`${this.dbUrl}?t=${Date.now()}`,{cache:"no-store"});if(!_.ok)throw new Error(`Failed to download DB: ${_.status}`);const p=await _.arrayBuffer(),b=new File([p],this.dbName),k=await ot(lt(this.dbName,{...pr(b),url:`${Oe}wa-sqlite-async.wasm`}));f&&localStorage.setItem(t,f.version),this.db=k;try{await k.run("PRAGMA cache_size = 500"),await k.run("PRAGMA temp_store = MEMORY"),await k.run("PRAGMA synchronous = OFF"),await k.run("PRAGMA mmap_size = 0")}catch(S){console.warn(" Cannot set PRAGMAs",S)}}else{const _=await ot(lt(this.dbName,{url:`${Oe}wa-sqlite-async.wasm`}));try{if((await _.run("SELECT name FROM sqlite_master WHERE type='table' AND name='contents'")).length===0)return console.warn(" Cached DB is empty/corrupted. Force re-downloading."),localStorage.removeItem(t),this.db=null,await this.forceDownload();await _.run("PRAGMA cache_size = 500"),await _.run("PRAGMA temp_store = MEMORY"),await _.run("PRAGMA mmap_size = 0")}catch(p){return console.warn(" DB integrity check failed.",p),localStorage.removeItem(t),this.db=null,await this.forceDownload()}this.db=_}return this.db}catch(r){throw console.error(" SqliteConnection Init Error:",r),r}}async forceDownload(){console.log(" Force downloading DB...");const r=await fetch(`${this.dbUrl}?t=${Date.now()}`,{cache:"no-store"});if(!r.ok)throw new Error(`Failed to download DB: ${r.status}`);const t=await r.arrayBuffer(),c=new File([t],this.dbName);this.db=await ot(lt(this.dbName,{...pr(c),url:`${Oe}wa-sqlite-async.wasm`}));try{const l=this.dbUrl.replace(/\.db$/,"_version.json"),f=await fetch(`${l}?t=${Date.now()}`,{cache:"no-store"});if(f.ok){const _=await f.json();localStorage.setItem(`db_version_${this.dbName}`,_.version)}}catch{}return this.db}async query(r,t=[]){return this.db||await this.init(),await this.db.run(r,t)}}class Us{constructor(){this.apiKey=localStorage.getItem(le.API_KEY)||"",this.cachedVoices=this._loadVoicesFromCache(),this.voice={languageCode:He.VOICE_LANG,name:localStorage.getItem(le.TTS_VOICE)||He.VOICE_NAME},this.rate=parseFloat(localStorage.getItem(le.TTS_RATE))||He.RATE}setApiKey(r){this.apiKey=r,localStorage.setItem(le.API_KEY,r)}getApiKey(){return this.apiKey}hasApiKey(){return!!this.apiKey&&this.apiKey.length>0}setVoice(r,t="vi-VN"){this.voice={name:r,languageCode:t},localStorage.setItem(le.TTS_VOICE,r)}setRate(r){this.rate=r,localStorage.setItem(le.TTS_RATE,r)}_loadVoicesFromCache(){const r=localStorage.getItem(le.TTS_CACHE_LIST);if(r)try{return JSON.parse(r)}catch(t){console.warn("Failed to parse cached voices:",t)}return[]}async getVoices(r=!1){if(!this.apiKey)return[];const t=parseInt(localStorage.getItem(le.TTS_CACHE_TS)||"0"),c=Date.now();if(!r&&this.cachedVoices.length>0&&c-t<He.CACHE_DURATION)return console.log("Using cached voices."),this.cachedVoices;console.log("Fetching voices from API...");try{const l=await fetch(`${yr.VOICES}?key=${this.apiKey}&languageCode=vi-VN`);if(!l.ok)return this.cachedVoices.length>0?(console.warn("Fetch failed, using stale cache."),this.cachedVoices):[];const p=((await l.json()).voices||[]).filter(b=>b.languageCodes.includes("vi-VN"));return p.length>0&&(this.cachedVoices=p,localStorage.setItem(le.TTS_CACHE_LIST,JSON.stringify(p)),localStorage.setItem(le.TTS_CACHE_TS,c.toString())),p}catch(l){return console.error("Error fetching voices:",l),this.cachedVoices.length>0?this.cachedVoices:[]}}async fetchAudioBlob(r){if(!this.apiKey)throw new Error("Vui lng nhp Google Cloud API Key trong phn Ci t.");const t={input:{text:r},voice:{languageCode:this.voice.languageCode,name:this.voice.name},audioConfig:{audioEncoding:"MP3",speakingRate:this.rate,pitch:0}};try{const c=await fetch(`${yr.TTS}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!c.ok){const f=await c.json().catch(()=>({}));throw new Error(f.error?.message||`API Error: ${c.status}`)}const l=await c.json();if(l.audioContent){const f=atob(l.audioContent),_=new Uint8Array(f.length);for(let p=0;p<f.length;p++)_[p]=f.charCodeAt(p);return new Blob([_],{type:"audio/mp3"})}throw new Error("No audio content received")}catch(c){throw console.error("TTS Fetch Error:",c),c}}async fetchAudio(r){const t=await this.fetchAudioBlob(r);return new Promise((c,l)=>{const f=new FileReader;f.onloadend=()=>c(f.result),f.onerror=l,f.readAsDataURL(t)})}}class Hs{constructor(){this.ttsRules=null,this.rulesPromise=this._loadRules()}async _loadRules(){try{const r=await fetch(`${Oe}app-content/tts_rules.json`);r.ok&&(this.ttsRules=await r.json())}catch(r){console.warn(" Khng tm thy tts_rules.json",r)}}async normalize(r){if(!r)return"";if(await this.rulesPromise,!this.ttsRules)return r;let t=r;if(this.ttsRules.remove_html&&(t=t.replace(/<[^>]*>?/gm,"")),this.ttsRules.remove_chars){const c=this.ttsRules.remove_chars.map(f=>this._escapeRegExp(f)).join(""),l=new RegExp(`[${c}]`,"g");t=t.replace(l," ")}if(this.ttsRules.collapse_spaces&&(t=t.replace(/\s+/g," ").trim()),this.ttsRules.phonetics)for(const[c,l]of Object.entries(this.ttsRules.phonetics)){const f=new RegExp(this._escapeRegExp(c),"gi");t=t.replace(f,l)}return this.ttsRules.capitalize_upper&&this._isUpper(t)&&(t=this._capitalize(t)),t}_escapeRegExp(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}_isUpper(r){return r===r.toUpperCase()&&r!==r.toLowerCase()}_capitalize(r){return r&&r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()}}const Vs="tts_audio_cache",Te="audios",zs=1;class Ws{constructor(){this.db=null,this.initPromise=this.init()}async init(){if(!this.db)return new Promise((r,t)=>{const c=indexedDB.open(Vs,zs);c.onupgradeneeded=l=>{const f=l.target.result;f.objectStoreNames.contains(Te)||f.createObjectStore(Te,{keyPath:"hash"})},c.onsuccess=l=>{this.db=l.target.result,r()},c.onerror=l=>{console.error("AudioCache IDB Error:",l.target.error),t(l.target.error)}})}async generateHash(r,t,c){if(!r)return null;const l=`${r}|${t}|${c}`,_=new TextEncoder().encode(l),p=await crypto.subtle.digest("SHA-256",_);return Array.from(new Uint8Array(p)).map(S=>S.toString(16).padStart(2,"0")).join("").substring(0,16)}async get(r){return await this.initPromise,new Promise((t,c)=>{const _=this.db.transaction([Te],"readonly").objectStore(Te).get(r);_.onsuccess=()=>{t(_.result?_.result.blob:null)},_.onerror=()=>c(_.error)})}async set(r,t){return await this.initPromise,new Promise((c,l)=>{const _=this.db.transaction([Te],"readwrite").objectStore(Te),p={hash:r,blob:t,timestamp:Date.now()},b=_.put(p);b.onsuccess=()=>c(),b.onerror=()=>l(b.error)})}async has(r){return!!await this.get(r)}}const Ve=new Ws;class $s{constructor(r,t){this.engine=r,this.dbConnection=t}async resolve(r,t,c,l){const f=await l.normalize(r.text);if(t!==c()||!f)return null;const _=this.engine.voice.name,p=this.engine.voice.languageCode,b=await Ve.generateHash(f,_,p),k=`${b}.mp3`;if(r.audio===k&&this.dbConnection)try{const S=await this.dbConnection.query("SELECT audio_blob FROM audios WHERE audio_name = ?",[r.audio]);if(S&&S.length>0){let I=S[0].audio_blob;if(I){const L=new Blob([I],{type:"audio/mp3"});return{url:URL.createObjectURL(L),isBlob:!0}}}}catch(S){console.error("DB Blob Fetch Error:",S)}if(await Ve.has(b)){if(t!==c())return null;const S=await Ve.get(b);return{url:URL.createObjectURL(S),isBlob:!0}}if(this.engine.hasApiKey())try{const S=await this.engine.fetchAudioBlob(f);return t!==c()?null:(await Ve.set(b,S),{url:URL.createObjectURL(S),isBlob:!0})}catch(S){console.error("AudioResolver API Error:",S)}if(r.audio&&r.audio!=="skip"&&this.dbConnection)try{const S=await this.dbConnection.query("SELECT audio_blob FROM audios WHERE audio_name = ?",[r.audio]);if(S&&S.length>0&&S[0].audio_blob){const I=new Blob([S[0].audio_blob],{type:"audio/mp3"});return{url:URL.createObjectURL(I),isBlob:!0}}}catch(S){console.error("DB Fallback Fetch Error:",S)}return null}}class Ks{constructor(r){this.engine=new Us,this.textProcessor=new Hs,this.audioResolver=new $s(this.engine,r),this.audioElement=new Audio,this.audioQueue=[],this.isPlaying=!1,this.isPaused=!1,this.currentAudio=this.audioElement,this.currentSegmentId=null,this.isSequence=!1,this.sequenceParentId=null,this.isLooping=!1,this.currentPlaylist=[],this.onSegmentStart=null,this.onSegmentEnd=null,this.onPlaybackEnd=null,this.onPlaybackStateChange=null,this.playbackSessionId=0,this.preloadMap=new Map,this.preloadDepth=2,this.currentBlobUrl=null}setApiKey(r){this.engine.setApiKey(r)}getApiKey(){return this.engine.getApiKey()}setVoice(r){this.engine.setVoice(r)}setRate(r){this.engine.setRate(r)}getVoices(r){return this.engine.getVoices(r)}get currentVoice(){return this.engine.voice}get currentRate(){return this.engine.rate}playSegment(r,t,c){if(String(this.currentSegmentId)===String(r)&&(this.isPlaying||this.isPaused)){this.togglePause();return}this._startNewSession(),this.isSequence=!1;const l={id:r,audio:t,text:c};this.audioQueue=[l],this.currentPlaylist=[l],this._processQueue()}playSequence(r,t=null){if(this.isSequence&&r.length>0&&this.currentPlaylist.length>0&&String(this.currentPlaylist[0].id)===String(r[0].id)&&(this.isPlaying||this.isPaused)){this.togglePause();return}this._startNewSession(),this.isSequence=!0,this.sequenceParentId=t,this.audioQueue=[...r],this.currentPlaylist=[...r],this._processQueue()}pause(){this.audioElement.paused||(this.audioElement.pause(),this.isPaused=!0,this.isPlaying=!1,this._emitState("paused"))}resume(){this.audioElement.paused&&this.isPaused?(this.audioElement.play(),this.isPaused=!1,this.isPlaying=!0,this._emitState("playing")):this.audioQueue.length>0&&!this.isPlaying&&!this.isPaused&&this._processQueue()}togglePause(){this.isPaused?this.resume():this.pause()}stop(){this._cleanupSession(),this.audioQueue=[],this.currentPlaylist=[],this.sequenceParentId=null,this.audioElement.pause(),this.audioElement.currentTime=0,this.audioElement.removeAttribute("src"),this.audioElement.load(),this._revokeCurrentBlob(),this.isPlaying=!1,this.isPaused=!1,this.currentSegmentId=null,this.isSequence=!1,this.onPlaybackEnd&&this.onPlaybackEnd(),this._emitState("stopped")}_startNewSession(){this._cleanupSession(),this.playbackSessionId++}_cleanupSession(){for(const r of this.preloadMap.values())URL.revokeObjectURL(r);this.preloadMap.clear()}_revokeCurrentBlob(){this.currentBlobUrl&&(URL.revokeObjectURL(this.currentBlobUrl),this.currentBlobUrl=null)}_getCurrentSessionId(){return this.playbackSessionId}async _preloadNextItem(){if(this.audioQueue.length===0)return;const r=this.playbackSessionId;for(let t=0;t<Math.min(this.preloadDepth,this.audioQueue.length);t++){const c=this.audioQueue[t];if(!this.preloadMap.has(c.id)){const l=await this.audioResolver.resolve(c,r,()=>this.playbackSessionId,this.textProcessor);l&&l.isBlob&&this.playbackSessionId===r&&this.preloadMap.set(c.id,l.url)}}}async _processQueue(){if(this.audioQueue.length===0)if(this.isLooping&&this.currentPlaylist.length>0)this.audioQueue=[...this.currentPlaylist];else{this.stop();return}if(this.isPaused)return;this._revokeCurrentBlob(),this.isPlaying=!0,this._emitState("playing");const r=this.audioQueue.shift();this.currentSegmentId=r.id,this.onSegmentStart&&this.onSegmentStart(r.id,this.isSequence);try{const t=this.playbackSessionId;let c=null,l=!1;if(this.preloadMap.has(r.id))c=this.preloadMap.get(r.id),l=!0,this.preloadMap.delete(r.id);else{const _=await this.audioResolver.resolve(r,t,()=>this.playbackSessionId,this.textProcessor);_&&(c=_.url,l=_.isBlob)}if(t!==this.playbackSessionId)return;if(!c){this._handleSegmentEnd(r.id,null);return}l&&(this.currentBlobUrl=c),this.audioElement.src=c,this.engine.rate&&(this.audioElement.playbackRate=this.engine.rate);const f=()=>{this._revokeCurrentBlob(),this._handleSegmentEnd(r.id)};this.audioElement.onended=f,this.audioElement.onerror=_=>{console.error("Audio Playback Error:",_,c),f()},await this.audioElement.play(),this._preloadNextItem()}catch(t){console.error("Playback error",t),this._handleSegmentEnd(r.id)}}_handleSegmentEnd(r){this.onSegmentEnd&&this.onSegmentEnd(r),this._processQueue()}_emitState(r){this.onPlaybackStateChange&&this.onPlaybackStateChange(r)}}class Qs{constructor(r){this.db=r||new Fr,this.data=null}async load(){if(this.data)return this.data;try{this.data=[];let t=0,c=!0;for(;c;){const l=await this.db.query(`SELECT uid, html, label, segment, audio_name, hint FROM contents WHERE uid > ${t} ORDER BY uid ASC LIMIT 100`);if(l&&l.length>0){const f=l.map(_=>({id:_.uid,html:_.html,label:_.label,audio:_.audio_name,text:_.hint||_.segment}));this.data.push(...f),t=l[l.length-1].uid,await new Promise(_=>setTimeout(_,5))}else c=!1}return this.data}catch(r){throw console.error("ContentLoader Error:",r),r}}getAllSegments(){return this.data?this.data.filter(r=>r.audio!=="skip").map(r=>({id:r.id,audio:r.audio,text:r.text})):[]}getSegmentsStartingFrom(r){if(!this.data)return[];let t=0;return r&&(t=this.data.findIndex(l=>l.id===r),t===-1&&(t=0)),this.data.slice(t).filter(l=>l.audio!=="skip").map(l=>({id:l.id,audio:l.audio,text:l.text}))}getSegment(r){return this.data?.find(t=>t.id===r)}getSegmentsByLabelPrefix(r){return this.data?this.data.filter(t=>t.label.startsWith(r)):[]}getRuleSegments(r,t){return[]}}class Gs{constructor(r,t,c,l){this.container=document.getElementById(r),this.sidebar=document.getElementById(t),this.toggle=document.getElementById(c),this.contentRenderer=l,this.activeLink=null}render(r){if(!this.container)return;this.container.innerHTML="";const t=document.createElement("ul");t.className="toc-main-list",this.container.appendChild(t);let c=null,l=null,f=null;r.forEach(_=>{const p=_.html?_.html.match(/^<h(\d)>(.*?)<\/h\d>/i):null,b=_.label.endsWith("-name");if(p||b){let k=p?parseInt(p[1]):4;b&&(k=4);let S=(_.text||"").replace(/<[^>]*>?/gm,"").trim();if(!S&&!b)return;const I=this._createLink(_,S,k);if(k===1){const L=document.createElement("li");L.className="toc-item level-title",L.appendChild(I),t.appendChild(L),c=null,l=null,f=null}else if(k===2){const L=document.createElement("li");L.className="toc-item level-h2",L.appendChild(I),t.appendChild(L),c=L,l=null,f=null}else if(k===3){const L=document.createElement("li");L.className="toc-item level-h3",L.appendChild(I),t.appendChild(L),l=L,f=null}else if(k===4){const L=l||c;if(L){(!f||f.parentElement!==L)&&(f=document.createElement("ul"),f.className="toc-rule-list",L.appendChild(f));let M=S;const P=S.match(/^(\d+)\./)||S.match(/^(\d+)$/)||S.match(/(\d+)$/);if(P)M=P[1];else{const g=_.label.match(/([a-z]+)(\d+)-name/i);g&&(M=g[2])}M.length>3&&(M=M.substring(0,3)),I.textContent=M,I.title=S,I.className="toc-link rule-link";const w=document.createElement("li");w.className="toc-rule-item",w.appendChild(I),f.appendChild(w)}}}}),this._setupToggle()}_createLink(r,t,c){const l=document.createElement("a");return l.className="toc-link",l.href=`#segment-${r.id}`,l.dataset.id=r.id,l.textContent=t,l.onclick=f=>{f.preventDefault(),this._handleLinkClick(r.id,l)},l}_handleLinkClick(r,t){this.contentRenderer&&this.contentRenderer.scrollToSegment(r),this._setActive(t),window.innerWidth<=1024&&this.sidebar&&this.sidebar.classList.remove("visible")}_setActive(r){this.container&&this.container.querySelectorAll(".toc-link").forEach(t=>t.classList.remove("active")),r.classList.add("active"),this.activeLink=r}_setupToggle(){if(!this.toggle)return;const r=this.toggle.cloneNode(!0);this.toggle.parentNode.replaceChild(r,this.toggle),this.toggle=r,this.toggle.addEventListener("click",()=>{this.sidebar.classList.toggle("visible")}),document.addEventListener("click",t=>{window.innerWidth<=1024&&this.sidebar&&!this.sidebar.contains(t.target)&&!this.toggle.contains(t.target)&&this.sidebar.classList.contains("visible")&&this.sidebar.classList.remove("visible")})}}class Ys{constructor(r){this.callbacks=r}create(r,t){const c=document.createElement("div");c.className="segment",c.dataset.id=r.id,c.dataset.label=r.label,c.dataset.index=t,c.addEventListener("mouseenter",()=>{this.callbacks.onHover&&this.callbacks.onHover(r.id)}),this._applyClasses(c,r);const l=document.createElement("div");return l.className="segment-content-wrapper",this._addPlayButtons(l,r,t),this._addTextContent(l,r),c.appendChild(l),this._addMaskToggle(c,r),c}_applyClasses(r,t){t.label.endsWith("-name")?r.classList.add("rule-header"):t.label.endsWith("-chapter")?r.classList.add("chapter-header"):t.label==="title"&&r.classList.add("main-title"),t.html&&t.html.match(/^<h[1-6]/i)&&r.classList.add("heading-segment"),t.html&&t.html.match(/class=['"](endsection|endvagga|endsutta|sadhu|namo)['"]/)&&r.classList.add("end-segment")}_addPlayButtons(r,t,c){if(t.audio&&t.audio!=="skip"){const l=document.createElement("button");l.id=`play-btn-${t.id}`,l.name=`play-btn-${t.id}`,l.className="play-btn icon-btn",l.innerHTML='<i class="fas fa-circle"></i>',l.title="Nghe on ny",l.onclick=f=>{f.stopPropagation(),this.callbacks.playSegment&&this.callbacks.playSegment(t.id,t.audio,t.text)},r.appendChild(l)}if(t.html&&t.html.match(/^<h[1-6]/i)&&t.label!=="title"&&t.label!=="subtitle"){const l=document.createElement("button");l.id=`play-seq-btn-${t.id}`,l.name=`play-seq-btn-${t.id}`,l.className="play-btn icon-btn play-sequence-btn",l.innerHTML='<i class="fas fa-play-circle"></i>',l.title="Nghe ton b phn ny",l.onclick=f=>{f.stopPropagation(),this.callbacks.playSequence&&this.callbacks.playSequence(c)},r.appendChild(l)}}_addTextContent(r,t){const c=document.createElement("div");c.className="segment-text";const f=(t.html||"{}").replace("{}",t.text||"");c.innerHTML=f,r.appendChild(c)}_addMaskToggle(r,t){const c=t.html&&t.html.match(/^<h[1-6]/i)&&t.label!=="title"&&t.label!=="subtitle";if(t.audio&&t.audio!=="skip"||c){const f=document.createElement("div");f.className="segment-mask-toggle",f.title="Nhp  che/hin text",this.callbacks.onMaskStart&&(f.addEventListener("mousedown",_=>this.callbacks.onMaskStart(_,r,t)),f.addEventListener("touchstart",_=>this.callbacks.onMaskStart(_,r,t),{passive:!1})),this.callbacks.onMaskEnter&&f.addEventListener("mouseenter",_=>this.callbacks.onMaskEnter(_,r)),r.appendChild(f)}}}class Xs{constructor(r){this.container=r,this.items=[],this.isDraggingMask=!1,this.dragMaskAction=null,this.lastActionTime=0,this.cooldownMs=250,this._setupGlobalListeners()}setItems(r){this.items=r}_setupGlobalListeners(){const r=()=>{this.isDraggingMask=!1,this.dragMaskAction=null};document.addEventListener("mouseup",r),document.addEventListener("touchend",r)}_isHeading(r){return r.html&&r.html.match(/^<h[1-6]/i)&&r.label!=="title"&&r.label!=="subtitle"}toggleMask(r,t){const c=Date.now();if(c-this.lastActionTime<this.cooldownMs)return;this.lastActionTime=c;const l=r.querySelector(".segment-text");if(!l)return;if(this._isHeading(t)){this._toggleHeadingMask(r,t);return}const f=l.classList.contains("masked");this._applyMaskAction(l,f?"unmask":"mask")}handleMaskStart(r,t,c){if(r.type==="mousedown"&&r.button!==0)return;const l=Date.now();if(l-this.lastActionTime<this.cooldownMs){r&&r.cancelable&&r.preventDefault();return}this.lastActionTime=l,r&&r.cancelable&&r.preventDefault(),this.isDraggingMask=!0;const f=t.querySelector(".segment-text");if(this._isHeading(c)){this._toggleHeadingMask(t,c);return}const _=f.classList.contains("masked");this.dragMaskAction=_?"unmask":"mask",this._applyMaskAction(f,this.dragMaskAction)}handleMaskEnter(r,t){if(!this.isDraggingMask||!this.dragMaskAction)return;const c=t.dataset.id,l=this.items.find(_=>String(_.id)===String(c));if(l&&this._isHeading(l))return;const f=t.querySelector(".segment-text");this._applyMaskAction(f,this.dragMaskAction)}_applyMaskAction(r,t){t==="mask"?r.classList.add("masked"):r.classList.remove("masked")}_toggleHeadingMask(r,t){const c=parseInt(r.dataset.index),l=t.html.match(/^<h(\d)>/i);if(!l)return;const f=parseInt(l[1]);let _="mask";for(let p=c+1;p<this.items.length;p++){const b=this.items[p];if(b.label==="end")break;const k=b.html?b.html.match(/^<h(\d)>/i):null;if(k){if(parseInt(k[1])<=f)break;continue}const S=this._findElement(b.id);if(S){const I=S.querySelector(".segment-text");if(I){_=I.classList.contains("masked")?"unmask":"mask";break}}}for(let p=c+1;p<this.items.length;p++){const b=this.items[p];if(b.label==="end")break;const k=b.html?b.html.match(/^<h(\d)>/i):null;if(k){if(parseInt(k[1])<=f)break;continue}const S=this._findElement(b.id);if(S){const I=S.querySelector(".segment-text");I&&this._applyMaskAction(I,_)}}}_findElement(r){return this.container.querySelector(`.segment[data-id="${r}"]`)}}const Js=60;class Zs{constructor(r,t,c){this.container=document.getElementById(r),this.playSegmentCallback=t,this.playSequenceCallback=c,this.items=[],this.hoveredSegmentId=null,this.elementCache=new Map,this.activeSegmentId=null,this.maskManager=new Xs(this.container),this.segmentFactory=new Ys({playSegment:this.playSegmentCallback,playSequence:l=>this._handlePlaySequence(l),onMaskStart:(l,f,_)=>this.maskManager.handleMaskStart(l,f,_),onMaskEnter:(l,f)=>this.maskManager.handleMaskEnter(l,f),onHover:l=>{this.hoveredSegmentId=l}}),this.renderedCount=0,this.observer=null,this.sentinel=null,this.currentPrefix=null,this.isRendering=!1,this._setupKeyboardListeners()}_setupKeyboardListeners(){document.addEventListener("keydown",r=>{if(r.target.tagName==="INPUT"||r.target.tagName==="SELECT")return;const t=r.key.toLowerCase();t==="r"?this._handleKeyboardPlay():t==="f"&&this._handleKeyboardFlip()})}render(r){if(this.container){if(this.observer&&(this.observer.disconnect(),this.observer=null),this.container.innerHTML="",this.elementCache.clear(),this.activeSegmentId=null,this.renderedCount=0,this.currentPrefix=null,this.sentinel=null,this.isRendering=!1,this.items=r||[],this.maskManager.setItems(this.items),!this.items||this.items.length===0){this.container.innerHTML='<div class="empty">Khng c d liu hin th.</div>';return}this.sentinel=document.createElement("div"),this.sentinel.className="loading-sentinel",this.sentinel.style.height="50px",this.sentinel.style.width="100%",this.container.appendChild(this.sentinel),this.observer=new IntersectionObserver(t=>{t[0].isIntersecting&&(this.isRendering||(this.isRendering=!0,requestAnimationFrame(()=>this._renderNextBatch())))},{root:this.container,rootMargin:"200px",threshold:.1}),this.observer.observe(this.sentinel),this._renderNextBatch()}}_renderNextBatch(){if(this.renderedCount>=this.items.length){this.sentinel&&this.sentinel.remove(),this.observer&&this.observer.disconnect(),this.isRendering=!1;return}const r=this.items.slice(this.renderedCount,this.renderedCount+Js),t=document.createDocumentFragment();let c=null;this.sentinel&&this.sentinel.previousElementSibling&&this.sentinel.previousElementSibling.classList.contains("section")&&(c=this.sentinel.previousElementSibling),r.forEach((l,f)=>{const _=this.renderedCount+f;let p="misc";if(["title","subtitle","nidana"].includes(l.label))p="intro";else if(l.label==="end")p="outro";else if(l.label.startsWith("note"))p=this.currentPrefix||"intro";else{const S=l.label.match(/^([a-z]+)/);S&&(p=S[1])}(p!==this.currentPrefix||l.label.endsWith("-chapter")||l.label==="title"||!c)&&(this.currentPrefix=p,c=document.createElement("section"),c.className=`section section-${p}`,c.id=`section-${l.label}`,t.appendChild(c));const k=this.segmentFactory.create(l,_);this.elementCache.set(l.id,k),c.appendChild(k)}),this.sentinel&&this.sentinel.parentNode===this.container?this.container.insertBefore(t,this.sentinel):this.container.appendChild(t),this.renderedCount+=r.length,this.isRendering=!1,this.renderedCount>=this.items.length&&(this.sentinel&&this.sentinel.remove(),this.observer&&this.observer.disconnect())}_handlePlaySequence(r){if(!this.playSequenceCallback)return;const t=this.items[r],c=t.html?t.html.match(/^<h(\d)>/i):null;if(!c)return;const l=parseInt(c[1]),f=[];for(let _=r+1;_<this.items.length;_++){const p=this.items[_];if(p.label==="end")break;const b=p.html?p.html.match(/^<h(\d)>/i):null;if(b&&parseInt(b[1])<=l)break;p.audio&&p.audio!=="skip"&&f.push({id:p.id,audio:p.audio,text:p.text})}f.length>0?this.playSequenceCallback(f,t.id):alert("Khng c d liu m thanh cho phn ny.")}_handleKeyboardPlay(){if(!this.hoveredSegmentId)return;const r=this.items.find(t=>t.id===this.hoveredSegmentId);if(r)if(r.html&&r.html.match(/^<h[1-6]/i)){const t=this.items.indexOf(r);this._handlePlaySequence(t)}else r.audio&&r.audio!=="skip"&&this.playSegmentCallback&&this.playSegmentCallback(r.id,r.audio,r.text)}_handleKeyboardFlip(){if(!this.hoveredSegmentId)return;const r=this.items.find(c=>c.id===this.hoveredSegmentId);if(!r)return;const t=this.elementCache.get(this.hoveredSegmentId);if(t){const c=r.audio&&r.audio!=="skip",l=r.html&&r.html.match(/^<h[1-6]/i)&&r.label!=="title"&&r.label!=="subtitle";(c||l)&&this.maskManager.toggleMask(t,r)}}_ensureRendered(r){if(!(r===-1||r<this.renderedCount))for(;this.renderedCount<=r&&(this._renderNextBatch(),!(this.renderedCount>=this.items.length)););}scrollToSegment(r){this.highlightSegment(r,!0)}highlightSegment(r,t=!0){if(!this.container)return;let c=this.elementCache.get(r);if(!c){const l=this.items.findIndex(f=>f.id===r);l!==-1&&(this._ensureRendered(l),c=this.elementCache.get(r))}if(this.activeSegmentId!==null&&this.activeSegmentId!==r){const l=this.elementCache.get(this.activeSegmentId);l&&l.classList.remove("active")}c&&(c.classList.add("active"),this.activeSegmentId=r,t&&this._smartScroll(c))}_parseThreshold(r){return typeof r=="number"?r:typeof r!="string"?0:r.endsWith("vh")?parseFloat(r)/100*document.documentElement.clientHeight:parseFloat(r)||0}_smartScroll(r){if(!this.container||!r)return;const t=r.getBoundingClientRect(),c=this.container.getBoundingClientRect(),l=this._parseThreshold(ct.SCROLL_THRESHOLD_TOP),f=this._parseThreshold(ct.SCROLL_THRESHOLD_BOTTOM),_=c.top+l,p=c.bottom-f,b=t.top<_,k=t.bottom>p;if(b||k){const I=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?"auto":ct.SCROLL_BEHAVIOR,L=this.container.scrollTop+(t.top-_);this.container.scrollTo({top:L,behavior:I})}}clearHighlight(){if(this.activeSegmentId!==null){const r=this.elementCache.get(this.activeSegmentId);r&&r.classList.remove("active"),this.activeSegmentId=null}}updatePlaybackState(r,t,c,l){if(this.container.querySelectorAll(".play-btn:not(.play-sequence-btn)").forEach(p=>{p.classList.remove("active-play"),p.innerHTML='<i class="fas fa-circle"></i>',p.title="Nghe on ny"}),this.container.querySelectorAll(".play-sequence-btn").forEach(p=>{p.classList.remove("active-play"),p.innerHTML='<i class="fas fa-play-circle"></i>',p.title="Nghe ton b phn ny"}),!t||r==="stopped")return;const f=this.elementCache.get(t);if(!f)return;const _=f.querySelector(".play-btn:not(.play-sequence-btn)");if(_&&(_.classList.add("active-play"),_.innerHTML=r==="playing"?'<i class="fas fa-pause-circle"></i>':'<i class="fas fa-play-circle"></i>',_.title=r==="playing"?"Tm dng":"Tip tc"),c&&l){const p=this.elementCache.get(l);if(p){const b=p.querySelector(".play-sequence-btn");b&&(b.classList.add("active-play"),b.innerHTML=r==="playing"?'<i class="fas fa-pause-circle"></i>':'<i class="fas fa-play-circle"></i>',b.title=r==="playing"?"Tm dng":"Tip tc")}}}getFirstVisibleSegmentId(){if(!this.container)return null;const r=this.container.querySelectorAll(".segment");for(const t of r){const c=t.getBoundingClientRect();if(c.top+c.height>80&&c.top<window.innerHeight&&parseInt(t.dataset.id))return parseInt(t.dataset.id)}return null}}class ea{constructor(r,t,c,l,f){this.playBtn=document.getElementById("play-all-btn"),this.pauseBtn=document.getElementById("pause-btn"),this.stopBtn=document.getElementById("stop-btn"),this.speedSelect=document.getElementById("speed-select"),this.loopBtn=document.getElementById("loop-btn"),this.hintToggleBtn=document.getElementById("hint-toggle-btn");const _="sutta_loop_enabled",p="tts_rate",b="sutta_hint_mode_enabled";if(this.playBtn&&this.playBtn.addEventListener("click",r),this.pauseBtn&&this.pauseBtn.addEventListener("click",t),this.stopBtn&&this.stopBtn.addEventListener("click",c),this.speedSelect){const k=localStorage.getItem(p);k&&(this.speedSelect.value=k),this.speedSelect.addEventListener("change",S=>{const I=parseFloat(S.target.value);localStorage.setItem(p,I),l(I)})}if(this.loopBtn&&(localStorage.getItem(_)==="true"&&this.loopBtn.classList.add("active"),this.loopBtn.addEventListener("click",()=>{const S=this.loopBtn.classList.toggle("active");localStorage.setItem(_,S),f&&f(S)})),this.hintToggleBtn){const k=localStorage.getItem(b);(k===null||k==="true")&&(this.hintToggleBtn.classList.add("active"),document.body.classList.add("hint-mode-active")),this.hintToggleBtn.addEventListener("click",()=>{const I=this.hintToggleBtn.classList.toggle("active");I?document.body.classList.add("hint-mode-active"):document.body.classList.remove("hint-mode-active"),localStorage.setItem(b,I)})}document.addEventListener("keydown",k=>{if(k.target.tagName==="INPUT"||k.target.tagName==="TEXTAREA"||k.target.isContentEditable)return;const S=k.key.toLowerCase();S==="g"&&this.loopBtn&&this.loopBtn.click(),S==="h"&&this.hintToggleBtn&&this.hintToggleBtn.click(),S==="t"&&this._changeSpeedIndex(1,l),S==="e"&&this._changeSpeedIndex(-1,l)})}_changeSpeedIndex(r,t){if(!this.speedSelect)return;const c=this.speedSelect.selectedIndex+r;if(c>=0&&c<this.speedSelect.options.length){this.speedSelect.selectedIndex=c;const l=parseFloat(this.speedSelect.value);localStorage.setItem("tts_rate",l),t&&t(l)}}updateState(r){if(!this.playBtn||!this.pauseBtn||!this.stopBtn)return;const t=this.pauseBtn.querySelector("i");switch(r){case"playing":this.playBtn.disabled=!0,this.pauseBtn.disabled=!1,this.stopBtn.disabled=!1,t&&(t.classList.remove("fa-play"),t.classList.add("fa-pause"));break;case"paused":this.playBtn.disabled=!0,this.pauseBtn.disabled=!1,this.stopBtn.disabled=!1,t&&(t.classList.remove("fa-pause"),t.classList.add("fa-play"));break;case"stopped":this.playBtn.disabled=!1,this.pauseBtn.disabled=!0,this.stopBtn.disabled=!0,t&&(t.classList.remove("fa-play"),t.classList.add("fa-pause"));break}}setSpeed(r){this.speedSelect&&(this.speedSelect.value=r.toString())}}class ta{constructor(r){this.ttsEngine=r,this.modal=document.getElementById("settings-modal"),this.openBtn=document.getElementById("settings-btn"),this.closeBtn=document.querySelector(".close-modal"),this.form=document.getElementById("settings-form"),this.apiKeyInput=document.getElementById("api-key"),this.voiceSelect=document.getElementById("voice-select"),this.refreshVoicesBtn=document.getElementById("refresh-voices-btn"),this._setupListeners()}_setupListeners(){this.openBtn&&this.openBtn.addEventListener("click",r=>{r.preventDefault(),this._open()}),this.closeBtn&&this.closeBtn.addEventListener("click",r=>{r.preventDefault(),this._close()}),this.form&&this.form.addEventListener("submit",r=>{r.preventDefault(),this._save()}),this.refreshVoicesBtn&&this.refreshVoicesBtn.addEventListener("click",r=>{r.preventDefault(),this._loadVoices(!0)}),this.voiceSelect&&this.voiceSelect.addEventListener("change",r=>{this.ttsEngine.setVoice(r.target.value)}),window.addEventListener("click",r=>{r.target===this.modal&&this._close()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&!this.modal.classList.contains("hidden")&&this._close()})}_open(){try{this.modal.classList.remove("hidden"),this.ttsEngine&&(this.apiKeyInput&&(this.apiKeyInput.value=this.ttsEngine.getApiKey()||""),this._loadVoices(!1))}catch(r){console.error("Error opening settings modal:",r)}}_close(){this.modal.classList.add("hidden")}_save(){try{const r=this.apiKeyInput?this.apiKeyInput.value.trim():"";this.ttsEngine.setApiKey(r),this._close(),r?this._loadVoices(!0):this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Vui lng nhp API Key</option>')}catch(r){console.error("Error saving settings:",r)}}async _loadVoices(r){if(!this.ttsEngine||!this.ttsEngine.getApiKey()){this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Vui lng nhp API Key trc</option>');return}this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>ang ti...</option>'),this.refreshVoicesBtn&&(this.refreshVoicesBtn.disabled=!0,this.refreshVoicesBtn.innerHTML='<i class="fas fa-spin fa-spinner"></i>');try{const t=await this.ttsEngine.getVoices(r);if(this.voiceSelect){this.voiceSelect.innerHTML="";const c=this.ttsEngine.currentVoice,l=c?c.name:"";!t||t.length===0?this.voiceSelect.innerHTML='<option value="" disabled selected>Khng tm thy ging ting Vit</option>':(t.forEach(f=>{const _=document.createElement("option");_.value=f.name,_.textContent=`${f.name} (${f.ssmlGender})`,f.name===l&&(_.selected=!0),this.voiceSelect.appendChild(_)}),t.length>0&&!t.find(f=>f.name===l)&&(this.voiceSelect.selectedIndex=0,this.ttsEngine.setVoice(t[0].name)))}}catch(t){console.error("Error loading voices:",t),this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Li ti ging</option>')}finally{this.refreshVoicesBtn&&(this.refreshVoicesBtn.disabled=!1,this.refreshVoicesBtn.innerHTML='<i class="fas fa-sync-alt"></i>')}}}const ra={init(){const o=document.getElementById("btn-toggle-drawer"),r=document.getElementById("control-drawer");o&&r&&(o.addEventListener("click",t=>{t.stopPropagation(),r.classList.toggle("hidden"),o.classList.toggle("open");const c=document.getElementById("control-bar");c&&c.classList.toggle("expanded")}),document.addEventListener("click",t=>{if(!r.classList.contains("hidden")&&!r.contains(t.target)&&!o.contains(t.target)){r.classList.add("hidden"),o.classList.remove("open");const l=document.getElementById("control-bar");l&&l.classList.remove("expanded")}}),r.addEventListener("click",t=>{t.stopPropagation()}))}},ut={HUE_COEFF:"35deg",SATURATE:"60%",STORAGE_KEY_PREFIX:"sutta_sepia_"},na={CONFIG:{STORAGE_KEY_THEME:"sutta_theme"},init(){const o=document.getElementById("btn-theme-toggle"),r=o?.querySelector(".icon-moon"),t=o?.querySelector(".icon-sun"),c=document.getElementById("sepia-control-panel"),l=document.getElementById("sepia-slider"),f=document.getElementById("btn-sepia-indicator");document.documentElement.style.setProperty("--sepia-hue-coeff",ut.HUE_COEFF),document.documentElement.style.setProperty("--sepia-saturate",ut.SATURATE);const _=window.matchMedia("(prefers-color-scheme: dark)").matches;let b=localStorage.getItem(this.CONFIG.STORAGE_KEY_THEME)||(_?"dark":"light");const k=P=>`${ut.STORAGE_KEY_PREFIX}${P}`,S=()=>{if(!c)return;c.classList.contains("hidden")?(c.classList.remove("hidden"),f&&f.classList.add("panel-open")):(c.classList.add("hidden"),f&&f.classList.remove("panel-open"))},I=(P,w)=>{const g=w==="dark"?.2:.3;return P/100*g},L=(P,w)=>{const g=I(P,w);document.documentElement.style.setProperty("--sepia-overlay-opacity",g),l&&l.value!=P&&(l.value=P),f&&(f.textContent=`${P}%`)},M=P=>{document.documentElement.setAttribute("data-theme",P),localStorage.setItem(this.CONFIG.STORAGE_KEY_THEME,P),b=P,P==="dark"?(r?.classList.add("hidden"),t?.classList.remove("hidden")):(r?.classList.remove("hidden"),t?.classList.add("hidden"));const w=localStorage.getItem(k(P))||0;L(w,P)};M(b),f&&f.addEventListener("click",P=>{P.stopPropagation(),S()}),o&&o.addEventListener("click",()=>{M(b==="light"?"dark":"light"),c&&!c.classList.contains("hidden")&&S()}),l&&(l.addEventListener("input",P=>{const w=P.target.value;L(w,b),localStorage.setItem(k(b),w)}),document.addEventListener("click",P=>{c&&!c.classList.contains("hidden")&&!c.contains(P.target)&&!o.contains(P.target)&&(!f||!f.contains(P.target))&&S()}),c.addEventListener("click",P=>{P.stopPropagation()}))}},ia={MIN_SCALE:.8,MAX_SCALE:2,STEP:.1,DEFAULT_SCALE:1,STORAGE_KEY:"sutta_font_scale",init(){const o=document.getElementById("btn-font-decrease"),r=document.getElementById("btn-font-increase"),t=document.getElementById("font-size-label"),c=localStorage.getItem(this.STORAGE_KEY);let l=c?parseFloat(c):this.DEFAULT_SCALE;this.applyScale(l),o&&o.addEventListener("click",f=>{f.stopPropagation(),l>this.MIN_SCALE&&(l=Math.max(this.MIN_SCALE,l-this.STEP),this.applyScale(l))}),r&&r.addEventListener("click",f=>{f.stopPropagation(),l<this.MAX_SCALE&&(l=Math.min(this.MAX_SCALE,l+this.STEP),this.applyScale(l))}),t&&(t.addEventListener("click",f=>{f.stopPropagation(),l=this.DEFAULT_SCALE,this.applyScale(l)}),t.style.cursor="pointer")},applyScale(o){const r=Math.round(o*10)/10;document.documentElement.style.setProperty("--text-scale",r),localStorage.setItem(this.STORAGE_KEY,r)}},sa="modulepreload",aa=function(o){return"/gioibon/"+o},vr={},oa=function(r,t,c){let l=Promise.resolve();if(t&&t.length>0){let b=function(k){return Promise.all(k.map(S=>Promise.resolve(S).then(I=>({status:"fulfilled",value:I}),I=>({status:"rejected",reason:I}))))};document.getElementsByTagName("link");const _=document.querySelector("meta[property=csp-nonce]"),p=_?.nonce||_?.getAttribute("nonce");l=b(t.map(k=>{if(k=aa(k),k in vr)return;vr[k]=!0;const S=k.endsWith(".css"),I=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${k}"]${I}`))return;const L=document.createElement("link");if(L.rel=S?"stylesheet":sa,S||(L.as="script"),L.crossOrigin="",L.href=k,p&&L.setAttribute("nonce",p),document.head.appendChild(L),S)return new Promise((M,P)=>{L.addEventListener("load",M),L.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${k}`)))})}))}function f(_){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=_,window.dispatchEvent(p),!p.defaultPrevented)throw _}return l.then(_=>{for(const p of _||[])p.status==="rejected"&&f(p.reason);return r().catch(f)})};function la(o={}){const{immediate:r=!1,onNeedRefresh:t,onOfflineReady:c,onRegistered:l,onRegisteredSW:f,onRegisterError:_}=o;let p,b,k;const S=async(L=!0)=>{await b,k?.()};async function I(){if("serviceWorker"in navigator){if(p=await oa(async()=>{const{Workbox:L}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:L}},[]).then(({Workbox:L})=>new L("/gioibon/sw.js",{scope:"/gioibon/",type:"classic"})).catch(L=>{_?.(L)}),!p)return;k=()=>{p?.messageSkipWaiting()};{let L=!1;const M=()=>{L=!0,p?.addEventListener("controlling",P=>{P.isUpdate&&window.location.reload()}),t?.()};p.addEventListener("installed",P=>{typeof P.isUpdate>"u"?typeof P.isExternal<"u"&&P.isExternal?M():!L&&c?.():P.isUpdate||c?.()}),p.addEventListener("waiting",M)}p.register({immediate:r}).then(L=>{f?f("/gioibon/sw.js",L):l?.(L)}).catch(L=>{_?.(L)})}}return b=I(),S}function ca(){const o=document.getElementById("btn-clear-cache");o&&o.addEventListener("click",async()=>{if(confirm("Bn c chc chn mun lm mi ton b d liu? Cc cu hnh nh API Key, font size v tc  c s c gi li.")){o.disabled=!0,o.style.opacity="0.5";try{const f=["google_cloud_api_key","tts_voice_name","tts_rate","sutta_font_scale","sutta_theme","sutta_sepia_light","sutta_sepia_dark","sutta_loop_enabled","sutta_hint_mode_enabled"],_={};if(f.forEach(p=>{const b=localStorage.getItem(p);b!==null&&(_[p]=b)}),"serviceWorker"in navigator){const p=await navigator.serviceWorker.getRegistrations();for(let b of p)await b.unregister()}if("caches"in window){const p=await caches.keys();await Promise.all(p.map(b=>caches.delete(b)))}indexedDB.databases&&(await indexedDB.databases()).forEach(b=>{b.name&&indexedDB.deleteDatabase(b.name)}),localStorage.clear(),sessionStorage.clear(),Object.entries(_).forEach(([p,b])=>{localStorage.setItem(p,b)}),window.location.reload()}catch(f){console.error("Li khi xa cache:",f),alert(" xy ra li khi lm mi d liu. Vui lng th li."),o.disabled=!1,o.style.opacity="1"}}});const r=document.getElementById("pwa-toast"),t=document.getElementById("pwa-refresh"),c=document.getElementById("pwa-close"),l=document.getElementById("btn-update-app");if(r&&t&&c){const f=la({onNeedRefresh(){r.classList.remove("hidden"),l&&l.classList.add("update-available")},onOfflineReady(){console.log("App ready to work offline")}}),_=()=>{f(!0)};t.addEventListener("click",_),l&&l.addEventListener("click",async()=>{if(!r.classList.contains("hidden")){_();return}l.classList.add("rotating"),l.title="ang kim tra...";try{if("serviceWorker"in navigator){const p=await navigator.serviceWorker.getRegistration();p&&(await p.update(),setTimeout(()=>{l.classList.remove("rotating"),l.title="Kim tra & Cp nht",r.classList.contains("hidden")&&alert("ng dng v d liu   phin bn mi nht.")},1500))}}catch(p){console.error("Manual update check failed:",p),l.classList.remove("rotating")}}),c.addEventListener("click",()=>{r.classList.add("hidden")})}}document.addEventListener("DOMContentLoaded",async()=>{ca(),await new Promise(p=>setTimeout(p,150));const o=new Fr,r=new Qs(o),t=new Ks(o),c=localStorage.getItem("sutta_loop_enabled")==="true";t.isLooping=c,ra.init(),na.init(),ia.init();const l=new Zs("content",(p,b,k)=>{t.playSegment(p,b,k)},(p,b)=>{t.playSequence(p,b)}),f=new Gs("toc-list","sidebar","sidebar-toggle",l),_=new ea(()=>{if(t.isPaused)t.resume();else{const p=l.getFirstVisibleSegmentId();if(p){const b=r.getSegmentsStartingFrom(p);b.length>0&&t.playSequence(b)}else{const b=r.getAllSegments();b.length>0&&t.playSequence(b)}}},()=>{t.isPlaying?t.pause():t.isPaused&&t.resume()},()=>{t.stop()},p=>{t.setRate(p)},p=>{t.isLooping=p});_.setSpeed(t.currentRate),new ta(t.engine),t.onSegmentStart=(p,b)=>{l.highlightSegment(p,b),l.updatePlaybackState(t.isPlaying?"playing":"paused",p,b,t.sequenceParentId)},t.onPlaybackEnd=()=>{l.clearHighlight(),_.updateState("stopped"),l.updatePlaybackState("stopped",null,!1,null)},t.onPlaybackStateChange=p=>{_.updateState(p),l.updatePlaybackState(p,t.currentSegmentId,t.isSequence,t.sequenceParentId)};try{const p=await r.load();l.render(p),f.render(p);const b=document.querySelector(".loading");b&&b.remove()}catch(p){console.error("Initialization Error:",p),document.getElementById("content").innerHTML='<div class="error">Khng th ti d liu. Vui lng th li sau.</div>'}});
