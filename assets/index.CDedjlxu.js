var jt=(b,e)=>()=>(e||b((e={exports:{}}).exports,e),e.exports);import{i as Et,u as Ct,w as Rt}from"./vendor-sqlite.CMSgUCi5.js";var ue=jt((Nt,Lt)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();const Ht={},bt=Ht?"/gioibon/":"/",ut={API_KEY:"google_cloud_api_key",TTS_VOICE:"tts_voice_name",TTS_RATE:"tts_rate",TTS_CACHE_LIST:"tts_gcloud_voices_list",TTS_CACHE_TS:"tts_gcloud_voices_ts"},wt={VOICE_LANG:"vi-VN",VOICE_NAME:"vi-VN-Chirp3-HD-Charon",RATE:1.5,CACHE_DURATION:10080*60*1e3},zt={TTS:"https://texttospeech.googleapis.com/v1/text:synthesize",VOICES:"https://texttospeech.googleapis.com/v1/voices"},At={SCROLL_THRESHOLD_TOP:80,SCROLL_THRESHOLD_BOTTOM:80,SCROLL_BEHAVIOR:"smooth"},xt="libs/wa-sqlite/wa-sqlite-async.wasm";class Dt{constructor(e="content.db",r=`${bt}app-content/content.db`){this.dbName=e,this.dbUrl=r,this.db=null}async init(){if(this.db)return this.db;try{const e=this.dbUrl.replace(/\.db$/,"_version.json"),r=`db_version_${this.dbName}`,s=localStorage.getItem(r);let t=!1,i=null;try{const a=await fetch(`${e}?t=${Date.now()}`,{cache:"no-store"});a.ok?(i=await a.json(),i.version!==s&&(t=!0)):t=!s}catch{t=!s}if(t){const a=await fetch(`${this.dbUrl}?t=${Date.now()}`,{cache:"no-store"});if(!a.ok)throw new Error(`Failed to download DB: ${a.status}`);const h=await a.arrayBuffer(),m=new File([h],this.dbName),u=await Et(Ct(this.dbName,{...Rt(m),url:xt}));i&&localStorage.setItem(r,i.version),this.db=u;try{await u.run("PRAGMA cache_size = 500"),await u.run("PRAGMA temp_store = MEMORY"),await u.run("PRAGMA synchronous = OFF"),await u.run("PRAGMA mmap_size = 0"),await u.run("PRAGMA query_only = 1")}catch{}}else{const a=await Et(Ct(this.dbName,{url:xt}));try{if((await a.run("SELECT name FROM sqlite_master WHERE type='table' AND name='contents'")).length===0)return localStorage.removeItem(r),this.db=null,await this.forceDownload();await a.run("PRAGMA cache_size = 500"),await a.run("PRAGMA temp_store = MEMORY"),await a.run("PRAGMA mmap_size = 0"),await a.run("PRAGMA query_only = 1")}catch{return localStorage.removeItem(r),this.db=null,await this.forceDownload()}this.db=a}return this.db}catch(e){throw e}}async forceDownload(){const e=await fetch(`${this.dbUrl}?t=${Date.now()}`,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to download DB: ${e.status}`);const r=await e.arrayBuffer(),s=new File([r],this.dbName);this.db=await Et(Ct(this.dbName,{...Rt(s),url:xt}));try{const t=this.dbUrl.replace(/\.db$/,"_version.json"),i=await fetch(`${t}?t=${Date.now()}`,{cache:"no-store"});if(i.ok){const a=await i.json();localStorage.setItem(`db_version_${this.dbName}`,a.version)}}catch{}try{await this.db.run("PRAGMA cache_size = 500"),await this.db.run("PRAGMA temp_store = MEMORY"),await this.db.run("PRAGMA mmap_size = 0"),await this.db.run("PRAGMA query_only = 1")}catch{}return this.db}async query(e,r=[]){return this.db||await this.init(),await this.db.run(e,r)}}class Wt{constructor(){this.apiKey=localStorage.getItem(ut.API_KEY)||"",this.cachedVoices=this._loadVoicesFromCache(),this.voice={languageCode:wt.VOICE_LANG,name:localStorage.getItem(ut.TTS_VOICE)||wt.VOICE_NAME},this.rate=parseFloat(localStorage.getItem(ut.TTS_RATE))||wt.RATE}setApiKey(e){this.apiKey=e,localStorage.setItem(ut.API_KEY,e)}getApiKey(){return this.apiKey}hasApiKey(){return!!this.apiKey&&this.apiKey.length>0}setVoice(e,r="vi-VN"){this.voice={name:e,languageCode:r},localStorage.setItem(ut.TTS_VOICE,e)}setRate(e){this.rate=e,localStorage.setItem(ut.TTS_RATE,e)}_loadVoicesFromCache(){const e=localStorage.getItem(ut.TTS_CACHE_LIST);if(e)try{return JSON.parse(e)}catch{}return[]}async getVoices(e=!1){if(!this.apiKey)return[];const r=parseInt(localStorage.getItem(ut.TTS_CACHE_TS)||"0"),s=Date.now();if(!e&&this.cachedVoices.length>0&&s-r<wt.CACHE_DURATION)return this.cachedVoices;try{const t=await fetch(`${zt.VOICES}?key=${this.apiKey}&languageCode=vi-VN`);if(!t.ok)return this.cachedVoices.length>0?this.cachedVoices:[];const h=((await t.json()).voices||[]).filter(m=>m.languageCodes.includes("vi-VN"));return h.length>0&&(this.cachedVoices=h,localStorage.setItem(ut.TTS_CACHE_LIST,JSON.stringify(h)),localStorage.setItem(ut.TTS_CACHE_TS,s.toString())),h}catch{return this.cachedVoices.length>0?this.cachedVoices:[]}}async fetchAudioBlob(e){if(!this.apiKey)throw new Error("Vui lòng nhập Google Cloud API Key trong phần Cài đặt.");const r={input:{text:e},voice:{languageCode:this.voice.languageCode,name:this.voice.name},audioConfig:{audioEncoding:"MP3",speakingRate:this.rate,pitch:0}};try{const s=await fetch(`${zt.TTS}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok){const i=await s.json().catch(()=>({}));throw new Error(i.error?.message||`API Error: ${s.status}`)}const t=await s.json();if(t.audioContent){const i=atob(t.audioContent),a=new Uint8Array(i.length);for(let h=0;h<i.length;h++)a[h]=i.charCodeAt(h);return new Blob([a],{type:"audio/mp3"})}throw new Error("No audio content received")}catch(s){throw s}}async fetchAudio(e){const r=await this.fetchAudioBlob(e);return new Promise((s,t)=>{const i=new FileReader;i.onloadend=()=>s(i.result),i.onerror=t,i.readAsDataURL(r)})}}class Zt{constructor(){this.ttsRules=null,this.rulesPromise=this._loadRules()}async _loadRules(){try{const e=await fetch(`${bt}app-content/tts_rules.json`);e.ok&&(this.ttsRules=await e.json())}catch{}}async normalize(e){if(!e)return"";if(await this.rulesPromise,!this.ttsRules)return e;let r=e;if(this.ttsRules.remove_html&&(r=r.replace(/<[^>]*>?/gm,"")),this.ttsRules.remove_chars){const s=this.ttsRules.remove_chars.map(i=>this._escapeRegExp(i)).join(""),t=new RegExp(`[${s}]`,"g");r=r.replace(t," ")}if(this.ttsRules.collapse_spaces&&(r=r.replace(/\s+/g," ").trim()),this.ttsRules.phonetics)for(const[s,t]of Object.entries(this.ttsRules.phonetics)){const i=new RegExp(this._escapeRegExp(s),"gi");r=r.replace(i,t)}return this.ttsRules.capitalize_upper&&this._isUpper(r)&&(r=this._capitalize(r)),r}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}_isUpper(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}_capitalize(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}}const qt="tts_audio_cache",pt="audios",Kt=1;class Vt{constructor(){this.db=null,this.initPromise=this.init()}async init(){if(!this.db)return new Promise((e,r)=>{const s=indexedDB.open(qt,Kt);s.onupgradeneeded=t=>{const i=t.target.result;i.objectStoreNames.contains(pt)||i.createObjectStore(pt,{keyPath:"hash"})},s.onsuccess=t=>{this.db=t.target.result,e()},s.onerror=t=>{r(t.target.error)}})}async generateHash(e,r,s){if(!e)return null;const t=`${e}|${r}|${s}`,a=new TextEncoder().encode(t),h=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(h)).map(y=>y.toString(16).padStart(2,"0")).join("").substring(0,16)}async get(e){return await this.initPromise,new Promise((r,s)=>{const a=this.db.transaction([pt],"readonly").objectStore(pt).get(e);a.onsuccess=()=>{r(a.result?a.result.blob:null)},a.onerror=()=>s(a.error)})}async set(e,r){return await this.initPromise,new Promise((s,t)=>{const a=this.db.transaction([pt],"readwrite").objectStore(pt),h={hash:e,blob:r,timestamp:Date.now()},m=a.put(h);m.onsuccess=()=>s(),m.onerror=()=>t(m.error)})}async has(e){return!!await this.get(e)}}const kt=new Vt;class Gt{constructor(e,r){this.engine=e,this.dbConnection=r}async resolve(e,r,s,t){const i=await t.normalize(e.text);if(r!==s()||!i)return null;const a=this.engine.voice.name,h=this.engine.voice.languageCode,m=await kt.generateHash(i,a,h);if(e.audio&&e.audio!=="skip")return{url:`${bt}app-content/audio/${e.audio}`,isBlob:!1};if(await kt.has(m)){if(r!==s())return null;const u=await kt.get(m);return{url:URL.createObjectURL(u),isBlob:!0}}if(this.engine.hasApiKey())try{const u=await this.engine.fetchAudioBlob(i);return r!==s()?null:(await kt.set(m,u),{url:URL.createObjectURL(u),isBlob:!0})}catch{}return null}}class $t{constructor(e){this.engine=new Wt,this.textProcessor=new Zt,this.audioResolver=new Gt(this.engine,e),this.audioElement=new Audio,this.audioQueue=[],this.isPlaying=!1,this.isPaused=!1,this.currentAudio=this.audioElement,this.currentSegmentId=null,this.isSequence=!1,this.sequenceParentId=null,this.isLooping=!1,this.currentPlaylist=[],this.onSegmentStart=null,this.onSegmentEnd=null,this.onPlaybackEnd=null,this.onPlaybackStateChange=null,this.playbackSessionId=0,this.preloadMap=new Map,this.preloadDepth=2,this.currentBlobUrl=null}setApiKey(e){this.engine.setApiKey(e)}getApiKey(){return this.engine.getApiKey()}setVoice(e){this.engine.setVoice(e)}setRate(e){this.engine.setRate(e)}getVoices(e){return this.engine.getVoices(e)}get currentVoice(){return this.engine.voice}get currentRate(){return this.engine.rate}playSegment(e,r,s){if(String(this.currentSegmentId)===String(e)&&(this.isPlaying||this.isPaused)){this.togglePause();return}this._startNewSession(),this.isSequence=!1;const t={id:e,audio:r,text:s};this.audioQueue=[t],this.currentPlaylist=[t],this._processQueue()}playSequence(e,r=null){if(this.isSequence&&e.length>0&&this.currentPlaylist.length>0&&String(this.currentPlaylist[0].id)===String(e[0].id)&&(this.isPlaying||this.isPaused)){this.togglePause();return}this._startNewSession(),this.isSequence=!0,this.sequenceParentId=r,this.audioQueue=[...e],this.currentPlaylist=[...e],this._processQueue()}pause(){this.audioElement.paused||(this.audioElement.pause(),this.isPaused=!0,this.isPlaying=!1,this._emitState("paused"))}resume(){this.audioElement.paused&&this.isPaused?(this.audioElement.play(),this.isPaused=!1,this.isPlaying=!0,this._emitState("playing")):this.audioQueue.length>0&&!this.isPlaying&&!this.isPaused&&this._processQueue()}togglePause(){this.isPaused?this.resume():this.pause()}stop(){this._cleanupSession(),this.audioQueue=[],this.currentPlaylist=[],this.sequenceParentId=null,this.audioElement.pause(),this.audioElement.currentTime=0,this.audioElement.removeAttribute("src"),this.audioElement.load(),this._revokeCurrentBlob(),this.isPlaying=!1,this.isPaused=!1,this.currentSegmentId=null,this.isSequence=!1,this.onPlaybackEnd&&this.onPlaybackEnd(),this._emitState("stopped")}_startNewSession(){this._cleanupSession(),this.playbackSessionId++}_cleanupSession(){for(const e of this.preloadMap.values())URL.revokeObjectURL(e);this.preloadMap.clear()}_revokeCurrentBlob(){this.currentBlobUrl&&(URL.revokeObjectURL(this.currentBlobUrl),this.currentBlobUrl=null)}_getCurrentSessionId(){return this.playbackSessionId}async _preloadNextItem(){if(this.audioQueue.length===0)return;const e=this.playbackSessionId;for(let r=0;r<Math.min(this.preloadDepth,this.audioQueue.length);r++){const s=this.audioQueue[r];if(!this.preloadMap.has(s.id)){const t=await this.audioResolver.resolve(s,e,()=>this.playbackSessionId,this.textProcessor);t&&t.isBlob&&this.playbackSessionId===e&&this.preloadMap.set(s.id,t.url)}}}async _processQueue(){if(this.audioQueue.length===0)if(this.isLooping&&this.currentPlaylist.length>0)this.audioQueue=[...this.currentPlaylist];else{this.stop();return}if(this.isPaused)return;this._revokeCurrentBlob(),this.isPlaying=!0,this._emitState("playing");const e=this.audioQueue.shift();this.currentSegmentId=e.id,this.onSegmentStart&&this.onSegmentStart(e.id,this.isSequence);try{const r=this.playbackSessionId;let s=null,t=!1;if(this.preloadMap.has(e.id))s=this.preloadMap.get(e.id),t=!0,this.preloadMap.delete(e.id);else{const a=await this.audioResolver.resolve(e,r,()=>this.playbackSessionId,this.textProcessor);a&&(s=a.url,t=a.isBlob)}if(r!==this.playbackSessionId)return;if(!s){this._handleSegmentEnd(e.id,null);return}t&&(this.currentBlobUrl=s),this.audioElement.src=s,this.engine.rate&&(this.audioElement.playbackRate=this.engine.rate);const i=()=>{this._revokeCurrentBlob(),this._handleSegmentEnd(e.id)};this.audioElement.onended=i,this.audioElement.onerror=a=>{i()},await this.audioElement.play(),this._preloadNextItem()}catch{this._handleSegmentEnd(e.id)}}_handleSegmentEnd(e){this.onSegmentEnd&&this.onSegmentEnd(e),this._processQueue()}_emitState(e){this.onPlaybackStateChange&&this.onPlaybackStateChange(e)}}class Yt{constructor(e){this.db=e||new Dt,this.data=null}async load(){if(this.data)return this.data;try{this.data=[];let r=0,s=!0;for(;s;){const t=await this.db.query(`SELECT uid, html, label, audio_name, 
                     CASE WHEN hint IS NOT NULL AND hint != '' THEN hint ELSE segment END as text 
                     FROM contents WHERE uid > ${r} ORDER BY uid ASC LIMIT 100`);if(t&&t.length>0){const i=t.map(a=>({id:a.uid,html:a.html,label:a.label,audio:a.audio_name,text:a.text}));this.data.push(...i),r=t[t.length-1].uid,await new Promise(a=>setTimeout(a,5))}else s=!1}return this.data}catch(e){throw e}}getAllSegments(){return this.data?this.data.filter(e=>e.audio!=="skip").map(e=>({id:e.id,audio:e.audio,text:e.text})):[]}getSegmentsStartingFrom(e){if(!this.data)return[];let r=0;return e&&(r=this.data.findIndex(t=>t.id===e),r===-1&&(r=0)),this.data.slice(r).filter(t=>t.audio!=="skip").map(t=>({id:t.id,audio:t.audio,text:t.text}))}getSegment(e){return this.data?.find(r=>r.id===e)}getSegmentsByLabelPrefix(e){return this.data?this.data.filter(r=>r.label.startsWith(e)):[]}getRuleSegments(e,r){return[]}}class Xt{constructor(e,r,s,t){this.container=document.getElementById(e),this.sidebar=document.getElementById(r),this.toggle=document.getElementById(s),this.contentRenderer=t,this.activeLink=null}render(e){if(!this.container)return;this.container.innerHTML="";const r=document.createElement("ul");r.className="toc-main-list",this.container.appendChild(r);let s=null,t=null,i=null;e.forEach(a=>{const h=a.html?a.html.match(/^<h(\d)>(.*?)<\/h\d>/i):null,m=a.label.endsWith("-name");if(h||m){let u=h?parseInt(h[1]):4;m&&(u=4);let y=(a.text||"").replace(/<[^>]*>?/gm,"").trim();if(!y&&!m)return;const l=this._createLink(a,y,u);if(u===1){const g=document.createElement("li");g.className="toc-item level-title",g.appendChild(l),r.appendChild(g),s=null,t=null,i=null}else if(u===2){const g=document.createElement("li");g.className="toc-item level-h2",g.appendChild(l),r.appendChild(g),s=g,t=null,i=null}else if(u===3){const g=document.createElement("li");g.className="toc-item level-h3",g.appendChild(l),r.appendChild(g),t=g,i=null}else if(u===4){const g=t||s;if(g){(!i||i.parentElement!==g)&&(i=document.createElement("ul"),i.className="toc-rule-list",g.appendChild(i));let c=y;const f=y.match(/^(\d+)\./)||y.match(/^(\d+)$/)||y.match(/(\d+)$/);if(f)c=f[1];else{const v=a.label.match(/([a-z]+)(\d+)-name/i);v&&(c=v[2])}c.length>3&&(c=c.substring(0,3)),l.textContent=c,l.title=y,l.className="toc-link rule-link";const d=document.createElement("li");d.className="toc-rule-item",d.appendChild(l),i.appendChild(d)}}}}),this._setupToggle()}_createLink(e,r,s){const t=document.createElement("a");return t.className="toc-link",t.href=`#segment-${e.id}`,t.dataset.id=e.id,t.textContent=r,t.onclick=i=>{i.preventDefault(),this._handleLinkClick(e.id,t)},t}_handleLinkClick(e,r){this.contentRenderer&&this.contentRenderer.scrollToSegment(e),this._setActive(r),window.innerWidth<=1024&&this.sidebar&&this.sidebar.classList.remove("visible")}_setActive(e){this.container&&this.container.querySelectorAll(".toc-link").forEach(r=>r.classList.remove("active")),e.classList.add("active"),this.activeLink=e}_setupToggle(){if(!this.toggle)return;const e=this.toggle.cloneNode(!0);this.toggle.parentNode.replaceChild(e,this.toggle),this.toggle=e,this.toggle.addEventListener("click",()=>{this.sidebar.classList.toggle("visible")}),document.addEventListener("click",r=>{window.innerWidth<=1024&&this.sidebar&&!this.sidebar.contains(r.target)&&!this.toggle.contains(r.target)&&this.sidebar.classList.contains("visible")&&this.sidebar.classList.remove("visible")})}}class Qt{constructor(e){this.callbacks=e}create(e,r){const s=document.createElement("div");s.className="segment",s.dataset.id=e.id,s.dataset.label=e.label,s.dataset.index=r,s.addEventListener("mouseenter",()=>{this.callbacks.onHover&&this.callbacks.onHover(e.id)}),this._applyClasses(s,e);const t=document.createElement("div");return t.className="segment-content-wrapper",this._addPlayButtons(t,e,r),this._addTextContent(t,e),s.appendChild(t),this._addMaskToggle(s,e),s}_applyClasses(e,r){r.label.endsWith("-name")?e.classList.add("rule-header"):r.label.endsWith("-chapter")?e.classList.add("chapter-header"):r.label==="title"&&e.classList.add("main-title"),r.html&&r.html.match(/^<h[1-6]/i)&&e.classList.add("heading-segment"),r.html&&r.html.match(/class=['"](endsection|endvagga|endsutta|sadhu|namo)['"]/)&&e.classList.add("end-segment")}_addPlayButtons(e,r,s){if(r.audio&&r.audio!=="skip"){const t=document.createElement("button");t.id=`play-btn-${r.id}`,t.name=`play-btn-${r.id}`,t.className="play-btn icon-btn",t.innerHTML='<i class="fas fa-circle"></i>',t.title="Nghe đoạn này",t.onclick=i=>{i.stopPropagation(),this.callbacks.playSegment&&this.callbacks.playSegment(r.id,r.audio,r.text)},e.appendChild(t)}if(r.html&&r.html.match(/^<h[1-6]/i)&&r.label!=="title"&&r.label!=="subtitle"){const t=document.createElement("button");t.id=`play-seq-btn-${r.id}`,t.name=`play-seq-btn-${r.id}`,t.className="play-btn icon-btn play-sequence-btn",t.innerHTML='<i class="fas fa-play-circle"></i>',t.title="Nghe toàn bộ phần này",t.onclick=i=>{i.stopPropagation(),this.callbacks.playSequence&&this.callbacks.playSequence(s)},e.appendChild(t)}}_addTextContent(e,r){const s=document.createElement("div");s.className="segment-text";const i=(r.html||"{}").replace("{}",r.text||"");s.innerHTML=i,e.appendChild(s)}_addMaskToggle(e,r){const s=r.html&&r.html.match(/^<h[1-6]/i)&&r.label!=="title"&&r.label!=="subtitle";if(r.audio&&r.audio!=="skip"||s){const i=document.createElement("div");i.className="segment-mask-toggle",i.title="Nhấp để che/hiện text",this.callbacks.onMaskStart&&(i.addEventListener("mousedown",a=>this.callbacks.onMaskStart(a,e,r)),i.addEventListener("touchstart",a=>this.callbacks.onMaskStart(a,e,r),{passive:!1})),this.callbacks.onMaskEnter&&i.addEventListener("mouseenter",a=>this.callbacks.onMaskEnter(a,e)),e.appendChild(i)}}}class Jt{constructor(e){this.container=e,this.items=[],this.isDraggingMask=!1,this.dragMaskAction=null,this.lastActionTime=0,this.cooldownMs=250,this._setupGlobalListeners()}setItems(e){this.items=e}_setupGlobalListeners(){const e=()=>{this.isDraggingMask=!1,this.dragMaskAction=null};document.addEventListener("mouseup",e),document.addEventListener("touchend",e)}_isHeading(e){return e.html&&e.html.match(/^<h[1-6]/i)&&e.label!=="title"&&e.label!=="subtitle"}toggleMask(e,r){const s=Date.now();if(s-this.lastActionTime<this.cooldownMs)return;this.lastActionTime=s;const t=e.querySelector(".segment-text");if(!t)return;if(this._isHeading(r)){this._toggleHeadingMask(e,r);return}const i=t.classList.contains("masked");this._applyMaskAction(t,i?"unmask":"mask")}handleMaskStart(e,r,s){if(e.type==="mousedown"&&e.button!==0)return;const t=Date.now();if(t-this.lastActionTime<this.cooldownMs){e&&e.cancelable&&e.preventDefault();return}this.lastActionTime=t,e&&e.cancelable&&e.preventDefault(),this.isDraggingMask=!0;const i=r.querySelector(".segment-text");if(this._isHeading(s)){this._toggleHeadingMask(r,s);return}const a=i.classList.contains("masked");this.dragMaskAction=a?"unmask":"mask",this._applyMaskAction(i,this.dragMaskAction)}handleMaskEnter(e,r){if(!this.isDraggingMask||!this.dragMaskAction)return;const s=r.dataset.id,t=this.items.find(a=>String(a.id)===String(s));if(t&&this._isHeading(t))return;const i=r.querySelector(".segment-text");this._applyMaskAction(i,this.dragMaskAction)}_applyMaskAction(e,r){r==="mask"?e.classList.add("masked"):e.classList.remove("masked")}_toggleHeadingMask(e,r){const s=parseInt(e.dataset.index),t=r.html.match(/^<h(\d)>/i);if(!t)return;const i=parseInt(t[1]);let a="mask";for(let h=s+1;h<this.items.length;h++){const m=this.items[h];if(m.label==="end")break;const u=m.html?m.html.match(/^<h(\d)>/i):null;if(u){if(parseInt(u[1])<=i)break;continue}const y=this._findElement(m.id);if(y){const l=y.querySelector(".segment-text");if(l){a=l.classList.contains("masked")?"unmask":"mask";break}}}for(let h=s+1;h<this.items.length;h++){const m=this.items[h];if(m.label==="end")break;const u=m.html?m.html.match(/^<h(\d)>/i):null;if(u){if(parseInt(u[1])<=i)break;continue}const y=this._findElement(m.id);if(y){const l=y.querySelector(".segment-text");l&&this._applyMaskAction(l,a)}}}_findElement(e){return this.container.querySelector(`.segment[data-id="${e}"]`)}}const te=60;class ee{constructor(e,r,s){this.container=document.getElementById(e),this.playSegmentCallback=r,this.playSequenceCallback=s,this.items=[],this.hoveredSegmentId=null,this.elementCache=new Map,this.activeSegmentId=null,this.maskManager=new Jt(this.container),this.segmentFactory=new Qt({playSegment:this.playSegmentCallback,playSequence:t=>this._handlePlaySequence(t),onMaskStart:(t,i,a)=>this.maskManager.handleMaskStart(t,i,a),onMaskEnter:(t,i)=>this.maskManager.handleMaskEnter(t,i),onHover:t=>{this.hoveredSegmentId=t}}),this.renderedCount=0,this.observer=null,this.sentinel=null,this.currentPrefix=null,this.isRendering=!1,this._setupKeyboardListeners()}_setupKeyboardListeners(){document.addEventListener("keydown",e=>{if(e.target.tagName==="INPUT"||e.target.tagName==="SELECT")return;const r=e.key.toLowerCase();r==="r"?this._handleKeyboardPlay():r==="f"&&this._handleKeyboardFlip()})}render(e){if(this.container){if(this.observer&&(this.observer.disconnect(),this.observer=null),this.container.innerHTML="",this.elementCache.clear(),this.activeSegmentId=null,this.renderedCount=0,this.currentPrefix=null,this.sentinel=null,this.isRendering=!1,this.items=e||[],this.maskManager.setItems(this.items),!this.items||this.items.length===0){this.container.innerHTML='<div class="empty">Không có dữ liệu hiển thị.</div>';return}this.sentinel=document.createElement("div"),this.sentinel.className="loading-sentinel",this.sentinel.style.height="50px",this.sentinel.style.width="100%",this.container.appendChild(this.sentinel),this.observer=new IntersectionObserver(r=>{r[0].isIntersecting&&(this.isRendering||(this.isRendering=!0,requestAnimationFrame(()=>this._renderNextBatch())))},{root:this.container,rootMargin:"200px",threshold:.1}),this.observer.observe(this.sentinel),this._renderNextBatch()}}_renderNextBatch(){if(this.renderedCount>=this.items.length){this.sentinel&&this.sentinel.remove(),this.observer&&this.observer.disconnect(),this.isRendering=!1;return}const e=this.items.slice(this.renderedCount,this.renderedCount+te),r=document.createDocumentFragment();let s=null;this.sentinel&&this.sentinel.previousElementSibling&&this.sentinel.previousElementSibling.classList.contains("section")&&(s=this.sentinel.previousElementSibling),e.forEach((t,i)=>{const a=this.renderedCount+i;let h="misc";if(["title","subtitle","nidana"].includes(t.label))h="intro";else if(t.label==="end")h="outro";else if(t.label.startsWith("note"))h=this.currentPrefix||"intro";else{const y=t.label.match(/^([a-z]+)/);y&&(h=y[1])}(h!==this.currentPrefix||t.label.endsWith("-chapter")||t.label==="title"||!s)&&(this.currentPrefix=h,s=document.createElement("section"),s.className=`section section-${h}`,s.id=`section-${t.label}`,r.appendChild(s));const u=this.segmentFactory.create(t,a);this.elementCache.set(t.id,u),s.appendChild(u)}),this.sentinel&&this.sentinel.parentNode===this.container?this.container.insertBefore(r,this.sentinel):this.container.appendChild(r),this.renderedCount+=e.length,this.isRendering=!1,this.renderedCount>=this.items.length&&(this.sentinel&&this.sentinel.remove(),this.observer&&this.observer.disconnect())}_handlePlaySequence(e){if(!this.playSequenceCallback)return;const r=this.items[e],s=r.html?r.html.match(/^<h(\d)>/i):null;if(!s)return;const t=parseInt(s[1]),i=[];for(let a=e+1;a<this.items.length;a++){const h=this.items[a];if(h.label==="end")break;const m=h.html?h.html.match(/^<h(\d)>/i):null;if(m&&parseInt(m[1])<=t)break;h.audio&&h.audio!=="skip"&&i.push({id:h.id,audio:h.audio,text:h.text})}i.length>0?this.playSequenceCallback(i,r.id):alert("Không có dữ liệu âm thanh cho phần này.")}_handleKeyboardPlay(){if(!this.hoveredSegmentId)return;const e=this.items.find(r=>r.id===this.hoveredSegmentId);if(e)if(e.html&&e.html.match(/^<h[1-6]/i)){const r=this.items.indexOf(e);this._handlePlaySequence(r)}else e.audio&&e.audio!=="skip"&&this.playSegmentCallback&&this.playSegmentCallback(e.id,e.audio,e.text)}_handleKeyboardFlip(){if(!this.hoveredSegmentId)return;const e=this.items.find(s=>s.id===this.hoveredSegmentId);if(!e)return;const r=this.elementCache.get(this.hoveredSegmentId);if(r){const s=e.audio&&e.audio!=="skip",t=e.html&&e.html.match(/^<h[1-6]/i)&&e.label!=="title"&&e.label!=="subtitle";(s||t)&&this.maskManager.toggleMask(r,e)}}_ensureRendered(e){if(!(e===-1||e<this.renderedCount))for(;this.renderedCount<=e&&(this._renderNextBatch(),!(this.renderedCount>=this.items.length)););}scrollToSegment(e){this.highlightSegment(e,!0)}highlightSegment(e,r=!0){if(!this.container)return;let s=this.elementCache.get(e);if(!s){const t=this.items.findIndex(i=>i.id===e);t!==-1&&(this._ensureRendered(t),s=this.elementCache.get(e))}if(this.activeSegmentId!==null&&this.activeSegmentId!==e){const t=this.elementCache.get(this.activeSegmentId);t&&t.classList.remove("active")}s&&(s.classList.add("active"),this.activeSegmentId=e,r&&this._smartScroll(s))}_parseThreshold(e){return typeof e=="number"?e:typeof e!="string"?0:e.endsWith("vh")?parseFloat(e)/100*document.documentElement.clientHeight:parseFloat(e)||0}_smartScroll(e){if(!this.container||!e)return;const r=e.getBoundingClientRect(),s=this.container.getBoundingClientRect(),t=this._parseThreshold(At.SCROLL_THRESHOLD_TOP),i=this._parseThreshold(At.SCROLL_THRESHOLD_BOTTOM),a=s.top+t,h=s.bottom-i,m=r.top<a,u=r.bottom>h;if(m||u){const l=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?"auto":At.SCROLL_BEHAVIOR,g=this.container.scrollTop+(r.top-a);this.container.scrollTo({top:g,behavior:l})}}clearHighlight(){if(this.activeSegmentId!==null){const e=this.elementCache.get(this.activeSegmentId);e&&e.classList.remove("active"),this.activeSegmentId=null}}updatePlaybackState(e,r,s,t){if(this.container.querySelectorAll(".play-btn:not(.play-sequence-btn)").forEach(h=>{h.classList.remove("active-play"),h.innerHTML='<i class="fas fa-circle"></i>',h.title="Nghe đoạn này"}),this.container.querySelectorAll(".play-sequence-btn").forEach(h=>{h.classList.remove("active-play"),h.innerHTML='<i class="fas fa-play-circle"></i>',h.title="Nghe toàn bộ phần này"}),!r||e==="stopped")return;const i=this.elementCache.get(r);if(!i)return;const a=i.querySelector(".play-btn:not(.play-sequence-btn)");if(a&&(a.classList.add("active-play"),a.innerHTML=e==="playing"?'<i class="fas fa-pause-circle"></i>':'<i class="fas fa-play-circle"></i>',a.title=e==="playing"?"Tạm dừng":"Tiếp tục"),s&&t){const h=this.elementCache.get(t);if(h){const m=h.querySelector(".play-sequence-btn");m&&(m.classList.add("active-play"),m.innerHTML=e==="playing"?'<i class="fas fa-pause-circle"></i>':'<i class="fas fa-play-circle"></i>',m.title=e==="playing"?"Tạm dừng":"Tiếp tục")}}}getFirstVisibleSegmentId(){if(!this.container)return null;const e=this.container.querySelectorAll(".segment");for(const r of e){const s=r.getBoundingClientRect();if(s.top+s.height>80&&s.top<window.innerHeight&&parseInt(r.dataset.id))return parseInt(r.dataset.id)}return null}}class ie{constructor(e,r,s,t,i){this.playBtn=document.getElementById("play-all-btn"),this.pauseBtn=document.getElementById("pause-btn"),this.stopBtn=document.getElementById("stop-btn"),this.speedSelect=document.getElementById("speed-select"),this.loopBtn=document.getElementById("loop-btn"),this.hintToggleBtn=document.getElementById("hint-toggle-btn");const a="sutta_loop_enabled",h="tts_rate",m="sutta_hint_mode_enabled";if(this.playBtn&&this.playBtn.addEventListener("click",e),this.pauseBtn&&this.pauseBtn.addEventListener("click",r),this.stopBtn&&this.stopBtn.addEventListener("click",s),this.speedSelect){const u=localStorage.getItem(h);u&&(this.speedSelect.value=u),this.speedSelect.addEventListener("change",y=>{const l=parseFloat(y.target.value);localStorage.setItem(h,l),t(l)})}if(this.loopBtn&&(localStorage.getItem(a)==="true"&&this.loopBtn.classList.add("active"),this.loopBtn.addEventListener("click",()=>{const y=this.loopBtn.classList.toggle("active");localStorage.setItem(a,y),i&&i(y)})),this.hintToggleBtn){const u=localStorage.getItem(m);(u===null||u==="true")&&(this.hintToggleBtn.classList.add("active"),document.body.classList.add("hint-mode-active")),this.hintToggleBtn.addEventListener("click",()=>{const l=this.hintToggleBtn.classList.toggle("active");l?document.body.classList.add("hint-mode-active"):document.body.classList.remove("hint-mode-active"),localStorage.setItem(m,l)})}document.addEventListener("keydown",u=>{if(u.target.tagName==="INPUT"||u.target.tagName==="TEXTAREA"||u.target.isContentEditable)return;const y=u.key.toLowerCase();y==="g"&&this.loopBtn&&this.loopBtn.click(),y==="h"&&this.hintToggleBtn&&this.hintToggleBtn.click(),y==="t"&&this._changeSpeedIndex(1,t),y==="e"&&this._changeSpeedIndex(-1,t)})}_changeSpeedIndex(e,r){if(!this.speedSelect)return;const s=this.speedSelect.selectedIndex+e;if(s>=0&&s<this.speedSelect.options.length){this.speedSelect.selectedIndex=s;const t=parseFloat(this.speedSelect.value);localStorage.setItem("tts_rate",t),r&&r(t)}}updateState(e){if(!this.playBtn||!this.pauseBtn||!this.stopBtn)return;const r=this.pauseBtn.querySelector("i");switch(e){case"playing":this.playBtn.disabled=!0,this.pauseBtn.disabled=!1,this.stopBtn.disabled=!1,r&&(r.classList.remove("fa-play"),r.classList.add("fa-pause"));break;case"paused":this.playBtn.disabled=!0,this.pauseBtn.disabled=!1,this.stopBtn.disabled=!1,r&&(r.classList.remove("fa-pause"),r.classList.add("fa-play"));break;case"stopped":this.playBtn.disabled=!1,this.pauseBtn.disabled=!0,this.stopBtn.disabled=!0,r&&(r.classList.remove("fa-play"),r.classList.add("fa-pause"));break}}setSpeed(e){this.speedSelect&&(this.speedSelect.value=e.toString())}}class ne{constructor(e){this.ttsEngine=e,this.modal=document.getElementById("settings-modal"),this.openBtn=document.getElementById("settings-btn"),this.closeBtn=document.querySelector(".close-modal"),this.form=document.getElementById("settings-form"),this.apiKeyInput=document.getElementById("api-key"),this.voiceSelect=document.getElementById("voice-select"),this.refreshVoicesBtn=document.getElementById("refresh-voices-btn"),this._setupListeners()}_setupListeners(){this.openBtn&&this.openBtn.addEventListener("click",e=>{e.preventDefault(),this._open()}),this.closeBtn&&this.closeBtn.addEventListener("click",e=>{e.preventDefault(),this._close()}),this.form&&this.form.addEventListener("submit",e=>{e.preventDefault(),this._save()}),this.refreshVoicesBtn&&this.refreshVoicesBtn.addEventListener("click",e=>{e.preventDefault(),this._loadVoices(!0)}),this.voiceSelect&&this.voiceSelect.addEventListener("change",e=>{this.ttsEngine.setVoice(e.target.value)}),window.addEventListener("click",e=>{e.target===this.modal&&this._close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&!this.modal.classList.contains("hidden")&&this._close()})}_open(){try{this.modal.classList.remove("hidden"),this.ttsEngine&&(this.apiKeyInput&&(this.apiKeyInput.value=this.ttsEngine.getApiKey()||""),this._loadVoices(!1))}catch{}}_close(){this.modal.classList.add("hidden")}_save(){try{const e=this.apiKeyInput?this.apiKeyInput.value.trim():"";this.ttsEngine.setApiKey(e),this._close(),e?this._loadVoices(!0):this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Vui lòng nhập API Key</option>')}catch{}}async _loadVoices(e){if(!this.ttsEngine||!this.ttsEngine.getApiKey()){this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Vui lòng nhập API Key trước</option>');return}this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Đang tải...</option>'),this.refreshVoicesBtn&&(this.refreshVoicesBtn.disabled=!0,this.refreshVoicesBtn.innerHTML='<i class="fas fa-spin fa-spinner"></i>');try{const r=await this.ttsEngine.getVoices(e);if(this.voiceSelect){this.voiceSelect.innerHTML="";const s=this.ttsEngine.currentVoice,t=s?s.name:"";!r||r.length===0?this.voiceSelect.innerHTML='<option value="" disabled selected>Không tìm thấy giọng tiếng Việt</option>':(r.forEach(i=>{const a=document.createElement("option");a.value=i.name,a.textContent=`${i.name} (${i.ssmlGender})`,i.name===t&&(a.selected=!0),this.voiceSelect.appendChild(a)}),r.length>0&&!r.find(i=>i.name===t)&&(this.voiceSelect.selectedIndex=0,this.ttsEngine.setVoice(r[0].name)))}}catch{this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Lỗi tải giọng</option>')}finally{this.refreshVoicesBtn&&(this.refreshVoicesBtn.disabled=!1,this.refreshVoicesBtn.innerHTML='<i class="fas fa-sync-alt"></i>')}}}const re={init(){const b=document.getElementById("btn-toggle-drawer"),e=document.getElementById("control-drawer");b&&e&&(b.addEventListener("click",r=>{r.stopPropagation(),e.classList.toggle("hidden"),b.classList.toggle("open");const s=document.getElementById("control-bar");s&&s.classList.toggle("expanded")}),document.addEventListener("click",r=>{if(!e.classList.contains("hidden")&&!e.contains(r.target)&&!b.contains(r.target)){e.classList.add("hidden"),b.classList.remove("open");const t=document.getElementById("control-bar");t&&t.classList.remove("expanded")}}),e.addEventListener("click",r=>{r.stopPropagation()}))}},It={HUE_COEFF:"35deg",SATURATE:"60%",STORAGE_KEY_PREFIX:"sutta_sepia_"},se={CONFIG:{STORAGE_KEY_THEME:"sutta_theme"},init(){const b=document.getElementById("btn-theme-toggle"),e=b?.querySelector(".icon-moon"),r=b?.querySelector(".icon-sun"),s=document.getElementById("sepia-control-panel"),t=document.getElementById("sepia-slider"),i=document.getElementById("btn-sepia-indicator");document.documentElement.style.setProperty("--sepia-hue-coeff",It.HUE_COEFF),document.documentElement.style.setProperty("--sepia-saturate",It.SATURATE);const a=window.matchMedia("(prefers-color-scheme: dark)").matches;let m=localStorage.getItem(this.CONFIG.STORAGE_KEY_THEME)||(a?"dark":"light");const u=f=>`${It.STORAGE_KEY_PREFIX}${f}`,y=()=>{if(!s)return;s.classList.contains("hidden")?(s.classList.remove("hidden"),i&&i.classList.add("panel-open")):(s.classList.add("hidden"),i&&i.classList.remove("panel-open"))},l=(f,d)=>{const v=d==="dark"?.2:.3;return f/100*v},g=(f,d)=>{const v=l(f,d);document.documentElement.style.setProperty("--sepia-overlay-opacity",v),t&&t.value!=f&&(t.value=f),i&&(i.textContent=`${f}%`)},c=f=>{document.documentElement.setAttribute("data-theme",f),localStorage.setItem(this.CONFIG.STORAGE_KEY_THEME,f),m=f,f==="dark"?(e?.classList.add("hidden"),r?.classList.remove("hidden")):(e?.classList.remove("hidden"),r?.classList.add("hidden"));const d=localStorage.getItem(u(f))||0;g(d,f)};c(m),i&&i.addEventListener("click",f=>{f.stopPropagation(),y()}),b&&b.addEventListener("click",()=>{c(m==="light"?"dark":"light"),s&&!s.classList.contains("hidden")&&y()}),t&&(t.addEventListener("input",f=>{const d=f.target.value;g(d,m),localStorage.setItem(u(m),d)}),document.addEventListener("click",f=>{s&&!s.classList.contains("hidden")&&!s.contains(f.target)&&!b.contains(f.target)&&(!i||!i.contains(f.target))&&y()}),s.addEventListener("click",f=>{f.stopPropagation()}))}},ae={MIN_SCALE:.8,MAX_SCALE:2,STEP:.1,DEFAULT_SCALE:1,STORAGE_KEY:"sutta_font_scale",init(){const b=document.getElementById("btn-font-decrease"),e=document.getElementById("btn-font-increase"),r=document.getElementById("font-size-label"),s=localStorage.getItem(this.STORAGE_KEY);let t=s?parseFloat(s):this.DEFAULT_SCALE;this.applyScale(t),b&&b.addEventListener("click",i=>{i.stopPropagation(),t>this.MIN_SCALE&&(t=Math.max(this.MIN_SCALE,t-this.STEP),this.applyScale(t))}),e&&e.addEventListener("click",i=>{i.stopPropagation(),t<this.MAX_SCALE&&(t=Math.min(this.MAX_SCALE,t+this.STEP),this.applyScale(t))}),r&&(r.addEventListener("click",i=>{i.stopPropagation(),t=this.DEFAULT_SCALE,this.applyScale(t)}),r.style.cursor="pointer")},applyScale(b){const e=Math.round(b*10)/10;document.documentElement.style.setProperty("--text-scale",e),localStorage.setItem(this.STORAGE_KEY,e)}},oe="modulepreload",le=function(b){return"/gioibon/"+b},Ot={},ce=function(e,r,s){let t=Promise.resolve();if(r&&r.length>0){let m=function(u){return Promise.all(u.map(y=>Promise.resolve(y).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),h=a?.nonce||a?.getAttribute("nonce");t=m(r.map(u=>{if(u=le(u),u in Ot)return;Ot[u]=!0;const y=u.endsWith(".css"),l=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${l}`))return;const g=document.createElement("link");if(g.rel=y?"stylesheet":oe,y||(g.as="script"),g.crossOrigin="",g.href=u,h&&g.setAttribute("nonce",h),document.head.appendChild(g),y)return new Promise((c,f)=>{g.addEventListener("load",c),g.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(a){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=a,window.dispatchEvent(h),!h.defaultPrevented)throw a}return t.then(a=>{for(const h of a||[])h.status==="rejected"&&i(h.reason);return e().catch(i)})};function he(b={}){const{immediate:e=!1,onNeedRefresh:r,onOfflineReady:s,onRegistered:t,onRegisteredSW:i,onRegisterError:a}=b;let h,m;const u=async(l=!0)=>{await m};async function y(){if("serviceWorker"in navigator){if(h=await ce(async()=>{const{Workbox:l}=await import("./vendor.BIl4cyR9.js");return{Workbox:l}},[]).then(({Workbox:l})=>new l("/gioibon/sw.js",{scope:"/gioibon/",type:"classic"})).catch(l=>{a?.(l)}),!h)return;h.addEventListener("activated",l=>{(l.isUpdate||l.isExternal)&&window.location.reload()}),h.addEventListener("installed",l=>{l.isUpdate||s?.()}),h.register({immediate:e}).then(l=>{i?i("/gioibon/sw.js",l):t?.(l)}).catch(l=>{a?.(l)})}}return m=y(),u}function de(){const b=document.getElementById("btn-clear-cache");b&&b.addEventListener("click",async()=>{if(confirm("Bạn có chắc chắn muốn làm mới toàn bộ dữ liệu? Các cấu hình như API Key, font size và tốc độ đọc sẽ được giữ lại.")){b.disabled=!0,b.style.opacity="0.5";try{const a=["google_cloud_api_key","tts_voice_name","tts_rate","sutta_font_scale","sutta_theme","sutta_sepia_light","sutta_sepia_dark","sutta_loop_enabled","sutta_hint_mode_enabled"],h={};if(a.forEach(m=>{const u=localStorage.getItem(m);u!==null&&(h[m]=u)}),"serviceWorker"in navigator){const m=await navigator.serviceWorker.getRegistrations();for(let u of m)await u.unregister()}if("caches"in window){const m=await caches.keys();await Promise.all(m.map(u=>caches.delete(u)))}indexedDB.databases&&(await indexedDB.databases()).forEach(u=>{u.name&&indexedDB.deleteDatabase(u.name)}),localStorage.clear(),sessionStorage.clear(),Object.entries(h).forEach(([m,u])=>{localStorage.setItem(m,u)}),window.location.reload()}catch{alert("Đã xảy ra lỗi khi làm mới dữ liệu. Vui lòng thử lại."),b.disabled=!1,b.style.opacity="1"}}});const e=document.getElementById("pwa-toast"),r=document.getElementById("pwa-refresh"),s=document.getElementById("pwa-close"),t=document.getElementById("btn-update-app"),i=he({onNeedRefresh(){e&&e.classList.remove("hidden"),t&&t.classList.add("update-available")},onOfflineReady(){},onRegisterError(a){}});if(e&&r&&s){const a=()=>{r.disabled=!0,r.textContent="Đang tải...",s.disabled=!0,i(!0),setTimeout(()=>{window.location.reload()},1e3)};r.addEventListener("click",a),t&&t.addEventListener("click",async()=>{if(!e.classList.contains("hidden")){a();return}t.classList.add("rotating"),t.title="Đang kiểm tra...";try{if("serviceWorker"in navigator){const h=await navigator.serviceWorker.getRegistration();h&&(await h.update(),setTimeout(()=>{t.classList.remove("rotating"),t.title="Kiểm tra & Cập nhật",e.classList.contains("hidden")&&alert("Ứng dụng và dữ liệu đã ở phiên bản mới nhất.")},1500))}}catch{t.classList.remove("rotating")}}),s.addEventListener("click",()=>{e.classList.add("hidden")})}}(function(b){typeof Nt=="object"&&typeof Lt<"u"?Lt.exports=b():typeof define=="function"&&define.amd?define([],b):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=b()})(function(){return(function b(e,r,s){function t(h,m){if(!r[h]){if(!e[h]){var u=typeof require=="function"&&require;if(!m&&u)return u(h,!0);if(i)return i(h,!0);var y=new Error("Cannot find module '"+h+"'");throw y.code="MODULE_NOT_FOUND",y}var l=r[h]={exports:{}};e[h][0].call(l.exports,function(g){var c=e[h][1][g];return t(c||g)},l,l.exports,b,e,r,s)}return r[h].exports}for(var i=typeof require=="function"&&require,a=0;a<s.length;a++)t(s[a]);return t})({1:[function(b,e,r){var s=b("./utils"),t=b("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(a){for(var h,m,u,y,l,g,c,f=[],d=0,v=a.length,k=v,C=s.getTypeOf(a)!=="string";d<a.length;)k=v-d,u=C?(h=a[d++],m=d<v?a[d++]:0,d<v?a[d++]:0):(h=a.charCodeAt(d++),m=d<v?a.charCodeAt(d++):0,d<v?a.charCodeAt(d++):0),y=h>>2,l=(3&h)<<4|m>>4,g=1<k?(15&m)<<2|u>>6:64,c=2<k?63&u:64,f.push(i.charAt(y)+i.charAt(l)+i.charAt(g)+i.charAt(c));return f.join("")},r.decode=function(a){var h,m,u,y,l,g,c=0,f=0,d="data:";if(a.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var v,k=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===i.charAt(64)&&k--,a.charAt(a.length-2)===i.charAt(64)&&k--,k%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=t.uint8array?new Uint8Array(0|k):new Array(0|k);c<a.length;)h=i.indexOf(a.charAt(c++))<<2|(y=i.indexOf(a.charAt(c++)))>>4,m=(15&y)<<4|(l=i.indexOf(a.charAt(c++)))>>2,u=(3&l)<<6|(g=i.indexOf(a.charAt(c++))),v[f++]=h,l!==64&&(v[f++]=m),g!==64&&(v[f++]=u);return v}},{"./support":30,"./utils":32}],2:[function(b,e,r){var s=b("./external"),t=b("./stream/DataWorker"),i=b("./stream/Crc32Probe"),a=b("./stream/DataLengthProbe");function h(m,u,y,l,g){this.compressedSize=m,this.uncompressedSize=u,this.crc32=y,this.compression=l,this.compressedContent=g}h.prototype={getContentWorker:function(){var m=new t(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),u=this;return m.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),m},getCompressedWorker:function(){return new t(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(m,u,y){return m.pipe(new i).pipe(new a("uncompressedSize")).pipe(u.compressWorker(y)).pipe(new a("compressedSize")).withStreamInfo("compression",u)},e.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(b,e,r){var s=b("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},r.DEFLATE=b("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(b,e,r){var s=b("./utils"),t=(function(){for(var i,a=[],h=0;h<256;h++){i=h;for(var m=0;m<8;m++)i=1&i?3988292384^i>>>1:i>>>1;a[h]=i}return a})();e.exports=function(i,a){return i!==void 0&&i.length?s.getTypeOf(i)!=="string"?(function(h,m,u,y){var l=t,g=y+u;h^=-1;for(var c=y;c<g;c++)h=h>>>8^l[255&(h^m[c])];return-1^h})(0|a,i,i.length,0):(function(h,m,u,y){var l=t,g=y+u;h^=-1;for(var c=y;c<g;c++)h=h>>>8^l[255&(h^m.charCodeAt(c))];return-1^h})(0|a,i,i.length,0):0}},{"./utils":32}],5:[function(b,e,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(b,e,r){var s=null;s=typeof Promise<"u"?Promise:b("lie"),e.exports={Promise:s}},{lie:37}],7:[function(b,e,r){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",t=b("pako"),i=b("./utils"),a=b("./stream/GenericWorker"),h=s?"uint8array":"array";function m(u,y){a.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=y,this.meta={}}r.magic="\b\0",i.inherits(m,a),m.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(h,u.data),!1)},m.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},m.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},m.prototype._createPako=function(){this._pako=new t[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(y){u.push({data:y,meta:u.meta})}},r.compressWorker=function(u){return new m("Deflate",u)},r.uncompressWorker=function(){return new m("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(b,e,r){function s(l,g){var c,f="";for(c=0;c<g;c++)f+=String.fromCharCode(255&l),l>>>=8;return f}function t(l,g,c,f,d,v){var k,C,E=l.file,P=l.compression,B=v!==h.utf8encode,M=i.transformTo("string",v(E.name)),T=i.transformTo("string",h.utf8encode(E.name)),H=E.comment,$=i.transformTo("string",v(H)),w=i.transformTo("string",h.utf8encode(H)),R=T.length!==E.name.length,o=w.length!==H.length,O="",X="",F="",Q=E.dir,U=E.date,Y={crc32:0,compressedSize:0,uncompressedSize:0};g&&!c||(Y.crc32=l.crc32,Y.compressedSize=l.compressedSize,Y.uncompressedSize=l.uncompressedSize);var I=0;g&&(I|=8),B||!R&&!o||(I|=2048);var x=0,G=0;Q&&(x|=16),d==="UNIX"?(G=798,x|=(function(Z,nt){var ot=Z;return Z||(ot=nt?16893:33204),(65535&ot)<<16})(E.unixPermissions,Q)):(G=20,x|=(function(Z){return 63&(Z||0)})(E.dosPermissions)),k=U.getUTCHours(),k<<=6,k|=U.getUTCMinutes(),k<<=5,k|=U.getUTCSeconds()/2,C=U.getUTCFullYear()-1980,C<<=4,C|=U.getUTCMonth()+1,C<<=5,C|=U.getUTCDate(),R&&(X=s(1,1)+s(m(M),4)+T,O+="up"+s(X.length,2)+X),o&&(F=s(1,1)+s(m($),4)+w,O+="uc"+s(F.length,2)+F);var q="";return q+=`
\0`,q+=s(I,2),q+=P.magic,q+=s(k,2),q+=s(C,2),q+=s(Y.crc32,4),q+=s(Y.compressedSize,4),q+=s(Y.uncompressedSize,4),q+=s(M.length,2),q+=s(O.length,2),{fileRecord:u.LOCAL_FILE_HEADER+q+M+O,dirRecord:u.CENTRAL_FILE_HEADER+s(G,2)+q+s($.length,2)+"\0\0\0\0"+s(x,4)+s(f,4)+M+O+$}}var i=b("../utils"),a=b("../stream/GenericWorker"),h=b("../utf8"),m=b("../crc32"),u=b("../signature");function y(l,g,c,f){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=c,this.encodeFileName=f,this.streamFiles=l,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(y,a),y.prototype.push=function(l){var g=l.meta.percent||0,c=this.entriesCount,f=this._sources.length;this.accumulate?this.contentBuffer.push(l):(this.bytesWritten+=l.data.length,a.prototype.push.call(this,{data:l.data,meta:{currentFile:this.currentFile,percent:c?(g+100*(c-f-1))/c:100}}))},y.prototype.openedSource=function(l){this.currentSourceOffset=this.bytesWritten,this.currentFile=l.file.name;var g=this.streamFiles&&!l.file.dir;if(g){var c=t(l,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},y.prototype.closedSource=function(l){this.accumulate=!1;var g=this.streamFiles&&!l.file.dir,c=t(l,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),g)this.push({data:(function(f){return u.DATA_DESCRIPTOR+s(f.crc32,4)+s(f.compressedSize,4)+s(f.uncompressedSize,4)})(l),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},y.prototype.flush=function(){for(var l=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var c=this.bytesWritten-l,f=(function(d,v,k,C,E){var P=i.transformTo("string",E(C));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(d,2)+s(d,2)+s(v,4)+s(k,4)+s(P.length,2)+P})(this.dirRecords.length,c,l,this.zipComment,this.encodeFileName);this.push({data:f,meta:{percent:100}})},y.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},y.prototype.registerPrevious=function(l){this._sources.push(l);var g=this;return l.on("data",function(c){g.processChunk(c)}),l.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),l.on("error",function(c){g.error(c)}),this},y.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},y.prototype.error=function(l){var g=this._sources;if(!a.prototype.error.call(this,l))return!1;for(var c=0;c<g.length;c++)try{g[c].error(l)}catch{}return!0},y.prototype.lock=function(){a.prototype.lock.call(this);for(var l=this._sources,g=0;g<l.length;g++)l[g].lock()},e.exports=y},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(b,e,r){var s=b("../compressions"),t=b("./ZipFileWorker");r.generateWorker=function(i,a,h){var m=new t(a.streamFiles,h,a.platform,a.encodeFileName),u=0;try{i.forEach(function(y,l){u++;var g=(function(v,k){var C=v||k,E=s[C];if(!E)throw new Error(C+" is not a valid compression method !");return E})(l.options.compression,a.compression),c=l.options.compressionOptions||a.compressionOptions||{},f=l.dir,d=l.date;l._compressWorker(g,c).withStreamInfo("file",{name:y,dir:f,date:d,comment:l.comment||"",unixPermissions:l.unixPermissions,dosPermissions:l.dosPermissions}).pipe(m)}),m.entriesCount=u}catch(y){m.error(y)}return m}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(b,e,r){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new s;for(var i in this)typeof this[i]!="function"&&(t[i]=this[i]);return t}}(s.prototype=b("./object")).loadAsync=b("./load"),s.support=b("./support"),s.defaults=b("./defaults"),s.version="3.10.1",s.loadAsync=function(t,i){return new s().loadAsync(t,i)},s.external=b("./external"),e.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(b,e,r){var s=b("./utils"),t=b("./external"),i=b("./utf8"),a=b("./zipEntries"),h=b("./stream/Crc32Probe"),m=b("./nodejsUtils");function u(y){return new t.Promise(function(l,g){var c=y.decompressed.getContentWorker().pipe(new h);c.on("error",function(f){g(f)}).on("end",function(){c.streamInfo.crc32!==y.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):l()}).resume()})}e.exports=function(y,l){var g=this;return l=s.extend(l||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),m.isNode&&m.isStream(y)?t.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",y,!0,l.optimizedBinaryString,l.base64).then(function(c){var f=new a(l);return f.load(c),f}).then(function(c){var f=[t.Promise.resolve(c)],d=c.files;if(l.checkCRC32)for(var v=0;v<d.length;v++)f.push(u(d[v]));return t.Promise.all(f)}).then(function(c){for(var f=c.shift(),d=f.files,v=0;v<d.length;v++){var k=d[v],C=k.fileNameStr,E=s.resolve(k.fileNameStr);g.file(E,k.decompressed,{binary:!0,optimizedBinaryString:!0,date:k.date,dir:k.dir,comment:k.fileCommentStr.length?k.fileCommentStr:null,unixPermissions:k.unixPermissions,dosPermissions:k.dosPermissions,createFolders:l.createFolders}),k.dir||(g.file(E).unsafeOriginalName=C)}return f.zipComment.length&&(g.comment=f.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(b,e,r){var s=b("../utils"),t=b("../stream/GenericWorker");function i(a,h){t.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(h)}s.inherits(i,t),i.prototype._bindStream=function(a){var h=this;(this._stream=a).pause(),a.on("data",function(m){h.push({data:m,meta:{percent:0}})}).on("error",function(m){h.isPaused?this.generatedError=m:h.error(m)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},i.prototype.pause=function(){return!!t.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(b,e,r){var s=b("readable-stream").Readable;function t(i,a,h){s.call(this,a),this._helper=i;var m=this;i.on("data",function(u,y){m.push(u)||m._helper.pause(),h&&h(y)}).on("error",function(u){m.emit("error",u)}).on("end",function(){m.push(null)})}b("../utils").inherits(t,s),t.prototype._read=function(){this._helper.resume()},e.exports=t},{"../utils":32,"readable-stream":16}],14:[function(b,e,r){e.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,t);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,t)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var t=new Buffer(s);return t.fill(0),t},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(b,e,r){function s(E,P,B){var M,T=i.getTypeOf(P),H=i.extend(B||{},m);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(E=d(E)),H.createFolders&&(M=f(E))&&v.call(this,M,!0);var $=T==="string"&&H.binary===!1&&H.base64===!1;B&&B.binary!==void 0||(H.binary=!$),(P instanceof u&&P.uncompressedSize===0||H.dir||!P||P.length===0)&&(H.base64=!1,H.binary=!0,P="",H.compression="STORE",T="string");var w=null;w=P instanceof u||P instanceof a?P:g.isNode&&g.isStream(P)?new c(E,P):i.prepareContent(E,P,H.binary,H.optimizedBinaryString,H.base64);var R=new y(E,w,H);this.files[E]=R}var t=b("./utf8"),i=b("./utils"),a=b("./stream/GenericWorker"),h=b("./stream/StreamHelper"),m=b("./defaults"),u=b("./compressedObject"),y=b("./zipObject"),l=b("./generate"),g=b("./nodejsUtils"),c=b("./nodejs/NodejsStreamInputAdapter"),f=function(E){E.slice(-1)==="/"&&(E=E.substring(0,E.length-1));var P=E.lastIndexOf("/");return 0<P?E.substring(0,P):""},d=function(E){return E.slice(-1)!=="/"&&(E+="/"),E},v=function(E,P){return P=P!==void 0?P:m.createFolders,E=d(E),this.files[E]||s.call(this,E,null,{dir:!0,createFolders:P}),this.files[E]};function k(E){return Object.prototype.toString.call(E)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(E){var P,B,M;for(P in this.files)M=this.files[P],(B=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&E(B,M)},filter:function(E){var P=[];return this.forEach(function(B,M){E(B,M)&&P.push(M)}),P},file:function(E,P,B){if(arguments.length!==1)return E=this.root+E,s.call(this,E,P,B),this;if(k(E)){var M=E;return this.filter(function(H,$){return!$.dir&&M.test(H)})}var T=this.files[this.root+E];return T&&!T.dir?T:null},folder:function(E){if(!E)return this;if(k(E))return this.filter(function(T,H){return H.dir&&E.test(T)});var P=this.root+E,B=v.call(this,P),M=this.clone();return M.root=B.name,M},remove:function(E){E=this.root+E;var P=this.files[E];if(P||(E.slice(-1)!=="/"&&(E+="/"),P=this.files[E]),P&&!P.dir)delete this.files[E];else for(var B=this.filter(function(T,H){return H.name.slice(0,E.length)===E}),M=0;M<B.length;M++)delete this.files[B[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(E){var P,B={};try{if((B=i.extend(E||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:t.utf8encode})).type=B.type.toLowerCase(),B.compression=B.compression.toUpperCase(),B.type==="binarystring"&&(B.type="string"),!B.type)throw new Error("No output type specified.");i.checkSupport(B.type),B.platform!=="darwin"&&B.platform!=="freebsd"&&B.platform!=="linux"&&B.platform!=="sunos"||(B.platform="UNIX"),B.platform==="win32"&&(B.platform="DOS");var M=B.comment||this.comment||"";P=l.generateWorker(this,B,M)}catch(T){(P=new a("error")).error(T)}return new h(P,B.type||"string",B.mimeType)},generateAsync:function(E,P){return this.generateInternalStream(E).accumulate(P)},generateNodeStream:function(E,P){return(E=E||{}).type||(E.type="nodebuffer"),this.generateInternalStream(E).toNodejsStream(P)}};e.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(b,e,r){e.exports=b("stream")},{stream:void 0}],17:[function(b,e,r){var s=b("./DataReader");function t(i){s.call(this,i);for(var a=0;a<this.data.length;a++)i[a]=255&i[a]}b("../utils").inherits(t,s),t.prototype.byteAt=function(i){return this.data[this.zero+i]},t.prototype.lastIndexOfSignature=function(i){for(var a=i.charCodeAt(0),h=i.charCodeAt(1),m=i.charCodeAt(2),u=i.charCodeAt(3),y=this.length-4;0<=y;--y)if(this.data[y]===a&&this.data[y+1]===h&&this.data[y+2]===m&&this.data[y+3]===u)return y-this.zero;return-1},t.prototype.readAndCheckSignature=function(i){var a=i.charCodeAt(0),h=i.charCodeAt(1),m=i.charCodeAt(2),u=i.charCodeAt(3),y=this.readData(4);return a===y[0]&&h===y[1]&&m===y[2]&&u===y[3]},t.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,a},e.exports=t},{"../utils":32,"./DataReader":18}],18:[function(b,e,r){var s=b("../utils");function t(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}t.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var a,h=0;for(this.checkOffset(i),a=this.index+i-1;a>=this.index;a--)h=(h<<8)+this.byteAt(a);return this.index+=i,h},readString:function(i){return s.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},e.exports=t},{"../utils":32}],19:[function(b,e,r){var s=b("./Uint8ArrayReader");function t(i){s.call(this,i)}b("../utils").inherits(t,s),t.prototype.readData=function(i){this.checkOffset(i);var a=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,a},e.exports=t},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(b,e,r){var s=b("./DataReader");function t(i){s.call(this,i)}b("../utils").inherits(t,s),t.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},t.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},t.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},t.prototype.readData=function(i){this.checkOffset(i);var a=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,a},e.exports=t},{"../utils":32,"./DataReader":18}],21:[function(b,e,r){var s=b("./ArrayReader");function t(i){s.call(this,i)}b("../utils").inherits(t,s),t.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,a},e.exports=t},{"../utils":32,"./ArrayReader":17}],22:[function(b,e,r){var s=b("../utils"),t=b("../support"),i=b("./ArrayReader"),a=b("./StringReader"),h=b("./NodeBufferReader"),m=b("./Uint8ArrayReader");e.exports=function(u){var y=s.getTypeOf(u);return s.checkSupport(y),y!=="string"||t.uint8array?y==="nodebuffer"?new h(u):t.uint8array?new m(s.transformTo("uint8array",u)):new i(s.transformTo("array",u)):new a(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(b,e,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(b,e,r){var s=b("./GenericWorker"),t=b("../utils");function i(a){s.call(this,"ConvertWorker to "+a),this.destType=a}t.inherits(i,s),i.prototype.processChunk=function(a){this.push({data:t.transformTo(this.destType,a.data),meta:a.meta})},e.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(b,e,r){var s=b("./GenericWorker"),t=b("../crc32");function i(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}b("../utils").inherits(i,s),i.prototype.processChunk=function(a){this.streamInfo.crc32=t(a.data,this.streamInfo.crc32||0),this.push(a)},e.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(b,e,r){var s=b("../utils"),t=b("./GenericWorker");function i(a){t.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}s.inherits(i,t),i.prototype.processChunk=function(a){if(a){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+a.data.length}t.prototype.processChunk.call(this,a)},e.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(b,e,r){var s=b("../utils"),t=b("./GenericWorker");function i(a){t.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(m){h.dataIsReady=!0,h.data=m,h.max=m&&m.length||0,h.type=s.getTypeOf(m),h.isPaused||h._tickAndRepeat()},function(m){h.error(m)})}s.inherits(i,t),i.prototype.cleanUp=function(){t.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!t.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,h);break;case"uint8array":a=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":a=this.data.slice(this.index,h)}return this.index=h,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(b,e,r){function s(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,i){return this._listeners[t].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,i){if(this._listeners[t])for(var a=0;a<this._listeners[t].length;a++)this._listeners[t][a].call(this,i)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var i=this;return t.on("data",function(a){i.processChunk(a)}),t.on("end",function(){i.end()}),t.on("error",function(a){i.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,i){return this.extraStreamInfo[t]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=s},{}],29:[function(b,e,r){var s=b("../utils"),t=b("./ConvertWorker"),i=b("./GenericWorker"),a=b("../base64"),h=b("../support"),m=b("../external"),u=null;if(h.nodestream)try{u=b("../nodejs/NodejsStreamOutputAdapter")}catch{}function y(g,c){return new m.Promise(function(f,d){var v=[],k=g._internalType,C=g._outputType,E=g._mimeType;g.on("data",function(P,B){v.push(P),c&&c(B)}).on("error",function(P){v=[],d(P)}).on("end",function(){try{var P=(function(B,M,T){switch(B){case"blob":return s.newBlob(s.transformTo("arraybuffer",M),T);case"base64":return a.encode(M);default:return s.transformTo(B,M)}})(C,(function(B,M){var T,H=0,$=null,w=0;for(T=0;T<M.length;T++)w+=M[T].length;switch(B){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for($=new Uint8Array(w),T=0;T<M.length;T++)$.set(M[T],H),H+=M[T].length;return $;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+B+"'")}})(k,v),E);f(P)}catch(B){d(B)}v=[]}).resume()})}function l(g,c,f){var d=c;switch(c){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=c,this._mimeType=f,s.checkSupport(d),this._worker=g.pipe(new t(d)),g.lock()}catch(v){this._worker=new i("error"),this._worker.error(v)}}l.prototype={accumulate:function(g){return y(this,g)},on:function(g,c){var f=this;return g==="data"?this._worker.on(g,function(d){c.call(f,d.data,d.meta)}):this._worker.on(g,function(){s.delay(c,arguments,f)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},g)}},e.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(b,e,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var s=new ArrayBuffer(0);try{r.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var t=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);t.append(s),r.blob=t.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!b("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(b,e,r){for(var s=b("./utils"),t=b("./support"),i=b("./nodejsUtils"),a=b("./stream/GenericWorker"),h=new Array(256),m=0;m<256;m++)h[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;h[254]=h[254]=1;function u(){a.call(this,"utf-8 decode"),this.leftOver=null}function y(){a.call(this,"utf-8 encode")}r.utf8encode=function(l){return t.nodebuffer?i.newBufferFrom(l,"utf-8"):(function(g){var c,f,d,v,k,C=g.length,E=0;for(v=0;v<C;v++)(64512&(f=g.charCodeAt(v)))==55296&&v+1<C&&(64512&(d=g.charCodeAt(v+1)))==56320&&(f=65536+(f-55296<<10)+(d-56320),v++),E+=f<128?1:f<2048?2:f<65536?3:4;for(c=t.uint8array?new Uint8Array(E):new Array(E),v=k=0;k<E;v++)(64512&(f=g.charCodeAt(v)))==55296&&v+1<C&&(64512&(d=g.charCodeAt(v+1)))==56320&&(f=65536+(f-55296<<10)+(d-56320),v++),f<128?c[k++]=f:(f<2048?c[k++]=192|f>>>6:(f<65536?c[k++]=224|f>>>12:(c[k++]=240|f>>>18,c[k++]=128|f>>>12&63),c[k++]=128|f>>>6&63),c[k++]=128|63&f);return c})(l)},r.utf8decode=function(l){return t.nodebuffer?s.transformTo("nodebuffer",l).toString("utf-8"):(function(g){var c,f,d,v,k=g.length,C=new Array(2*k);for(c=f=0;c<k;)if((d=g[c++])<128)C[f++]=d;else if(4<(v=h[d]))C[f++]=65533,c+=v-1;else{for(d&=v===2?31:v===3?15:7;1<v&&c<k;)d=d<<6|63&g[c++],v--;1<v?C[f++]=65533:d<65536?C[f++]=d:(d-=65536,C[f++]=55296|d>>10&1023,C[f++]=56320|1023&d)}return C.length!==f&&(C.subarray?C=C.subarray(0,f):C.length=f),s.applyFromCharCode(C)})(l=s.transformTo(t.uint8array?"uint8array":"array",l))},s.inherits(u,a),u.prototype.processChunk=function(l){var g=s.transformTo(t.uint8array?"uint8array":"array",l.data);if(this.leftOver&&this.leftOver.length){if(t.uint8array){var c=g;(g=new Uint8Array(c.length+this.leftOver.length)).set(this.leftOver,0),g.set(c,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var f=(function(v,k){var C;for((k=k||v.length)>v.length&&(k=v.length),C=k-1;0<=C&&(192&v[C])==128;)C--;return C<0||C===0?k:C+h[v[C]]>k?C:k})(g),d=g;f!==g.length&&(t.uint8array?(d=g.subarray(0,f),this.leftOver=g.subarray(f,g.length)):(d=g.slice(0,f),this.leftOver=g.slice(f,g.length))),this.push({data:r.utf8decode(d),meta:l.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=u,s.inherits(y,a),y.prototype.processChunk=function(l){this.push({data:r.utf8encode(l.data),meta:l.meta})},r.Utf8EncodeWorker=y},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(b,e,r){var s=b("./support"),t=b("./base64"),i=b("./nodejsUtils"),a=b("./external");function h(c){return c}function m(c,f){for(var d=0;d<c.length;++d)f[d]=255&c.charCodeAt(d);return f}b("setimmediate"),r.newBlob=function(c,f){r.checkSupport("blob");try{return new Blob([c],{type:f})}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return d.append(c),d.getBlob(f)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(c,f,d){var v=[],k=0,C=c.length;if(C<=d)return String.fromCharCode.apply(null,c);for(;k<C;)f==="array"||f==="nodebuffer"?v.push(String.fromCharCode.apply(null,c.slice(k,Math.min(k+d,C)))):v.push(String.fromCharCode.apply(null,c.subarray(k,Math.min(k+d,C)))),k+=d;return v.join("")},stringifyByChar:function(c){for(var f="",d=0;d<c.length;d++)f+=String.fromCharCode(c[d]);return f},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}})()}};function y(c){var f=65536,d=r.getTypeOf(c),v=!0;if(d==="uint8array"?v=u.applyCanBeUsed.uint8array:d==="nodebuffer"&&(v=u.applyCanBeUsed.nodebuffer),v)for(;1<f;)try{return u.stringifyByChunk(c,d,f)}catch{f=Math.floor(f/2)}return u.stringifyByChar(c)}function l(c,f){for(var d=0;d<c.length;d++)f[d]=c[d];return f}r.applyFromCharCode=y;var g={};g.string={string:h,array:function(c){return m(c,new Array(c.length))},arraybuffer:function(c){return g.string.uint8array(c).buffer},uint8array:function(c){return m(c,new Uint8Array(c.length))},nodebuffer:function(c){return m(c,i.allocBuffer(c.length))}},g.array={string:y,array:h,arraybuffer:function(c){return new Uint8Array(c).buffer},uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return i.newBufferFrom(c)}},g.arraybuffer={string:function(c){return y(new Uint8Array(c))},array:function(c){return l(new Uint8Array(c),new Array(c.byteLength))},arraybuffer:h,uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return i.newBufferFrom(new Uint8Array(c))}},g.uint8array={string:y,array:function(c){return l(c,new Array(c.length))},arraybuffer:function(c){return c.buffer},uint8array:h,nodebuffer:function(c){return i.newBufferFrom(c)}},g.nodebuffer={string:y,array:function(c){return l(c,new Array(c.length))},arraybuffer:function(c){return g.nodebuffer.uint8array(c).buffer},uint8array:function(c){return l(c,new Uint8Array(c.length))},nodebuffer:h},r.transformTo=function(c,f){if(f=f||"",!c)return f;r.checkSupport(c);var d=r.getTypeOf(f);return g[d][c](f)},r.resolve=function(c){for(var f=c.split("/"),d=[],v=0;v<f.length;v++){var k=f[v];k==="."||k===""&&v!==0&&v!==f.length-1||(k===".."?d.pop():d.push(k))}return d.join("/")},r.getTypeOf=function(c){return typeof c=="string"?"string":Object.prototype.toString.call(c)==="[object Array]"?"array":s.nodebuffer&&i.isBuffer(c)?"nodebuffer":s.uint8array&&c instanceof Uint8Array?"uint8array":s.arraybuffer&&c instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(c){if(!s[c.toLowerCase()])throw new Error(c+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(c){var f,d,v="";for(d=0;d<(c||"").length;d++)v+="\\x"+((f=c.charCodeAt(d))<16?"0":"")+f.toString(16).toUpperCase();return v},r.delay=function(c,f,d){setImmediate(function(){c.apply(d||null,f||[])})},r.inherits=function(c,f){function d(){}d.prototype=f.prototype,c.prototype=new d},r.extend=function(){var c,f,d={};for(c=0;c<arguments.length;c++)for(f in arguments[c])Object.prototype.hasOwnProperty.call(arguments[c],f)&&d[f]===void 0&&(d[f]=arguments[c][f]);return d},r.prepareContent=function(c,f,d,v,k){return a.Promise.resolve(f).then(function(C){return s.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new a.Promise(function(E,P){var B=new FileReader;B.onload=function(M){E(M.target.result)},B.onerror=function(M){P(M.target.error)},B.readAsArrayBuffer(C)}):C}).then(function(C){var E=r.getTypeOf(C);return E?(E==="arraybuffer"?C=r.transformTo("uint8array",C):E==="string"&&(k?C=t.decode(C):d&&v!==!0&&(C=(function(P){return m(P,s.uint8array?new Uint8Array(P.length):new Array(P.length))})(C))),C):a.Promise.reject(new Error("Can't read the data of '"+c+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(b,e,r){var s=b("./reader/readerFor"),t=b("./utils"),i=b("./signature"),a=b("./zipEntry"),h=b("./support");function m(u){this.files=[],this.loadOptions=u}m.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var y=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+t.pretty(y)+", expected "+t.pretty(u)+")")}},isSignature:function(u,y){var l=this.reader.index;this.reader.setIndex(u);var g=this.reader.readString(4)===y;return this.reader.setIndex(l),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),y=h.uint8array?"uint8array":"array",l=t.transformTo(y,u);this.zipComment=this.loadOptions.decodeFileName(l)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,y,l,g=this.zip64EndOfCentralSize-44;0<g;)u=this.reader.readInt(2),y=this.reader.readInt(4),l=this.reader.readData(y),this.zip64ExtensibleData[u]={id:u,length:y,value:l}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,y;for(u=0;u<this.files.length;u++)y=this.files[u],this.reader.setIndex(y.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),y.readLocalPart(this.reader),y.handleUTF8(),y.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(u=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var y=u;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===t.MAX_VALUE_16BITS||this.diskWithCentralDirStart===t.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===t.MAX_VALUE_16BITS||this.centralDirRecords===t.MAX_VALUE_16BITS||this.centralDirSize===t.MAX_VALUE_32BITS||this.centralDirOffset===t.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var l=this.centralDirOffset+this.centralDirSize;this.zip64&&(l+=20,l+=12+this.zip64EndOfCentralSize);var g=y-l;if(0<g)this.isSignature(y,i.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(u){this.reader=s(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=m},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(b,e,r){var s=b("./reader/readerFor"),t=b("./utils"),i=b("./compressedObject"),a=b("./crc32"),h=b("./utf8"),m=b("./compressions"),u=b("./support");function y(l,g){this.options=l,this.loadOptions=g}y.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(l){var g,c;if(l.skip(22),this.fileNameLength=l.readInt(2),c=l.readInt(2),this.fileName=l.readData(this.fileNameLength),l.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=(function(f){for(var d in m)if(Object.prototype.hasOwnProperty.call(m,d)&&m[d].magic===f)return m[d];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+t.pretty(this.compressionMethod)+" unknown (inner file : "+t.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,g,l.readData(this.compressedSize))},readCentralPart:function(l){this.versionMadeBy=l.readInt(2),l.skip(2),this.bitFlag=l.readInt(2),this.compressionMethod=l.readString(2),this.date=l.readDate(),this.crc32=l.readInt(4),this.compressedSize=l.readInt(4),this.uncompressedSize=l.readInt(4);var g=l.readInt(2);if(this.extraFieldsLength=l.readInt(2),this.fileCommentLength=l.readInt(2),this.diskNumberStart=l.readInt(2),this.internalFileAttributes=l.readInt(2),this.externalFileAttributes=l.readInt(4),this.localHeaderOffset=l.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");l.skip(g),this.readExtraFields(l),this.parseZIP64ExtraField(l),this.fileComment=l.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var l=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),l==0&&(this.dosPermissions=63&this.externalFileAttributes),l==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var l=s(this.extraFields[1].value);this.uncompressedSize===t.MAX_VALUE_32BITS&&(this.uncompressedSize=l.readInt(8)),this.compressedSize===t.MAX_VALUE_32BITS&&(this.compressedSize=l.readInt(8)),this.localHeaderOffset===t.MAX_VALUE_32BITS&&(this.localHeaderOffset=l.readInt(8)),this.diskNumberStart===t.MAX_VALUE_32BITS&&(this.diskNumberStart=l.readInt(4))}},readExtraFields:function(l){var g,c,f,d=l.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});l.index+4<d;)g=l.readInt(2),c=l.readInt(2),f=l.readData(c),this.extraFields[g]={id:g,length:c,value:f};l.setIndex(d)},handleUTF8:function(){var l=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var c=t.transformTo(l,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var d=t.transformTo(l,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(d)}}},findExtraFieldUnicodePath:function(){var l=this.extraFields[28789];if(l){var g=s(l.value);return g.readInt(1)!==1||a(this.fileName)!==g.readInt(4)?null:h.utf8decode(g.readData(l.length-5))}return null},findExtraFieldUnicodeComment:function(){var l=this.extraFields[25461];if(l){var g=s(l.value);return g.readInt(1)!==1||a(this.fileComment)!==g.readInt(4)?null:h.utf8decode(g.readData(l.length-5))}return null}},e.exports=y},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(b,e,r){function s(g,c,f){this.name=g,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this.unixPermissions=f.unixPermissions,this.dosPermissions=f.dosPermissions,this._data=c,this._dataBinary=f.binary,this.options={compression:f.compression,compressionOptions:f.compressionOptions}}var t=b("./stream/StreamHelper"),i=b("./stream/DataWorker"),a=b("./utf8"),h=b("./compressedObject"),m=b("./stream/GenericWorker");s.prototype={internalStream:function(g){var c=null,f="string";try{if(!g)throw new Error("No output type specified.");var d=(f=g.toLowerCase())==="string"||f==="text";f!=="binarystring"&&f!=="text"||(f="string"),c=this._decompressWorker();var v=!this._dataBinary;v&&!d&&(c=c.pipe(new a.Utf8EncodeWorker)),!v&&d&&(c=c.pipe(new a.Utf8DecodeWorker))}catch(k){(c=new m("error")).error(k)}return new t(c,f,"")},async:function(g,c){return this.internalStream(g).accumulate(c)},nodeStream:function(g,c){return this.internalStream(g||"nodebuffer").toNodejsStream(c)},_compressWorker:function(g,c){if(this._data instanceof h&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var f=this._decompressWorker();return this._dataBinary||(f=f.pipe(new a.Utf8EncodeWorker)),h.createWorkerFrom(f,g,c)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof m?this._data:new i(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],y=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<u.length;l++)s.prototype[u[l]]=y;e.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(b,e,r){(function(s){var t,i,a=s.MutationObserver||s.WebKitMutationObserver;if(a){var h=0,m=new a(g),u=s.document.createTextNode("");m.observe(u,{characterData:!0}),t=function(){u.data=h=++h%2}}else if(s.setImmediate||s.MessageChannel===void 0)t="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var c=s.document.createElement("script");c.onreadystatechange=function(){g(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},s.document.documentElement.appendChild(c)}:function(){setTimeout(g,0)};else{var y=new s.MessageChannel;y.port1.onmessage=g,t=function(){y.port2.postMessage(0)}}var l=[];function g(){var c,f;i=!0;for(var d=l.length;d;){for(f=l,l=[],c=-1;++c<d;)f[c]();d=l.length}i=!1}e.exports=function(c){l.push(c)!==1||i||t()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(b,e,r){var s=b("immediate");function t(){}var i={},a=["REJECTED"],h=["FULFILLED"],m=["PENDING"];function u(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,d!==t&&c(this,d)}function y(d,v,k){this.promise=d,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}function l(d,v,k){s(function(){var C;try{C=v(k)}catch(E){return i.reject(d,E)}C===d?i.reject(d,new TypeError("Cannot resolve promise with itself")):i.resolve(d,C)})}function g(d){var v=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof v=="function")return function(){v.apply(d,arguments)}}function c(d,v){var k=!1;function C(B){k||(k=!0,i.reject(d,B))}function E(B){k||(k=!0,i.resolve(d,B))}var P=f(function(){v(E,C)});P.status==="error"&&C(P.value)}function f(d,v){var k={};try{k.value=d(v),k.status="success"}catch(C){k.status="error",k.value=C}return k}(e.exports=u).prototype.finally=function(d){if(typeof d!="function")return this;var v=this.constructor;return this.then(function(k){return v.resolve(d()).then(function(){return k})},function(k){return v.resolve(d()).then(function(){throw k})})},u.prototype.catch=function(d){return this.then(null,d)},u.prototype.then=function(d,v){if(typeof d!="function"&&this.state===h||typeof v!="function"&&this.state===a)return this;var k=new this.constructor(t);return this.state!==m?l(k,this.state===h?d:v,this.outcome):this.queue.push(new y(k,d,v)),k},y.prototype.callFulfilled=function(d){i.resolve(this.promise,d)},y.prototype.otherCallFulfilled=function(d){l(this.promise,this.onFulfilled,d)},y.prototype.callRejected=function(d){i.reject(this.promise,d)},y.prototype.otherCallRejected=function(d){l(this.promise,this.onRejected,d)},i.resolve=function(d,v){var k=f(g,v);if(k.status==="error")return i.reject(d,k.value);var C=k.value;if(C)c(d,C);else{d.state=h,d.outcome=v;for(var E=-1,P=d.queue.length;++E<P;)d.queue[E].callFulfilled(v)}return d},i.reject=function(d,v){d.state=a,d.outcome=v;for(var k=-1,C=d.queue.length;++k<C;)d.queue[k].callRejected(v);return d},u.resolve=function(d){return d instanceof this?d:i.resolve(new this(t),d)},u.reject=function(d){var v=new this(t);return i.reject(v,d)},u.all=function(d){var v=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=d.length,C=!1;if(!k)return this.resolve([]);for(var E=new Array(k),P=0,B=-1,M=new this(t);++B<k;)T(d[B],B);return M;function T(H,$){v.resolve(H).then(function(w){E[$]=w,++P!==k||C||(C=!0,i.resolve(M,E))},function(w){C||(C=!0,i.reject(M,w))})}},u.race=function(d){var v=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=d.length,C=!1;if(!k)return this.resolve([]);for(var E=-1,P=new this(t);++E<k;)B=d[E],v.resolve(B).then(function(M){C||(C=!0,i.resolve(P,M))},function(M){C||(C=!0,i.reject(P,M))});var B;return P}},{immediate:36}],38:[function(b,e,r){var s={};(0,b("./lib/utils/common").assign)(s,b("./lib/deflate"),b("./lib/inflate"),b("./lib/zlib/constants")),e.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(b,e,r){var s=b("./zlib/deflate"),t=b("./utils/common"),i=b("./utils/strings"),a=b("./zlib/messages"),h=b("./zlib/zstream"),m=Object.prototype.toString,u=0,y=-1,l=0,g=8;function c(d){if(!(this instanceof c))return new c(d);this.options=t.assign({level:y,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},d||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var k=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(k!==u)throw new Error(a[k]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var C;if(C=typeof v.dictionary=="string"?i.string2buf(v.dictionary):m.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(k=s.deflateSetDictionary(this.strm,C))!==u)throw new Error(a[k]);this._dict_set=!0}}function f(d,v){var k=new c(v);if(k.push(d,!0),k.err)throw k.msg||a[k.err];return k.result}c.prototype.push=function(d,v){var k,C,E=this.strm,P=this.options.chunkSize;if(this.ended)return!1;C=v===~~v?v:v===!0?4:0,typeof d=="string"?E.input=i.string2buf(d):m.call(d)==="[object ArrayBuffer]"?E.input=new Uint8Array(d):E.input=d,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new t.Buf8(P),E.next_out=0,E.avail_out=P),(k=s.deflate(E,C))!==1&&k!==u)return this.onEnd(k),!(this.ended=!0);E.avail_out!==0&&(E.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(t.shrinkBuf(E.output,E.next_out))):this.onData(t.shrinkBuf(E.output,E.next_out)))}while((0<E.avail_in||E.avail_out===0)&&k!==1);return C===4?(k=s.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===u):C!==2||(this.onEnd(u),!(E.avail_out=0))},c.prototype.onData=function(d){this.chunks.push(d)},c.prototype.onEnd=function(d){d===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},r.Deflate=c,r.deflate=f,r.deflateRaw=function(d,v){return(v=v||{}).raw=!0,f(d,v)},r.gzip=function(d,v){return(v=v||{}).gzip=!0,f(d,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(b,e,r){var s=b("./zlib/inflate"),t=b("./utils/common"),i=b("./utils/strings"),a=b("./zlib/constants"),h=b("./zlib/messages"),m=b("./zlib/zstream"),u=b("./zlib/gzheader"),y=Object.prototype.toString;function l(c){if(!(this instanceof l))return new l(c);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},c||{});var f=this.options;f.raw&&0<=f.windowBits&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),!(0<=f.windowBits&&f.windowBits<16)||c&&c.windowBits||(f.windowBits+=32),15<f.windowBits&&f.windowBits<48&&(15&f.windowBits)==0&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var d=s.inflateInit2(this.strm,f.windowBits);if(d!==a.Z_OK)throw new Error(h[d]);this.header=new u,s.inflateGetHeader(this.strm,this.header)}function g(c,f){var d=new l(f);if(d.push(c,!0),d.err)throw d.msg||h[d.err];return d.result}l.prototype.push=function(c,f){var d,v,k,C,E,P,B=this.strm,M=this.options.chunkSize,T=this.options.dictionary,H=!1;if(this.ended)return!1;v=f===~~f?f:f===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof c=="string"?B.input=i.binstring2buf(c):y.call(c)==="[object ArrayBuffer]"?B.input=new Uint8Array(c):B.input=c,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new t.Buf8(M),B.next_out=0,B.avail_out=M),(d=s.inflate(B,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&T&&(P=typeof T=="string"?i.string2buf(T):y.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,d=s.inflateSetDictionary(this.strm,P)),d===a.Z_BUF_ERROR&&H===!0&&(d=a.Z_OK,H=!1),d!==a.Z_STREAM_END&&d!==a.Z_OK)return this.onEnd(d),!(this.ended=!0);B.next_out&&(B.avail_out!==0&&d!==a.Z_STREAM_END&&(B.avail_in!==0||v!==a.Z_FINISH&&v!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(k=i.utf8border(B.output,B.next_out),C=B.next_out-k,E=i.buf2string(B.output,k),B.next_out=C,B.avail_out=M-C,C&&t.arraySet(B.output,B.output,k,C,0),this.onData(E)):this.onData(t.shrinkBuf(B.output,B.next_out)))),B.avail_in===0&&B.avail_out===0&&(H=!0)}while((0<B.avail_in||B.avail_out===0)&&d!==a.Z_STREAM_END);return d===a.Z_STREAM_END&&(v=a.Z_FINISH),v===a.Z_FINISH?(d=s.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===a.Z_OK):v!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(B.avail_out=0))},l.prototype.onData=function(c){this.chunks.push(c)},l.prototype.onEnd=function(c){c===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},r.Inflate=l,r.inflate=g,r.inflateRaw=function(c,f){return(f=f||{}).raw=!0,g(c,f)},r.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(b,e,r){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(a){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var m=h.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var u in m)m.hasOwnProperty(u)&&(a[u]=m[u])}}return a},r.shrinkBuf=function(a,h){return a.length===h?a:a.subarray?a.subarray(0,h):(a.length=h,a)};var t={arraySet:function(a,h,m,u,y){if(h.subarray&&a.subarray)a.set(h.subarray(m,m+u),y);else for(var l=0;l<u;l++)a[y+l]=h[m+l]},flattenChunks:function(a){var h,m,u,y,l,g;for(h=u=0,m=a.length;h<m;h++)u+=a[h].length;for(g=new Uint8Array(u),h=y=0,m=a.length;h<m;h++)l=a[h],g.set(l,y),y+=l.length;return g}},i={arraySet:function(a,h,m,u,y){for(var l=0;l<u;l++)a[y+l]=h[m+l]},flattenChunks:function(a){return[].concat.apply([],a)}};r.setTyped=function(a){a?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,t)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,i))},r.setTyped(s)},{}],42:[function(b,e,r){var s=b("./common"),t=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var a=new s.Buf8(256),h=0;h<256;h++)a[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function m(u,y){if(y<65537&&(u.subarray&&i||!u.subarray&&t))return String.fromCharCode.apply(null,s.shrinkBuf(u,y));for(var l="",g=0;g<y;g++)l+=String.fromCharCode(u[g]);return l}a[254]=a[254]=1,r.string2buf=function(u){var y,l,g,c,f,d=u.length,v=0;for(c=0;c<d;c++)(64512&(l=u.charCodeAt(c)))==55296&&c+1<d&&(64512&(g=u.charCodeAt(c+1)))==56320&&(l=65536+(l-55296<<10)+(g-56320),c++),v+=l<128?1:l<2048?2:l<65536?3:4;for(y=new s.Buf8(v),c=f=0;f<v;c++)(64512&(l=u.charCodeAt(c)))==55296&&c+1<d&&(64512&(g=u.charCodeAt(c+1)))==56320&&(l=65536+(l-55296<<10)+(g-56320),c++),l<128?y[f++]=l:(l<2048?y[f++]=192|l>>>6:(l<65536?y[f++]=224|l>>>12:(y[f++]=240|l>>>18,y[f++]=128|l>>>12&63),y[f++]=128|l>>>6&63),y[f++]=128|63&l);return y},r.buf2binstring=function(u){return m(u,u.length)},r.binstring2buf=function(u){for(var y=new s.Buf8(u.length),l=0,g=y.length;l<g;l++)y[l]=u.charCodeAt(l);return y},r.buf2string=function(u,y){var l,g,c,f,d=y||u.length,v=new Array(2*d);for(l=g=0;l<d;)if((c=u[l++])<128)v[g++]=c;else if(4<(f=a[c]))v[g++]=65533,l+=f-1;else{for(c&=f===2?31:f===3?15:7;1<f&&l<d;)c=c<<6|63&u[l++],f--;1<f?v[g++]=65533:c<65536?v[g++]=c:(c-=65536,v[g++]=55296|c>>10&1023,v[g++]=56320|1023&c)}return m(v,g)},r.utf8border=function(u,y){var l;for((y=y||u.length)>u.length&&(y=u.length),l=y-1;0<=l&&(192&u[l])==128;)l--;return l<0||l===0?y:l+a[u[l]]>y?l:y}},{"./common":41}],43:[function(b,e,r){e.exports=function(s,t,i,a){for(var h=65535&s|0,m=s>>>16&65535|0,u=0;i!==0;){for(i-=u=2e3<i?2e3:i;m=m+(h=h+t[a++]|0)|0,--u;);h%=65521,m%=65521}return h|m<<16|0}},{}],44:[function(b,e,r){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(b,e,r){var s=(function(){for(var t,i=[],a=0;a<256;a++){t=a;for(var h=0;h<8;h++)t=1&t?3988292384^t>>>1:t>>>1;i[a]=t}return i})();e.exports=function(t,i,a,h){var m=s,u=h+a;t^=-1;for(var y=h;y<u;y++)t=t>>>8^m[255&(t^i[y])];return-1^t}},{}],46:[function(b,e,r){var s,t=b("../utils/common"),i=b("./trees"),a=b("./adler32"),h=b("./crc32"),m=b("./messages"),u=0,y=4,l=0,g=-2,c=-1,f=4,d=2,v=8,k=9,C=286,E=30,P=19,B=2*C+1,M=15,T=3,H=258,$=H+T+1,w=42,R=113,o=1,O=2,X=3,F=4;function Q(n,z){return n.msg=m[z],z}function U(n){return(n<<1)-(4<n?9:0)}function Y(n){for(var z=n.length;0<=--z;)n[z]=0}function I(n){var z=n.state,L=z.pending;L>n.avail_out&&(L=n.avail_out),L!==0&&(t.arraySet(n.output,z.pending_buf,z.pending_out,L,n.next_out),n.next_out+=L,z.pending_out+=L,n.total_out+=L,n.avail_out-=L,z.pending-=L,z.pending===0&&(z.pending_out=0))}function x(n,z){i._tr_flush_block(n,0<=n.block_start?n.block_start:-1,n.strstart-n.block_start,z),n.block_start=n.strstart,I(n.strm)}function G(n,z){n.pending_buf[n.pending++]=z}function q(n,z){n.pending_buf[n.pending++]=z>>>8&255,n.pending_buf[n.pending++]=255&z}function Z(n,z){var L,_,p=n.max_chain_length,S=n.strstart,D=n.prev_length,N=n.nice_match,A=n.strstart>n.w_size-$?n.strstart-(n.w_size-$):0,j=n.window,K=n.w_mask,W=n.prev,V=n.strstart+H,it=j[S+D-1],tt=j[S+D];n.prev_length>=n.good_match&&(p>>=2),N>n.lookahead&&(N=n.lookahead);do if(j[(L=z)+D]===tt&&j[L+D-1]===it&&j[L]===j[S]&&j[++L]===j[S+1]){S+=2,L++;do;while(j[++S]===j[++L]&&j[++S]===j[++L]&&j[++S]===j[++L]&&j[++S]===j[++L]&&j[++S]===j[++L]&&j[++S]===j[++L]&&j[++S]===j[++L]&&j[++S]===j[++L]&&S<V);if(_=H-(V-S),S=V-H,D<_){if(n.match_start=z,N<=(D=_))break;it=j[S+D-1],tt=j[S+D]}}while((z=W[z&K])>A&&--p!=0);return D<=n.lookahead?D:n.lookahead}function nt(n){var z,L,_,p,S,D,N,A,j,K,W=n.w_size;do{if(p=n.window_size-n.lookahead-n.strstart,n.strstart>=W+(W-$)){for(t.arraySet(n.window,n.window,W,W,0),n.match_start-=W,n.strstart-=W,n.block_start-=W,z=L=n.hash_size;_=n.head[--z],n.head[z]=W<=_?_-W:0,--L;);for(z=L=W;_=n.prev[--z],n.prev[z]=W<=_?_-W:0,--L;);p+=W}if(n.strm.avail_in===0)break;if(D=n.strm,N=n.window,A=n.strstart+n.lookahead,j=p,K=void 0,K=D.avail_in,j<K&&(K=j),L=K===0?0:(D.avail_in-=K,t.arraySet(N,D.input,D.next_in,K,A),D.state.wrap===1?D.adler=a(D.adler,N,K,A):D.state.wrap===2&&(D.adler=h(D.adler,N,K,A)),D.next_in+=K,D.total_in+=K,K),n.lookahead+=L,n.lookahead+n.insert>=T)for(S=n.strstart-n.insert,n.ins_h=n.window[S],n.ins_h=(n.ins_h<<n.hash_shift^n.window[S+1])&n.hash_mask;n.insert&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[S+T-1])&n.hash_mask,n.prev[S&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=S,S++,n.insert--,!(n.lookahead+n.insert<T)););}while(n.lookahead<$&&n.strm.avail_in!==0)}function ot(n,z){for(var L,_;;){if(n.lookahead<$){if(nt(n),n.lookahead<$&&z===u)return o;if(n.lookahead===0)break}if(L=0,n.lookahead>=T&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+T-1])&n.hash_mask,L=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),L!==0&&n.strstart-L<=n.w_size-$&&(n.match_length=Z(n,L)),n.match_length>=T)if(_=i._tr_tally(n,n.strstart-n.match_start,n.match_length-T),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=T){for(n.match_length--;n.strstart++,n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+T-1])&n.hash_mask,L=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart,--n.match_length!=0;);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+1])&n.hash_mask;else _=i._tr_tally(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(_&&(x(n,!1),n.strm.avail_out===0))return o}return n.insert=n.strstart<T-1?n.strstart:T-1,z===y?(x(n,!0),n.strm.avail_out===0?X:F):n.last_lit&&(x(n,!1),n.strm.avail_out===0)?o:O}function J(n,z){for(var L,_,p;;){if(n.lookahead<$){if(nt(n),n.lookahead<$&&z===u)return o;if(n.lookahead===0)break}if(L=0,n.lookahead>=T&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+T-1])&n.hash_mask,L=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=T-1,L!==0&&n.prev_length<n.max_lazy_match&&n.strstart-L<=n.w_size-$&&(n.match_length=Z(n,L),n.match_length<=5&&(n.strategy===1||n.match_length===T&&4096<n.strstart-n.match_start)&&(n.match_length=T-1)),n.prev_length>=T&&n.match_length<=n.prev_length){for(p=n.strstart+n.lookahead-T,_=i._tr_tally(n,n.strstart-1-n.prev_match,n.prev_length-T),n.lookahead-=n.prev_length-1,n.prev_length-=2;++n.strstart<=p&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+T-1])&n.hash_mask,L=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),--n.prev_length!=0;);if(n.match_available=0,n.match_length=T-1,n.strstart++,_&&(x(n,!1),n.strm.avail_out===0))return o}else if(n.match_available){if((_=i._tr_tally(n,0,n.window[n.strstart-1]))&&x(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return o}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(_=i._tr_tally(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<T-1?n.strstart:T-1,z===y?(x(n,!0),n.strm.avail_out===0?X:F):n.last_lit&&(x(n,!1),n.strm.avail_out===0)?o:O}function et(n,z,L,_,p){this.good_length=n,this.max_lazy=z,this.nice_length=L,this.max_chain=_,this.func=p}function at(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(2*B),this.dyn_dtree=new t.Buf16(2*(2*E+1)),this.bl_tree=new t.Buf16(2*(2*P+1)),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(M+1),this.heap=new t.Buf16(2*C+1),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*C+1),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function rt(n){var z;return n&&n.state?(n.total_in=n.total_out=0,n.data_type=d,(z=n.state).pending=0,z.pending_out=0,z.wrap<0&&(z.wrap=-z.wrap),z.status=z.wrap?w:R,n.adler=z.wrap===2?0:1,z.last_flush=u,i._tr_init(z),l):Q(n,g)}function ht(n){var z=rt(n);return z===l&&(function(L){L.window_size=2*L.w_size,Y(L.head),L.max_lazy_match=s[L.level].max_lazy,L.good_match=s[L.level].good_length,L.nice_match=s[L.level].nice_length,L.max_chain_length=s[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=T-1,L.match_available=0,L.ins_h=0})(n.state),z}function ct(n,z,L,_,p,S){if(!n)return g;var D=1;if(z===c&&(z=6),_<0?(D=0,_=-_):15<_&&(D=2,_-=16),p<1||k<p||L!==v||_<8||15<_||z<0||9<z||S<0||f<S)return Q(n,g);_===8&&(_=9);var N=new at;return(n.state=N).strm=n,N.wrap=D,N.gzhead=null,N.w_bits=_,N.w_size=1<<N.w_bits,N.w_mask=N.w_size-1,N.hash_bits=p+7,N.hash_size=1<<N.hash_bits,N.hash_mask=N.hash_size-1,N.hash_shift=~~((N.hash_bits+T-1)/T),N.window=new t.Buf8(2*N.w_size),N.head=new t.Buf16(N.hash_size),N.prev=new t.Buf16(N.w_size),N.lit_bufsize=1<<p+6,N.pending_buf_size=4*N.lit_bufsize,N.pending_buf=new t.Buf8(N.pending_buf_size),N.d_buf=1*N.lit_bufsize,N.l_buf=3*N.lit_bufsize,N.level=z,N.strategy=S,N.method=L,ht(n)}s=[new et(0,0,0,0,function(n,z){var L=65535;for(L>n.pending_buf_size-5&&(L=n.pending_buf_size-5);;){if(n.lookahead<=1){if(nt(n),n.lookahead===0&&z===u)return o;if(n.lookahead===0)break}n.strstart+=n.lookahead,n.lookahead=0;var _=n.block_start+L;if((n.strstart===0||n.strstart>=_)&&(n.lookahead=n.strstart-_,n.strstart=_,x(n,!1),n.strm.avail_out===0)||n.strstart-n.block_start>=n.w_size-$&&(x(n,!1),n.strm.avail_out===0))return o}return n.insert=0,z===y?(x(n,!0),n.strm.avail_out===0?X:F):(n.strstart>n.block_start&&(x(n,!1),n.strm.avail_out),o)}),new et(4,4,8,4,ot),new et(4,5,16,8,ot),new et(4,6,32,32,ot),new et(4,4,16,16,J),new et(8,16,32,32,J),new et(8,16,128,128,J),new et(8,32,128,256,J),new et(32,128,258,1024,J),new et(32,258,258,4096,J)],r.deflateInit=function(n,z){return ct(n,z,v,15,8,0)},r.deflateInit2=ct,r.deflateReset=ht,r.deflateResetKeep=rt,r.deflateSetHeader=function(n,z){return n&&n.state?n.state.wrap!==2?g:(n.state.gzhead=z,l):g},r.deflate=function(n,z){var L,_,p,S;if(!n||!n.state||5<z||z<0)return n?Q(n,g):g;if(_=n.state,!n.output||!n.input&&n.avail_in!==0||_.status===666&&z!==y)return Q(n,n.avail_out===0?-5:g);if(_.strm=n,L=_.last_flush,_.last_flush=z,_.status===w)if(_.wrap===2)n.adler=0,G(_,31),G(_,139),G(_,8),_.gzhead?(G(_,(_.gzhead.text?1:0)+(_.gzhead.hcrc?2:0)+(_.gzhead.extra?4:0)+(_.gzhead.name?8:0)+(_.gzhead.comment?16:0)),G(_,255&_.gzhead.time),G(_,_.gzhead.time>>8&255),G(_,_.gzhead.time>>16&255),G(_,_.gzhead.time>>24&255),G(_,_.level===9?2:2<=_.strategy||_.level<2?4:0),G(_,255&_.gzhead.os),_.gzhead.extra&&_.gzhead.extra.length&&(G(_,255&_.gzhead.extra.length),G(_,_.gzhead.extra.length>>8&255)),_.gzhead.hcrc&&(n.adler=h(n.adler,_.pending_buf,_.pending,0)),_.gzindex=0,_.status=69):(G(_,0),G(_,0),G(_,0),G(_,0),G(_,0),G(_,_.level===9?2:2<=_.strategy||_.level<2?4:0),G(_,3),_.status=R);else{var D=v+(_.w_bits-8<<4)<<8;D|=(2<=_.strategy||_.level<2?0:_.level<6?1:_.level===6?2:3)<<6,_.strstart!==0&&(D|=32),D+=31-D%31,_.status=R,q(_,D),_.strstart!==0&&(q(_,n.adler>>>16),q(_,65535&n.adler)),n.adler=1}if(_.status===69)if(_.gzhead.extra){for(p=_.pending;_.gzindex<(65535&_.gzhead.extra.length)&&(_.pending!==_.pending_buf_size||(_.gzhead.hcrc&&_.pending>p&&(n.adler=h(n.adler,_.pending_buf,_.pending-p,p)),I(n),p=_.pending,_.pending!==_.pending_buf_size));)G(_,255&_.gzhead.extra[_.gzindex]),_.gzindex++;_.gzhead.hcrc&&_.pending>p&&(n.adler=h(n.adler,_.pending_buf,_.pending-p,p)),_.gzindex===_.gzhead.extra.length&&(_.gzindex=0,_.status=73)}else _.status=73;if(_.status===73)if(_.gzhead.name){p=_.pending;do{if(_.pending===_.pending_buf_size&&(_.gzhead.hcrc&&_.pending>p&&(n.adler=h(n.adler,_.pending_buf,_.pending-p,p)),I(n),p=_.pending,_.pending===_.pending_buf_size)){S=1;break}S=_.gzindex<_.gzhead.name.length?255&_.gzhead.name.charCodeAt(_.gzindex++):0,G(_,S)}while(S!==0);_.gzhead.hcrc&&_.pending>p&&(n.adler=h(n.adler,_.pending_buf,_.pending-p,p)),S===0&&(_.gzindex=0,_.status=91)}else _.status=91;if(_.status===91)if(_.gzhead.comment){p=_.pending;do{if(_.pending===_.pending_buf_size&&(_.gzhead.hcrc&&_.pending>p&&(n.adler=h(n.adler,_.pending_buf,_.pending-p,p)),I(n),p=_.pending,_.pending===_.pending_buf_size)){S=1;break}S=_.gzindex<_.gzhead.comment.length?255&_.gzhead.comment.charCodeAt(_.gzindex++):0,G(_,S)}while(S!==0);_.gzhead.hcrc&&_.pending>p&&(n.adler=h(n.adler,_.pending_buf,_.pending-p,p)),S===0&&(_.status=103)}else _.status=103;if(_.status===103&&(_.gzhead.hcrc?(_.pending+2>_.pending_buf_size&&I(n),_.pending+2<=_.pending_buf_size&&(G(_,255&n.adler),G(_,n.adler>>8&255),n.adler=0,_.status=R)):_.status=R),_.pending!==0){if(I(n),n.avail_out===0)return _.last_flush=-1,l}else if(n.avail_in===0&&U(z)<=U(L)&&z!==y)return Q(n,-5);if(_.status===666&&n.avail_in!==0)return Q(n,-5);if(n.avail_in!==0||_.lookahead!==0||z!==u&&_.status!==666){var N=_.strategy===2?(function(A,j){for(var K;;){if(A.lookahead===0&&(nt(A),A.lookahead===0)){if(j===u)return o;break}if(A.match_length=0,K=i._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++,K&&(x(A,!1),A.strm.avail_out===0))return o}return A.insert=0,j===y?(x(A,!0),A.strm.avail_out===0?X:F):A.last_lit&&(x(A,!1),A.strm.avail_out===0)?o:O})(_,z):_.strategy===3?(function(A,j){for(var K,W,V,it,tt=A.window;;){if(A.lookahead<=H){if(nt(A),A.lookahead<=H&&j===u)return o;if(A.lookahead===0)break}if(A.match_length=0,A.lookahead>=T&&0<A.strstart&&(W=tt[V=A.strstart-1])===tt[++V]&&W===tt[++V]&&W===tt[++V]){it=A.strstart+H;do;while(W===tt[++V]&&W===tt[++V]&&W===tt[++V]&&W===tt[++V]&&W===tt[++V]&&W===tt[++V]&&W===tt[++V]&&W===tt[++V]&&V<it);A.match_length=H-(it-V),A.match_length>A.lookahead&&(A.match_length=A.lookahead)}if(A.match_length>=T?(K=i._tr_tally(A,1,A.match_length-T),A.lookahead-=A.match_length,A.strstart+=A.match_length,A.match_length=0):(K=i._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++),K&&(x(A,!1),A.strm.avail_out===0))return o}return A.insert=0,j===y?(x(A,!0),A.strm.avail_out===0?X:F):A.last_lit&&(x(A,!1),A.strm.avail_out===0)?o:O})(_,z):s[_.level].func(_,z);if(N!==X&&N!==F||(_.status=666),N===o||N===X)return n.avail_out===0&&(_.last_flush=-1),l;if(N===O&&(z===1?i._tr_align(_):z!==5&&(i._tr_stored_block(_,0,0,!1),z===3&&(Y(_.head),_.lookahead===0&&(_.strstart=0,_.block_start=0,_.insert=0))),I(n),n.avail_out===0))return _.last_flush=-1,l}return z!==y?l:_.wrap<=0?1:(_.wrap===2?(G(_,255&n.adler),G(_,n.adler>>8&255),G(_,n.adler>>16&255),G(_,n.adler>>24&255),G(_,255&n.total_in),G(_,n.total_in>>8&255),G(_,n.total_in>>16&255),G(_,n.total_in>>24&255)):(q(_,n.adler>>>16),q(_,65535&n.adler)),I(n),0<_.wrap&&(_.wrap=-_.wrap),_.pending!==0?l:1)},r.deflateEnd=function(n){var z;return n&&n.state?(z=n.state.status)!==w&&z!==69&&z!==73&&z!==91&&z!==103&&z!==R&&z!==666?Q(n,g):(n.state=null,z===R?Q(n,-3):l):g},r.deflateSetDictionary=function(n,z){var L,_,p,S,D,N,A,j,K=z.length;if(!n||!n.state||(S=(L=n.state).wrap)===2||S===1&&L.status!==w||L.lookahead)return g;for(S===1&&(n.adler=a(n.adler,z,K,0)),L.wrap=0,K>=L.w_size&&(S===0&&(Y(L.head),L.strstart=0,L.block_start=0,L.insert=0),j=new t.Buf8(L.w_size),t.arraySet(j,z,K-L.w_size,L.w_size,0),z=j,K=L.w_size),D=n.avail_in,N=n.next_in,A=n.input,n.avail_in=K,n.next_in=0,n.input=z,nt(L);L.lookahead>=T;){for(_=L.strstart,p=L.lookahead-(T-1);L.ins_h=(L.ins_h<<L.hash_shift^L.window[_+T-1])&L.hash_mask,L.prev[_&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=_,_++,--p;);L.strstart=_,L.lookahead=T-1,nt(L)}return L.strstart+=L.lookahead,L.block_start=L.strstart,L.insert=L.lookahead,L.lookahead=0,L.match_length=L.prev_length=T-1,L.match_available=0,n.next_in=N,n.input=A,n.avail_in=D,L.wrap=S,l},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(b,e,r){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(b,e,r){e.exports=function(s,t){var i,a,h,m,u,y,l,g,c,f,d,v,k,C,E,P,B,M,T,H,$,w,R,o,O;i=s.state,a=s.next_in,o=s.input,h=a+(s.avail_in-5),m=s.next_out,O=s.output,u=m-(t-s.avail_out),y=m+(s.avail_out-257),l=i.dmax,g=i.wsize,c=i.whave,f=i.wnext,d=i.window,v=i.hold,k=i.bits,C=i.lencode,E=i.distcode,P=(1<<i.lenbits)-1,B=(1<<i.distbits)-1;t:do{k<15&&(v+=o[a++]<<k,k+=8,v+=o[a++]<<k,k+=8),M=C[v&P];e:for(;;){if(v>>>=T=M>>>24,k-=T,(T=M>>>16&255)===0)O[m++]=65535&M;else{if(!(16&T)){if((64&T)==0){M=C[(65535&M)+(v&(1<<T)-1)];continue e}if(32&T){i.mode=12;break t}s.msg="invalid literal/length code",i.mode=30;break t}H=65535&M,(T&=15)&&(k<T&&(v+=o[a++]<<k,k+=8),H+=v&(1<<T)-1,v>>>=T,k-=T),k<15&&(v+=o[a++]<<k,k+=8,v+=o[a++]<<k,k+=8),M=E[v&B];i:for(;;){if(v>>>=T=M>>>24,k-=T,!(16&(T=M>>>16&255))){if((64&T)==0){M=E[(65535&M)+(v&(1<<T)-1)];continue i}s.msg="invalid distance code",i.mode=30;break t}if($=65535&M,k<(T&=15)&&(v+=o[a++]<<k,(k+=8)<T&&(v+=o[a++]<<k,k+=8)),l<($+=v&(1<<T)-1)){s.msg="invalid distance too far back",i.mode=30;break t}if(v>>>=T,k-=T,(T=m-u)<$){if(c<(T=$-T)&&i.sane){s.msg="invalid distance too far back",i.mode=30;break t}if(R=d,(w=0)===f){if(w+=g-T,T<H){for(H-=T;O[m++]=d[w++],--T;);w=m-$,R=O}}else if(f<T){if(w+=g+f-T,(T-=f)<H){for(H-=T;O[m++]=d[w++],--T;);if(w=0,f<H){for(H-=T=f;O[m++]=d[w++],--T;);w=m-$,R=O}}}else if(w+=f-T,T<H){for(H-=T;O[m++]=d[w++],--T;);w=m-$,R=O}for(;2<H;)O[m++]=R[w++],O[m++]=R[w++],O[m++]=R[w++],H-=3;H&&(O[m++]=R[w++],1<H&&(O[m++]=R[w++]))}else{for(w=m-$;O[m++]=O[w++],O[m++]=O[w++],O[m++]=O[w++],2<(H-=3););H&&(O[m++]=O[w++],1<H&&(O[m++]=O[w++]))}break}}break}}while(a<h&&m<y);a-=H=k>>3,v&=(1<<(k-=H<<3))-1,s.next_in=a,s.next_out=m,s.avail_in=a<h?h-a+5:5-(a-h),s.avail_out=m<y?y-m+257:257-(m-y),i.hold=v,i.bits=k}},{}],49:[function(b,e,r){var s=b("../utils/common"),t=b("./adler32"),i=b("./crc32"),a=b("./inffast"),h=b("./inftrees"),m=1,u=2,y=0,l=-2,g=1,c=852,f=592;function d(w){return(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function k(w){var R;return w&&w.state?(R=w.state,w.total_in=w.total_out=R.total=0,w.msg="",R.wrap&&(w.adler=1&R.wrap),R.mode=g,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new s.Buf32(c),R.distcode=R.distdyn=new s.Buf32(f),R.sane=1,R.back=-1,y):l}function C(w){var R;return w&&w.state?((R=w.state).wsize=0,R.whave=0,R.wnext=0,k(w)):l}function E(w,R){var o,O;return w&&w.state?(O=w.state,R<0?(o=0,R=-R):(o=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?l:(O.window!==null&&O.wbits!==R&&(O.window=null),O.wrap=o,O.wbits=R,C(w))):l}function P(w,R){var o,O;return w?(O=new v,(w.state=O).window=null,(o=E(w,R))!==y&&(w.state=null),o):l}var B,M,T=!0;function H(w){if(T){var R;for(B=new s.Buf32(512),M=new s.Buf32(32),R=0;R<144;)w.lens[R++]=8;for(;R<256;)w.lens[R++]=9;for(;R<280;)w.lens[R++]=7;for(;R<288;)w.lens[R++]=8;for(h(m,w.lens,0,288,B,0,w.work,{bits:9}),R=0;R<32;)w.lens[R++]=5;h(u,w.lens,0,32,M,0,w.work,{bits:5}),T=!1}w.lencode=B,w.lenbits=9,w.distcode=M,w.distbits=5}function $(w,R,o,O){var X,F=w.state;return F.window===null&&(F.wsize=1<<F.wbits,F.wnext=0,F.whave=0,F.window=new s.Buf8(F.wsize)),O>=F.wsize?(s.arraySet(F.window,R,o-F.wsize,F.wsize,0),F.wnext=0,F.whave=F.wsize):(O<(X=F.wsize-F.wnext)&&(X=O),s.arraySet(F.window,R,o-O,X,F.wnext),(O-=X)?(s.arraySet(F.window,R,o-O,O,0),F.wnext=O,F.whave=F.wsize):(F.wnext+=X,F.wnext===F.wsize&&(F.wnext=0),F.whave<F.wsize&&(F.whave+=X))),0}r.inflateReset=C,r.inflateReset2=E,r.inflateResetKeep=k,r.inflateInit=function(w){return P(w,15)},r.inflateInit2=P,r.inflate=function(w,R){var o,O,X,F,Q,U,Y,I,x,G,q,Z,nt,ot,J,et,at,rt,ht,ct,n,z,L,_,p=0,S=new s.Buf8(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!w||!w.state||!w.output||!w.input&&w.avail_in!==0)return l;(o=w.state).mode===12&&(o.mode=13),Q=w.next_out,X=w.output,Y=w.avail_out,F=w.next_in,O=w.input,U=w.avail_in,I=o.hold,x=o.bits,G=U,q=Y,z=y;t:for(;;)switch(o.mode){case g:if(o.wrap===0){o.mode=13;break}for(;x<16;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if(2&o.wrap&&I===35615){S[o.check=0]=255&I,S[1]=I>>>8&255,o.check=i(o.check,S,2,0),x=I=0,o.mode=2;break}if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&I)<<8)+(I>>8))%31){w.msg="incorrect header check",o.mode=30;break}if((15&I)!=8){w.msg="unknown compression method",o.mode=30;break}if(x-=4,n=8+(15&(I>>>=4)),o.wbits===0)o.wbits=n;else if(n>o.wbits){w.msg="invalid window size",o.mode=30;break}o.dmax=1<<n,w.adler=o.check=1,o.mode=512&I?10:12,x=I=0;break;case 2:for(;x<16;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if(o.flags=I,(255&o.flags)!=8){w.msg="unknown compression method",o.mode=30;break}if(57344&o.flags){w.msg="unknown header flags set",o.mode=30;break}o.head&&(o.head.text=I>>8&1),512&o.flags&&(S[0]=255&I,S[1]=I>>>8&255,o.check=i(o.check,S,2,0)),x=I=0,o.mode=3;case 3:for(;x<32;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}o.head&&(o.head.time=I),512&o.flags&&(S[0]=255&I,S[1]=I>>>8&255,S[2]=I>>>16&255,S[3]=I>>>24&255,o.check=i(o.check,S,4,0)),x=I=0,o.mode=4;case 4:for(;x<16;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}o.head&&(o.head.xflags=255&I,o.head.os=I>>8),512&o.flags&&(S[0]=255&I,S[1]=I>>>8&255,o.check=i(o.check,S,2,0)),x=I=0,o.mode=5;case 5:if(1024&o.flags){for(;x<16;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}o.length=I,o.head&&(o.head.extra_len=I),512&o.flags&&(S[0]=255&I,S[1]=I>>>8&255,o.check=i(o.check,S,2,0)),x=I=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&(U<(Z=o.length)&&(Z=U),Z&&(o.head&&(n=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Array(o.head.extra_len)),s.arraySet(o.head.extra,O,F,Z,n)),512&o.flags&&(o.check=i(o.check,O,Z,F)),U-=Z,F+=Z,o.length-=Z),o.length))break t;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(U===0)break t;for(Z=0;n=O[F+Z++],o.head&&n&&o.length<65536&&(o.head.name+=String.fromCharCode(n)),n&&Z<U;);if(512&o.flags&&(o.check=i(o.check,O,Z,F)),U-=Z,F+=Z,n)break t}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(U===0)break t;for(Z=0;n=O[F+Z++],o.head&&n&&o.length<65536&&(o.head.comment+=String.fromCharCode(n)),n&&Z<U;);if(512&o.flags&&(o.check=i(o.check,O,Z,F)),U-=Z,F+=Z,n)break t}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;x<16;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if(I!==(65535&o.check)){w.msg="header crc mismatch",o.mode=30;break}x=I=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),w.adler=o.check=0,o.mode=12;break;case 10:for(;x<32;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}w.adler=o.check=d(I),x=I=0,o.mode=11;case 11:if(o.havedict===0)return w.next_out=Q,w.avail_out=Y,w.next_in=F,w.avail_in=U,o.hold=I,o.bits=x,2;w.adler=o.check=1,o.mode=12;case 12:if(R===5||R===6)break t;case 13:if(o.last){I>>>=7&x,x-=7&x,o.mode=27;break}for(;x<3;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}switch(o.last=1&I,x-=1,3&(I>>>=1)){case 0:o.mode=14;break;case 1:if(H(o),o.mode=20,R!==6)break;I>>>=2,x-=2;break t;case 2:o.mode=17;break;case 3:w.msg="invalid block type",o.mode=30}I>>>=2,x-=2;break;case 14:for(I>>>=7&x,x-=7&x;x<32;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if((65535&I)!=(I>>>16^65535)){w.msg="invalid stored block lengths",o.mode=30;break}if(o.length=65535&I,x=I=0,o.mode=15,R===6)break t;case 15:o.mode=16;case 16:if(Z=o.length){if(U<Z&&(Z=U),Y<Z&&(Z=Y),Z===0)break t;s.arraySet(X,O,F,Z,Q),U-=Z,F+=Z,Y-=Z,Q+=Z,o.length-=Z;break}o.mode=12;break;case 17:for(;x<14;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if(o.nlen=257+(31&I),I>>>=5,x-=5,o.ndist=1+(31&I),I>>>=5,x-=5,o.ncode=4+(15&I),I>>>=4,x-=4,286<o.nlen||30<o.ndist){w.msg="too many length or distance symbols",o.mode=30;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;x<3;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}o.lens[D[o.have++]]=7&I,I>>>=3,x-=3}for(;o.have<19;)o.lens[D[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,L={bits:o.lenbits},z=h(0,o.lens,0,19,o.lencode,0,o.work,L),o.lenbits=L.bits,z){w.msg="invalid code lengths set",o.mode=30;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;et=(p=o.lencode[I&(1<<o.lenbits)-1])>>>16&255,at=65535&p,!((J=p>>>24)<=x);){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if(at<16)I>>>=J,x-=J,o.lens[o.have++]=at;else{if(at===16){for(_=J+2;x<_;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if(I>>>=J,x-=J,o.have===0){w.msg="invalid bit length repeat",o.mode=30;break}n=o.lens[o.have-1],Z=3+(3&I),I>>>=2,x-=2}else if(at===17){for(_=J+3;x<_;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}x-=J,n=0,Z=3+(7&(I>>>=J)),I>>>=3,x-=3}else{for(_=J+7;x<_;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}x-=J,n=0,Z=11+(127&(I>>>=J)),I>>>=7,x-=7}if(o.have+Z>o.nlen+o.ndist){w.msg="invalid bit length repeat",o.mode=30;break}for(;Z--;)o.lens[o.have++]=n}}if(o.mode===30)break;if(o.lens[256]===0){w.msg="invalid code -- missing end-of-block",o.mode=30;break}if(o.lenbits=9,L={bits:o.lenbits},z=h(m,o.lens,0,o.nlen,o.lencode,0,o.work,L),o.lenbits=L.bits,z){w.msg="invalid literal/lengths set",o.mode=30;break}if(o.distbits=6,o.distcode=o.distdyn,L={bits:o.distbits},z=h(u,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,L),o.distbits=L.bits,z){w.msg="invalid distances set",o.mode=30;break}if(o.mode=20,R===6)break t;case 20:o.mode=21;case 21:if(6<=U&&258<=Y){w.next_out=Q,w.avail_out=Y,w.next_in=F,w.avail_in=U,o.hold=I,o.bits=x,a(w,q),Q=w.next_out,X=w.output,Y=w.avail_out,F=w.next_in,O=w.input,U=w.avail_in,I=o.hold,x=o.bits,o.mode===12&&(o.back=-1);break}for(o.back=0;et=(p=o.lencode[I&(1<<o.lenbits)-1])>>>16&255,at=65535&p,!((J=p>>>24)<=x);){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if(et&&(240&et)==0){for(rt=J,ht=et,ct=at;et=(p=o.lencode[ct+((I&(1<<rt+ht)-1)>>rt)])>>>16&255,at=65535&p,!(rt+(J=p>>>24)<=x);){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}I>>>=rt,x-=rt,o.back+=rt}if(I>>>=J,x-=J,o.back+=J,o.length=at,et===0){o.mode=26;break}if(32&et){o.back=-1,o.mode=12;break}if(64&et){w.msg="invalid literal/length code",o.mode=30;break}o.extra=15&et,o.mode=22;case 22:if(o.extra){for(_=o.extra;x<_;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}o.length+=I&(1<<o.extra)-1,I>>>=o.extra,x-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;et=(p=o.distcode[I&(1<<o.distbits)-1])>>>16&255,at=65535&p,!((J=p>>>24)<=x);){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if((240&et)==0){for(rt=J,ht=et,ct=at;et=(p=o.distcode[ct+((I&(1<<rt+ht)-1)>>rt)])>>>16&255,at=65535&p,!(rt+(J=p>>>24)<=x);){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}I>>>=rt,x-=rt,o.back+=rt}if(I>>>=J,x-=J,o.back+=J,64&et){w.msg="invalid distance code",o.mode=30;break}o.offset=at,o.extra=15&et,o.mode=24;case 24:if(o.extra){for(_=o.extra;x<_;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}o.offset+=I&(1<<o.extra)-1,I>>>=o.extra,x-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){w.msg="invalid distance too far back",o.mode=30;break}o.mode=25;case 25:if(Y===0)break t;if(Z=q-Y,o.offset>Z){if((Z=o.offset-Z)>o.whave&&o.sane){w.msg="invalid distance too far back",o.mode=30;break}nt=Z>o.wnext?(Z-=o.wnext,o.wsize-Z):o.wnext-Z,Z>o.length&&(Z=o.length),ot=o.window}else ot=X,nt=Q-o.offset,Z=o.length;for(Y<Z&&(Z=Y),Y-=Z,o.length-=Z;X[Q++]=ot[nt++],--Z;);o.length===0&&(o.mode=21);break;case 26:if(Y===0)break t;X[Q++]=o.length,Y--,o.mode=21;break;case 27:if(o.wrap){for(;x<32;){if(U===0)break t;U--,I|=O[F++]<<x,x+=8}if(q-=Y,w.total_out+=q,o.total+=q,q&&(w.adler=o.check=o.flags?i(o.check,X,q,Q-q):t(o.check,X,q,Q-q)),q=Y,(o.flags?I:d(I))!==o.check){w.msg="incorrect data check",o.mode=30;break}x=I=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;x<32;){if(U===0)break t;U--,I+=O[F++]<<x,x+=8}if(I!==(4294967295&o.total)){w.msg="incorrect length check",o.mode=30;break}x=I=0}o.mode=29;case 29:z=1;break t;case 30:z=-3;break t;case 31:return-4;default:return l}return w.next_out=Q,w.avail_out=Y,w.next_in=F,w.avail_in=U,o.hold=I,o.bits=x,(o.wsize||q!==w.avail_out&&o.mode<30&&(o.mode<27||R!==4))&&$(w,w.output,w.next_out,q-w.avail_out)?(o.mode=31,-4):(G-=w.avail_in,q-=w.avail_out,w.total_in+=G,w.total_out+=q,o.total+=q,o.wrap&&q&&(w.adler=o.check=o.flags?i(o.check,X,q,w.next_out-q):t(o.check,X,q,w.next_out-q)),w.data_type=o.bits+(o.last?64:0)+(o.mode===12?128:0)+(o.mode===20||o.mode===15?256:0),(G==0&&q===0||R===4)&&z===y&&(z=-5),z)},r.inflateEnd=function(w){if(!w||!w.state)return l;var R=w.state;return R.window&&(R.window=null),w.state=null,y},r.inflateGetHeader=function(w,R){var o;return w&&w.state?(2&(o=w.state).wrap)==0?l:((o.head=R).done=!1,y):l},r.inflateSetDictionary=function(w,R){var o,O=R.length;return w&&w.state?(o=w.state).wrap!==0&&o.mode!==11?l:o.mode===11&&t(1,R,O,0)!==o.check?-3:$(w,R,O,O)?(o.mode=31,-4):(o.havedict=1,y):l},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(b,e,r){var s=b("../utils/common"),t=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(m,u,y,l,g,c,f,d){var v,k,C,E,P,B,M,T,H,$=d.bits,w=0,R=0,o=0,O=0,X=0,F=0,Q=0,U=0,Y=0,I=0,x=null,G=0,q=new s.Buf16(16),Z=new s.Buf16(16),nt=null,ot=0;for(w=0;w<=15;w++)q[w]=0;for(R=0;R<l;R++)q[u[y+R]]++;for(X=$,O=15;1<=O&&q[O]===0;O--);if(O<X&&(X=O),O===0)return g[c++]=20971520,g[c++]=20971520,d.bits=1,0;for(o=1;o<O&&q[o]===0;o++);for(X<o&&(X=o),w=U=1;w<=15;w++)if(U<<=1,(U-=q[w])<0)return-1;if(0<U&&(m===0||O!==1))return-1;for(Z[1]=0,w=1;w<15;w++)Z[w+1]=Z[w]+q[w];for(R=0;R<l;R++)u[y+R]!==0&&(f[Z[u[y+R]]++]=R);if(B=m===0?(x=nt=f,19):m===1?(x=t,G-=257,nt=i,ot-=257,256):(x=a,nt=h,-1),w=o,P=c,Q=R=I=0,C=-1,E=(Y=1<<(F=X))-1,m===1&&852<Y||m===2&&592<Y)return 1;for(;;){for(M=w-Q,H=f[R]<B?(T=0,f[R]):f[R]>B?(T=nt[ot+f[R]],x[G+f[R]]):(T=96,0),v=1<<w-Q,o=k=1<<F;g[P+(I>>Q)+(k-=v)]=M<<24|T<<16|H|0,k!==0;);for(v=1<<w-1;I&v;)v>>=1;if(v!==0?(I&=v-1,I+=v):I=0,R++,--q[w]==0){if(w===O)break;w=u[y+f[R]]}if(X<w&&(I&E)!==C){for(Q===0&&(Q=X),P+=o,U=1<<(F=w-Q);F+Q<O&&!((U-=q[F+Q])<=0);)F++,U<<=1;if(Y+=1<<F,m===1&&852<Y||m===2&&592<Y)return 1;g[C=I&E]=X<<24|F<<16|P-c|0}}return I!==0&&(g[P+I]=w-Q<<24|64<<16|0),d.bits=X,0}},{"../utils/common":41}],51:[function(b,e,r){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(b,e,r){var s=b("../utils/common"),t=0,i=1;function a(p){for(var S=p.length;0<=--S;)p[S]=0}var h=0,m=29,u=256,y=u+1+m,l=30,g=19,c=2*y+1,f=15,d=16,v=7,k=256,C=16,E=17,P=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(y+2));a($);var w=new Array(2*l);a(w);var R=new Array(512);a(R);var o=new Array(256);a(o);var O=new Array(m);a(O);var X,F,Q,U=new Array(l);function Y(p,S,D,N,A){this.static_tree=p,this.extra_bits=S,this.extra_base=D,this.elems=N,this.max_length=A,this.has_stree=p&&p.length}function I(p,S){this.dyn_tree=p,this.max_code=0,this.stat_desc=S}function x(p){return p<256?R[p]:R[256+(p>>>7)]}function G(p,S){p.pending_buf[p.pending++]=255&S,p.pending_buf[p.pending++]=S>>>8&255}function q(p,S,D){p.bi_valid>d-D?(p.bi_buf|=S<<p.bi_valid&65535,G(p,p.bi_buf),p.bi_buf=S>>d-p.bi_valid,p.bi_valid+=D-d):(p.bi_buf|=S<<p.bi_valid&65535,p.bi_valid+=D)}function Z(p,S,D){q(p,D[2*S],D[2*S+1])}function nt(p,S){for(var D=0;D|=1&p,p>>>=1,D<<=1,0<--S;);return D>>>1}function ot(p,S,D){var N,A,j=new Array(f+1),K=0;for(N=1;N<=f;N++)j[N]=K=K+D[N-1]<<1;for(A=0;A<=S;A++){var W=p[2*A+1];W!==0&&(p[2*A]=nt(j[W]++,W))}}function J(p){var S;for(S=0;S<y;S++)p.dyn_ltree[2*S]=0;for(S=0;S<l;S++)p.dyn_dtree[2*S]=0;for(S=0;S<g;S++)p.bl_tree[2*S]=0;p.dyn_ltree[2*k]=1,p.opt_len=p.static_len=0,p.last_lit=p.matches=0}function et(p){8<p.bi_valid?G(p,p.bi_buf):0<p.bi_valid&&(p.pending_buf[p.pending++]=p.bi_buf),p.bi_buf=0,p.bi_valid=0}function at(p,S,D,N){var A=2*S,j=2*D;return p[A]<p[j]||p[A]===p[j]&&N[S]<=N[D]}function rt(p,S,D){for(var N=p.heap[D],A=D<<1;A<=p.heap_len&&(A<p.heap_len&&at(S,p.heap[A+1],p.heap[A],p.depth)&&A++,!at(S,N,p.heap[A],p.depth));)p.heap[D]=p.heap[A],D=A,A<<=1;p.heap[D]=N}function ht(p,S,D){var N,A,j,K,W=0;if(p.last_lit!==0)for(;N=p.pending_buf[p.d_buf+2*W]<<8|p.pending_buf[p.d_buf+2*W+1],A=p.pending_buf[p.l_buf+W],W++,N===0?Z(p,A,S):(Z(p,(j=o[A])+u+1,S),(K=B[j])!==0&&q(p,A-=O[j],K),Z(p,j=x(--N),D),(K=M[j])!==0&&q(p,N-=U[j],K)),W<p.last_lit;);Z(p,k,S)}function ct(p,S){var D,N,A,j=S.dyn_tree,K=S.stat_desc.static_tree,W=S.stat_desc.has_stree,V=S.stat_desc.elems,it=-1;for(p.heap_len=0,p.heap_max=c,D=0;D<V;D++)j[2*D]!==0?(p.heap[++p.heap_len]=it=D,p.depth[D]=0):j[2*D+1]=0;for(;p.heap_len<2;)j[2*(A=p.heap[++p.heap_len]=it<2?++it:0)]=1,p.depth[A]=0,p.opt_len--,W&&(p.static_len-=K[2*A+1]);for(S.max_code=it,D=p.heap_len>>1;1<=D;D--)rt(p,j,D);for(A=V;D=p.heap[1],p.heap[1]=p.heap[p.heap_len--],rt(p,j,1),N=p.heap[1],p.heap[--p.heap_max]=D,p.heap[--p.heap_max]=N,j[2*A]=j[2*D]+j[2*N],p.depth[A]=(p.depth[D]>=p.depth[N]?p.depth[D]:p.depth[N])+1,j[2*D+1]=j[2*N+1]=A,p.heap[1]=A++,rt(p,j,1),2<=p.heap_len;);p.heap[--p.heap_max]=p.heap[1],(function(tt,lt){var mt,dt,gt,st,yt,St,ft=lt.dyn_tree,Tt=lt.max_code,Ft=lt.stat_desc.static_tree,Mt=lt.stat_desc.has_stree,Ut=lt.stat_desc.extra_bits,Bt=lt.stat_desc.extra_base,_t=lt.stat_desc.max_length,vt=0;for(st=0;st<=f;st++)tt.bl_count[st]=0;for(ft[2*tt.heap[tt.heap_max]+1]=0,mt=tt.heap_max+1;mt<c;mt++)_t<(st=ft[2*ft[2*(dt=tt.heap[mt])+1]+1]+1)&&(st=_t,vt++),ft[2*dt+1]=st,Tt<dt||(tt.bl_count[st]++,yt=0,Bt<=dt&&(yt=Ut[dt-Bt]),St=ft[2*dt],tt.opt_len+=St*(st+yt),Mt&&(tt.static_len+=St*(Ft[2*dt+1]+yt)));if(vt!==0){do{for(st=_t-1;tt.bl_count[st]===0;)st--;tt.bl_count[st]--,tt.bl_count[st+1]+=2,tt.bl_count[_t]--,vt-=2}while(0<vt);for(st=_t;st!==0;st--)for(dt=tt.bl_count[st];dt!==0;)Tt<(gt=tt.heap[--mt])||(ft[2*gt+1]!==st&&(tt.opt_len+=(st-ft[2*gt+1])*ft[2*gt],ft[2*gt+1]=st),dt--)}})(p,S),ot(j,it,p.bl_count)}function n(p,S,D){var N,A,j=-1,K=S[1],W=0,V=7,it=4;for(K===0&&(V=138,it=3),S[2*(D+1)+1]=65535,N=0;N<=D;N++)A=K,K=S[2*(N+1)+1],++W<V&&A===K||(W<it?p.bl_tree[2*A]+=W:A!==0?(A!==j&&p.bl_tree[2*A]++,p.bl_tree[2*C]++):W<=10?p.bl_tree[2*E]++:p.bl_tree[2*P]++,j=A,it=(W=0)===K?(V=138,3):A===K?(V=6,3):(V=7,4))}function z(p,S,D){var N,A,j=-1,K=S[1],W=0,V=7,it=4;for(K===0&&(V=138,it=3),N=0;N<=D;N++)if(A=K,K=S[2*(N+1)+1],!(++W<V&&A===K)){if(W<it)for(;Z(p,A,p.bl_tree),--W!=0;);else A!==0?(A!==j&&(Z(p,A,p.bl_tree),W--),Z(p,C,p.bl_tree),q(p,W-3,2)):W<=10?(Z(p,E,p.bl_tree),q(p,W-3,3)):(Z(p,P,p.bl_tree),q(p,W-11,7));j=A,it=(W=0)===K?(V=138,3):A===K?(V=6,3):(V=7,4)}}a(U);var L=!1;function _(p,S,D,N){q(p,(h<<1)+(N?1:0),3),(function(A,j,K,W){et(A),G(A,K),G(A,~K),s.arraySet(A.pending_buf,A.window,j,K,A.pending),A.pending+=K})(p,S,D)}r._tr_init=function(p){L||((function(){var S,D,N,A,j,K=new Array(f+1);for(A=N=0;A<m-1;A++)for(O[A]=N,S=0;S<1<<B[A];S++)o[N++]=A;for(o[N-1]=A,A=j=0;A<16;A++)for(U[A]=j,S=0;S<1<<M[A];S++)R[j++]=A;for(j>>=7;A<l;A++)for(U[A]=j<<7,S=0;S<1<<M[A]-7;S++)R[256+j++]=A;for(D=0;D<=f;D++)K[D]=0;for(S=0;S<=143;)$[2*S+1]=8,S++,K[8]++;for(;S<=255;)$[2*S+1]=9,S++,K[9]++;for(;S<=279;)$[2*S+1]=7,S++,K[7]++;for(;S<=287;)$[2*S+1]=8,S++,K[8]++;for(ot($,y+1,K),S=0;S<l;S++)w[2*S+1]=5,w[2*S]=nt(S,5);X=new Y($,B,u+1,y,f),F=new Y(w,M,0,l,f),Q=new Y(new Array(0),T,0,g,v)})(),L=!0),p.l_desc=new I(p.dyn_ltree,X),p.d_desc=new I(p.dyn_dtree,F),p.bl_desc=new I(p.bl_tree,Q),p.bi_buf=0,p.bi_valid=0,J(p)},r._tr_stored_block=_,r._tr_flush_block=function(p,S,D,N){var A,j,K=0;0<p.level?(p.strm.data_type===2&&(p.strm.data_type=(function(W){var V,it=4093624447;for(V=0;V<=31;V++,it>>>=1)if(1&it&&W.dyn_ltree[2*V]!==0)return t;if(W.dyn_ltree[18]!==0||W.dyn_ltree[20]!==0||W.dyn_ltree[26]!==0)return i;for(V=32;V<u;V++)if(W.dyn_ltree[2*V]!==0)return i;return t})(p)),ct(p,p.l_desc),ct(p,p.d_desc),K=(function(W){var V;for(n(W,W.dyn_ltree,W.l_desc.max_code),n(W,W.dyn_dtree,W.d_desc.max_code),ct(W,W.bl_desc),V=g-1;3<=V&&W.bl_tree[2*H[V]+1]===0;V--);return W.opt_len+=3*(V+1)+5+5+4,V})(p),A=p.opt_len+3+7>>>3,(j=p.static_len+3+7>>>3)<=A&&(A=j)):A=j=D+5,D+4<=A&&S!==-1?_(p,S,D,N):p.strategy===4||j===A?(q(p,2+(N?1:0),3),ht(p,$,w)):(q(p,4+(N?1:0),3),(function(W,V,it,tt){var lt;for(q(W,V-257,5),q(W,it-1,5),q(W,tt-4,4),lt=0;lt<tt;lt++)q(W,W.bl_tree[2*H[lt]+1],3);z(W,W.dyn_ltree,V-1),z(W,W.dyn_dtree,it-1)})(p,p.l_desc.max_code+1,p.d_desc.max_code+1,K+1),ht(p,p.dyn_ltree,p.dyn_dtree)),J(p),N&&et(p)},r._tr_tally=function(p,S,D){return p.pending_buf[p.d_buf+2*p.last_lit]=S>>>8&255,p.pending_buf[p.d_buf+2*p.last_lit+1]=255&S,p.pending_buf[p.l_buf+p.last_lit]=255&D,p.last_lit++,S===0?p.dyn_ltree[2*D]++:(p.matches++,S--,p.dyn_ltree[2*(o[D]+u+1)]++,p.dyn_dtree[2*x(S)]++),p.last_lit===p.lit_bufsize-1},r._tr_align=function(p){q(p,2,3),Z(p,k,$),(function(S){S.bi_valid===16?(G(S,S.bi_buf),S.bi_buf=0,S.bi_valid=0):8<=S.bi_valid&&(S.pending_buf[S.pending++]=255&S.bi_buf,S.bi_buf>>=8,S.bi_valid-=8)})(p)}},{"../utils/common":41}],53:[function(b,e,r){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(b,e,r){(function(s){(function(t,i){if(!t.setImmediate){var a,h,m,u,y=1,l={},g=!1,c=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,a={}.toString.call(t.process)==="[object process]"?function(C){process.nextTick(function(){v(C)})}:(function(){if(t.postMessage&&!t.importScripts){var C=!0,E=t.onmessage;return t.onmessage=function(){C=!1},t.postMessage("","*"),t.onmessage=E,C}})()?(u="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",k,!1):t.attachEvent("onmessage",k),function(C){t.postMessage(u+C,"*")}):t.MessageChannel?((m=new MessageChannel).port1.onmessage=function(C){v(C.data)},function(C){m.port2.postMessage(C)}):c&&"onreadystatechange"in c.createElement("script")?(h=c.documentElement,function(C){var E=c.createElement("script");E.onreadystatechange=function(){v(C),E.onreadystatechange=null,h.removeChild(E),E=null},h.appendChild(E)}):function(C){setTimeout(v,0,C)},f.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var E=new Array(arguments.length-1),P=0;P<E.length;P++)E[P]=arguments[P+1];var B={callback:C,args:E};return l[y]=B,a(y),y++},f.clearImmediate=d}function d(C){delete l[C]}function v(C){if(g)setTimeout(v,0,C);else{var E=l[C];if(E){g=!0;try{(function(P){var B=P.callback,M=P.args;switch(M.length){case 0:B();break;case 1:B(M[0]);break;case 2:B(M[0],M[1]);break;case 3:B(M[0],M[1],M[2]);break;default:B.apply(i,M)}})(E)}finally{d(C),g=!1}}}}function k(C){C.source===t&&typeof C.data=="string"&&C.data.indexOf(u)===0&&v(+C.data.slice(u.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)});class Pt{constructor(e){this.contentLoader=e,this.isProcessing=!1,this.cacheName="audio-mp3-cache"}async loadAndInject(){if(!this.isProcessing){this.isProcessing=!0;try{if(!("caches"in window))return;const e=await caches.open(this.cacheName),r=this.contentLoader.getAllSegments(),s=[...new Set(r.map(d=>d.audio).filter(d=>d&&d!=="skip"))],t=await e.keys();let i=0;const a=new Set;for(const d of t){const k=new URL(d.url).pathname.split("/").pop();k&&k.endsWith(".mp3")&&(s.includes(k)?a.add(k):(await e.delete(d),i++))}i>0;const h=s.filter(d=>!a.has(d));if(h.length===0)return;const m=`${bt}app-content/audio.zip?t=${Date.now()}`,u=await fetch(m);if(!u.ok)return;const y=await u.blob(),l=window.JSZip;if(!l)return;const c=await new l().loadAsync(y);let f=0;for(const d of h){const v=c.file(d);if(v){const k=await v.async("blob"),C=`${window.location.origin}${bt}app-content/audio/${d}`,E=new Response(k,{status:200,statusText:"OK",headers:{"Content-Type":"audio/mpeg","Content-Length":k.size.toString(),"Cache-Control":"max-age=31536000"}});await e.put(C,E),f++}}}catch{}finally{this.isProcessing=!1}}}}document.addEventListener("DOMContentLoaded",async()=>{de(),await new Promise(h=>setTimeout(h,150));const b=new Dt,e=new Yt(b),r=new $t(b),s=localStorage.getItem("sutta_loop_enabled")==="true";r.isLooping=s,re.init(),se.init(),ae.init();const t=new ee("content",(h,m,u)=>{r.playSegment(h,m,u)},(h,m)=>{r.playSequence(h,m)}),i=new Xt("toc-list","sidebar","sidebar-toggle",t),a=new ie(()=>{if(r.isPaused)r.resume();else{const h=t.getFirstVisibleSegmentId();if(h){const m=e.getSegmentsStartingFrom(h);m.length>0&&r.playSequence(m)}else{const m=e.getAllSegments();m.length>0&&r.playSequence(m)}}},()=>{r.isPlaying?r.pause():r.isPaused&&r.resume()},()=>{r.stop()},h=>{r.setRate(h)},h=>{r.isLooping=h});a.setSpeed(r.currentRate),new ne(r.engine),r.onSegmentStart=(h,m)=>{t.highlightSegment(h,m),t.updatePlaybackState(r.isPlaying?"playing":"paused",h,m,r.sequenceParentId)},r.onPlaybackEnd=()=>{t.clearHighlight(),a.updateState("stopped"),t.updatePlaybackState("stopped",null,!1,null)},r.onPlaybackStateChange=h=>{a.updateState(h),t.updatePlaybackState(h,r.currentSegmentId,r.isSequence,r.sequenceParentId)};try{const h=await e.load();t.render(h),i.render(h);const m=document.querySelector(".loading");m&&m.remove(),"requestIdleCallback"in window?requestIdleCallback(()=>{new Pt(e).loadAndInject()}):setTimeout(()=>{new Pt(e).loadAndInject()},3e3)}catch{document.getElementById("content").innerHTML='<div class="error">Không thể tải dữ liệu. Vui lòng thử lại sau.</div>'}})});export default ue();
