(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))u(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const y of h.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&u(y)}).observe(document,{childList:!0,subtree:!0});function t(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function u(l){if(l.ep)return;l.ep=!0;const h=t(l);fetch(l.href,h)}})();const De="/gioibon/",le={API_KEY:"google_cloud_api_key",TTS_VOICE:"tts_voice_name",TTS_RATE:"tts_rate",TTS_CACHE_LIST:"tts_gcloud_voices_list",TTS_CACHE_TS:"tts_gcloud_voices_ts"},Ue={VOICE_LANG:"vi-VN",VOICE_NAME:"vi-VN-Chirp3-HD-Charon",RATE:1.5,CACHE_DURATION:10080*60*1e3},er={TTS:"https://texttospeech.googleapis.com/v1/text:synthesize",VOICES:"https://texttospeech.googleapis.com/v1/voices"};class Ni{constructor(){this.apiKey=localStorage.getItem(le.API_KEY)||"",this.cachedVoices=this._loadVoicesFromCache(),this.voice={languageCode:Ue.VOICE_LANG,name:localStorage.getItem(le.TTS_VOICE)||Ue.VOICE_NAME},this.rate=parseFloat(localStorage.getItem(le.TTS_RATE))||Ue.RATE}setApiKey(n){this.apiKey=n,localStorage.setItem(le.API_KEY,n)}getApiKey(){return this.apiKey}setVoice(n,t="vi-VN"){this.voice={name:n,languageCode:t},localStorage.setItem(le.TTS_VOICE,n)}setRate(n){this.rate=n,localStorage.setItem(le.TTS_RATE,n)}_loadVoicesFromCache(){const n=localStorage.getItem(le.TTS_CACHE_LIST);if(n)try{return JSON.parse(n)}catch(t){console.warn("Failed to parse cached voices:",t)}return[]}async getVoices(n=!1){if(!this.apiKey)return[];const t=parseInt(localStorage.getItem(le.TTS_CACHE_TS)||"0"),u=Date.now();if(!n&&this.cachedVoices.length>0&&u-t<Ue.CACHE_DURATION)return console.log("Using cached voices."),this.cachedVoices;console.log("Fetching voices from API...");try{const l=await fetch(`${er.VOICES}?key=${this.apiKey}&languageCode=vi-VN`);if(!l.ok)return this.cachedVoices.length>0?(console.warn("Fetch failed, using stale cache."),this.cachedVoices):[];const w=((await l.json()).voices||[]).filter(S=>S.languageCodes.includes("vi-VN"));return w.length>0&&(this.cachedVoices=w,localStorage.setItem(le.TTS_CACHE_LIST,JSON.stringify(w)),localStorage.setItem(le.TTS_CACHE_TS,u.toString())),w}catch(l){return console.error("Error fetching voices:",l),this.cachedVoices.length>0?this.cachedVoices:[]}}async fetchAudio(n){if(!this.apiKey)throw new Error("Vui lòng nhập Google Cloud API Key trong phần Cài đặt.");const t={input:{text:n},voice:{languageCode:this.voice.languageCode,name:this.voice.name},audioConfig:{audioEncoding:"MP3",speakingRate:this.rate,pitch:0}};try{const u=await fetch(`${er.TTS}?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!u.ok){const h=await u.json().catch(()=>({}));throw new Error(h.error?.message||`API Error: ${u.status}`)}const l=await u.json();if(l.audioContent)return"data:audio/mp3;base64,"+l.audioContent;throw new Error("No audio content received")}catch(u){throw console.error("TTS Fetch Error:",u),u}}}class Mi{constructor(){this.engine=new Ni,this.audioQueue=[],this.isPlaying=!1,this.isPaused=!1,this.currentAudio=null,this.currentSegmentId=null,this.isSequence=!1,this.sequenceParentId=null,this.isLooping=!1,this.currentPlaylist=[],this.onSegmentStart=null,this.onSegmentEnd=null,this.onPlaybackEnd=null,this.onPlaybackStateChange=null,this.ttsRules=null,this.rulesPromise=fetch(`${De}app-content/tts_rules.json`).then(n=>n.json()).then(n=>{this.ttsRules=n}).catch(n=>console.warn("Không tìm thấy tts_rules.json",n))}setApiKey(n){this.engine.setApiKey(n)}getApiKey(){return this.engine.getApiKey()}setVoice(n){this.engine.setVoice(n)}setRate(n){this.engine.setRate(n)}getVoices(n){return this.engine.getVoices(n)}get currentVoice(){return this.engine.voice}get currentRate(){return this.engine.rate}playSegment(n,t,u){if(String(this.currentSegmentId)===String(n)&&(this.isPlaying||this.isPaused)){this.togglePause();return}this.stop(),this.isSequence=!1;const l={id:n,audio:t,text:u};this.audioQueue=[l],this.currentPlaylist=[l],this._processQueue()}playSequence(n,t=null){if(this.isSequence&&n.length>0&&this.currentPlaylist.length>0&&String(this.currentPlaylist[0].id)===String(n[0].id)&&(this.isPlaying||this.isPaused)){this.togglePause();return}this.stop(),this.isSequence=!0,this.sequenceParentId=t,this.audioQueue=[...n],this.currentPlaylist=[...n],this._processQueue()}pause(){this.currentAudio&&!this.currentAudio.paused&&(this.currentAudio.pause(),this.isPaused=!0,this.isPlaying=!1,this.onPlaybackStateChange&&this.onPlaybackStateChange("paused"))}resume(){this.currentAudio&&this.currentAudio.paused&&this.isPaused?(this.currentAudio.play(),this.isPaused=!1,this.isPlaying=!0,this.onPlaybackStateChange&&this.onPlaybackStateChange("playing")):this.audioQueue.length>0&&!this.isPlaying&&!this.isPaused&&this._processQueue()}togglePause(){this.isPaused?this.resume():this.pause()}stop(){this.audioQueue=[],this.currentPlaylist=[],this.sequenceParentId=null,this.currentAudio&&(this.currentAudio.pause(),this.currentAudio=null),this.isPlaying=!1,this.isPaused=!1,this.currentSegmentId=null,this.isSequence=!1,this.onPlaybackEnd&&this.onPlaybackEnd(),this.onPlaybackStateChange&&this.onPlaybackStateChange("stopped")}_escapeRegExp(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}_isUpper(n){return n===n.toUpperCase()&&n!==n.toLowerCase()}_capitalize(n){return n&&n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}async _applyTTSRules(n){if(!n)return"";if(await this.rulesPromise,!this.ttsRules)return n;let t=n;if(this.ttsRules.remove_html&&(t=t.replace(/<[^>]*>?/gm,"")),this.ttsRules.remove_chars_regex&&(t=t.replace(new RegExp(this.ttsRules.remove_chars_regex,"g")," ")),this.ttsRules.collapse_spaces&&(t=t.replace(/\s+/g," ").trim()),this.ttsRules.phonetics)for(const[u,l]of Object.entries(this.ttsRules.phonetics)){const h=new RegExp(this._escapeRegExp(u),"gi");t=t.replace(h,l)}return this.ttsRules.capitalize_upper&&this._isUpper(t)&&(t=this._capitalize(t)),t}async _processQueue(){if(this.audioQueue.length===0)if(this.isLooping&&this.currentPlaylist.length>0)this.audioQueue=[...this.currentPlaylist];else{this.stop();return}if(this.isPaused)return;this.isPlaying=!0,this.onPlaybackStateChange&&this.onPlaybackStateChange("playing");const n=this.audioQueue.shift();this.currentSegmentId=n.id,this.onSegmentStart&&this.onSegmentStart(n.id,this.isSequence);try{let t=null;if(n.audio&&n.audio!=="skip")t=`${De}app-content/audio/${n.audio}`;else if(n.text){const l=await this._applyTTSRules(n.text);l&&(t=await this.engine.fetchAudio(l))}if(!t){this.onSegmentEnd&&this.onSegmentEnd(n.id),this._processQueue();return}if(!this.isPlaying&&!this.isPaused&&this.audioQueue.length===0&&!this.currentSegmentId)return;const u=new Audio(t);this.currentAudio=u,this.engine.rate&&(u.playbackRate=this.engine.rate),u.onended=()=>{this.currentAudio=null,this.onSegmentEnd&&this.onSegmentEnd(n.id),this._processQueue()},u.onerror=l=>{console.error("Audio Playback Error:",l,t),this.currentAudio=null,this.onSegmentEnd&&this.onSegmentEnd(n.id),this._processQueue()},await u.play()}catch(t){console.error("Playback error",t),this.onSegmentEnd&&this.onSegmentEnd(n.id),this._processQueue()}}}var P=0,tr=1,fe=5,at=10,ut=12,dt=14,rr=21,nt=25,Ui=27,ot=100,Hi=101,Vi=3338,zi=3594,Ki=4106,Wi=2570,$i=1802,Qi=1034,Gi=3850,Yi=266,pr=522,Xi=1546,Ji=2058,mr=778,gr=1,ft=2,We=4,Zi=8,es=64,ye=256,ts=512,ve=0,qe=1,Ve=2,ze=4,rs=2048,ns=16384,is=14,yr=21,vr=31,wr=32,ss=33,nr=1,ir=2,sr=3,ar=4,or=5,as=2,os=512,ls=class{name;mxPathname=64;_module;constructor(o,n){this.name=o,this._module=n}close(){}isReady(){return!0}hasAsyncMethod(o){return!1}xOpen(o,n,t,u,l){return dt}xDelete(o,n,t){return P}xAccess(o,n,t,u){return P}xFullPathname(o,n,t,u){return P}xGetLastError(o,n,t){return P}xClose(o){return P}xRead(o,n,t,u,l){return P}xWrite(o,n,t,u,l){return P}xTruncate(o,n,t){return P}xSync(o,n){return P}xFileSize(o,n){return P}xLock(o,n){return P}xUnlock(o,n){return P}xCheckReservedLock(o,n){return P}xFileControl(o,n,t){return ut}xSectorSize(o){return os}xDeviceCharacteristics(o){return 0}},cs=Object.getPrototypeOf(async function(){}).constructor,us=class extends ls{constructor(o,n){super(o,n)}hasAsyncMethod(o){const n=`j${o.slice(1)}`;return this[n]instanceof cs}getFilename(o){throw new Error("unimplemented")}jOpen(o,n,t,u){return dt}jDelete(o,n){return P}jAccess(o,n,t){return P}jFullPathname(o,n){const{read:t,written:u}=new TextEncoder().encodeInto(o,n);return t<o.length||u>=n.length?at:(n[u]=0,P)}jGetLastError(o){return P}jClose(o){return P}jRead(o,n,t){return n.fill(0),pr}jWrite(o,n,t){return mr}jTruncate(o,n){return P}jSync(o,n){return P}jFileSize(o,n){return P}jLock(o,n){return P}jUnlock(o,n){return P}jCheckReservedLock(o,n){return n.setInt32(0,0,!0),P}jFileControl(o,n,t){return ut}jSectorSize(o){return super.xSectorSize(o)}jDeviceCharacteristics(o){return 0}xOpen(o,n,t,u,l){const h=this.#e(n,u),y=this.#r("Int32",l);return this.log?.("jOpen",h,t,"0x"+u.toString(16)),this.jOpen(h,t,u,y)}xDelete(o,n,t){const u=this._module.UTF8ToString(n);return this.log?.("jDelete",u,t),this.jDelete(u,t)}xAccess(o,n,t,u){const l=this._module.UTF8ToString(n),h=this.#r("Int32",u);return this.log?.("jAccess",l,t),this.jAccess(l,t,h)}xFullPathname(o,n,t,u){const l=this._module.UTF8ToString(n),h=this._module.HEAPU8.subarray(u,u+t);return this.log?.("jFullPathname",l,t),this.jFullPathname(l,h)}xGetLastError(o,n,t){const u=this._module.HEAPU8.subarray(t,t+n);return this.log?.("jGetLastError",n),this.jGetLastError(u)}xClose(o){return this.log?.("jClose",o),this.jClose(o)}xRead(o,n,t,u,l){const h=this.#t(n,t),y=it(u,l);return this.log?.("jRead",o,t,y),this.jRead(o,h,y)}xWrite(o,n,t,u,l){const h=this.#t(n,t),y=it(u,l);return this.log?.("jWrite",o,h,y),this.jWrite(o,h,y)}xTruncate(o,n,t){const u=it(n,t);return this.log?.("jTruncate",o,u),this.jTruncate(o,u)}xSync(o,n){return this.log?.("jSync",o,n),this.jSync(o,n)}xFileSize(o,n){const t=this.#r("BigInt64",n);return this.log?.("jFileSize",o),this.jFileSize(o,t)}xLock(o,n){return this.log?.("jLock",o,n),this.jLock(o,n)}xUnlock(o,n){return this.log?.("jUnlock",o,n),this.jUnlock(o,n)}xCheckReservedLock(o,n){const t=this.#r("Int32",n);return this.log?.("jCheckReservedLock",o),this.jCheckReservedLock(o,t)}xFileControl(o,n,t){const u=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+t);return this.log?.("jFileControl",o,n,u),this.jFileControl(o,n,u)}xSectorSize(o){return this.log?.("jSectorSize",o),this.jSectorSize(o)}xDeviceCharacteristics(o){return this.log?.("jDeviceCharacteristics",o),this.jDeviceCharacteristics(o)}#r(o,n){return new fs(this._module,n,o)}#t(o,n){return new ds(this._module,o,n)}#e(o,n){if(n&es){let t=o,u=1;const l=[];for(;u;){const h=this._module.HEAPU8[t++];if(h)l.push(h);else switch(this._module.HEAPU8[t]||(u=null),u){case 1:l.push(63),u=2;break;case 2:l.push(61),u=3;break;case 3:l.push(38),u=2;break}}return new TextDecoder().decode(new Uint8Array(l))}return o?this._module.UTF8ToString(o):null}};function it(o,n){return n*4294967296+o+(o<0?2**32:0)}var ds=class{#r;#t=new Uint8Array;get#e(){return this.#t.buffer.byteLength===0&&(this.#t=this.#r.HEAPU8.subarray(this.byteOffset,this.byteOffset+this.byteLength)),this.#t}constructor(o,n,t){this.#r=o,this.byteOffset=n,this.length=this.byteLength=t}get buffer(){return this.#e.buffer}at(o){return this.#e.at(o)}copyWithin(o,n,t){this.#e.copyWithin(o,n,t)}entries(){return this.#e.entries()}every(o){return this.#e.every(o)}fill(o,n,t){this.#e.fill(o,n,t)}filter(o){return this.#e.filter(o)}find(o){return this.#e.find(o)}findIndex(o){return this.#e.findIndex(o)}findLast(o){return this.#e.findLast(o)}findLastIndex(o){return this.#e.findLastIndex(o)}forEach(o){this.#e.forEach(o)}includes(o,n){return this.#e.includes(o,n)}indexOf(o,n){return this.#e.indexOf(o,n)}join(o){return this.#e.join(o)}keys(){return this.#e.keys()}lastIndexOf(o,n){return this.#e.lastIndexOf(o,n)}map(o){return this.#e.map(o)}reduce(o,n){return this.#e.reduce(o,n)}reduceRight(o,n){return this.#e.reduceRight(o,n)}reverse(){this.#e.reverse()}set(o,n){this.#e.set(o,n)}slice(o,n){return this.#e.slice(o,n)}some(o){return this.#e.some(o)}sort(o){this.#e.sort(o)}subarray(o,n){return this.#e.subarray(o,n)}toLocaleString(o,n){return this.#e.toLocaleString(o,n)}toReversed(){return this.#e.toReversed()}toSorted(o){return this.#e.toSorted(o)}toString(){return this.#e.toString()}values(){return this.#e.values()}with(o,n){return this.#e.with(o,n)}[Symbol.iterator](){return this.#e[Symbol.iterator]()}},fs=class{#r;#t;#e=new DataView(new ArrayBuffer(0));get#n(){return this.#e.buffer.byteLength===0&&(this.#e=new DataView(this.#r.HEAPU8.buffer,this.#r.HEAPU8.byteOffset+this.byteOffset)),this.#e}constructor(o,n,t){this.#r=o,this.byteOffset=n,this.#t=t}get buffer(){return this.#n.buffer}get byteLength(){return this.#t==="Int32"?4:8}getInt32(o,n){if(this.#t!=="Int32")throw new Error("invalid type");if(!n)throw new Error("must be little endian");return this.#n.getInt32(o,n)}setInt32(o,n,t){if(this.#t!=="Int32")throw new Error("invalid type");if(!t)throw new Error("must be little endian");this.#n.setInt32(o,n,t)}getBigInt64(o,n){if(this.#t!=="BigInt64")throw new Error("invalid type");if(!n)throw new Error("must be little endian");return this.#n.getBigInt64(o,n)}setBigInt64(o,n,t){if(this.#t!=="BigInt64")throw new Error("invalid type");if(!t)throw new Error("must be little endian");this.#n.setBigInt64(o,n,t)}},lr=0x7fffffffffffffffn,cr=-0x8000000000000000n,st=Object.getPrototypeOf(async function(){}).constructor,Pe=class extends Error{constructor(o,n){super(o),this.code=n}},Re=!0;function hs(o){const n={};o.retryOps=[];const t=o._getSqliteFree(),u=o._malloc(8),l=[u,u+4],h=new TextEncoder;function y(v){if(typeof v!="string")return 0;const p=h.encode(v),m=o._sqlite3_malloc(p.byteLength+1);return o.HEAPU8.set(p,m),o.HEAPU8[m+p.byteLength]=0,m}function w(v,p){return BigInt(p)<<32n|BigInt(v)&0xffffffffn}const S=(function(){const v=BigInt(Number.MAX_SAFE_INTEGER)>>32n,p=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(m,b){return b>v||b<p?w(m,b):b*4294967296+(m&2147483647)-(m&2147483648)}})(),q=new Set;function T(v){if(!q.has(v))throw new Pe("not a database",rr)}const F=new Map;function O(v){if(!F.has(v))throw new Pe("not a statement",rr)}n.bind_collection=function(v,p){O(v);const m=Array.isArray(p),b=n.bind_parameter_count(v);for(let k=1;k<=b;++k){const j=m?k-1:n.bind_parameter_name(v,k),R=p[j];R!==void 0&&n.bind(v,k,R)}return P},n.bind=function(v,p,m){switch(O(v),typeof m){case"number":return m===(m|0)?n.bind_int(v,p,m):n.bind_double(v,p,m);case"string":return n.bind_text(v,p,m);case"boolean":return n.bind_int(v,p,m?1:0);default:return m instanceof Uint8Array||Array.isArray(m)?n.bind_blob(v,p,m):m===null?n.bind_null(v,p):typeof m=="bigint"?n.bind_int64(v,p,m):m===void 0?Ui:(console.warn("unknown binding converted to null",m),n.bind_null(v,p))}},n.bind_blob=(function(){const v="sqlite3_bind_blob",p=o.cwrap(v,...M("nnnnn:n"));return function(m,b,k){O(m);const j=k.byteLength??k.length,R=o._sqlite3_malloc(j);o.HEAPU8.subarray(R).set(k);const Q=p(m,b,R,j,t);return H(v,Q,F.get(m))}})(),n.bind_parameter_count=(function(){const p=o.cwrap("sqlite3_bind_parameter_count",...M("n:n"));return function(m){return O(m),p(m)}})(),n.bind_double=(function(){const v="sqlite3_bind_double",p=o.cwrap(v,...M("nnn:n"));return function(m,b,k){O(m);const j=p(m,b,k);return H(v,j,F.get(m))}})(),n.bind_int=(function(){const v="sqlite3_bind_int",p=o.cwrap(v,...M("nnn:n"));return function(m,b,k){if(O(m),k>2147483647||k<-2147483648)return nt;const j=p(m,b,k);return H(v,j,F.get(m))}})(),n.bind_int64=(function(){const v="sqlite3_bind_int64",p=o.cwrap(v,...M("nnnn:n"));return function(m,b,k){if(O(m),k>lr||k<cr)return nt;const j=k&0xffffffffn,R=k>>32n,Q=p(m,b,Number(j),Number(R));return H(v,Q,F.get(m))}})(),n.bind_null=(function(){const v="sqlite3_bind_null",p=o.cwrap(v,...M("nn:n"));return function(m,b){O(m);const k=p(m,b);return H(v,k,F.get(m))}})(),n.bind_parameter_name=(function(){const p=o.cwrap("sqlite3_bind_parameter_name",...M("n:s"));return function(m,b){return O(m),p(m,b)}})(),n.bind_text=(function(){const v="sqlite3_bind_text",p=o.cwrap(v,...M("nnnnn:n"));return function(m,b,k){O(m);const j=y(k),R=p(m,b,j,-1,t);return H(v,R,F.get(m))}})(),n.changes=(function(){const p=o.cwrap("sqlite3_changes",...M("n:n"));return function(m){return T(m),p(m)}})(),n.clear_bindings=(function(){const v="sqlite3_clear_bindings",p=o.cwrap(v,...M("n:n"));return function(m){O(m);const b=p(m);return H(v,b,F.get(m))}})(),n.close=(function(){const v="sqlite3_close",p=o.cwrap(v,...M("n:n"),{async:Re});return async function(m){T(m);const b=await p(m);return q.delete(m),H(v,b,m)}})(),n.column=function(v,p){O(v);const m=n.column_type(v,p);switch(m){case ar:return n.column_blob(v,p);case ir:return n.column_double(v,p);case nr:const b=n.column_int(v,p),k=o.getTempRet0();return S(b,k);case or:return null;case sr:return n.column_text(v,p);default:throw new Pe("unknown type",m)}},n.column_blob=(function(){const p=o.cwrap("sqlite3_column_blob",...M("nn:n"));return function(m,b){O(m);const k=n.column_bytes(m,b),j=p(m,b);return o.HEAPU8.subarray(j,j+k)}})(),n.column_bytes=(function(){const p=o.cwrap("sqlite3_column_bytes",...M("nn:n"));return function(m,b){return O(m),p(m,b)}})(),n.column_count=(function(){const p=o.cwrap("sqlite3_column_count",...M("n:n"));return function(m){return O(m),p(m)}})(),n.column_double=(function(){const p=o.cwrap("sqlite3_column_double",...M("nn:n"));return function(m,b){return O(m),p(m,b)}})(),n.column_int=(function(){const p=o.cwrap("sqlite3_column_int64",...M("nn:n"));return function(m,b){return O(m),p(m,b)}})(),n.column_int64=(function(){const p=o.cwrap("sqlite3_column_int64",...M("nn:n"));return function(m,b){O(m);const k=p(m,b),j=o.getTempRet0();return w(k,j)}})(),n.column_name=(function(){const p=o.cwrap("sqlite3_column_name",...M("nn:s"));return function(m,b){return O(m),p(m,b)}})(),n.column_names=function(v){const p=[],m=n.column_count(v);for(let b=0;b<m;++b)p.push(n.column_name(v,b));return p},n.column_text=(function(){const p=o.cwrap("sqlite3_column_text",...M("nn:s"));return function(m,b){return O(m),p(m,b)}})(),n.column_type=(function(){const p=o.cwrap("sqlite3_column_type",...M("nn:n"));return function(m,b){return O(m),p(m,b)}})(),n.create_function=function(v,p,m,b,k,j,R,Q){T(v);function X(A){return A instanceof st?(async(W,ie,re)=>A(W,o.HEAP32.subarray(re/4,re/4+ie))):((W,ie,re)=>A(W,o.HEAP32.subarray(re/4,re/4+ie)))}const Z=o.create_function(v,p,m,b,k,j&&X(j),R&&X(R),Q);return H("sqlite3_create_function",Z,v)},n.data_count=(function(){const p=o.cwrap("sqlite3_data_count",...M("n:n"));return function(m){return O(m),p(m)}})(),n.exec=async function(v,p,m){for await(const b of n.statements(v,p)){let k;for(;await n.step(b)===ot;)if(m){k=k??n.column_names(b);const j=n.row(b);await m(j,k)}}return P},n.finalize=(function(){const p=o.cwrap("sqlite3_finalize",...M("n:n"),{async:Re});return async function(m){const b=await p(m);return F.delete(m),b}})(),n.get_autocommit=(function(){const p=o.cwrap("sqlite3_get_autocommit",...M("n:n"));return function(m){return p(m)}})(),n.libversion=(function(){const p=o.cwrap("sqlite3_libversion",...M(":s"));return function(){return p()}})(),n.libversion_number=(function(){const p=o.cwrap("sqlite3_libversion_number",...M(":n"));return function(){return p()}})(),n.limit=(function(){const p=o.cwrap("sqlite3_limit",...M("nnn:n"));return function(m,b,k){return p(m,b,k)}})(),n.open_v2=(function(){const v="sqlite3_open_v2",p=o.cwrap(v,...M("snnn:n"),{async:Re});return async function(m,b,k){b=b||We|ft,k=y(k);try{const j=await x(()=>p(m,l[0],b,k)),R=o.getValue(l[0],"*");return q.add(R),o.ccall("RegisterExtensionFunctions","void",["number"],[R]),H(v,j),R}finally{o._sqlite3_free(k)}}})(),n.progress_handler=function(v,p,m,b){T(v),o.progress_handler(v,p,m,b)},n.reset=(function(){const v="sqlite3_reset",p=o.cwrap(v,...M("n:n"),{async:Re});return async function(m){O(m);const b=await p(m);return H(v,b,F.get(m))}})(),n.result=function(v,p){switch(typeof p){case"number":p===(p|0)?n.result_int(v,p):n.result_double(v,p);break;case"string":n.result_text(v,p);break;default:if(p instanceof Uint8Array||Array.isArray(p))n.result_blob(v,p);else if(p===null)n.result_null(v);else{if(typeof p=="bigint")return n.result_int64(v,p);console.warn("unknown result converted to null",p),n.result_null(v)}break}},n.result_blob=(function(){const p=o.cwrap("sqlite3_result_blob",...M("nnnn:n"));return function(m,b){const k=b.byteLength??b.length,j=o._sqlite3_malloc(k);o.HEAPU8.subarray(j).set(b),p(m,j,k,t)}})(),n.result_double=(function(){const p=o.cwrap("sqlite3_result_double",...M("nn:n"));return function(m,b){p(m,b)}})(),n.result_int=(function(){const p=o.cwrap("sqlite3_result_int",...M("nn:n"));return function(m,b){p(m,b)}})(),n.result_int64=(function(){const p=o.cwrap("sqlite3_result_int64",...M("nnn:n"));return function(m,b){if(b>lr||b<cr)return nt;const k=b&0xffffffffn,j=b>>32n;p(m,Number(k),Number(j))}})(),n.result_null=(function(){const p=o.cwrap("sqlite3_result_null",...M("n:n"));return function(m){p(m)}})(),n.result_text=(function(){const p=o.cwrap("sqlite3_result_text",...M("nnnn:n"));return function(m,b){const k=y(b);p(m,k,-1,t)}})(),n.row=function(v){const p=[],m=n.data_count(v);for(let b=0;b<m;++b){const k=n.column(v,b);p.push(k?.buffer===o.HEAPU8.buffer?k.slice():k)}return p},n.set_authorizer=function(v,p,m){T(v);function b(R,Q,X,Z,A,W){return[R,Q,o.UTF8ToString(X),o.UTF8ToString(Z),o.UTF8ToString(A),o.UTF8ToString(W)]}function k(R){return R instanceof st?(async(Q,X,Z,A,W,ie)=>R(...b(Q,X,Z,A,W,ie))):((Q,X,Z,A,W,ie)=>R(...b(Q,X,Z,A,W,ie)))}const j=o.set_authorizer(v,k(p),m);return H("sqlite3_set_authorizer",j,v)},n.sql=(function(){const p=o.cwrap("sqlite3_sql",...M("n:s"));return function(m){return O(m),p(m)}})(),n.statements=function(v,p,m={}){const b=o.cwrap("sqlite3_prepare_v3","number",["number","number","number","number","number","number"],{async:!0});return(async function*(){const k=[];try{let R=function(){re&&!m.unscoped&&n.finalize(re),re=0};var j=R;const Q=h.encode(p),X=Q.byteLength-Q.byteLength%4+12,Z=o._sqlite3_malloc(X),A=Z+Q.byteLength+1;k.push(()=>o._sqlite3_free(Z)),o.HEAPU8.set(Q,Z),o.HEAPU8[A-1]=0;const W=Z+X-8,ie=Z+X-4;let re;k.push(R),o.setValue(ie,Z,"*");do{R();const Oe=o.getValue(ie,"*"),je=await x(()=>b(v,Oe,A-ie,m.flags||0,W,ie));je!==P&&H("sqlite3_prepare_v3",je,v),re=o.getValue(W,"*"),re&&(F.set(re,v),yield re)}while(re)}finally{for(;k.length;)k.pop()()}})()},n.step=(function(){const v="sqlite3_step",p=o.cwrap(v,...M("n:n"),{async:Re});return async function(m){O(m);const b=await x(()=>p(m));return H(v,b,F.get(m),[ot,Hi])}})(),n.commit_hook=function(v,p){T(v),o.commit_hook(v,p)},n.update_hook=function(v,p){T(v);function m(k,j,R,Q,X){return[k,o.UTF8ToString(j),o.UTF8ToString(R),w(Q,X)]}function b(k){return k instanceof st?(async(j,R,Q,X,Z)=>k(...m(j,R,Q,X,Z))):((j,R,Q,X,Z)=>k(...m(j,R,Q,X,Z)))}o.update_hook(v,b(p))},n.value=function(v){const p=n.value_type(v);switch(p){case ar:return n.value_blob(v);case ir:return n.value_double(v);case nr:const m=n.value_int(v),b=o.getTempRet0();return S(m,b);case or:return null;case sr:return n.value_text(v);default:throw new Pe("unknown type",p)}},n.value_blob=(function(){const p=o.cwrap("sqlite3_value_blob",...M("n:n"));return function(m){const b=n.value_bytes(m),k=p(m);return o.HEAPU8.subarray(k,k+b)}})(),n.value_bytes=(function(){const p=o.cwrap("sqlite3_value_bytes",...M("n:n"));return function(m){return p(m)}})(),n.value_double=(function(){const p=o.cwrap("sqlite3_value_double",...M("n:n"));return function(m){return p(m)}})(),n.value_int=(function(){const p=o.cwrap("sqlite3_value_int64",...M("n:n"));return function(m){return p(m)}})(),n.value_int64=(function(){const p=o.cwrap("sqlite3_value_int64",...M("n:n"));return function(m){const b=p(m),k=o.getTempRet0();return w(b,k)}})(),n.value_text=(function(){const p=o.cwrap("sqlite3_value_text",...M("n:s"));return function(m){return p(m)}})(),n.value_type=(function(){const p=o.cwrap("sqlite3_value_type",...M("n:n"));return function(m){return p(m)}})(),n.vfs_register=function(v,p){const m=o.vfs_register(v,p);return H("sqlite3_vfs_register",m)};function H(v,p,m=null,b=[P]){if(b.includes(p))return p;const k=m?o.ccall("sqlite3_errmsg","string",["number"],[m]):v;throw new Pe(k,p)}async function x(v){let p;do o.retryOps.length&&(await Promise.all(o.retryOps),o.retryOps=[]),p=await v();while(p&&o.retryOps.length);return p}return n}function M(o){const n=[],t=o.match(/([ns@]*):([nsv@])/);switch(t[2]){case"n":n.push("number");break;case"s":n.push("string");break;case"v":n.push(null);break}const u=[];for(let l of t[1])switch(l){case"n":u.push("number");break;case"s":u.push("string");break}return n.push(u),n}async function ce(o){if(await o!==P)throw new Error(`Error code: ${await o}`)}function lt(){return new DataView(new ArrayBuffer(4))}async function br(o,n,t){let u;return o.releaser instanceof FileSystemDirectoryHandle?[u]=await o.getPathComponents(n,t):u=await navigator.storage.getDirectory(),await u.getFileHandle(n,{create:t})}function Er(o){return"releaser"in o}function _s(o,n,t){const u=[];let l,h;new Promise((q,T)=>{l=q,h=T}).finally(async()=>{for(;u.length;)await u.pop()()});const y=Math.floor(Math.random()*4294967296);let w=0,S=0;return new ReadableStream({async start(q){try{const T=ye|gr;await ce(o.jOpen(n,y,T,lt())),u.push(()=>o.jClose(y)),await ce(o.jLock(y,qe)),u.push(()=>o.jUnlock(y,ve));const F=new DataView(new ArrayBuffer(8));await ce(o.jFileSize(y,F)),S=Number(F.getBigUint64(0,!0))}catch(T){q.error(T),h(T)}},async pull(q){if(S===0){q.close(),l();return}try{const T=Math.min(S,65536),F=new Uint8Array(T);await ce(o.jRead(y,F,w)),q.enqueue(F),w+=T,S-=T,S===0&&(q.close(),l())}catch(T){q.error(T),h(T)}},cancel(q){h(new Error(q))}})}async function ps(o,n){const t=_s(o,n),u=[],l=t.getReader();let h=0;try{for(;;){const{done:S,value:q}=await l.read();if(S)break;u.push(q),h+=q.length}}finally{l.releaseLock()}const y=new Uint8Array(h);let w=0;for(const S of u)y.set(S,w),w+=S.length;return y}async function ms(o,n){return await br(o,n).then(t=>t.getFile()).then(t=>t.arrayBuffer()).then(t=>new Uint8Array(t))}async function gs(o,n){return Er(o)?await ms(o,n):await ps(o,n)}var ur=new Uint8Array([83,81,76,105,116,101,32,102,111,114,109,97,116,32,51,0]);async function Sr(o){const n=await ct(o,32);for(let t=0;t<ur.length;t++)if(n[t]!==ur[t])throw new Error("Not a SQLite database file");return n}async function ct(o,n){const t=new Uint8Array(n);let u=0;if(o.leftover){const l=Math.min(n,o.leftover.length);t.set(o.leftover.subarray(0,l),0),u+=l,l<o.leftover.length?o.leftover=o.leftover.subarray(l):o.leftover=null}for(;u<n;){const{done:l,value:h}=await o.read();if(l){if(u<n)throw new Error(`Unexpected EOF: Expected ${n}, got ${u}`);break}const y=Math.min(n-u,h.length);t.set(h.subarray(0,y),u),u+=y,y<h.length&&(o.leftover=h.subarray(y))}return t}async function*ys(o){const n=o.getReader();try{const t=await Sr(n),u=new DataView(t.buffer),l=u.getUint16(16),h=l===1?65536:l,y=u.getUint32(28),w=await ct(n,h-32),S=new Uint8Array(h);S.set(t),S.set(w,32),yield S;for(let T=1;T<y;T++)yield await ct(n,h);const{done:q}=await n.read();if(!q)throw new Error("Unexpected data after last page")}finally{n.releaseLock()}}async function vs(o,n,t){const u=[];try{const h=ye|We|ft;await ce(o.jOpen(n,1234,h,lt())),u.push(()=>o.jClose(1234)),await ce(o.jLock(1234,qe)),u.push(()=>o.jUnlock(1234,ve)),await ce(o.jLock(1234,Ve)),u.push(()=>o.jUnlock(1234,qe)),await ce(o.jLock(1234,ze));const y=lt();await o.jFileControl(1234,vr,y),await ce(o.jTruncate(1234,0));let w=0;for await(const S of ys(t))await ce(o.jWrite(1234,S,w)),w+=S.byteLength;await o.jFileControl(1234,wr,y),await o.jFileControl(1234,yr,y),await o.jSync(1234,as)}finally{for(;u.length;)await u.pop()()}}async function ws(o,n,t){const u=await br(o,n,!0),[l,h]=t.tee(),y=l.getReader();try{await Sr(y)}finally{y.releaseLock()}const w=await u.createWritable();await h.pipeTo(w)}async function kr(o,n,t){const u=t instanceof globalThis.File?t.stream():t;Er(o)?await ws(o,n,u):await vs(o,n,u)}function bs(o,n){return{...n,beforeOpen:(t,u)=>kr(t,u,o)}}async function Es(o){await o.sqlite.close(o.pointer)}function Ss(o){return o.sqliteModule._sqlite3_changes(o.pointer)}function ks(o){return o.sqliteModule._sqlite3_last_insert_rowid(o.pointer)}async function qr(o,n,t,u){const{sqlite:l,pointer:h}=o;for await(const y of l.statements(h,t)){u&&l.bind_collection(y,u);const w=l.column_names(y);for(;await l.step(y)===ot;){const S=l.row(y);n(Object.fromEntries(w.map((q,T)=>[q,S[T]])))}}}async function qs(o,n,t){const u=[];return await qr(o,l=>u.push(l),n,t),u}function Ts(o){return o?gr:ft|We}async function dr(o){const n=await As(o);return{...n,changes:()=>Ss(n),close:()=>Es(n),dump:()=>gs(n.vfs,n.path),lastInsertRowId:()=>ks(n),run:(...t)=>qs(n,...t),stream:(...t)=>qr(n,...t),sync:t=>kr(n.vfs,n.path,t)}}async function As(o){const{path:n,sqliteModule:t,vfsFn:u,vfsOptions:l,readonly:h,beforeOpen:y}=await o,w=hs(t),S=await u(n,t,l);w.vfs_register(S,!0),await y?.(S,n);const q=await w.open_v2(n,Ts(h));return{db:q,path:n,pointer:q,sqlite:w,sqliteModule:t,vfs:S}}var He={mode:"shared"},Is={ifAvailable:!0,mode:"shared"},fr={ifAvailable:!0,mode:"exclusive"},Ls=["exclusive","shared","shared+hint"],Ke=o=>class extends o{#r={lockPolicy:"exclusive",lockTimeout:1/0};#t=new Map;constructor(n,t,u){if(super(n,t,u),Object.assign(this.#r,u),Ls.indexOf(this.#r.lockPolicy)===-1)throw new Error(`WebLocksMixin: invalid lock mode: ${u.lockPolicy}`)}async jLock(n,t){try{const u=this.#e(n);if(t<=u.type)return P;switch(this.#r.lockPolicy){case"exclusive":return await this.#n(u,t);case"shared":case"shared+hint":return await this.#o(u,t)}}catch(u){return console.error("WebLocksMixin: lock error",u),Gi}}async jUnlock(n,t){try{const u=this.#e(n);if(!(t<u.type))return P;switch(this.#r.lockPolicy){case"exclusive":return await this.#s(u,t);case"shared":case"shared+hint":return await this.#l(u,t)}}catch(u){return console.error("WebLocksMixin: unlock error",u),Ji}}async jCheckReservedLock(n,t){try{const u=this.#e(n);switch(this.#r.lockPolicy){case"exclusive":return this.#a(u,t);case"shared":case"shared+hint":return await this.#c(u,t)}}catch(u){return console.error("WebLocksMixin: check reserved lock error",u),zi}return t.setInt32(0,0,!0),P}jFileControl(n,t,u){if(t===Ke.WRITE_HINT_OP_CODE&&this.#r.lockPolicy==="shared+hint"){const l=this.#e(n);l.writeHint=!0}return ut}#e(n){let t=this.#t.get(n);return t||(t={baseName:this.getFilename(n),type:ve,writeHint:!1},this.#t.set(n,t)),t}async#n(n,t){if(!n.access){if(!await this.#i(n,"access"))return fe;console.assert(!!n.access)}return n.type=t,P}#s(n,t){return t===ve&&(n.access?.(),console.assert(!n.access)),n.type=t,P}#a(n,t){return t.setInt32(0,0,!0),P}async#o(n,t){switch(n.type){case ve:switch(t){case qe:if(n.writeHint&&!await this.#i(n,"hint"))return fe;if(!await this.#i(n,"gate",He))return n.hint?.(),fe;await this.#i(n,"access",He),n.gate(),console.assert(!n.gate),console.assert(!!n.access),console.assert(!n.reserved);break;default:throw new Error("unsupported lock transition")}break;case qe:switch(t){case Ve:if(this.#r.lockPolicy==="shared+hint"&&!n.hint&&!await this.#i(n,"hint",fr))return fe;if(!await this.#i(n,"reserved",fr))return n.hint?.(),fe;n.access(),console.assert(!n.gate),console.assert(!n.access),console.assert(!!n.reserved);break;case ze:if(!await this.#i(n,"gate"))return fe;if(n.access(),!await this.#i(n,"access"))return n.gate(),fe;console.assert(!!n.gate),console.assert(!!n.access),console.assert(!n.reserved);break;default:throw new Error("unsupported lock transition")}break;case Ve:switch(t){case ze:if(!await this.#i(n,"gate"))return fe;if(!await this.#i(n,"access"))return n.gate(),fe;console.assert(!!n.gate),console.assert(!!n.access),console.assert(!!n.reserved);break;default:throw new Error("unsupported lock transition")}break}return n.type=t,P}async#l(n,t){if(t===ve)n.access?.(),n.gate?.(),n.reserved?.(),n.hint?.(),n.writeHint=!1,console.assert(!n.access),console.assert(!n.gate),console.assert(!n.reserved),console.assert(!n.hint);else switch(n.type){case ze:n.access(),await this.#i(n,"access",He),n.gate(),n.reserved?.(),n.hint?.(),console.assert(!!n.access),console.assert(!n.gate),console.assert(!n.reserved);break;case Ve:await this.#i(n,"access",He),n.reserved(),n.hint?.(),console.assert(!!n.access),console.assert(!n.gate),console.assert(!n.reserved);break}return n.type=t,P}async#c(n,t){return await this.#i(n,"reserved",Is)?(n.reserved(),t.setInt32(0,0,!0)):t.setInt32(0,1,!0),P}#i(n,t,u={}){return console.assert(!n[t]),new Promise(l=>{if(!u.ifAvailable&&this.#r.lockTimeout<1/0){const y=new AbortController;u=Object.assign({},u,{signal:y.signal}),setTimeout(()=>{y.abort(),l?.(!1)},this.#r.lockTimeout)}const h=`lock##${n.baseName}##${t}`;navigator.locks.request(h,u,y=>{if(y)return new Promise(w=>{n[t]=()=>{w(),n[t]=null},l(!0),l=null});n[t]=null,l(!1),l=null}).catch(y=>{if(y.name!=="AbortError")throw y})})}};Ke.WRITE_HINT_OP_CODE=-9999;var Cs=(async function(o={}){var n,t=o,u,l,h=new Promise((e,r)=>{u=e,l=r}),y=typeof window=="object",w=typeof WorkerGlobalScope<"u";typeof process=="object"&&process.versions?.node&&process.type!="renderer";var S="./this.program",q=(e,r)=>{throw r},T=import.meta.url,F="";function O(e){return t.locateFile?t.locateFile(e,F):F+e}var H,x;if(y||w){try{F=new URL(".",T).href}catch{}w&&(x=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),H=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)}}var v=console.log.bind(console),p=console.error.bind(console),m,b,k=!1,j,R,Q,X,Z,A,W,ie,re;function Oe(){var e=b.buffer;R=new Int8Array(e),X=new Int16Array(e),t.HEAPU8=Q=new Uint8Array(e),Z=new Uint16Array(e),t.HEAP32=A=new Int32Array(e),W=new Uint32Array(e),ie=new Float32Array(e),re=new Float64Array(e)}function je(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Br(t.preRun.shift());pt(gt)}function Ir(){!t.noFSInit&&!a.initialized&&a.init(),d.qa(),a.ignorePermissions=!1}function Lr(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)jr(t.postRun.shift());pt(mt)}var _e=0,Te=null;function ht(e){_e++,t.monitorRunDependencies?.(_e)}function $e(e){if(_e--,t.monitorRunDependencies?.(_e),_e==0&&Te){var r=Te;Te=null,r()}}function ue(e){t.onAbort?.(e),e="Aborted("+e+")",p(e),k=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw l(r),r}var Qe;function Cr(){return t.locateFile?O("wa-sqlite-async.wasm"):new URL("/gioibon/assets/wa-sqlite-async-CTFr_gWm.wasm",import.meta.url).href}function Fr(e){if(e==Qe&&m)return new Uint8Array(m);if(x)return x(e);throw"both async and sync fetching of the wasm failed"}async function Pr(e){if(!m)try{var r=await H(e);return new Uint8Array(r)}catch{}return Fr(e)}async function Rr(e,r){try{var i=await Pr(e),s=await WebAssembly.instantiate(i,r);return s}catch(c){p(`failed to asynchronously prepare wasm: ${c}`),ue(c)}}async function xr(e,r,i){if(!e&&typeof WebAssembly.instantiateStreaming=="function")try{var s=fetch(r,{credentials:"same-origin"}),c=await WebAssembly.instantiateStreaming(s,i);return c}catch(f){p(`wasm streaming compile failed: ${f}`),p("falling back to ArrayBuffer instantiation")}return Rr(r,i)}function Dr(){return{a:Si}}async function Or(){function e(f,_){return d=f.exports,d=L.instrumentWasmExports(d),b=d.pa,Oe(),Ee=d.jf,$e(),d}ht();function r(f){return e(f.instance)}var i=Dr();if(t.instantiateWasm)return new Promise((f,_)=>{t.instantiateWasm(i,(g,E)=>{f(e(g))})});Qe??=Cr();try{var s=await xr(m,Qe,i),c=r(s);return c}catch(f){return l(f),Promise.reject(f)}}var D,J;class _t{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var pt=e=>{for(;e.length>0;)e.shift()(t)},mt=[],jr=e=>mt.push(e),gt=[],Br=e=>gt.push(e);function yt(e,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":return R[e];case"i8":return R[e];case"i16":return X[e>>1];case"i32":return A[e>>2];case"i64":ue("to do getValue(i64) use WASM_BIGINT");case"float":return ie[e>>2];case"double":return re[e>>3];case"*":return W[e>>2];default:ue(`invalid type for getValue: ${r}`)}}var Ge=!0;function we(e,r,i="i8"){switch(i.endsWith("*")&&(i="*"),i){case"i1":R[e]=r;break;case"i8":R[e]=r;break;case"i16":X[e>>1]=r;break;case"i32":A[e>>2]=r;break;case"i64":ue("to do setValue(i64) use WASM_BIGINT");case"float":ie[e>>2]=r;break;case"double":re[e>>3]=r;break;case"*":W[e>>2]=r;break;default:ue(`invalid type for setValue: ${i}`)}}var Nr=e=>Ci(e),Mr=()=>Pi(),vt=new TextDecoder,pe=(e,r)=>{if(!e)return"";for(var i=e+r,s=e;!(s>=i)&&Q[s];)++s;return vt.decode(Q.subarray(e,s))},Ur=(e,r,i,s)=>ue(`Assertion failed: ${pe(e)}, at: `+[r?pe(r):"unknown filename",i,s?pe(s):"unknown function"]),G={isAbs:e=>e.charAt(0)==="/",splitPath:e=>{var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return r.exec(e).slice(1)},normalizeArray:(e,r)=>{for(var i=0,s=e.length-1;s>=0;s--){var c=e[s];c==="."?e.splice(s,1):c===".."?(e.splice(s,1),i++):i&&(e.splice(s,1),i--)}if(r)for(;i;i--)e.unshift("..");return e},normalize:e=>{var r=G.isAbs(e),i=e.slice(-1)==="/";return e=G.normalizeArray(e.split("/").filter(s=>!!s),!r).join("/"),!e&&!r&&(e="."),e&&i&&(e+="/"),(r?"/":"")+e},dirname:e=>{var r=G.splitPath(e),i=r[0],s=r[1];return!i&&!s?".":(s&&(s=s.slice(0,-1)),i+s)},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>G.normalize(e.join("/")),join2:(e,r)=>G.normalize(e+"/"+r)},Hr=()=>e=>crypto.getRandomValues(e),wt=e=>{(wt=Hr())(e)},be={resolve:(...e)=>{for(var r="",i=!1,s=e.length-1;s>=-1&&!i;s--){var c=s>=0?e[s]:a.cwd();if(typeof c!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!c)return"";r=c+"/"+r,i=G.isAbs(c)}return r=G.normalizeArray(r.split("/").filter(f=>!!f),!i).join("/"),(i?"/":"")+r||"."},relative:(e,r)=>{e=be.resolve(e).slice(1),r=be.resolve(r).slice(1);function i(I){for(var B=0;B<I.length&&I[B]==="";B++);for(var K=I.length-1;K>=0&&I[K]==="";K--);return B>K?[]:I.slice(B,K-B+1)}for(var s=i(e.split("/")),c=i(r.split("/")),f=Math.min(s.length,c.length),_=f,g=0;g<f;g++)if(s[g]!==c[g]){_=g;break}for(var E=[],g=_;g<s.length;g++)E.push("..");return E=E.concat(c.slice(_)),E.join("/")}},Ae=(e,r=0,i=NaN)=>{for(var s=r+i,c=r;e[c]&&!(c>=s);)++c;return vt.decode(e.buffer?e.subarray(r,c):new Uint8Array(e.slice(r,c)))},Ye=[],me=e=>{for(var r=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s<=127?r++:s<=2047?r+=2:s>=55296&&s<=57343?(r+=4,++i):r+=3}return r},Xe=(e,r,i,s)=>{if(!(s>0))return 0;for(var c=i,f=i+s-1,_=0;_<e.length;++_){var g=e.charCodeAt(_);if(g>=55296&&g<=57343){var E=e.charCodeAt(++_);g=65536+((g&1023)<<10)|E&1023}if(g<=127){if(i>=f)break;r[i++]=g}else if(g<=2047){if(i+1>=f)break;r[i++]=192|g>>6,r[i++]=128|g&63}else if(g<=65535){if(i+2>=f)break;r[i++]=224|g>>12,r[i++]=128|g>>6&63,r[i++]=128|g&63}else{if(i+3>=f)break;r[i++]=240|g>>18,r[i++]=128|g>>12&63,r[i++]=128|g>>6&63,r[i++]=128|g&63}}return r[i]=0,i-c},Je=(e,r,i)=>{var s=i>0?i:me(e)+1,c=new Array(s),f=Xe(e,c,0,c.length);return r&&(c.length=f),c},Vr=()=>{if(!Ye.length){var e=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(e=window.prompt("Input: "),e!==null&&(e+=`
`)),!e)return null;Ye=Je(e,!0)}return Ye.shift()},ge={ttys:[],init(){},shutdown(){},register(e,r){ge.ttys[e]={input:[],output:[],ops:r},a.registerDevice(e,ge.stream_ops)},stream_ops:{open(e){var r=ge.ttys[e.node.rdev];if(!r)throw new a.ErrnoError(43);e.tty=r,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,r,i,s,c){if(!e.tty||!e.tty.ops.get_char)throw new a.ErrnoError(60);for(var f=0,_=0;_<s;_++){var g;try{g=e.tty.ops.get_char(e.tty)}catch{throw new a.ErrnoError(29)}if(g===void 0&&f===0)throw new a.ErrnoError(6);if(g==null)break;f++,r[i+_]=g}return f&&(e.node.atime=Date.now()),f},write(e,r,i,s,c){if(!e.tty||!e.tty.ops.put_char)throw new a.ErrnoError(60);try{for(var f=0;f<s;f++)e.tty.ops.put_char(e.tty,r[i+f])}catch{throw new a.ErrnoError(29)}return s&&(e.node.mtime=e.node.ctime=Date.now()),f}},default_tty_ops:{get_char(e){return Vr()},put_char(e,r){r===null||r===10?(v(Ae(e.output)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output?.length>0&&(v(Ae(e.output)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,r,i){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,r){r===null||r===10?(p(Ae(e.output)),e.output=[]):r!=0&&e.output.push(r)},fsync(e){e.output?.length>0&&(p(Ae(e.output)),e.output=[])}}},zr=(e,r)=>Q.fill(0,e,e+r),bt=(e,r)=>Math.ceil(e/r)*r,Et=e=>{e=bt(e,65536);var r=Ai(65536,e);return r&&zr(r,e),r},N={ops_table:null,mount(e){return N.createNode(null,"/",16895,0)},createNode(e,r,i,s){if(a.isBlkdev(i)||a.isFIFO(i))throw new a.ErrnoError(63);N.ops_table||={dir:{node:{getattr:N.node_ops.getattr,setattr:N.node_ops.setattr,lookup:N.node_ops.lookup,mknod:N.node_ops.mknod,rename:N.node_ops.rename,unlink:N.node_ops.unlink,rmdir:N.node_ops.rmdir,readdir:N.node_ops.readdir,symlink:N.node_ops.symlink},stream:{llseek:N.stream_ops.llseek}},file:{node:{getattr:N.node_ops.getattr,setattr:N.node_ops.setattr},stream:{llseek:N.stream_ops.llseek,read:N.stream_ops.read,write:N.stream_ops.write,mmap:N.stream_ops.mmap,msync:N.stream_ops.msync}},link:{node:{getattr:N.node_ops.getattr,setattr:N.node_ops.setattr,readlink:N.node_ops.readlink},stream:{}},chrdev:{node:{getattr:N.node_ops.getattr,setattr:N.node_ops.setattr},stream:a.chrdev_stream_ops}};var c=a.createNode(e,r,i,s);return a.isDir(c.mode)?(c.node_ops=N.ops_table.dir.node,c.stream_ops=N.ops_table.dir.stream,c.contents={}):a.isFile(c.mode)?(c.node_ops=N.ops_table.file.node,c.stream_ops=N.ops_table.file.stream,c.usedBytes=0,c.contents=null):a.isLink(c.mode)?(c.node_ops=N.ops_table.link.node,c.stream_ops=N.ops_table.link.stream):a.isChrdev(c.mode)&&(c.node_ops=N.ops_table.chrdev.node,c.stream_ops=N.ops_table.chrdev.stream),c.atime=c.mtime=c.ctime=Date.now(),e&&(e.contents[r]=c,e.atime=e.mtime=e.ctime=c.atime),c},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,r){var i=e.contents?e.contents.length:0;if(!(i>=r)){var s=1024*1024;r=Math.max(r,i*(i<s?2:1.125)>>>0),i!=0&&(r=Math.max(r,256));var c=e.contents;e.contents=new Uint8Array(r),e.usedBytes>0&&e.contents.set(c.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,r){if(e.usedBytes!=r)if(r==0)e.contents=null,e.usedBytes=0;else{var i=e.contents;e.contents=new Uint8Array(r),i&&e.contents.set(i.subarray(0,Math.min(r,e.usedBytes))),e.usedBytes=r}},node_ops:{getattr(e){var r={};return r.dev=a.isChrdev(e.mode)?e.id:1,r.ino=e.id,r.mode=e.mode,r.nlink=1,r.uid=0,r.gid=0,r.rdev=e.rdev,a.isDir(e.mode)?r.size=4096:a.isFile(e.mode)?r.size=e.usedBytes:a.isLink(e.mode)?r.size=e.link.length:r.size=0,r.atime=new Date(e.atime),r.mtime=new Date(e.mtime),r.ctime=new Date(e.ctime),r.blksize=4096,r.blocks=Math.ceil(r.size/r.blksize),r},setattr(e,r){for(const i of["mode","atime","mtime","ctime"])r[i]!=null&&(e[i]=r[i]);r.size!==void 0&&N.resizeFileStorage(e,r.size)},lookup(e,r){throw N.doesNotExistError},mknod(e,r,i,s){return N.createNode(e,r,i,s)},rename(e,r,i){var s;try{s=a.lookupNode(r,i)}catch{}if(s){if(a.isDir(e.mode))for(var c in s.contents)throw new a.ErrnoError(55);a.hashRemoveNode(s)}delete e.parent.contents[e.name],r.contents[i]=e,e.name=i,r.ctime=r.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,r){delete e.contents[r],e.ctime=e.mtime=Date.now()},rmdir(e,r){var i=a.lookupNode(e,r);for(var s in i.contents)throw new a.ErrnoError(55);delete e.contents[r],e.ctime=e.mtime=Date.now()},readdir(e){return[".","..",...Object.keys(e.contents)]},symlink(e,r,i){var s=N.createNode(e,r,41471,0);return s.link=i,s},readlink(e){if(!a.isLink(e.mode))throw new a.ErrnoError(28);return e.link}},stream_ops:{read(e,r,i,s,c){var f=e.node.contents;if(c>=e.node.usedBytes)return 0;var _=Math.min(e.node.usedBytes-c,s);if(_>8&&f.subarray)r.set(f.subarray(c,c+_),i);else for(var g=0;g<_;g++)r[i+g]=f[c+g];return _},write(e,r,i,s,c,f){if(r.buffer===R.buffer&&(f=!1),!s)return 0;var _=e.node;if(_.mtime=_.ctime=Date.now(),r.subarray&&(!_.contents||_.contents.subarray)){if(f)return _.contents=r.subarray(i,i+s),_.usedBytes=s,s;if(_.usedBytes===0&&c===0)return _.contents=r.slice(i,i+s),_.usedBytes=s,s;if(c+s<=_.usedBytes)return _.contents.set(r.subarray(i,i+s),c),s}if(N.expandFileStorage(_,c+s),_.contents.subarray&&r.subarray)_.contents.set(r.subarray(i,i+s),c);else for(var g=0;g<s;g++)_.contents[c+g]=r[i+g];return _.usedBytes=Math.max(_.usedBytes,c+s),s},llseek(e,r,i){var s=r;if(i===1?s+=e.position:i===2&&a.isFile(e.node.mode)&&(s+=e.node.usedBytes),s<0)throw new a.ErrnoError(28);return s},mmap(e,r,i,s,c){if(!a.isFile(e.node.mode))throw new a.ErrnoError(43);var f,_,g=e.node.contents;if(!(c&2)&&g&&g.buffer===R.buffer)_=!1,f=g.byteOffset;else{if(_=!0,f=Et(r),!f)throw new a.ErrnoError(48);g&&((i>0||i+r<g.length)&&(g.subarray?g=g.subarray(i,i+r):g=Array.prototype.slice.call(g,i,i+r)),R.set(g,f))}return{ptr:f,allocated:_}},msync(e,r,i,s,c){return N.stream_ops.write(e,r,0,s,i,!1),0}}},St=async e=>{var r=await H(e);return new Uint8Array(r)};St.isAsync=!0;var Kr=(...e)=>a.createDataFile(...e),kt=[],Wr=(e,r,i,s)=>{typeof Browser<"u"&&Browser.init();var c=!1;return kt.forEach(f=>{c||f.canHandle(r)&&(f.handle(e,r,i,s),c=!0)}),c},$r=(e,r,i,s,c,f,_,g,E,I)=>{var B=r?be.resolve(G.join2(e,r)):e;function K(V){function C(U){I?.(),g||Kr(e,r,U,s,c,E),f?.(),$e()}Wr(V,B,C,()=>{_?.(),$e()})||C(V)}ht(),typeof i=="string"?St(i).then(K,_):K(i)},Qr=e=>{var r={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},i=r[e];if(typeof i>"u")throw new Error(`Unknown file open mode: ${e}`);return i},Ze=(e,r)=>{var i=0;return e&&(i|=365),r&&(i|=146),i},a={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{name="ErrnoError";constructor(e){this.errno=e}},FSStream:class{shared={};get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(e,r,i,s){e||(e=this),this.parent=e,this.mount=e.mount,this.id=a.nextInode++,this.name=r,this.mode=i,this.rdev=s,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return a.isDir(this.mode)}get isDevice(){return a.isChrdev(this.mode)}},lookupPath(e,r={}){if(!e)throw new a.ErrnoError(44);r.follow_mount??=!0,G.isAbs(e)||(e=a.cwd()+"/"+e);e:for(var i=0;i<40;i++){for(var s=e.split("/").filter(I=>!!I),c=a.root,f="/",_=0;_<s.length;_++){var g=_===s.length-1;if(g&&r.parent)break;if(s[_]!=="."){if(s[_]===".."){if(f=G.dirname(f),a.isRoot(c)){e=f+"/"+s.slice(_+1).join("/");continue e}else c=c.parent;continue}f=G.join2(f,s[_]);try{c=a.lookupNode(c,s[_])}catch(I){if(I?.errno===44&&g&&r.noent_okay)return{path:f};throw I}if(a.isMountpoint(c)&&(!g||r.follow_mount)&&(c=c.mounted.root),a.isLink(c.mode)&&(!g||r.follow)){if(!c.node_ops.readlink)throw new a.ErrnoError(52);var E=c.node_ops.readlink(c);G.isAbs(E)||(E=G.dirname(f)+"/"+E),e=E+"/"+s.slice(_+1).join("/");continue e}}}return{path:f,node:c}}throw new a.ErrnoError(32)},getPath(e){for(var r;;){if(a.isRoot(e)){var i=e.mount.mountpoint;return r?i[i.length-1]!=="/"?`${i}/${r}`:i+r:i}r=r?`${e.name}/${r}`:e.name,e=e.parent}},hashName(e,r){for(var i=0,s=0;s<r.length;s++)i=(i<<5)-i+r.charCodeAt(s)|0;return(e+i>>>0)%a.nameTable.length},hashAddNode(e){var r=a.hashName(e.parent.id,e.name);e.name_next=a.nameTable[r],a.nameTable[r]=e},hashRemoveNode(e){var r=a.hashName(e.parent.id,e.name);if(a.nameTable[r]===e)a.nameTable[r]=e.name_next;else for(var i=a.nameTable[r];i;){if(i.name_next===e){i.name_next=e.name_next;break}i=i.name_next}},lookupNode(e,r){var i=a.mayLookup(e);if(i)throw new a.ErrnoError(i);for(var s=a.hashName(e.id,r),c=a.nameTable[s];c;c=c.name_next){var f=c.name;if(c.parent.id===e.id&&f===r)return c}return a.lookup(e,r)},createNode(e,r,i,s){var c=new a.FSNode(e,r,i,s);return a.hashAddNode(c),c},destroyNode(e){a.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var r=["r","w","rw"][e&3];return e&512&&(r+="w"),r},nodePermissions(e,r){return a.ignorePermissions?0:r.includes("r")&&!(e.mode&292)||r.includes("w")&&!(e.mode&146)||r.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!a.isDir(e.mode))return 54;var r=a.nodePermissions(e,"x");return r||(e.node_ops.lookup?0:2)},mayCreate(e,r){if(!a.isDir(e.mode))return 54;try{var i=a.lookupNode(e,r);return 20}catch{}return a.nodePermissions(e,"wx")},mayDelete(e,r,i){var s;try{s=a.lookupNode(e,r)}catch(f){return f.errno}var c=a.nodePermissions(e,"wx");if(c)return c;if(i){if(!a.isDir(s.mode))return 54;if(a.isRoot(s)||a.getPath(s)===a.cwd())return 10}else if(a.isDir(s.mode))return 31;return 0},mayOpen(e,r){return e?a.isLink(e.mode)?32:a.isDir(e.mode)&&(a.flagsToPermissionString(r)!=="r"||r&576)?31:a.nodePermissions(e,a.flagsToPermissionString(r)):44},checkOpExists(e,r){if(!e)throw new a.ErrnoError(r);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=a.MAX_OPEN_FDS;e++)if(!a.streams[e])return e;throw new a.ErrnoError(33)},getStreamChecked(e){var r=a.getStream(e);if(!r)throw new a.ErrnoError(8);return r},getStream:e=>a.streams[e],createStream(e,r=-1){return e=Object.assign(new a.FSStream,e),r==-1&&(r=a.nextfd()),e.fd=r,a.streams[r]=e,e},closeStream(e){a.streams[e]=null},dupStream(e,r=-1){var i=a.createStream(e,r);return i.stream_ops?.dup?.(i),i},doSetAttr(e,r,i){var s=e?.stream_ops.setattr,c=s?e:r;s??=r.node_ops.setattr,a.checkOpExists(s,63),s(c,i)},chrdev_stream_ops:{open(e){var r=a.getDevice(e.node.rdev);e.stream_ops=r.stream_ops,e.stream_ops.open?.(e)},llseek(){throw new a.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,r)=>e<<8|r,registerDevice(e,r){a.devices[e]={stream_ops:r}},getDevice:e=>a.devices[e],getMounts(e){for(var r=[],i=[e];i.length;){var s=i.pop();r.push(s),i.push(...s.mounts)}return r},syncfs(e,r){typeof e=="function"&&(r=e,e=!1),a.syncFSRequests++,a.syncFSRequests>1&&p(`warning: ${a.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var i=a.getMounts(a.root.mount),s=0;function c(_){return a.syncFSRequests--,r(_)}function f(_){if(_)return f.errored?void 0:(f.errored=!0,c(_));++s>=i.length&&c(null)}i.forEach(_=>{if(!_.type.syncfs)return f(null);_.type.syncfs(_,e,f)})},mount(e,r,i){var s=i==="/",c=!i,f;if(s&&a.root)throw new a.ErrnoError(10);if(!s&&!c){var _=a.lookupPath(i,{follow_mount:!1});if(i=_.path,f=_.node,a.isMountpoint(f))throw new a.ErrnoError(10);if(!a.isDir(f.mode))throw new a.ErrnoError(54)}var g={type:e,opts:r,mountpoint:i,mounts:[]},E=e.mount(g);return E.mount=g,g.root=E,s?a.root=E:f&&(f.mounted=g,f.mount&&f.mount.mounts.push(g)),E},unmount(e){var r=a.lookupPath(e,{follow_mount:!1});if(!a.isMountpoint(r.node))throw new a.ErrnoError(28);var i=r.node,s=i.mounted,c=a.getMounts(s);Object.keys(a.nameTable).forEach(_=>{for(var g=a.nameTable[_];g;){var E=g.name_next;c.includes(g.mount)&&a.destroyNode(g),g=E}}),i.mounted=null;var f=i.mount.mounts.indexOf(s);i.mount.mounts.splice(f,1)},lookup(e,r){return e.node_ops.lookup(e,r)},mknod(e,r,i){var s=a.lookupPath(e,{parent:!0}),c=s.node,f=G.basename(e);if(!f)throw new a.ErrnoError(28);if(f==="."||f==="..")throw new a.ErrnoError(20);var _=a.mayCreate(c,f);if(_)throw new a.ErrnoError(_);if(!c.node_ops.mknod)throw new a.ErrnoError(63);return c.node_ops.mknod(c,f,r,i)},statfs(e){return a.statfsNode(a.lookupPath(e,{follow:!0}).node)},statfsStream(e){return a.statfsNode(e.node)},statfsNode(e){var r={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:a.nextInode,ffree:a.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(r,e.node_ops.statfs(e.mount.opts.root)),r},create(e,r=438){return r&=4095,r|=32768,a.mknod(e,r,0)},mkdir(e,r=511){return r&=1023,r|=16384,a.mknod(e,r,0)},mkdirTree(e,r){var i=e.split("/"),s="";for(var c of i)if(c){(s||G.isAbs(e))&&(s+="/"),s+=c;try{a.mkdir(s,r)}catch(f){if(f.errno!=20)throw f}}},mkdev(e,r,i){return typeof i>"u"&&(i=r,r=438),r|=8192,a.mknod(e,r,i)},symlink(e,r){if(!be.resolve(e))throw new a.ErrnoError(44);var i=a.lookupPath(r,{parent:!0}),s=i.node;if(!s)throw new a.ErrnoError(44);var c=G.basename(r),f=a.mayCreate(s,c);if(f)throw new a.ErrnoError(f);if(!s.node_ops.symlink)throw new a.ErrnoError(63);return s.node_ops.symlink(s,c,e)},rename(e,r){var i=G.dirname(e),s=G.dirname(r),c=G.basename(e),f=G.basename(r),_,g,E;if(_=a.lookupPath(e,{parent:!0}),g=_.node,_=a.lookupPath(r,{parent:!0}),E=_.node,!g||!E)throw new a.ErrnoError(44);if(g.mount!==E.mount)throw new a.ErrnoError(75);var I=a.lookupNode(g,c),B=be.relative(e,s);if(B.charAt(0)!==".")throw new a.ErrnoError(28);if(B=be.relative(r,i),B.charAt(0)!==".")throw new a.ErrnoError(55);var K;try{K=a.lookupNode(E,f)}catch{}if(I!==K){var V=a.isDir(I.mode),C=a.mayDelete(g,c,V);if(C)throw new a.ErrnoError(C);if(C=K?a.mayDelete(E,f,V):a.mayCreate(E,f),C)throw new a.ErrnoError(C);if(!g.node_ops.rename)throw new a.ErrnoError(63);if(a.isMountpoint(I)||K&&a.isMountpoint(K))throw new a.ErrnoError(10);if(E!==g&&(C=a.nodePermissions(g,"w"),C))throw new a.ErrnoError(C);a.hashRemoveNode(I);try{g.node_ops.rename(I,E,f),I.parent=E}catch(U){throw U}finally{a.hashAddNode(I)}}},rmdir(e){var r=a.lookupPath(e,{parent:!0}),i=r.node,s=G.basename(e),c=a.lookupNode(i,s),f=a.mayDelete(i,s,!0);if(f)throw new a.ErrnoError(f);if(!i.node_ops.rmdir)throw new a.ErrnoError(63);if(a.isMountpoint(c))throw new a.ErrnoError(10);i.node_ops.rmdir(i,s),a.destroyNode(c)},readdir(e){var r=a.lookupPath(e,{follow:!0}),i=r.node,s=a.checkOpExists(i.node_ops.readdir,54);return s(i)},unlink(e){var r=a.lookupPath(e,{parent:!0}),i=r.node;if(!i)throw new a.ErrnoError(44);var s=G.basename(e),c=a.lookupNode(i,s),f=a.mayDelete(i,s,!1);if(f)throw new a.ErrnoError(f);if(!i.node_ops.unlink)throw new a.ErrnoError(63);if(a.isMountpoint(c))throw new a.ErrnoError(10);i.node_ops.unlink(i,s),a.destroyNode(c)},readlink(e){var r=a.lookupPath(e),i=r.node;if(!i)throw new a.ErrnoError(44);if(!i.node_ops.readlink)throw new a.ErrnoError(28);return i.node_ops.readlink(i)},stat(e,r){var i=a.lookupPath(e,{follow:!r}),s=i.node,c=a.checkOpExists(s.node_ops.getattr,63);return c(s)},fstat(e){var r=a.getStreamChecked(e),i=r.node,s=r.stream_ops.getattr,c=s?r:i;return s??=i.node_ops.getattr,a.checkOpExists(s,63),s(c)},lstat(e){return a.stat(e,!0)},doChmod(e,r,i,s){a.doSetAttr(e,r,{mode:i&4095|r.mode&-4096,ctime:Date.now(),dontFollow:s})},chmod(e,r,i){var s;if(typeof e=="string"){var c=a.lookupPath(e,{follow:!i});s=c.node}else s=e;a.doChmod(null,s,r,i)},lchmod(e,r){a.chmod(e,r,!0)},fchmod(e,r){var i=a.getStreamChecked(e);a.doChmod(i,i.node,r,!1)},doChown(e,r,i){a.doSetAttr(e,r,{timestamp:Date.now(),dontFollow:i})},chown(e,r,i,s){var c;if(typeof e=="string"){var f=a.lookupPath(e,{follow:!s});c=f.node}else c=e;a.doChown(null,c,s)},lchown(e,r,i){a.chown(e,r,i,!0)},fchown(e,r,i){var s=a.getStreamChecked(e);a.doChown(s,s.node,!1)},doTruncate(e,r,i){if(a.isDir(r.mode))throw new a.ErrnoError(31);if(!a.isFile(r.mode))throw new a.ErrnoError(28);var s=a.nodePermissions(r,"w");if(s)throw new a.ErrnoError(s);a.doSetAttr(e,r,{size:i,timestamp:Date.now()})},truncate(e,r){if(r<0)throw new a.ErrnoError(28);var i;if(typeof e=="string"){var s=a.lookupPath(e,{follow:!0});i=s.node}else i=e;a.doTruncate(null,i,r)},ftruncate(e,r){var i=a.getStreamChecked(e);if(r<0||(i.flags&2097155)===0)throw new a.ErrnoError(28);a.doTruncate(i,i.node,r)},utime(e,r,i){var s=a.lookupPath(e,{follow:!0}),c=s.node,f=a.checkOpExists(c.node_ops.setattr,63);f(c,{atime:r,mtime:i})},open(e,r,i=438){if(e==="")throw new a.ErrnoError(44);r=typeof r=="string"?Qr(r):r,r&64?i=i&4095|32768:i=0;var s,c;if(typeof e=="object")s=e;else{c=e.endsWith("/");var f=a.lookupPath(e,{follow:!(r&131072),noent_okay:!0});s=f.node,e=f.path}var _=!1;if(r&64)if(s){if(r&128)throw new a.ErrnoError(20)}else{if(c)throw new a.ErrnoError(31);s=a.mknod(e,i|511,0),_=!0}if(!s)throw new a.ErrnoError(44);if(a.isChrdev(s.mode)&&(r&=-513),r&65536&&!a.isDir(s.mode))throw new a.ErrnoError(54);if(!_){var g=a.mayOpen(s,r);if(g)throw new a.ErrnoError(g)}r&512&&!_&&a.truncate(s,0),r&=-131713;var E=a.createStream({node:s,path:a.getPath(s),flags:r,seekable:!0,position:0,stream_ops:s.stream_ops,ungotten:[],error:!1});return E.stream_ops.open&&E.stream_ops.open(E),_&&a.chmod(s,i&511),t.logReadFiles&&!(r&1)&&(e in a.readFiles||(a.readFiles[e]=1)),E},close(e){if(a.isClosed(e))throw new a.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(r){throw r}finally{a.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,r,i){if(a.isClosed(e))throw new a.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new a.ErrnoError(70);if(i!=0&&i!=1&&i!=2)throw new a.ErrnoError(28);return e.position=e.stream_ops.llseek(e,r,i),e.ungotten=[],e.position},read(e,r,i,s,c){if(s<0||c<0)throw new a.ErrnoError(28);if(a.isClosed(e))throw new a.ErrnoError(8);if((e.flags&2097155)===1)throw new a.ErrnoError(8);if(a.isDir(e.node.mode))throw new a.ErrnoError(31);if(!e.stream_ops.read)throw new a.ErrnoError(28);var f=typeof c<"u";if(!f)c=e.position;else if(!e.seekable)throw new a.ErrnoError(70);var _=e.stream_ops.read(e,r,i,s,c);return f||(e.position+=_),_},write(e,r,i,s,c,f){if(s<0||c<0)throw new a.ErrnoError(28);if(a.isClosed(e))throw new a.ErrnoError(8);if((e.flags&2097155)===0)throw new a.ErrnoError(8);if(a.isDir(e.node.mode))throw new a.ErrnoError(31);if(!e.stream_ops.write)throw new a.ErrnoError(28);e.seekable&&e.flags&1024&&a.llseek(e,0,2);var _=typeof c<"u";if(!_)c=e.position;else if(!e.seekable)throw new a.ErrnoError(70);var g=e.stream_ops.write(e,r,i,s,c,f);return _||(e.position+=g),g},mmap(e,r,i,s,c){if((s&2)!==0&&(c&2)===0&&(e.flags&2097155)!==2)throw new a.ErrnoError(2);if((e.flags&2097155)===1)throw new a.ErrnoError(2);if(!e.stream_ops.mmap)throw new a.ErrnoError(43);if(!r)throw new a.ErrnoError(28);return e.stream_ops.mmap(e,r,i,s,c)},msync(e,r,i,s,c){return e.stream_ops.msync?e.stream_ops.msync(e,r,i,s,c):0},ioctl(e,r,i){if(!e.stream_ops.ioctl)throw new a.ErrnoError(59);return e.stream_ops.ioctl(e,r,i)},readFile(e,r={}){if(r.flags=r.flags||0,r.encoding=r.encoding||"binary",r.encoding!=="utf8"&&r.encoding!=="binary")throw new Error(`Invalid encoding type "${r.encoding}"`);var i,s=a.open(e,r.flags),c=a.stat(e),f=c.size,_=new Uint8Array(f);return a.read(s,_,0,f,0),r.encoding==="utf8"?i=Ae(_):r.encoding==="binary"&&(i=_),a.close(s),i},writeFile(e,r,i={}){i.flags=i.flags||577;var s=a.open(e,i.flags,i.mode);if(typeof r=="string"){var c=new Uint8Array(me(r)+1),f=Xe(r,c,0,c.length);a.write(s,c,0,f,void 0,i.canOwn)}else if(ArrayBuffer.isView(r))a.write(s,r,0,r.byteLength,void 0,i.canOwn);else throw new Error("Unsupported data type");a.close(s)},cwd:()=>a.currentPath,chdir(e){var r=a.lookupPath(e,{follow:!0});if(r.node===null)throw new a.ErrnoError(44);if(!a.isDir(r.node.mode))throw new a.ErrnoError(54);var i=a.nodePermissions(r.node,"x");if(i)throw new a.ErrnoError(i);a.currentPath=r.path},createDefaultDirectories(){a.mkdir("/tmp"),a.mkdir("/home"),a.mkdir("/home/web_user")},createDefaultDevices(){a.mkdir("/dev"),a.registerDevice(a.makedev(1,3),{read:()=>0,write:(s,c,f,_,g)=>_,llseek:()=>0}),a.mkdev("/dev/null",a.makedev(1,3)),ge.register(a.makedev(5,0),ge.default_tty_ops),ge.register(a.makedev(6,0),ge.default_tty1_ops),a.mkdev("/dev/tty",a.makedev(5,0)),a.mkdev("/dev/tty1",a.makedev(6,0));var e=new Uint8Array(1024),r=0,i=()=>(r===0&&(wt(e),r=e.byteLength),e[--r]);a.createDevice("/dev","random",i),a.createDevice("/dev","urandom",i),a.mkdir("/dev/shm"),a.mkdir("/dev/shm/tmp")},createSpecialDirectories(){a.mkdir("/proc");var e=a.mkdir("/proc/self");a.mkdir("/proc/self/fd"),a.mount({mount(){var r=a.createNode(e,"fd",16895,73);return r.stream_ops={llseek:N.stream_ops.llseek},r.node_ops={lookup(i,s){var c=+s,f=a.getStreamChecked(c),_={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>f.path},id:c+1};return _.parent=_,_},readdir(){return Array.from(a.streams.entries()).filter(([i,s])=>s).map(([i,s])=>i.toString())}},r}},{},"/proc/self/fd")},createStandardStreams(e,r,i){e?a.createDevice("/dev","stdin",e):a.symlink("/dev/tty","/dev/stdin"),r?a.createDevice("/dev","stdout",null,r):a.symlink("/dev/tty","/dev/stdout"),i?a.createDevice("/dev","stderr",null,i):a.symlink("/dev/tty1","/dev/stderr"),a.open("/dev/stdin",0),a.open("/dev/stdout",1),a.open("/dev/stderr",1)},staticInit(){a.nameTable=new Array(4096),a.mount(N,{},"/"),a.createDefaultDirectories(),a.createDefaultDevices(),a.createSpecialDirectories(),a.filesystems={MEMFS:N}},init(e,r,i){a.initialized=!0,e??=t.stdin,r??=t.stdout,i??=t.stderr,a.createStandardStreams(e,r,i)},quit(){a.initialized=!1;for(var e of a.streams)e&&a.close(e)},findObject(e,r){var i=a.analyzePath(e,r);return i.exists?i.object:null},analyzePath(e,r){try{var i=a.lookupPath(e,{follow:!r});e=i.path}catch{}var s={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var i=a.lookupPath(e,{parent:!0});s.parentExists=!0,s.parentPath=i.path,s.parentObject=i.node,s.name=G.basename(e),i=a.lookupPath(e,{follow:!r}),s.exists=!0,s.path=i.path,s.object=i.node,s.name=i.node.name,s.isRoot=i.path==="/"}catch(c){s.error=c.errno}return s},createPath(e,r,i,s){e=typeof e=="string"?e:a.getPath(e);for(var c=r.split("/").reverse();c.length;){var f=c.pop();if(f){var _=G.join2(e,f);try{a.mkdir(_)}catch(g){if(g.errno!=20)throw g}e=_}}return _},createFile(e,r,i,s,c){var f=G.join2(typeof e=="string"?e:a.getPath(e),r),_=Ze(s,c);return a.create(f,_)},createDataFile(e,r,i,s,c,f){var _=r;e&&(e=typeof e=="string"?e:a.getPath(e),_=r?G.join2(e,r):e);var g=Ze(s,c),E=a.create(_,g);if(i){if(typeof i=="string"){for(var I=new Array(i.length),B=0,K=i.length;B<K;++B)I[B]=i.charCodeAt(B);i=I}a.chmod(E,g|146);var V=a.open(E,577);a.write(V,i,0,i.length,0,f),a.close(V),a.chmod(E,g)}},createDevice(e,r,i,s){var c=G.join2(typeof e=="string"?e:a.getPath(e),r),f=Ze(!!i,!!s);a.createDevice.major??=64;var _=a.makedev(a.createDevice.major++,0);return a.registerDevice(_,{open(g){g.seekable=!1},close(g){s?.buffer?.length&&s(10)},read(g,E,I,B,K){for(var V=0,C=0;C<B;C++){var U;try{U=i()}catch{throw new a.ErrnoError(29)}if(U===void 0&&V===0)throw new a.ErrnoError(6);if(U==null)break;V++,E[I+C]=U}return V&&(g.node.atime=Date.now()),V},write(g,E,I,B,K){for(var V=0;V<B;V++)try{s(E[I+V])}catch{throw new a.ErrnoError(29)}return B&&(g.node.mtime=g.node.ctime=Date.now()),V}}),a.mkdev(c,f,_)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{e.contents=x(e.url),e.usedBytes=e.contents.length}catch{throw new a.ErrnoError(29)}},createLazyFile(e,r,i,s,c){class f{lengthKnown=!1;chunks=[];get(C){if(!(C>this.length-1||C<0)){var U=C%this.chunkSize,ee=C/this.chunkSize|0;return this.getter(ee)[U]}}setDataGetter(C){this.getter=C}cacheLength(){var C=new XMLHttpRequest;if(C.open("HEAD",i,!1),C.send(null),!(C.status>=200&&C.status<300||C.status===304))throw new Error("Couldn't load "+i+". Status: "+C.status);var U=Number(C.getResponseHeader("Content-length")),ee,Y=(ee=C.getResponseHeader("Accept-Ranges"))&&ee==="bytes",te=(ee=C.getResponseHeader("Content-Encoding"))&&ee==="gzip",se=1024*1024;Y||(se=U);var ae=(oe,ke)=>{if(oe>ke)throw new Error("invalid range ("+oe+", "+ke+") or no bytes requested!");if(ke>U-1)throw new Error("only "+U+" bytes available! programmer error!");var ne=new XMLHttpRequest;if(ne.open("GET",i,!1),U!==se&&ne.setRequestHeader("Range","bytes="+oe+"-"+ke),ne.responseType="arraybuffer",ne.overrideMimeType&&ne.overrideMimeType("text/plain; charset=x-user-defined"),ne.send(null),!(ne.status>=200&&ne.status<300||ne.status===304))throw new Error("Couldn't load "+i+". Status: "+ne.status);return ne.response!==void 0?new Uint8Array(ne.response||[]):Je(ne.responseText||"",!0)},Fe=this;Fe.setDataGetter(oe=>{var ke=oe*se,ne=(oe+1)*se-1;if(ne=Math.min(ne,U-1),typeof Fe.chunks[oe]>"u"&&(Fe.chunks[oe]=ae(ke,ne)),typeof Fe.chunks[oe]>"u")throw new Error("doXHR failed!");return Fe.chunks[oe]}),(te||!U)&&(se=U=1,U=this.getter(0).length,se=U,v("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=U,this._chunkSize=se,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!w)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var _=new f,g={isDevice:!1,contents:_}}else var g={isDevice:!1,url:i};var E=a.createFile(e,r,g,s,c);g.contents?E.contents=g.contents:g.url&&(E.contents=null,E.url=g.url),Object.defineProperties(E,{usedBytes:{get:function(){return this.contents.length}}});var I={},B=Object.keys(E.stream_ops);B.forEach(V=>{var C=E.stream_ops[V];I[V]=(...U)=>(a.forceLoadFile(E),C(...U))});function K(V,C,U,ee,Y){var te=V.node.contents;if(Y>=te.length)return 0;var se=Math.min(te.length-Y,ee);if(te.slice)for(var ae=0;ae<se;ae++)C[U+ae]=te[Y+ae];else for(var ae=0;ae<se;ae++)C[U+ae]=te.get(Y+ae);return se}return I.read=(V,C,U,ee,Y)=>(a.forceLoadFile(E),K(V,C,U,ee,Y)),I.mmap=(V,C,U,ee,Y)=>{a.forceLoadFile(E);var te=Et(C);if(!te)throw new a.ErrnoError(48);return K(V,R,te,C,U),{ptr:te,allocated:!0}},E.stream_ops=I,E}},z={DEFAULT_POLLMASK:5,calculateAt(e,r,i){if(G.isAbs(r))return r;var s;if(e===-100)s=a.cwd();else{var c=z.getStreamFromFD(e);s=c.path}if(r.length==0){if(!i)throw new a.ErrnoError(44);return s}return s+"/"+r},writeStat(e,r){A[e>>2]=r.dev,A[e+4>>2]=r.mode,W[e+8>>2]=r.nlink,A[e+12>>2]=r.uid,A[e+16>>2]=r.gid,A[e+20>>2]=r.rdev,J=[r.size>>>0,(D=r.size,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],A[e+24>>2]=J[0],A[e+28>>2]=J[1],A[e+32>>2]=4096,A[e+36>>2]=r.blocks;var i=r.atime.getTime(),s=r.mtime.getTime(),c=r.ctime.getTime();return J=[Math.floor(i/1e3)>>>0,(D=Math.floor(i/1e3),+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],A[e+40>>2]=J[0],A[e+44>>2]=J[1],W[e+48>>2]=i%1e3*1e3*1e3,J=[Math.floor(s/1e3)>>>0,(D=Math.floor(s/1e3),+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],A[e+56>>2]=J[0],A[e+60>>2]=J[1],W[e+64>>2]=s%1e3*1e3*1e3,J=[Math.floor(c/1e3)>>>0,(D=Math.floor(c/1e3),+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],A[e+72>>2]=J[0],A[e+76>>2]=J[1],W[e+80>>2]=c%1e3*1e3*1e3,J=[r.ino>>>0,(D=r.ino,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],A[e+88>>2]=J[0],A[e+92>>2]=J[1],0},writeStatFs(e,r){A[e+4>>2]=r.bsize,A[e+40>>2]=r.bsize,A[e+8>>2]=r.blocks,A[e+12>>2]=r.bfree,A[e+16>>2]=r.bavail,A[e+20>>2]=r.files,A[e+24>>2]=r.ffree,A[e+28>>2]=r.fsid,A[e+44>>2]=r.flags,A[e+36>>2]=r.namelen},doMsync(e,r,i,s,c){if(!a.isFile(r.node.mode))throw new a.ErrnoError(43);if(s&2)return 0;var f=Q.slice(e,e+i);a.msync(r,f,c,i,s)},getStreamFromFD(e){var r=a.getStreamChecked(e);return r},varargs:void 0,getStr(e){var r=pe(e);return r}};function Gr(e,r){try{return e=z.getStr(e),a.chmod(e,r),0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function Yr(e,r,i,s){try{if(r=z.getStr(r),r=z.calculateAt(e,r),i&-8)return-28;var c=a.lookupPath(r,{follow:!0}),f=c.node;if(!f)return-44;var _="";return i&4&&(_+="r"),i&2&&(_+="w"),i&1&&(_+="x"),_&&a.nodePermissions(f,_)?-2:0}catch(g){if(typeof a>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}function Xr(e,r){try{return a.fchmod(e,r),0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function Jr(e,r,i){try{return a.fchown(e,r,i),0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}var Be=()=>{var e=A[+z.varargs>>2];return z.varargs+=4,e},Zr=Be;function en(e,r,i){z.varargs=i;try{var s=z.getStreamFromFD(e);switch(r){case 0:{var c=Be();if(c<0)return-28;for(;a.streams[c];)c++;var f;return f=a.dupStream(s,c),f.fd}case 1:case 2:return 0;case 3:return s.flags;case 4:{var c=Be();return s.flags|=c,0}case 12:{var c=Zr(),_=0;return X[c+_>>1]=2,0}case 13:case 14:return 0}return-28}catch(g){if(typeof a>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}function tn(e,r){try{return z.writeStat(r,a.fstat(e))}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}var Ie=(e,r)=>r+2097152>>>0<4194305-!!e?(e>>>0)+r*4294967296:NaN;function rn(e,r,i){var s=Ie(r,i);try{return isNaN(s)?-61:(a.ftruncate(e,s),0)}catch(c){if(typeof a>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}var de=(e,r,i)=>Xe(e,Q,r,i);function nn(e,r){try{if(r===0)return-28;var i=a.cwd(),s=me(i)+1;return r<s?-68:(de(i,e,r),s)}catch(c){if(typeof a>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function sn(e,r){try{return e=z.getStr(e),z.writeStat(r,a.lstat(e))}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function an(e,r,i){try{return r=z.getStr(r),r=z.calculateAt(e,r),a.mkdir(r,i,0),0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function on(e,r,i,s){try{r=z.getStr(r);var c=s&256,f=s&4096;return s=s&-6401,r=z.calculateAt(e,r,f),z.writeStat(i,c?a.lstat(r):a.stat(r))}catch(_){if(typeof a>"u"||_.name!=="ErrnoError")throw _;return-_.errno}}function ln(e,r,i,s){z.varargs=s;try{r=z.getStr(r),r=z.calculateAt(e,r);var c=s?Be():0;return a.open(r,i,c).fd}catch(f){if(typeof a>"u"||f.name!=="ErrnoError")throw f;return-f.errno}}function cn(e,r,i,s){try{if(r=z.getStr(r),r=z.calculateAt(e,r),s<=0)return-28;var c=a.readlink(r),f=Math.min(s,me(c)),_=R[i+f];return de(c,i,s+1),R[i+f]=_,f}catch(g){if(typeof a>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}function un(e){try{return e=z.getStr(e),a.rmdir(e),0}catch(r){if(typeof a>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function dn(e,r){try{return e=z.getStr(e),z.writeStat(r,a.stat(e))}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function fn(e,r,i){try{if(r=z.getStr(r),r=z.calculateAt(e,r),!i)a.unlink(r);else if(i===512)a.rmdir(r);else return-28;return 0}catch(s){if(typeof a>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}var qt=e=>W[e>>2]+A[e+4>>2]*4294967296;function hn(e,r,i,s){try{r=z.getStr(r),r=z.calculateAt(e,r,!0);var c=Date.now(),f,_;if(!i)f=c,_=c;else{var g=qt(i),E=A[i+8>>2];E==1073741823?f=c:E==1073741822?f=null:f=g*1e3+E/(1e3*1e3),i+=16,g=qt(i),E=A[i+8>>2],E==1073741823?_=c:E==1073741822?_=null:_=g*1e3+E/(1e3*1e3)}return(_??f)!==null&&a.utime(r,f,_),0}catch(I){if(typeof a>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}var _n=()=>ue(""),Ne=0,pn=()=>{Ge=!1,Ne=0},mn=e=>e%4===0&&(e%100!==0||e%400===0),gn=[0,31,60,91,121,152,182,213,244,274,305,335],yn=[0,31,59,90,120,151,181,212,243,273,304,334],vn=e=>{var r=mn(e.getFullYear()),i=r?gn:yn,s=i[e.getMonth()]+e.getDate()-1;return s};function wn(e,r,i){var s=Ie(e,r),c=new Date(s*1e3);A[i>>2]=c.getSeconds(),A[i+4>>2]=c.getMinutes(),A[i+8>>2]=c.getHours(),A[i+12>>2]=c.getDate(),A[i+16>>2]=c.getMonth(),A[i+20>>2]=c.getFullYear()-1900,A[i+24>>2]=c.getDay();var f=vn(c)|0;A[i+28>>2]=f,A[i+36>>2]=-(c.getTimezoneOffset()*60);var _=new Date(c.getFullYear(),0,1),g=new Date(c.getFullYear(),6,1).getTimezoneOffset(),E=_.getTimezoneOffset(),I=(g!=E&&c.getTimezoneOffset()==Math.min(E,g))|0;A[i+32>>2]=I}function bn(e,r,i,s,c,f,_,g){var E=Ie(c,f);try{var I=z.getStreamFromFD(s),B=a.mmap(I,e,E,r,i),K=B.ptr;return A[_>>2]=B.allocated,W[g>>2]=K,0}catch(V){if(typeof a>"u"||V.name!=="ErrnoError")throw V;return-V.errno}}function En(e,r,i,s,c,f,_){var g=Ie(f,_);try{var E=z.getStreamFromFD(c);i&2&&z.doMsync(e,E,r,s,g)}catch(I){if(typeof a>"u"||I.name!=="ErrnoError")throw I;return-I.errno}}var Le={},et=e=>{if(e instanceof _t||e=="unwind")return j;q(1,e)},Tt=()=>Ge||Ne>0,At=e=>{j=e,Tt()||(t.onExit?.(e),k=!0),q(e,new _t(e))},It=(e,r)=>{j=e,At(e)},Sn=It,kn=()=>{if(!Tt())try{Sn(j)}catch(e){et(e)}},Lt=e=>{if(!k)try{e(),kn()}catch(r){et(r)}},Ct=()=>performance.now(),qn=(e,r)=>{if(Le[e]&&(clearTimeout(Le[e].id),delete Le[e]),!r)return 0;var i=setTimeout(()=>{delete Le[e],Lt(()=>Ii(e,Ct()))},r);return Le[e]={id:i,timeout_ms:r},0},Tn=(e,r,i,s)=>{var c=new Date().getFullYear(),f=new Date(c,0,1),_=new Date(c,6,1),g=f.getTimezoneOffset(),E=_.getTimezoneOffset(),I=Math.max(g,E);W[e>>2]=I*60,A[r>>2]=+(g!=E);var B=C=>{var U=C>=0?"-":"+",ee=Math.abs(C),Y=String(Math.floor(ee/60)).padStart(2,"0"),te=String(ee%60).padStart(2,"0");return`UTC${U}${Y}${te}`},K=B(g),V=B(E);E<g?(de(K,i,17),de(V,s,17)):(de(K,s,17),de(V,i,17))},An=()=>Date.now(),In=()=>2147483648,Ln=e=>{var r=b.buffer,i=(e-r.byteLength+65535)/65536|0;try{return b.grow(i),Oe(),1}catch{}},Cn=e=>{var r=Q.length;e>>>=0;var i=In();if(e>i)return!1;for(var s=1;s<=4;s*=2){var c=r*(1+.2/s);c=Math.min(c,e+100663296);var f=Math.min(i,bt(Math.max(e,c),65536)),_=Ln(f);if(_)return!0}return!1},tt={},Fn=()=>S||"./this.program",Ce=()=>{if(!Ce.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:Fn()};for(var i in tt)tt[i]===void 0?delete r[i]:r[i]=tt[i];var s=[];for(var i in r)s.push(`${i}=${r[i]}`);Ce.strings=s}return Ce.strings},Pn=(e,r)=>{var i=0,s=0;for(var c of Ce()){var f=r+i;W[e+s>>2]=f,i+=de(c,f,1/0)+1,s+=4}return 0},Rn=(e,r)=>{var i=Ce();W[e>>2]=i.length;var s=0;for(var c of i)s+=me(c)+1;return W[r>>2]=s,0};function xn(e){try{var r=z.getStreamFromFD(e);return a.close(r),0}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return i.errno}}function Dn(e,r){try{var i=0,s=0,c=0,f=z.getStreamFromFD(e),_=f.tty?2:a.isDir(f.mode)?3:a.isLink(f.mode)?7:4;return R[r]=_,X[r+2>>1]=c,J=[i>>>0,(D=i,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],A[r+8>>2]=J[0],A[r+12>>2]=J[1],J=[s>>>0,(D=s,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],A[r+16>>2]=J[0],A[r+20>>2]=J[1],0}catch(g){if(typeof a>"u"||g.name!=="ErrnoError")throw g;return g.errno}}var On=(e,r,i,s)=>{for(var c=0,f=0;f<i;f++){var _=W[r>>2],g=W[r+4>>2];r+=8;var E=a.read(e,R,_,g,s);if(E<0)return-1;if(c+=E,E<g)break}return c};function jn(e,r,i,s){try{var c=z.getStreamFromFD(e),f=On(c,r,i);return W[s>>2]=f,0}catch(_){if(typeof a>"u"||_.name!=="ErrnoError")throw _;return _.errno}}function Bn(e,r,i,s,c){var f=Ie(r,i);try{if(isNaN(f))return 61;var _=z.getStreamFromFD(e);return a.llseek(_,f,s),J=[_.position>>>0,(D=_.position,+Math.abs(D)>=1?D>0?+Math.floor(D/4294967296)>>>0:~~+Math.ceil((D-+(~~D>>>0))/4294967296)>>>0:0)],A[c>>2]=J[0],A[c+4>>2]=J[1],_.getdents&&f===0&&s===0&&(_.getdents=null),0}catch(g){if(typeof a>"u"||g.name!=="ErrnoError")throw g;return g.errno}}var Ft=function(e){try{var r=z.getStreamFromFD(e);return L.handleSleep(i=>{var s=r.node.mount;if(!s.type.syncfs){i(0);return}s.type.syncfs(s,!1,c=>{i(c?29:0)})})}catch(i){if(typeof a>"u"||i.name!=="ErrnoError")throw i;return i.errno}};Ft.isAsync=!0;var Nn=(e,r,i,s)=>{for(var c=0,f=0;f<i;f++){var _=W[r>>2],g=W[r+4>>2];r+=8;var E=a.write(e,R,_,g,s);if(E<0)return-1;if(c+=E,E<g)break}return c};function Mn(e,r,i,s){try{var c=z.getStreamFromFD(e),f=Nn(c,r,i);return W[s>>2]=f,0}catch(_){if(typeof a>"u"||_.name!=="ErrnoError")throw _;return _.errno}}var $=function(){const e=typeof L=="object"?L.handleAsync.bind(L):null;t.handleAsync=e;const r=new Map;t.setCallback=(i,s)=>r.set(i,s),t.getCallback=i=>r.get(i),t.deleteCallback=i=>r.delete(i),$=function(i,s,...c){const f=r.get(s);let _=null;const g=typeof f=="function"?f:f[_=pe(c.shift())];if(i){if(e)return e(()=>g.apply(f,c));throw new Error("Synchronous WebAssembly cannot call async function")}const E=g.apply(f,c);if(typeof E?.then=="function")throw console.error("unexpected Promise",g),new Error(`${_} unexpectedly returned a Promise`);return E}};function Un(...e){return $(!1,...e)}function Pt(...e){return $(!0,...e)}Pt.isAsync=!0;function Hn(...e){return $(!1,...e)}function Rt(...e){return $(!0,...e)}Rt.isAsync=!0;function Vn(...e){return $(!1,...e)}function xt(...e){return $(!0,...e)}xt.isAsync=!0;function zn(...e){return $(!1,...e)}function Dt(...e){return $(!0,...e)}Dt.isAsync=!0;function Kn(...e){return $(!1,...e)}function Ot(...e){return $(!0,...e)}Ot.isAsync=!0;function Wn(...e){return $(!1,...e)}function jt(...e){return $(!0,...e)}jt.isAsync=!0;function $n(...e){return $(!1,...e)}function Bt(...e){return $(!0,...e)}Bt.isAsync=!0;function Qn(...e){return $(!1,...e)}function Nt(...e){return $(!0,...e)}Nt.isAsync=!0;function Gn(...e){return $(!1,...e)}function Mt(...e){return $(!0,...e)}Mt.isAsync=!0;function Yn(...e){return $(!1,...e)}function Ut(...e){return $(!0,...e)}Ut.isAsync=!0;function Xn(...e){return $(!1,...e)}function Ht(...e){return $(!0,...e)}Ht.isAsync=!0;function Jn(...e){return $(!1,...e)}function Vt(...e){return $(!0,...e)}Vt.isAsync=!0;function Zn(...e){return $(!1,...e)}function zt(...e){return $(!0,...e)}zt.isAsync=!0;function ei(...e){return $(!1,...e)}function Kt(...e){return $(!0,...e)}Kt.isAsync=!0;function ti(...e){return $(!1,...e)}function Wt(...e){return $(!0,...e)}Wt.isAsync=!0;function ri(...e){return $(!1,...e)}function $t(...e){return $(!0,...e)}$t.isAsync=!0;var Me=e=>{try{return e()}catch(r){ue(r)}},ni=e=>{for(var r={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},i={parameters:[],results:e[0]=="v"?[]:[r[e[0]]]},s=1;s<e.length;++s)i.parameters.push(r[e[s]]);return i},ii=()=>{Ne+=1},si=()=>{Ne-=1},L={instrumentWasmImports(e){var r=/^(ipp|ipp_async|ippp|ippp_async|vppp|vppp_async|ipppj|ipppj_async|ipppi|ipppi_async|ipppp|ipppp_async|ipppip|ipppip_async|vpppip|vpppip_async|ippppi|ippppi_async|ippppij|ippppij_async|ipppiii|ipppiii_async|ippppip|ippppip_async|ippipppp|ippipppp_async|ipppppip|ipppppip_async|ipppiiip|ipppiiip_async|vppippii|vppippii_async|invoke_.*|__asyncjs__.*)$/;for(let[i,s]of Object.entries(e))typeof s=="function"&&(s.isAsync||r.test(i))},instrumentWasmExports(e){var r={};for(let[i,s]of Object.entries(e))typeof s=="function"?r[i]=(...c)=>{L.exportCallStack.push(i);try{return s(...c)}finally{k||(L.exportCallStack.pop(),L.maybeStopUnwind())}}:r[i]=s;return r},State:{Normal:0,Unwinding:1,Rewinding:2,Disabled:3},state:0,StackSize:16384,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToName:{},callStackId:0,asyncPromiseHandlers:null,sleepCallbacks:[],getCallStackId(e){var r=L.callStackNameToId[e];return r===void 0&&(r=L.callStackId++,L.callStackNameToId[e]=r,L.callStackIdToName[r]=e),r},maybeStopUnwind(){L.currData&&L.state===L.State.Unwinding&&L.exportCallStack.length===0&&(L.state=L.State.Normal,Me(xi),typeof Fibers<"u"&&Fibers.trampoline())},whenDone(){return new Promise((e,r)=>{L.asyncPromiseHandlers={resolve:e,reject:r}})},allocateData(){var e=ki(12+L.StackSize);return L.setDataHeader(e,e+12,L.StackSize),L.setDataRewindFunc(e),e},setDataHeader(e,r,i){W[e>>2]=r,W[e+4>>2]=r+i},setDataRewindFunc(e){var r=L.exportCallStack[0],i=L.getCallStackId(r);A[e+8>>2]=i},getDataRewindFuncName(e){var r=A[e+8>>2],i=L.callStackIdToName[r];return i},getDataRewindFunc(e){var r=d[e];return r},doRewind(e){var r=L.getDataRewindFuncName(e),i=L.getDataRewindFunc(r);return i()},handleSleep(e){if(!k){if(L.state===L.State.Normal){var r=!1,i=!1;e((s=0)=>{if(!k&&(L.handleSleepReturnValue=s,r=!0,!!i)){L.state=L.State.Rewinding,Me(()=>Di(L.currData)),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.resume();var c,f=!1;try{c=L.doRewind(L.currData)}catch(E){c=E,f=!0}var _=!1;if(!L.currData){var g=L.asyncPromiseHandlers;g&&(L.asyncPromiseHandlers=null,(f?g.reject:g.resolve)(c),_=!0)}if(f&&!_)throw c}}),i=!0,r||(L.state=L.State.Unwinding,L.currData=L.allocateData(),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.pause(),Me(()=>Ri(L.currData)))}else L.state===L.State.Rewinding?(L.state=L.State.Normal,Me(Oi),qi(L.currData),L.currData=null,L.sleepCallbacks.forEach(Lt)):ue(`invalid state: ${L.state}`);return L.handleSleepReturnValue}},handleAsync:e=>L.handleSleep(r=>{e().then(r)})},Qt=(e,r)=>{e<128?r.push(e):r.push(e%128|128,e>>7)},ai=(e,r)=>{var i=e.slice(0,1),s=e.slice(1),c={i:127,p:127,j:126,f:125,d:124,e:111};r.push(96),Qt(s.length,r);for(var f of s)r.push(c[f]);i=="v"?r.push(0):r.push(1,c[i])},oi=(e,r)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(ni(r),e);var i=[1];ai(r,i);var s=[0,97,115,109,1,0,0,0,1];Qt(i.length,s),s.push(...i),s.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var c=new WebAssembly.Module(new Uint8Array(s)),f=new WebAssembly.Instance(c,{e:{f:e}}),_=f.exports.f;return _},Ee,li=e=>Ee.get(e),ci=(e,r)=>{if(Se)for(var i=e;i<e+r;i++){var s=li(i);s&&Se.set(s,i)}},Se,ui=e=>(Se||(Se=new WeakMap,ci(0,Ee.length)),Se.get(e)||0),Gt=[],di=()=>{if(Gt.length)return Gt.pop();try{Ee.grow(1)}catch(e){throw e instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":e}return Ee.length-1},Yt=(e,r)=>Ee.set(e,r),fi=(e,r)=>{var i=ui(e);if(i)return i;var s=di();try{Yt(s,e)}catch(f){if(!(f instanceof TypeError))throw f;var c=oi(e,r);Yt(s,c)}return Se.set(e,s),s},Xt=e=>{var r=t["_"+e];return r},Jt=(e,r)=>{R.set(e,r)},Zt=e=>Fi(e),hi=e=>{var r=me(e)+1,i=Zt(r);return de(e,i,r),i},he=(e,r,i,s,c)=>{var f={string:Y=>{var te=0;return Y!=null&&Y!==0&&(te=hi(Y)),te},array:Y=>{var te=Zt(Y.length);return Jt(Y,te),te}};function _(Y){return r==="string"?pe(Y):r==="boolean"?!!Y:Y}var g=Xt(e),E=[],I=0;if(s)for(var B=0;B<s.length;B++){var K=f[i[B]];K?(I===0&&(I=Mr()),E[B]=K(s[B])):E[B]=s[B]}var V=L.currData,C=g(...E);function U(Y){return si(),I!==0&&Nr(I),_(Y)}var ee=c?.async;return ii(),L.currData!=V?L.whenDone().then(U):(C=U(C),ee?Promise.resolve(C):C)},_i=(e,r,i,s)=>{var c=!i||i.every(_=>_==="number"||_==="boolean"),f=r!=="string";return f&&c&&!s?Xt(e):(..._)=>he(e,r,i,_,s)},pi=e=>Li(),mi=(e,r,i)=>{if(i??=2147483647,i<2)return 0;i-=2;for(var s=r,c=i<e.length*2?i/2:e.length,f=0;f<c;++f){var _=e.charCodeAt(f);X[r>>1]=_,r+=2}return X[r>>1]=0,r-s},gi=(e,r,i)=>{if(i??=2147483647,i<4)return 0;for(var s=r,c=s+i-4,f=0;f<e.length;++f){var _=e.charCodeAt(f);if(_>=55296&&_<=57343){var g=e.charCodeAt(++f);_=65536+((_&1023)<<10)|g&1023}if(A[r>>2]=_,r+=4,r+4>c)break}return A[r>>2]=0,r-s},yi=e=>{for(var r="";;){var i=Q[e++];if(!i)return r;r+=String.fromCharCode(i)}},vi=new TextDecoder("utf-16le"),wi=(e,r)=>{for(var i=e>>1,s=i+r/2,c=i;!(c>=s)&&Z[c];)++c;return vi.decode(Z.subarray(i,c))},bi=(e,r)=>{for(var i=0,s="";!(i>=r/4);){var c=A[e+i*4>>2];if(c==0)break;if(++i,c>=65536){var f=c-65536;s+=String.fromCharCode(55296|f>>10,56320|f&1023)}else s+=String.fromCharCode(c)}return s},Ei=e=>{for(var r=[],i=0;i<e.length;i++){var s=e[i];s>255&&(s&=255),r.push(String.fromCharCode(s))}return r.join("")};a.createPreloadedFile=$r,a.staticInit(),N.doesNotExistError=new a.ErrnoError(44),N.doesNotExistError.stack="<generic error, no stack>",$(),t.noExitRuntime&&(Ge=t.noExitRuntime),t.preloadPlugins&&(kt=t.preloadPlugins),t.print&&(v=t.print),t.printErr&&(p=t.printErr),t.wasmBinary&&(m=t.wasmBinary),t.arguments&&t.arguments,t.thisProgram&&(S=t.thisProgram),t.getTempRet0=pi,t.ccall=he,t.cwrap=_i,t.addFunction=fi,t.setValue=we,t.getValue=yt,t.UTF8ToString=pe,t.stringToUTF8=de,t.lengthBytesUTF8=me,t.intArrayFromString=Je,t.intArrayToString=Ei,t.AsciiToString=yi,t.UTF16ToString=wi,t.stringToUTF16=mi,t.UTF32ToString=bi,t.stringToUTF32=gi,t.writeArrayToMemory=Jt;var Si={a:Ur,aa:Gr,da:Yr,ba:Xr,$:Jr,b:en,_:tn,y:rn,U:nn,Y:sn,R:an,X:on,P:ln,N:cn,M:un,Z:dn,K:fn,J:hn,F:_n,E:pn,w:wn,u:bn,v:En,G:qn,Q:Tn,n:An,g:Ct,H:Cn,S:Pn,T:Rn,o:xn,I:Dn,O:jn,x:Bn,V:Ft,L:Mn,s:Un,t:Pt,ka:Hn,oa:Rt,j:Vn,k:xt,c:zn,d:Dt,ga:Kn,ha:Ot,ia:Wn,ja:jt,h:$n,i:Bt,z:Qn,A:Nt,e:Gn,f:Mt,ea:Yn,fa:Ut,B:Xn,C:Ht,p:Jn,q:Vt,la:Zn,ma:zt,D:At,na:ei,r:Kt,l:ti,m:Wt,W:ri,ca:$t},d=await Or();d.qa,t._sqlite3_status64=d.ra,t._sqlite3_status=d.sa,t._sqlite3_msize=d.ta,t._sqlite3_db_status=d.ua,t._sqlite3_vfs_find=d.va,t._sqlite3_vfs_register=d.wa,t._sqlite3_vfs_unregister=d.xa,t._sqlite3_release_memory=d.ya,t._sqlite3_soft_heap_limit64=d.za,t._sqlite3_memory_used=d.Aa,t._sqlite3_hard_heap_limit64=d.Ba,t._sqlite3_memory_highwater=d.Ca,t._sqlite3_malloc=d.Da,t._sqlite3_malloc64=d.Ea,t._sqlite3_free=d.Fa,t._sqlite3_realloc=d.Ga,t._sqlite3_realloc64=d.Ha,t._sqlite3_str_vappendf=d.Ia,t._sqlite3_str_append=d.Ja,t._sqlite3_str_appendchar=d.Ka,t._sqlite3_str_appendall=d.La,t._sqlite3_str_appendf=d.Ma,t._sqlite3_str_finish=d.Na,t._sqlite3_str_errcode=d.Oa,t._sqlite3_str_length=d.Pa,t._sqlite3_str_value=d.Qa,t._sqlite3_str_reset=d.Ra,t._sqlite3_str_new=d.Sa,t._sqlite3_vmprintf=d.Ta,t._sqlite3_mprintf=d.Ua,t._sqlite3_vsnprintf=d.Va,t._sqlite3_snprintf=d.Wa,t._sqlite3_log=d.Xa,t._sqlite3_randomness=d.Ya,t._sqlite3_stricmp=d.Za,t._sqlite3_strnicmp=d._a,t._sqlite3_os_init=d.$a,t._sqlite3_os_end=d.ab,t._sqlite3_serialize=d.bb,t._sqlite3_prepare_v2=d.cb,t._sqlite3_step=d.db,t._sqlite3_column_int64=d.eb,t._sqlite3_reset=d.fb,t._sqlite3_exec=d.gb,t._sqlite3_column_int=d.hb,t._sqlite3_finalize=d.ib,t._sqlite3_deserialize=d.jb,t._sqlite3_database_file_object=d.kb,t._sqlite3_backup_init=d.lb,t._sqlite3_backup_step=d.mb,t._sqlite3_backup_finish=d.nb,t._sqlite3_backup_remaining=d.ob,t._sqlite3_backup_pagecount=d.pb,t._sqlite3_clear_bindings=d.qb,t._sqlite3_value_blob=d.rb,t._sqlite3_value_text=d.sb,t._sqlite3_value_bytes=d.tb,t._sqlite3_value_bytes16=d.ub,t._sqlite3_value_double=d.vb,t._sqlite3_value_int=d.wb,t._sqlite3_value_int64=d.xb,t._sqlite3_value_subtype=d.yb,t._sqlite3_value_pointer=d.zb,t._sqlite3_value_text16=d.Ab,t._sqlite3_value_text16be=d.Bb,t._sqlite3_value_text16le=d.Cb,t._sqlite3_value_type=d.Db,t._sqlite3_value_encoding=d.Eb,t._sqlite3_value_nochange=d.Fb,t._sqlite3_value_frombind=d.Gb,t._sqlite3_value_dup=d.Hb,t._sqlite3_value_free=d.Ib,t._sqlite3_result_blob=d.Jb,t._sqlite3_result_blob64=d.Kb,t._sqlite3_result_double=d.Lb,t._sqlite3_result_error=d.Mb,t._sqlite3_result_error16=d.Nb,t._sqlite3_result_int=d.Ob,t._sqlite3_result_int64=d.Pb,t._sqlite3_result_null=d.Qb,t._sqlite3_result_pointer=d.Rb,t._sqlite3_result_subtype=d.Sb,t._sqlite3_result_text=d.Tb,t._sqlite3_result_text64=d.Ub,t._sqlite3_result_text16=d.Vb,t._sqlite3_result_text16be=d.Wb,t._sqlite3_result_text16le=d.Xb,t._sqlite3_result_value=d.Yb,t._sqlite3_result_error_toobig=d.Zb,t._sqlite3_result_zeroblob=d._b,t._sqlite3_result_zeroblob64=d.$b,t._sqlite3_result_error_code=d.ac,t._sqlite3_result_error_nomem=d.bc,t._sqlite3_user_data=d.cc,t._sqlite3_context_db_handle=d.dc,t._sqlite3_vtab_nochange=d.ec,t._sqlite3_vtab_in_first=d.fc,t._sqlite3_vtab_in_next=d.gc,t._sqlite3_aggregate_context=d.hc,t._sqlite3_get_auxdata=d.ic,t._sqlite3_set_auxdata=d.jc,t._sqlite3_column_count=d.kc,t._sqlite3_data_count=d.lc,t._sqlite3_column_blob=d.mc,t._sqlite3_column_bytes=d.nc,t._sqlite3_column_bytes16=d.oc,t._sqlite3_column_double=d.pc,t._sqlite3_column_text=d.qc,t._sqlite3_column_value=d.rc,t._sqlite3_column_text16=d.sc,t._sqlite3_column_type=d.tc,t._sqlite3_column_name=d.uc,t._sqlite3_column_name16=d.vc,t._sqlite3_bind_blob=d.wc,t._sqlite3_bind_blob64=d.xc,t._sqlite3_bind_double=d.yc,t._sqlite3_bind_int=d.zc,t._sqlite3_bind_int64=d.Ac,t._sqlite3_bind_null=d.Bc,t._sqlite3_bind_pointer=d.Cc,t._sqlite3_bind_text=d.Dc,t._sqlite3_bind_text64=d.Ec,t._sqlite3_bind_text16=d.Fc,t._sqlite3_bind_value=d.Gc,t._sqlite3_bind_zeroblob=d.Hc,t._sqlite3_bind_zeroblob64=d.Ic,t._sqlite3_bind_parameter_count=d.Jc,t._sqlite3_bind_parameter_name=d.Kc,t._sqlite3_bind_parameter_index=d.Lc,t._sqlite3_db_handle=d.Mc,t._sqlite3_stmt_readonly=d.Nc,t._sqlite3_stmt_isexplain=d.Oc,t._sqlite3_stmt_explain=d.Pc,t._sqlite3_stmt_busy=d.Qc,t._sqlite3_next_stmt=d.Rc,t._sqlite3_stmt_status=d.Sc,t._sqlite3_sql=d.Tc,t._sqlite3_expanded_sql=d.Uc,t._sqlite3_value_numeric_type=d.Vc,t._sqlite3_blob_open=d.Wc,t._sqlite3_blob_close=d.Xc,t._sqlite3_blob_read=d.Yc,t._sqlite3_blob_write=d.Zc,t._sqlite3_blob_bytes=d._c,t._sqlite3_blob_reopen=d.$c,t._sqlite3_set_authorizer=d.ad,t._sqlite3_strglob=d.bd,t._sqlite3_strlike=d.cd,t._sqlite3_errmsg=d.dd,t._sqlite3_auto_extension=d.ed,t._sqlite3_cancel_auto_extension=d.fd,t._sqlite3_reset_auto_extension=d.gd,t._sqlite3_prepare=d.hd,t._sqlite3_prepare_v3=d.id,t._sqlite3_prepare16=d.jd,t._sqlite3_prepare16_v2=d.kd,t._sqlite3_prepare16_v3=d.ld,t._sqlite3_get_table=d.md,t._sqlite3_free_table=d.nd,t._sqlite3_create_module=d.od,t._sqlite3_create_module_v2=d.pd,t._sqlite3_drop_modules=d.qd,t._sqlite3_declare_vtab=d.rd,t._sqlite3_vtab_on_conflict=d.sd,t._sqlite3_vtab_config=d.td,t._sqlite3_vtab_collation=d.ud,t._sqlite3_vtab_in=d.vd,t._sqlite3_vtab_rhs_value=d.wd,t._sqlite3_vtab_distinct=d.xd,t._sqlite3_keyword_name=d.yd,t._sqlite3_keyword_count=d.zd,t._sqlite3_keyword_check=d.Ad,t._sqlite3_complete=d.Bd,t._sqlite3_complete16=d.Cd,t._sqlite3_libversion=d.Dd,t._sqlite3_libversion_number=d.Ed,t._sqlite3_threadsafe=d.Fd,t._sqlite3_initialize=d.Gd,t._sqlite3_shutdown=d.Hd,t._sqlite3_config=d.Id,t._sqlite3_db_mutex=d.Jd,t._sqlite3_db_release_memory=d.Kd,t._sqlite3_db_cacheflush=d.Ld,t._sqlite3_db_config=d.Md,t._sqlite3_last_insert_rowid=d.Nd,t._sqlite3_set_last_insert_rowid=d.Od,t._sqlite3_changes64=d.Pd,t._sqlite3_changes=d.Qd,t._sqlite3_total_changes64=d.Rd,t._sqlite3_total_changes=d.Sd,t._sqlite3_txn_state=d.Td,t._sqlite3_close=d.Ud,t._sqlite3_close_v2=d.Vd,t._sqlite3_busy_handler=d.Wd,t._sqlite3_progress_handler=d.Xd,t._sqlite3_busy_timeout=d.Yd,t._sqlite3_interrupt=d.Zd,t._sqlite3_is_interrupted=d._d,t._sqlite3_create_function=d.$d,t._sqlite3_create_function_v2=d.ae,t._sqlite3_create_window_function=d.be,t._sqlite3_create_function16=d.ce,t._sqlite3_overload_function=d.de,t._sqlite3_trace_v2=d.ee,t._sqlite3_commit_hook=d.fe,t._sqlite3_update_hook=d.ge,t._sqlite3_rollback_hook=d.he,t._sqlite3_autovacuum_pages=d.ie,t._sqlite3_wal_autocheckpoint=d.je,t._sqlite3_wal_hook=d.ke,t._sqlite3_wal_checkpoint_v2=d.le,t._sqlite3_wal_checkpoint=d.me,t._sqlite3_error_offset=d.ne,t._sqlite3_errmsg16=d.oe,t._sqlite3_errcode=d.pe,t._sqlite3_extended_errcode=d.qe,t._sqlite3_system_errno=d.re,t._sqlite3_errstr=d.se,t._sqlite3_limit=d.te,t._sqlite3_open=d.ue,t._sqlite3_open_v2=d.ve,t._sqlite3_open16=d.we,t._sqlite3_create_collation=d.xe,t._sqlite3_create_collation_v2=d.ye,t._sqlite3_create_collation16=d.ze,t._sqlite3_collation_needed=d.Ae,t._sqlite3_collation_needed16=d.Be,t._sqlite3_get_clientdata=d.Ce,t._sqlite3_set_clientdata=d.De,t._sqlite3_get_autocommit=d.Ee,t._sqlite3_table_column_metadata=d.Fe,t._sqlite3_sleep=d.Ge,t._sqlite3_extended_result_codes=d.He,t._sqlite3_file_control=d.Ie,t._sqlite3_test_control=d.Je,t._sqlite3_create_filename=d.Ke,t._sqlite3_free_filename=d.Le,t._sqlite3_uri_parameter=d.Me,t._sqlite3_uri_key=d.Ne,t._sqlite3_uri_boolean=d.Oe,t._sqlite3_uri_int64=d.Pe,t._sqlite3_filename_database=d.Qe,t._sqlite3_filename_journal=d.Re,t._sqlite3_filename_wal=d.Se,t._sqlite3_db_name=d.Te,t._sqlite3_db_filename=d.Ue,t._sqlite3_db_readonly=d.Ve,t._sqlite3_compileoption_used=d.We,t._sqlite3_compileoption_get=d.Xe,t._sqlite3_sourceid=d.Ye;var ki=t._malloc=d.Ze,qi=t._free=d._e;t._RegisterExtensionFunctions=d.$e,t._getSqliteFree=d.af;var Ti=t._main=d.bf;t._libauthorizer_set_authorizer=d.cf,t._libfunction_create_function=d.df,t._libhook_commit_hook=d.ef,t._libhook_update_hook=d.ff,t._libprogress_progress_handler=d.gf,t._libvfs_vfs_register=d.hf;var Ai=d.kf,Ii=d.lf,Li=d.mf,Ci=d.nf,Fi=d.of,Pi=d.pf;t.dynCall_vi=d.dynCall_vi,t.dynCall_iiiii=d.dynCall_iiiii,t.dynCall_viii=d.dynCall_viii,t.dynCall_iii=d.dynCall_iii,t.dynCall_iiii=d.dynCall_iiii,t.dynCall_iiiiiii=d.dynCall_iiiiiii,t.dynCall_ii=d.dynCall_ii,t.dynCall_vii=d.dynCall_vii,t.dynCall_iiiiii=d.dynCall_iiiiii,t.dynCall_viiii=d.dynCall_viiii,t.dynCall_iiiiiiiii=d.dynCall_iiiiiiiii,t.dynCall_vijii=d.dynCall_vijii,t.dynCall_viiiii=d.dynCall_viiiii,t.dynCall_iiiij=d.dynCall_iiiij,t.dynCall_viji=d.dynCall_viji,t.dynCall_viiiij=d.dynCall_viiiij,t.dynCall_iij=d.dynCall_iij,t.dynCall_v=d.dynCall_v,t.dynCall_iijii=d.dynCall_iijii,t.dynCall_iiji=d.dynCall_iiji,t.dynCall_i=d.dynCall_i,t.dynCall_iiiiiij=d.dynCall_iiiiiij,t.dynCall_ji=d.dynCall_ji,t.dynCall_iiiiiiii=d.dynCall_iiiiiiii;var Ri=d.qf,xi=d.rf,Di=d.sf,Oi=d.tf;t._sqlite3_version=5472;function ji(){var e=Ti,r=0,i=0;try{var s=e(r,i);return It(s,!0),s}catch(c){return et(c)}}function rt(){if(_e>0){Te=rt;return}if(je(),_e>0){Te=rt;return}function e(){if(t.calledRun=!0,!k){Ir(),u(t),t.onRuntimeInitialized?.();var r=t.noInitialRun||!1;r||ji(),Lr()}}t.setStatus?(t.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>t.setStatus(""),1),e()},1)):e()}function Bi(){if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.shift()()}return Bi(),rt(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor;let r=0;t.set_authorizer=function(i,s,c){r&&(t.deleteCallback(r),t._sqlite3_free(r),r=0),r=t._sqlite3_malloc(4),we(r,s instanceof e?1:0,"i32");const f=he("libauthorizer_set_authorizer","number",["number","number","number"],[i,s?1:0,r]);return!f&&s&&t.setCallback(r,(_,g,E,I,B,K)=>s(c,g,E,I,B,K)),f}})(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor,r=["xFunc","xStep","xFinal"],i=new Map;t.create_function=function(s,c,f,_,g,E,I,B){const K=t._sqlite3_malloc(4),V={xFunc:E,xStep:I,xFinal:B};we(K,r.reduce((U,ee,Y)=>V[ee]instanceof e?U|1<<Y:U,0),"i32");const C=he("libfunction_create_function","number",["number","string","number","number","number","number","number","number"],[s,c,f,_,K,E?1:0,I?1:0,B?1:0]);if(!C){if(i.has(c)){const U=i.get(c);t.deleteCallback(U)}i.set(c,K),t.setCallback(K,{xFunc:E,xStep:I,xFinal:B})}return C}})(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor;let r=0;t.update_hook=function(i,s){r&&(t.deleteCallback(r),t._sqlite3_free(r),r=0),r=t._sqlite3_malloc(4),we(r,s instanceof e?1:0,"i32"),he("libhook_update_hook","void",["number","number","number"],[i,s?1:0,r]),s&&t.setCallback(r,(c,f,_,g,E,I)=>s(f,_,g,E,I))}})(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor;let r=0;t.commit_hook=function(i,s){r&&(t.deleteCallback(r),t._sqlite3_free(r),r=0),r=t._sqlite3_malloc(4),we(r,s instanceof e?1:0,"i32"),he("libhook_commit_hook","void",["number","number","number"],[i,s?1:0,r]),s&&t.setCallback(r,c=>s())}})(),(function(){const e=Object.getPrototypeOf(async function(){}).constructor;let r=0;t.progress_handler=function(i,s,c,f){r&&(t.deleteCallback(r),t._sqlite3_free(r),r=0),r=t._sqlite3_malloc(4),we(r,c instanceof e?1:0,"i32"),he("libprogress_progress_handler","number",["number","number","number","number"],[i,s,c?1:0,r]),c&&t.setCallback(r,_=>c(f))}})(),(function(){const e=["xOpen","xDelete","xAccess","xFullPathname","xRandomness","xSleep","xCurrentTime","xGetLastError","xCurrentTimeInt64","xClose","xRead","xWrite","xTruncate","xSync","xFileSize","xLock","xUnlock","xCheckReservedLock","xFileControl","xSectorSize","xDeviceCharacteristics","xShmMap","xShmLock","xShmBarrier","xShmUnmap"],r=new Map;t.vfs_register=function(i,s){let c=0,f=0;e.forEach((g,E)=>{i[g]&&(c|=1<<E,i.hasAsyncMethod(g)&&(f|=1<<E))});const _=t._sqlite3_malloc(4);try{const g=he("libvfs_vfs_register","number",["string","number","number","number","number","number"],[i.name,i.mxPathname,c,f,s?1:0,_]);if(!g){if(r.has(i.name)){const I=r.get(i.name);t.deleteCallback(I)}const E=yt(_,"*");r.set(i.name,E),t.setCallback(E,i)}return g}finally{t._sqlite3_free(_)}}})(),n=h,n}),Fs=Cs,Ps=new Set(["TransactionInactiveError","InvalidStateError"]),Rs=class{path;flags;metadata;fileSize=0;needsMetadataSync=!1;rollback=null;changedPages=new Set;synchronous="full";txOptions={durability:"strict"};constructor(n,t,u){this.path=n,this.flags=t,this.metadata=u}},xs=class Tr extends Ke(us){mapIdToFile=new Map;lastError=null;log=null;#r;#t;static async create(n,t,u){const l=new Tr(n,t,u);return await l.isReady(),l}constructor(n,t,u={}){super(n,t,u),this.#r=this.#e(u.idbName??n)}async#e(n){this.#t=await Ds.create(n)}close(){this.#t.close()}async isReady(){await super.isReady(),await this.#r}getFilename(n){const t=this.mapIdToFile.get(n).path;return`IDB(${this.name}):${t}`}async jOpen(n,t,u,l){try{const y=new URL(n||Math.random().toString(36).slice(2),"file://").pathname;let w=await this.#t.q(({metadata:q})=>q.get(y));if(!w&&u&We&&(w={name:y,fileSize:0,version:0},await this.#t.q(({metadata:q})=>q.put(w),"rw")),!w)throw new Error(`File ${y} not found`);const S=new Rs(y,u,w);return this.mapIdToFile.set(t,S),l.setInt32(0,u,!0),P}catch(h){return this.lastError=h,dt}}async jDelete(n,t){try{const l=new URL(n,"file://").pathname;return this.#t.q(({metadata:h,blocks:y})=>{const w=IDBKeyRange.bound([l,-1/0],[l,1/0]);y.delete(w),h.delete(l)},"rw"),t&&await this.#t.sync(!1),P}catch(u){return this.lastError=u,Wi}}async jAccess(n,t,u){try{const h=new URL(n,"file://").pathname,y=await this.#t.q(({metadata:w})=>w.get(h));return u.setInt32(0,y?1:0,!0),P}catch(l){return this.lastError=l,Vi}}async jClose(n){try{const t=this.mapIdToFile.get(n);return this.mapIdToFile.delete(n),t.flags&Zi&&await this.#t.q(({metadata:u,blocks:l})=>{u.delete(t.path),l.delete(IDBKeyRange.bound([t.path,0],[t.path,1/0]))},"rw"),t.needsMetadataSync&&this.#t.q(({metadata:u})=>u.put(t.metadata),"rw"),await this.#t.sync(t.synchronous==="full"),P}catch(t){return this.lastError=t,Ki}}async jRead(n,t,u){try{const l=this.mapIdToFile.get(n);let h=0;for(;h<t.byteLength;){const y=u+h,w=await this.#t.q(({blocks:F})=>{const O=IDBKeyRange.bound([l.path,-y],[l.path,1/0]);return F.get(O)});if(!w||w.data.byteLength-w.offset<=y)return t.fill(0,h),pr;const S=t.subarray(h),q=y+w.offset,T=Math.min(Math.max(w.data.byteLength-q,0),S.byteLength);S.set(w.data.subarray(q,q+T)),h+=T}return P}catch(l){return this.lastError=l,Yi}}jWrite(n,t,u){try{const l=this.mapIdToFile.get(n);if(l.flags&ye&&!l.rollback){const S=Object.assign({pendingVersion:l.metadata.version-1},l.metadata);this.#t.q(({metadata:q})=>q.put(S),"rw",l.txOptions),l.rollback=Object.assign({},l.metadata),l.metadata.version--}l.flags&ye&&l.changedPages.add(u);const h=t.slice(),y=l.metadata.version;if(!(u<l.metadata.fileSize)||l.flags&ye||l.flags&ts){const S={path:l.path,offset:-u,version:y,data:t.slice()};this.#t.q(({blocks:q})=>{q.put(S),l.changedPages.add(u)},"rw",l.txOptions)}else this.#t.q(async({blocks:S})=>{const q=IDBKeyRange.bound([l.path,-u],[l.path,1/0]),T=await S.get(q);T.data.subarray(u+T.offset).set(h),S.put(T)},"rw",l.txOptions);return l.metadata.fileSize<u+t.length&&(l.metadata.fileSize=u+t.length,l.needsMetadataSync=!0),P}catch(l){return this.lastError=l,mr}}jTruncate(n,t){try{const u=this.mapIdToFile.get(n);return t<u.metadata.fileSize&&(this.#t.q(({blocks:l})=>{const h=IDBKeyRange.bound([u.path,-1/0],[u.path,-t,1/0]);l.delete(h)},"rw",u.txOptions),u.metadata.fileSize=t,u.needsMetadataSync=!0),P}catch(u){return this.lastError=u,Xi}}async jSync(n,t){try{const u=this.mapIdToFile.get(n);return u.needsMetadataSync&&(this.#t.q(({metadata:l})=>l.put(u.metadata),"rw",u.txOptions),u.needsMetadataSync=!1),u.flags&ye?u.synchronous==="full"&&await this.#t.sync(!0):await this.#t.sync(u.synchronous==="full"),P}catch(u){return this.lastError=u,Qi}}jFileSize(n,t){try{const u=this.mapIdToFile.get(n);return t.setBigInt64(0,BigInt(u.metadata.fileSize),!0),P}catch(u){return this.lastError=u,$i}}async jLock(n,t){const u=this.mapIdToFile.get(n),l=await super.jLock(n,t);return t===qe&&(u.metadata=await this.#t.q(async({metadata:h,blocks:y})=>{const w=await h.get(u.path);return w.pendingVersion&&(console.warn(`removing failed transaction ${w.pendingVersion}`),await new Promise((S,q)=>{const T=IDBKeyRange.bound([w.name,-1/0],[w.name,1/0]),F=y.openCursor(T);F.onsuccess=()=>{const O=F.result;O?(O.value.version<w.version&&O.delete(),O.continue()):S()},F.onerror=()=>q(F.error)}),delete w.pendingVersion,h.put(w)),w},"rw",u.txOptions)),l}async jUnlock(n,t){if(t===ve){const u=this.mapIdToFile.get(n);await this.#t.sync(u.synchronous==="full")}return super.jUnlock(n,t)}jFileControl(n,t,u){try{const l=this.mapIdToFile.get(n);switch(t){case is:const h=hr(u,4),y=hr(u,8);this.log?.("xFileControl",l.path,"PRAGMA",h,y);const w=q=>{const T=new TextEncoder().encode(q),F=this._module._sqlite3_malloc(T.byteLength);return this._module.HEAPU8.subarray(F,F+T.byteLength).set(T),u.setUint32(0,F,!0),tr};switch(h.toLowerCase()){case"page_size":if(l.flags&ye&&y&&l.metadata.fileSize)return tr;break;case"synchronous":if(y)switch(y.toLowerCase()){case"0":case"off":l.synchronous="off",l.txOptions={durability:"relaxed"};break;case"1":case"normal":l.synchronous="normal",l.txOptions={durability:"relaxed"};break;case"2":case"3":case"full":case"extra":l.synchronous="full",l.txOptions={durability:"strict"};break}break;case"write_hint":return super.jFileControl(n,Ke.WRITE_HINT_OP_CODE,null)}break;case yr:if(this.log?.("xFileControl",l.path,"SYNC"),l.rollback){const q=Object.assign({},l.metadata),T=l.rollback.fileSize;this.#t.q(({metadata:F,blocks:O})=>{F.put(q);for(const H of l.changedPages)if(H<T){const x=IDBKeyRange.bound([l.path,-H,q.version],[l.path,-H,1/0],!0);O.delete(x)}l.changedPages.clear()},"rw",l.txOptions),l.needsMetadataSync=!1,l.rollback=null}break;case vr:return this.log?.("xFileControl",l.path,"BEGIN_ATOMIC_WRITE"),P;case wr:return this.log?.("xFileControl",l.path,"COMMIT_ATOMIC_WRITE"),P;case ss:this.log?.("xFileControl",l.path,"ROLLBACK_ATOMIC_WRITE"),l.metadata=l.rollback;const S=Object.assign({},l.metadata);return this.#t.q(({metadata:q,blocks:T})=>{q.put(S);for(const F of l.changedPages)T.delete([l.path,-F,S.version-1]);l.changedPages.clear()},"rw",l.txOptions),l.needsMetadataSync=!1,l.rollback=null,P}}catch(l){return this.lastError=l,at}return super.jFileControl(n,t,u)}jDeviceCharacteristics(n){return 0|ns|rs}jGetLastError(n){if(this.lastError){console.error(this.lastError);const t=n.subarray(0,n.byteLength-1),{written:u}=new TextEncoder().encodeInto(this.lastError.message,t);n[u]=0}return P}};function hr(o,n){const t=o.getUint32(n,!0);if(t){const u=new Uint8Array(o.buffer,t);return new TextDecoder().decode(u.subarray(0,u.indexOf(0)))}return null}var Ds=class Ar{#r;#t=null;#e=Promise.resolve();#n=null;#s=new WeakSet;log=null;static async create(n){const t=await new Promise((u,l)=>{const h=indexedDB.open(n,6);h.onupgradeneeded=async y=>{const w=h.result;switch(y.oldVersion&&console.log(`Upgrading IndexedDB from version ${y.oldVersion}`),y.oldVersion){case 0:w.createObjectStore("blocks",{keyPath:["path","offset","version"]}).createIndex("version",["path","version"]);case 5:const S=h.transaction;S.objectStore("blocks").deleteIndex("version");const T=w.createObjectStore("metadata",{keyPath:"name"});await new Promise((F,O)=>{let H={};const x=S.objectStore("blocks").openCursor();x.onsuccess=()=>{const v=x.result;if(v){const p=v.value;typeof p.offset!="number"||p.path===H.path&&p.offset===H.offset?v.delete():p.offset===0&&(T.put({name:p.path,fileSize:p.fileSize,version:p.version}),delete p.fileSize,v.update(p)),H=p,v.continue()}else F()},x.onerror=()=>O(x.error)});break}},h.onsuccess=()=>u(h.result),h.onerror=()=>l(h.error)});return new Ar(t)}constructor(n){this.#r=n}close(){this.#r.close()}q(n,t="ro",u={}){const l=t==="ro"?"readonly":"readwrite",h=Object.assign({durability:"default"},u);return this.#t=(this.#t||Promise.resolve()).then(()=>this.#a(n,l,h)),this.#t}async#a(n,t,u){let l;this.#n&&this.#s.has(this.#n.transaction)&&this.#n.transaction.mode>=t&&this.#n.transaction.durability===u.durability&&(l=this.#n.transaction,this.#n.readyState==="pending"&&await new Promise(h=>{this.#n.addEventListener("success",h,{once:!0}),this.#n.addEventListener("error",h,{once:!0})}));for(let h=0;h<2;++h){l||(await this.#e,l=this.#r.transaction(this.#r.objectStoreNames,t,u),this.log?.("IDBTransaction open",t),this.#s.add(l),this.#e=new Promise((y,w)=>{l.addEventListener("complete",()=>{this.log?.("IDBTransaction complete"),this.#s.delete(l),y()}),l.addEventListener("abort",()=>{this.#s.delete(l),w(new Error("transaction aborted"))})}));try{const y=[...l.objectStoreNames].map(w=>[w,this.proxyStoreOrIndex(l.objectStore(w))]);return await n(Object.fromEntries(y))}catch(y){if(!h&&Ps.has(y.name)){this.log?.(`${y.name}, retrying`),l=null;continue}throw y}}}proxyStoreOrIndex(n){return new Proxy(n,{get:(t,u,l)=>{const h=Reflect.get(t,u,l);return typeof h=="function"?(...y)=>{const w=Reflect.apply(h,t,y);return w instanceof IDBRequest&&!u.endsWith("Cursor")?(this.#n=w,w.addEventListener("error",()=>{console.error(w.error),w.transaction.abort()},{once:!0}),Os(w)):w}:h}})}async sync(n){this.#t&&(await this.#t,n&&await this.#e,this.reset())}reset(){this.#t=null,this.#e=Promise.resolve(),this.#n=null}};function Os(o){return new Promise((n,t)=>{o.onsuccess=()=>n(o.result),o.onerror=()=>t(o.error)})}async function _r(o,n={}){const{url:t,lockPolicy:u="shared+hint",lockTimeout:l=1/0,...h}=n,y=await Fs(t?{locateFile:()=>t}:void 0),w=o.endsWith(".db")?o:`${o}.db`,S={idbName:w,lockPolicy:u,lockTimeout:l};return{path:w,sqliteModule:y,vfsFn:xs.create,vfsOptions:S,...h}}class js{constructor(n="content.db",t=`${De}app-content/content.db`){this.dbName=n,this.dbUrl=t,this.db=null}async init(){if(this.db)return this.db;try{let n=await dr(_r(this.dbName,{url:`${De}wa-sqlite-async.wasm`})),t=[];try{t=await n.run("SELECT name FROM sqlite_master WHERE type='table' AND name='contents'")}catch(u){console.warn("DB check failed, might be empty or corrupted",u)}if(t.length===0){console.log("DB empty or missing 'contents' table. Downloading..."),await n.close();const u=await fetch(this.dbUrl);if(!u.ok)throw new Error(`Failed to fetch DB: ${u.status}`);const l=await u.arrayBuffer(),h=new File([l],this.dbName);n=await dr(_r(this.dbName,{...bs(h),url:`${De}wa-sqlite-async.wasm`})),console.log("Database initialized from server file.")}return this.db=n,this.db}catch(n){throw console.error("SqliteConnection Init Error:",n),n}}async query(n,t=[]){return this.db||await this.init(),await this.db.run(n,t)}}class Bs{constructor(){this.db=new js,this.data=null}async load(){if(this.data)return this.data;try{const n=await this.db.query("SELECT * FROM contents ORDER BY uid ASC");return this.data=n.map(t=>({id:t.uid,html:t.html,label:t.label,segment:t.segment,audio:t.audio})),this.data}catch(n){throw console.error("ContentLoader Error:",n),n}}getAllSegments(){return this.data?this.data.filter(n=>n.audio!=="skip").map(n=>({id:n.id,audio:n.audio,text:n.segment})):[]}getSegmentsStartingFrom(n){if(!this.data)return[];let t=0;return n&&(t=this.data.findIndex(l=>l.id===n),t===-1&&(t=0)),this.data.slice(t).filter(l=>l.audio!=="skip").map(l=>({id:l.id,audio:l.audio,text:l.segment}))}getSegment(n){return this.data?.find(t=>t.id===n)}getSegmentsByLabelPrefix(n){return this.data?this.data.filter(t=>t.label.startsWith(n)):[]}getRuleSegments(n,t){return[]}}class Ns{constructor(n,t,u){this.container=document.getElementById(n),this.sidebar=document.getElementById(t),this.toggle=document.getElementById(u),this.activeLink=null}render(n){if(!this.container)return;this.container.innerHTML="";const t=document.createElement("ul");t.className="toc-main-list",this.container.appendChild(t);let u=null,l=null;n.forEach(h=>{const y=h.html.match(/^<h(\d)>(.*?)<\/h\d>/i),w=h.label.endsWith("-name");if(y||w){let S=y?parseInt(y[1]):4,q=h.segment.replace(/<[^>]*>?/gm,"").trim();if(!q&&!w)return;if(S===1){const T=this._createTocItem(h,"Giới Bổn","level-title");t.appendChild(T),u=null,l=null}else if(S===2){const T=this._createTocItem(h,q,"level-h2");t.appendChild(T),u=T,l=null}else if(S===3){const T=this._createTocItem(h,q,"level-h3");t.appendChild(T),u=T,l=null}else if((S===4||w)&&u){l||(l=document.createElement("ul"),l.className="toc-rule-list",u.appendChild(l));let T=q;const F=q.match(/^(\d+)\./)||q.match(/^(\d+)$/)||q.match(/(\d+)$/);if(F)T=F[1];else{const x=h.label.match(/([a-z]+)(\d+)-name/i);x&&(T=x[2])}T.length>3&&(T=T.substring(0,3));const O=document.createElement("li");O.className="toc-rule-item";const H=document.createElement("a");H.className="toc-link rule-link",H.href=`#segment-${h.id}`,H.textContent=T,H.title=q,H.onclick=x=>this._handleLinkClick(x,h.id,H),O.appendChild(H),l.appendChild(O)}}}),this._setupToggle()}_createTocItem(n,t,u){const l=document.createElement("li");l.className=`toc-item ${u}`;const h=document.createElement("a");return h.className="toc-link",h.href=`#segment-${n.id}`,h.textContent=t,h.onclick=y=>this._handleLinkClick(y,n.id,h),l.appendChild(h),l}_handleLinkClick(n,t,u){n.preventDefault(),this._scrollTo(t),this._setActive(u)}_scrollTo(n){const t=document.querySelector(`.segment[data-id="${n}"]`);t&&(t.scrollIntoView({block:"start"}),window.innerWidth<=1024&&this.sidebar&&this.sidebar.classList.remove("visible"))}_setActive(n){this.container&&this.container.querySelectorAll(".toc-link").forEach(t=>t.classList.remove("active")),n.classList.add("active"),this.activeLink=n}_setupToggle(){if(!this.toggle)return;const n=this.toggle.cloneNode(!0);this.toggle.parentNode.replaceChild(n,this.toggle),this.toggle=n,this.toggle.addEventListener("click",()=>{this.sidebar.classList.toggle("visible")}),document.addEventListener("click",t=>{window.innerWidth<=1024&&this.sidebar&&!this.sidebar.contains(t.target)&&!this.toggle.contains(t.target)&&this.sidebar.classList.contains("visible")&&this.sidebar.classList.remove("visible")})}}class Ms{constructor(n){this.callbacks=n}create(n,t){const u=document.createElement("div");u.className="segment",u.dataset.id=n.id,u.dataset.label=n.label,u.dataset.index=t,u.addEventListener("mouseenter",()=>{this.callbacks.onHover&&this.callbacks.onHover(n.id)}),this._applyClasses(u,n);const l=document.createElement("div");return l.className="segment-content-wrapper",this._addPlayButtons(l,n,t),this._addTextContent(l,n),u.appendChild(l),this._addMaskToggle(u,n),u}_applyClasses(n,t){t.label.endsWith("-name")?n.classList.add("rule-header"):t.label.endsWith("-chapter")?n.classList.add("chapter-header"):t.label==="title"&&n.classList.add("main-title"),t.html&&t.html.match(/^<h[1-6]/i)&&n.classList.add("heading-segment"),t.html&&t.html.match(/class=['"](endsection|endvagga|endsutta|sadhu|namo)['"]/)&&n.classList.add("end-segment")}_addPlayButtons(n,t,u){if(t.audio&&t.audio!=="skip"){const l=document.createElement("button");l.className="play-btn icon-btn",l.innerHTML='<i class="fas fa-circle"></i>',l.title="Nghe đoạn này",l.onclick=h=>{h.stopPropagation(),this.callbacks.playSegment&&this.callbacks.playSegment(t.id,t.audio,t.segment)},n.appendChild(l)}if(t.html&&t.html.match(/^<h[1-6]/i)&&t.label!=="title"&&t.label!=="subtitle"){const l=document.createElement("button");l.className="play-btn icon-btn play-sequence-btn",l.innerHTML='<i class="fas fa-play-circle"></i>',l.title="Nghe toàn bộ phần này",l.onclick=h=>{h.stopPropagation(),this.callbacks.playSequence&&this.callbacks.playSequence(u)},n.appendChild(l)}}_addTextContent(n,t){const u=document.createElement("div");u.className="segment-text";const h=(t.html||"{}").replace("{}",t.segment||"");u.innerHTML=h,n.appendChild(u)}_addMaskToggle(n,t){const u=t.html&&t.html.match(/^<h[1-6]/i)&&t.label!=="title"&&t.label!=="subtitle";if(t.audio&&t.audio!=="skip"||u){const h=document.createElement("div");h.className="segment-mask-toggle",h.title="Nhấp để che/hiện text",this.callbacks.onMaskStart&&(h.addEventListener("mousedown",y=>this.callbacks.onMaskStart(y,n,t)),h.addEventListener("touchstart",y=>this.callbacks.onMaskStart(y,n,t),{passive:!1})),this.callbacks.onMaskEnter&&h.addEventListener("mouseenter",y=>this.callbacks.onMaskEnter(y,n)),n.appendChild(h)}}}class Us{constructor(n){this.container=n,this.items=[],this.isDraggingMask=!1,this.dragMaskAction=null,this.lastActionTime=0,this.cooldownMs=250,this._setupGlobalListeners()}setItems(n){this.items=n}_setupGlobalListeners(){const n=()=>{this.isDraggingMask=!1,this.dragMaskAction=null};document.addEventListener("mouseup",n),document.addEventListener("touchend",n)}_isHeading(n){return n.html&&n.html.match(/^<h[1-6]/i)&&n.label!=="title"&&n.label!=="subtitle"}toggleMask(n,t){const u=Date.now();if(u-this.lastActionTime<this.cooldownMs)return;this.lastActionTime=u;const l=n.querySelector(".segment-text");if(!l)return;if(this._isHeading(t)){this._toggleHeadingMask(n,t);return}const h=l.classList.contains("masked");this._applyMaskAction(l,h?"unmask":"mask")}handleMaskStart(n,t,u){const l=Date.now();if(l-this.lastActionTime<this.cooldownMs){n&&n.cancelable&&n.preventDefault();return}this.lastActionTime=l,n&&n.cancelable&&n.preventDefault(),this.isDraggingMask=!0;const h=t.querySelector(".segment-text");if(this._isHeading(u)){this._toggleHeadingMask(t,u);return}const y=h.classList.contains("masked");this.dragMaskAction=y?"unmask":"mask",this._applyMaskAction(h,this.dragMaskAction)}handleMaskEnter(n,t){if(!this.isDraggingMask||!this.dragMaskAction)return;const u=t.dataset.id,l=this.items.find(y=>String(y.id)===String(u));if(l&&this._isHeading(l))return;const h=t.querySelector(".segment-text");this._applyMaskAction(h,this.dragMaskAction)}_applyMaskAction(n,t){t==="mask"?n.classList.add("masked"):n.classList.remove("masked")}_toggleHeadingMask(n,t){const u=parseInt(n.dataset.index),l=t.html.match(/^<h(\d)>/i);if(!l)return;const h=parseInt(l[1]);let y="mask";for(let w=u+1;w<this.items.length;w++){const S=this.items[w];if(S.label==="end")break;const q=S.html?S.html.match(/^<h(\d)>/i):null;if(q){if(parseInt(q[1])<=h)break;continue}const T=this._findElement(S.id);if(T){const F=T.querySelector(".segment-text");if(F){y=F.classList.contains("masked")?"unmask":"mask";break}}}for(let w=u+1;w<this.items.length;w++){const S=this.items[w];if(S.label==="end")break;const q=S.html?S.html.match(/^<h(\d)>/i):null;if(q){if(parseInt(q[1])<=h)break;continue}const T=this._findElement(S.id);if(T){const F=T.querySelector(".segment-text");F&&this._applyMaskAction(F,y)}}}_findElement(n){return this.container.querySelector(`.segment[data-id="${n}"]`)}}class Hs{constructor(n,t,u){this.container=document.getElementById(n),this.playSegmentCallback=t,this.playSequenceCallback=u,this.items=[],this.hoveredSegmentId=null,this.maskManager=new Us(this.container),this.segmentFactory=new Ms({playSegment:this.playSegmentCallback,playSequence:l=>this._handlePlaySequence(l),onMaskStart:(l,h,y)=>this.maskManager.handleMaskStart(l,h,y),onMaskEnter:(l,h)=>this.maskManager.handleMaskEnter(l,h),onHover:l=>{this.hoveredSegmentId=l}}),this._setupKeyboardListeners()}_setupKeyboardListeners(){document.addEventListener("keydown",n=>{if(n.target.tagName==="INPUT"||n.target.tagName==="SELECT")return;const t=n.key.toLowerCase();t==="r"?this._handleKeyboardPlay():t==="f"&&this._handleKeyboardFlip()})}render(n){if(!this.container)return;if(this.container.innerHTML="",this.items=n||[],this.maskManager.setItems(this.items),!this.items||this.items.length===0){this.container.innerHTML='<div class="empty">Không có dữ liệu hiển thị.</div>';return}let t=null,u=null;this.items.forEach((l,h)=>{let y="misc";if(["title","subtitle","nidana"].includes(l.label))y="intro";else if(l.label==="end")y="outro";else if(l.label.startsWith("note-"))y=u||"intro";else{const q=l.label.match(/^([a-z]+)/);q&&(y=q[1])}(y!==u||l.label.endsWith("-chapter")||l.label==="title"||!t)&&(u=y,t=document.createElement("section"),t.className=`section section-${y}`,t.id=`section-${l.label}`,this.container.appendChild(t));const S=this.segmentFactory.create(l,h);t.appendChild(S)})}_handlePlaySequence(n){if(!this.playSequenceCallback)return;const t=this.items[n],u=t.html?t.html.match(/^<h(\d)>/i):null;if(!u)return;const l=parseInt(u[1]),h=[];for(let y=n+1;y<this.items.length;y++){const w=this.items[y];if(w.label==="end")break;const S=w.html?w.html.match(/^<h(\d)>/i):null;if(S&&parseInt(S[1])<=l)break;w.audio&&w.audio!=="skip"&&h.push({id:w.id,audio:w.audio,text:w.segment})}h.length>0?this.playSequenceCallback(h,t.id):alert("Không có dữ liệu âm thanh cho phần này.")}_handleKeyboardPlay(){if(!this.hoveredSegmentId)return;const n=this.items.find(t=>t.id===this.hoveredSegmentId);if(n)if(n.html&&n.html.match(/^<h[1-6]/i)){const t=this.items.indexOf(n);this._handlePlaySequence(t)}else n.audio&&n.audio!=="skip"&&this.playSegmentCallback&&this.playSegmentCallback(n.id,n.audio,n.segment)}_handleKeyboardFlip(){if(!this.hoveredSegmentId)return;const n=this.items.find(u=>u.id===this.hoveredSegmentId);if(!n)return;const t=this.container.querySelector(`.segment[data-id="${this.hoveredSegmentId}"]`);if(t){const u=n.audio&&n.audio!=="skip",l=n.html&&n.html.match(/^<h[1-6]/i)&&n.label!=="title"&&n.label!=="subtitle";(u||l)&&this.maskManager.toggleMask(t,n)}}highlightSegment(n,t=!0){if(!this.container)return;this.container.querySelectorAll(".segment").forEach(l=>l.classList.remove("active"));const u=this.container.querySelector(`.segment[data-id="${n}"]`);u&&(u.classList.add("active"),t&&u.scrollIntoView({behavior:"smooth",block:"center"}))}clearHighlight(){this.container&&this.container.querySelectorAll(".segment").forEach(n=>n.classList.remove("active"))}updatePlaybackState(n,t,u,l){if(this.container.querySelectorAll(".play-btn:not(.play-sequence-btn)").forEach(w=>{w.classList.remove("active-play"),w.innerHTML='<i class="fas fa-circle"></i>',w.title="Nghe đoạn này"}),this.container.querySelectorAll(".play-sequence-btn").forEach(w=>{w.classList.remove("active-play"),w.innerHTML='<i class="fas fa-play-circle"></i>',w.title="Nghe toàn bộ phần này"}),!t||n==="stopped")return;const h=this.container.querySelector(`.segment[data-id="${t}"]`);if(!h)return;const y=h.querySelector(".play-btn:not(.play-sequence-btn)");if(y&&(y.classList.add("active-play"),y.innerHTML=n==="playing"?'<i class="fas fa-pause-circle"></i>':'<i class="fas fa-play-circle"></i>',y.title=n==="playing"?"Tạm dừng":"Tiếp tục"),u&&l){const w=this.container.querySelector(`.segment[data-id="${l}"]`);if(w){const S=w.querySelector(".play-sequence-btn");S&&(S.classList.add("active-play"),S.innerHTML=n==="playing"?'<i class="fas fa-pause-circle"></i>':'<i class="fas fa-play-circle"></i>',S.title=n==="playing"?"Tạm dừng":"Tiếp tục")}}}getFirstVisibleSegmentId(){if(!this.container)return null;const n=this.container.querySelectorAll(".segment");for(const t of n){const u=t.getBoundingClientRect();if(u.top+u.height>80&&u.top<window.innerHeight&&parseInt(t.dataset.id))return parseInt(t.dataset.id)}return null}}class Vs{constructor(n,t,u,l,h){this.playBtn=document.getElementById("play-all-btn"),this.pauseBtn=document.getElementById("pause-btn"),this.stopBtn=document.getElementById("stop-btn"),this.speedSelect=document.getElementById("speed-select"),this.loopBtn=document.getElementById("loop-btn");const y="sutta_loop_enabled",w="tts_rate";if(this.playBtn&&this.playBtn.addEventListener("click",n),this.pauseBtn&&this.pauseBtn.addEventListener("click",t),this.stopBtn&&this.stopBtn.addEventListener("click",u),this.speedSelect){const S=localStorage.getItem(w);S&&(this.speedSelect.value=S),this.speedSelect.addEventListener("change",q=>{const T=parseFloat(q.target.value);localStorage.setItem(w,T),l(T)})}this.loopBtn&&(localStorage.getItem(y)==="true"&&this.loopBtn.classList.add("active"),this.loopBtn.addEventListener("click",()=>{const q=this.loopBtn.classList.toggle("active");localStorage.setItem(y,q),h&&h(q)})),document.addEventListener("keydown",S=>{if(S.target.tagName==="INPUT"||S.target.tagName==="TEXTAREA"||S.target.isContentEditable)return;const q=S.key.toLowerCase();q==="g"&&this.loopBtn&&this.loopBtn.click(),q==="t"&&this._changeSpeedIndex(1,l),q==="e"&&this._changeSpeedIndex(-1,l)})}_changeSpeedIndex(n,t){if(!this.speedSelect)return;const u=this.speedSelect.selectedIndex+n;if(u>=0&&u<this.speedSelect.options.length){this.speedSelect.selectedIndex=u;const l=parseFloat(this.speedSelect.value);localStorage.setItem("tts_rate",l),t&&t(l)}}updateState(n){if(!this.playBtn||!this.pauseBtn||!this.stopBtn)return;const t=this.pauseBtn.querySelector("i");switch(n){case"playing":this.playBtn.disabled=!0,this.pauseBtn.disabled=!1,this.stopBtn.disabled=!1,t&&(t.classList.remove("fa-play"),t.classList.add("fa-pause"));break;case"paused":this.playBtn.disabled=!0,this.pauseBtn.disabled=!1,this.stopBtn.disabled=!1,t&&(t.classList.remove("fa-pause"),t.classList.add("fa-play"));break;case"stopped":this.playBtn.disabled=!1,this.pauseBtn.disabled=!0,this.stopBtn.disabled=!0,t&&(t.classList.remove("fa-play"),t.classList.add("fa-pause"));break}}setSpeed(n){this.speedSelect&&(this.speedSelect.value=n.toString())}}class zs{constructor(n){this.ttsEngine=n,this.modal=document.getElementById("settings-modal"),this.openBtn=document.getElementById("settings-btn"),this.closeBtn=document.querySelector(".close-modal"),this.form=document.getElementById("settings-form"),this.apiKeyInput=document.getElementById("api-key"),this.voiceSelect=document.getElementById("voice-select"),this.refreshVoicesBtn=document.getElementById("refresh-voices-btn"),this._setupListeners()}_setupListeners(){this.openBtn&&this.openBtn.addEventListener("click",n=>{n.preventDefault(),this._open()}),this.closeBtn&&this.closeBtn.addEventListener("click",n=>{n.preventDefault(),this._close()}),this.form&&this.form.addEventListener("submit",n=>{n.preventDefault(),this._save()}),this.refreshVoicesBtn&&this.refreshVoicesBtn.addEventListener("click",n=>{n.preventDefault(),this._loadVoices(!0)}),this.voiceSelect&&this.voiceSelect.addEventListener("change",n=>{this.ttsEngine.setVoice(n.target.value)}),window.addEventListener("click",n=>{n.target===this.modal&&this._close()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!this.modal.classList.contains("hidden")&&this._close()})}_open(){try{this.modal.classList.remove("hidden"),this.ttsEngine&&(this.apiKeyInput&&(this.apiKeyInput.value=this.ttsEngine.getApiKey()||""),this._loadVoices(!1))}catch(n){console.error("Error opening settings modal:",n)}}_close(){this.modal.classList.add("hidden")}_save(){try{const n=this.apiKeyInput?this.apiKeyInput.value.trim():"";this.ttsEngine.setApiKey(n),this._close(),n?this._loadVoices(!0):this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Vui lòng nhập API Key</option>')}catch(n){console.error("Error saving settings:",n)}}async _loadVoices(n){if(!this.ttsEngine||!this.ttsEngine.getApiKey()){this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Vui lòng nhập API Key trước</option>');return}this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Đang tải...</option>'),this.refreshVoicesBtn&&(this.refreshVoicesBtn.disabled=!0,this.refreshVoicesBtn.innerHTML='<i class="fas fa-spin fa-spinner"></i>');try{const t=await this.ttsEngine.getVoices(n);if(this.voiceSelect){this.voiceSelect.innerHTML="";const u=this.ttsEngine.currentVoice,l=u?u.name:"";!t||t.length===0?this.voiceSelect.innerHTML='<option value="" disabled selected>Không tìm thấy giọng tiếng Việt</option>':(t.forEach(h=>{const y=document.createElement("option");y.value=h.name,y.textContent=`${h.name} (${h.ssmlGender})`,h.name===l&&(y.selected=!0),this.voiceSelect.appendChild(y)}),t.length>0&&!t.find(h=>h.name===l)&&(this.voiceSelect.selectedIndex=0,this.ttsEngine.setVoice(t[0].name)))}}catch(t){console.error("Error loading voices:",t),this.voiceSelect&&(this.voiceSelect.innerHTML='<option value="" disabled selected>Lỗi tải giọng</option>')}finally{this.refreshVoicesBtn&&(this.refreshVoicesBtn.disabled=!1,this.refreshVoicesBtn.innerHTML='<i class="fas fa-sync-alt"></i>')}}}const Ks={init(){const o=document.getElementById("btn-toggle-drawer"),n=document.getElementById("filter-drawer");o&&n&&(o.addEventListener("click",t=>{t.stopPropagation(),n.classList.toggle("hidden"),o.classList.toggle("open");const u=document.getElementById("filter-container");u&&u.classList.toggle("expanded")}),document.addEventListener("click",t=>{if(!n.classList.contains("hidden")&&!n.contains(t.target)&&!o.contains(t.target)){n.classList.add("hidden"),o.classList.remove("open");const l=document.getElementById("filter-container");l&&l.classList.remove("expanded")}}),n.addEventListener("click",t=>{t.stopPropagation()}))}},xe={HUE_COEFF:"35deg",SATURATE:"60%",MAX_CSS_LIGHT:.6,MAX_CSS_DARK:.4,STORAGE_KEY_PREFIX:"sutta_sepia_"},Ws={CONFIG:{STORAGE_KEY_THEME:"sutta_theme"},init(){const o=document.getElementById("btn-theme-toggle"),n=o?.querySelector(".icon-moon"),t=o?.querySelector(".icon-sun"),u=document.getElementById("sepia-control-panel"),l=document.getElementById("sepia-slider"),h=document.getElementById("btn-sepia-indicator");document.documentElement.style.setProperty("--sepia-hue-coeff",xe.HUE_COEFF),document.documentElement.style.setProperty("--sepia-saturate",xe.SATURATE);const y=window.matchMedia("(prefers-color-scheme: dark)").matches;let S=localStorage.getItem(this.CONFIG.STORAGE_KEY_THEME)||(y?"dark":"light");const q=x=>`${xe.STORAGE_KEY_PREFIX}${x}`,T=()=>{if(!u)return;u.classList.contains("hidden")?(u.classList.remove("hidden"),h&&h.classList.add("panel-open")):(u.classList.add("hidden"),h&&h.classList.remove("panel-open"))},F=(x,v)=>{const p=v==="dark"?xe.MAX_CSS_DARK:xe.MAX_CSS_LIGHT;return x/100*p},O=(x,v)=>{const p=F(x,v);document.documentElement.style.setProperty("--sepia-val",p),l&&l.value!=x&&(l.value=x),h&&(h.textContent=`${x}%`)},H=x=>{document.documentElement.setAttribute("data-theme",x),localStorage.setItem(this.CONFIG.STORAGE_KEY_THEME,x),S=x,x==="dark"?(n?.classList.add("hidden"),t?.classList.remove("hidden")):(n?.classList.remove("hidden"),t?.classList.add("hidden"));const v=localStorage.getItem(q(x))||0;O(v,x)};H(S),h&&h.addEventListener("click",x=>{x.stopPropagation(),T()}),o&&o.addEventListener("click",()=>{H(S==="light"?"dark":"light"),u&&!u.classList.contains("hidden")&&T()}),l&&(l.addEventListener("input",x=>{const v=x.target.value;O(v,S),localStorage.setItem(q(S),v)}),document.addEventListener("click",x=>{u&&!u.classList.contains("hidden")&&!u.contains(x.target)&&!o.contains(x.target)&&(!h||!h.contains(x.target))&&T()}),u.addEventListener("click",x=>{x.stopPropagation()}))}},$s={MIN_SCALE:.8,MAX_SCALE:2,STEP:.1,DEFAULT_SCALE:1,STORAGE_KEY:"sutta_font_scale",init(){const o=document.getElementById("btn-font-decrease"),n=document.getElementById("btn-font-increase"),t=document.getElementById("font-size-label"),u=localStorage.getItem(this.STORAGE_KEY);let l=u?parseFloat(u):this.DEFAULT_SCALE;this.applyScale(l),o&&o.addEventListener("click",h=>{h.stopPropagation(),l>this.MIN_SCALE&&(l=Math.max(this.MIN_SCALE,l-this.STEP),this.applyScale(l))}),n&&n.addEventListener("click",h=>{h.stopPropagation(),l<this.MAX_SCALE&&(l=Math.min(this.MAX_SCALE,l+this.STEP),this.applyScale(l))}),t&&(t.addEventListener("click",h=>{h.stopPropagation(),l=this.DEFAULT_SCALE,this.applyScale(l)}),t.style.cursor="pointer")},applyScale(o){const n=Math.round(o*10)/10;document.documentElement.style.setProperty("--text-scale",n),localStorage.setItem(this.STORAGE_KEY,n)}};function Qs(){const o=document.getElementById("btn-clear-cache");o&&o.addEventListener("click",async()=>{if(confirm("Bạn có chắc chắn muốn làm mới toàn bộ dữ liệu? Các cấu hình như API Key, font size và tốc độ đọc sẽ được giữ lại.")){o.disabled=!0,o.style.opacity="0.5";try{const l=["google_cloud_api_key","tts_voice_name","tts_rate","sutta_font_scale","sutta_theme","sutta_sepia_light","sutta_sepia_dark","sutta_loop_enabled"],h={};if(l.forEach(y=>{const w=localStorage.getItem(y);w!==null&&(h[y]=w)}),"serviceWorker"in navigator){const y=await navigator.serviceWorker.getRegistrations();for(let w of y)await w.unregister()}if("caches"in window){const y=await caches.keys();await Promise.all(y.map(w=>caches.delete(w)))}indexedDB.databases&&(await indexedDB.databases()).forEach(w=>{w.name&&indexedDB.deleteDatabase(w.name)}),localStorage.clear(),sessionStorage.clear(),Object.entries(h).forEach(([y,w])=>{localStorage.setItem(y,w)}),window.location.reload(!0)}catch(l){console.error("Lỗi khi xóa cache:",l),alert("Đã xảy ra lỗi khi làm mới dữ liệu. Vui lòng thử lại."),o.disabled=!1,o.style.opacity="1"}}});const n=document.getElementById("pwa-toast"),t=document.getElementById("pwa-refresh"),u=document.getElementById("pwa-close");if(n&&t&&u){let l;window.addEventListener("load",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(h=>{l=h,h.addEventListener("updatefound",()=>{const y=h.installing;y.addEventListener("statechange",()=>{y.state==="installed"&&navigator.serviceWorker.controller&&n.classList.remove("hidden")})})})}),t.addEventListener("click",()=>{l&&l.waiting&&l.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload()}),u.addEventListener("click",()=>{n.classList.add("hidden")})}}document.addEventListener("DOMContentLoaded",async()=>{Qs();const o=new Mi,n=new Bs,t=localStorage.getItem("sutta_loop_enabled")==="true";o.isLooping=t,Ks.init(),Ws.init(),$s.init();const u=new Ns("toc-list","sidebar","sidebar-toggle"),l=new Vs(()=>{if(o.isPaused)o.resume();else{const y=h.getFirstVisibleSegmentId(),w=y?n.getSegmentsStartingFrom(y):n.getAllSegments();w.length>0&&o.playSequence(w)}},()=>{o.isPlaying?o.pause():o.isPaused&&o.resume()},()=>{o.stop()},y=>{o.setRate(y)},y=>{o.isLooping=y});l.setSpeed(o.currentRate);const h=new Hs("content",(y,w,S)=>{o.playSegment(y,w,S)},(y,w)=>{o.playSequence(y,w)});new zs(o.engine),o.onSegmentStart=(y,w)=>{h.highlightSegment(y,w),h.updatePlaybackState(o.isPlaying?"playing":"paused",y,w,o.sequenceParentId)},o.onPlaybackEnd=()=>{h.clearHighlight(),l.updateState("stopped"),h.updatePlaybackState("stopped",null,!1,null)},o.onPlaybackStateChange=y=>{l.updateState(y),h.updatePlaybackState(y,o.currentSegmentId,o.isSequence,o.sequenceParentId)};try{const y=await n.load();h.render(y),u.render(y)}catch(y){console.error("Initialization Error:",y),document.getElementById("content").innerHTML='<div class="error">Không thể tải dữ liệu. Vui lòng thử lại sau.</div>'}});
